import{h as L,j as e,r as n,t as l,u as K,i as z,b as _}from"./index-_K5GSRRU.js";import{t as I,u as Q,d as B,f as U}from"./datasources-GxeZw5o7.js";import{u as $,a as A,P as O,T as X,b as Z,c as R,d as G,f as q,e as J,g as H,h as W,i as Y,j as ee,k as se,l as te,E as ae,m as ne,n as re}from"./table-DQPsKraq.js";import{B as v}from"./button-Be4NxNDx.js";import{D as ie,a as le,b as oe,c as V,d as ce}from"./dropdown-menu-B7a3xZ2J.js";import{I as h}from"./input-Dg8YOEYV.js";import{S as de,c as ue}from"./index-BlVUo6r5.js";import{c as me}from"./index-D1_BsMR8.js";import{D as ge}from"./datasource-dialog-CbNUyJ0k.js";import{D as he,a as xe,b as pe,c as fe,d as je}from"./dialog-DFCiCJoT.js";import{L as g}from"./label-BTqj266A.js";import{S as ve}from"./switch-D8q6tN8x.js";import"./index-DtcP887E.js";import"./index-DWLbhSGo.js";import"./index-DGw6FOsd.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ye=L("circle-check",be);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Se=L("circle-x",Ce);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]],we=L("plug",Ne),De=me("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ke({className:a,variant:o,asChild:d=!1,...u}){const c=d?de:"span";return e.jsx(c,{"data-slot":"badge",className:ue(De({variant:o}),a),...u})}function Fe({datasource:a,open:o,onOpenChange:d,onSaved:u}){const[c,x]=n.useState(""),[p,b]=n.useState(""),[y,f]=n.useState("5432"),[j,N]=n.useState(""),[m,w]=n.useState(""),[C,D]=n.useState(""),[S,k]=n.useState(!1),[F,P]=n.useState(!1),[M,r]=n.useState(!1);n.useEffect(()=>{a&&(x(a.name),b(a.host),f(String(a.port)),N(a.database),w(a.username),D(""),k(a.sslEnabled))},[a]);const T=async()=>{if(a){r(!0);try{const s={};c!==a.name&&(s.name=c),p!==a.host&&(s.host=p),Number(y)!==a.port&&(s.port=Number(y)),j!==a.database&&(s.database=j),m!==a.username&&(s.username=m),C&&(s.password=C),S!==a.sslEnabled&&(s.sslEnabled=S),await Q(a.id,s),l.success("DataSource updated"),u()}catch{l.error("Failed to update datasource")}finally{r(!1)}}},E=async()=>{if(a){P(!0);try{const s=await I(a.id);s.success?l.success("Connection successful"):l.error(`Connection failed: ${s.error}`)}catch{l.error("Failed to test connection")}finally{P(!1)}}};return e.jsx(he,{open:o,onOpenChange:d,children:e.jsxs(xe,{className:"sm:max-w-md",children:[e.jsxs(pe,{children:[e.jsx(fe,{children:"Edit DataSource"}),e.jsx(je,{children:"Update the connection settings for this datasource."})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-name",children:"Name"}),e.jsx(h,{id:"edit-ds-name",value:c,onChange:s=>x(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-host",children:"Host"}),e.jsx(h,{id:"edit-ds-host",value:p,onChange:s=>b(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-port",children:"Port"}),e.jsx(h,{id:"edit-ds-port",type:"number",value:y,onChange:s=>f(s.target.value)})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-database",children:"Database"}),e.jsx(h,{id:"edit-ds-database",value:j,onChange:s=>N(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-username",children:"Username"}),e.jsx(h,{id:"edit-ds-username",value:m,onChange:s=>w(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-password",children:"Password"}),e.jsx(h,{id:"edit-ds-password",type:"password",placeholder:"Leave blank to keep current",value:C,onChange:s=>D(s.target.value)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{id:"edit-ds-ssl",checked:S,onCheckedChange:k}),e.jsx(g,{htmlFor:"edit-ds-ssl",children:"Enable SSL"})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(v,{variant:"outline",onClick:E,disabled:F,children:F?"Testing...":"Test Connection"}),e.jsx(v,{onClick:T,disabled:M||!c||!p||!j||!m,children:M?"Saving...":"Save Changes"})]})]})})}function Pe({data:a}){var T,E;const o=K(),[d,u]=n.useState(!1),[c,x]=n.useState(null),[p,b]=n.useState(null),[y,f]=n.useState({}),j=$({mutationFn:async s=>await B(s),onSuccess:()=>{o.invalidateQueries({queryKey:["datasources"]}),l.success("DataSource deleted")},onError:()=>{l.error("Failed to delete datasource")}}),N=async s=>{b(s),f(t=>({...t,[s]:null}));try{const t=await I(s);f(i=>({...i,[s]:t.success})),t.success?l.success("Connection successful"):l.error(`Connection failed: ${t.error}`)}catch{f(t=>({...t,[s]:!1})),l.error("Failed to test connection")}finally{b(null)}},m=[{accessorKey:"name",header:"Name",cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.getValue("name")})},{id:"connection",header:"Connection",cell:({row:s})=>{const t=s.original;return e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.host,":",t.port,"/",t.database]})}},{accessorKey:"username",header:"User",cell:({row:s})=>e.jsx("div",{className:"text-sm",children:s.getValue("username")})},{id:"ssl",header:"SSL",cell:({row:s})=>s.original.sslEnabled?e.jsx(ke,{variant:"secondary",children:"SSL"}):null},{id:"status",header:"Status",cell:({row:s})=>{const t=s.original.id,i=y[t];return p===t?e.jsx(z,{className:"h-4 w-4 animate-spin text-muted-foreground"}):i===!0?e.jsx(ye,{className:"h-4 w-4 text-green-500"}):i===!1?e.jsx(Se,{className:"h-4 w-4 text-red-500"}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"â€”"})}},{accessorKey:"createdAt",header:()=>e.jsx("div",{className:"text-right",children:"Created"}),cell:({row:s})=>{const t=s.getValue("createdAt"),i=te(new Date(t),{includeSeconds:!0,addSuffix:!0});return e.jsx("div",{className:"text-right text-sm",children:i})}},{id:"actions",enableHiding:!1,cell:({row:s})=>{const t=s.original;return e.jsxs(ie,{children:[e.jsx(le,{asChild:!0,children:e.jsxs(v,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ae,{})]})}),e.jsxs(oe,{align:"end",children:[e.jsxs(V,{onClick:i=>{i.stopPropagation(),N(t.id)},children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Test Connection"]}),e.jsxs(V,{onClick:i=>{i.stopPropagation(),x(t)},children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(ce,{}),e.jsxs(V,{className:"text-red-500 focus:text-red-500",onClick:i=>{i.stopPropagation(),j.mutate(t.id)},children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}}],[w,C]=n.useState([]),[D,S]=n.useState([]),[k,F]=n.useState({}),[P,M]=n.useState({}),r=A({data:a,columns:m,onSortingChange:C,onColumnFiltersChange:S,getCoreRowModel:se(),getPaginationRowModel:ee(),getSortedRowModel:Y(),getFilteredRowModel:W(),onColumnVisibilityChange:F,onRowSelectionChange:M,state:{sorting:w,columnFilters:D,columnVisibility:k,rowSelection:P}});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx(h,{placeholder:"Filter by name...",value:((T=r.getColumn("name"))==null?void 0:T.getFilterValue())??"",onChange:s=>{var t;return(t=r.getColumn("name"))==null?void 0:t.setFilterValue(s.target.value)},className:"max-w-sm"}),e.jsxs(v,{onClick:()=>u(!0),className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"New DataSource"]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(X,{children:[e.jsx(Z,{children:r.getHeaderGroups().map(s=>e.jsx(R,{children:s.headers.map(t=>e.jsx(G,{children:t.isPlaceholder?null:q(t.column.columnDef.header,t.getContext())},t.id))},s.id))}),e.jsx(J,{children:(E=r.getRowModel().rows)!=null&&E.length?r.getRowModel().rows.map(s=>e.jsx(R,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(t=>e.jsx(H,{children:q(t.column.columnDef.cell,t.getContext())},t.id))},s.id)):e.jsx(R,{children:e.jsx(H,{colSpan:m.length,className:"h-24 text-center",children:"No datasources yet. Create one to get started."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>r.previousPage(),disabled:!r.getCanPreviousPage(),children:"Previous"}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>r.nextPage(),disabled:!r.getCanNextPage(),children:"Next"})]})]}),e.jsx(ge,{open:d,onOpenChange:u,onCreated:()=>{u(!1),o.invalidateQueries({queryKey:["datasources"]})}}),e.jsx(Fe,{datasource:c,open:c!==null,onOpenChange:s=>{s||x(null)},onSaved:()=>{x(null),o.invalidateQueries({queryKey:["datasources"]})}})]})}function $e(){const{data:a=[],isLoading:o,isError:d}=_({queryKey:["datasources"],queryFn:U});return o?e.jsx("div",{className:"flex flex-col items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Loading datasources..."})}):d?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("p",{className:"text-red-500 text-lg",children:"Failed to load datasources."}),e.jsx("p",{className:"text-gray-400",children:"Please try again later."})]}):e.jsx("div",{className:"p-4",children:e.jsx(Pe,{data:a})})}export{$e as default};
