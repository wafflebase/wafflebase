import{r as u,j as e,t as I}from"./index-DZ-om21y.js";import{B as L}from"./button-BOepPbA9.js";import{u as $,c as G}from"./index-CWwJWUS2.js";import{c as J,a as B,d as Q}from"./index-D7tJshVi.js";import{f as W,P as X,h as Y}from"./dropdown-menu-Cgle8vtg.js";import{u as Z}from"./index-Dzx5yyGq.js";import{C as U,S as T,a as M,b as _,c as F,d as E}from"./select-BhQz1P17.js";import{I as K}from"./input-Ce4ngwRr.js";import{L as S}from"./label-CGM9vF0G.js";import{c as ee,S as A}from"./IconDotsVertical-rcee167H.js";import{r as se,I as te,p as ne,f as re,g as ae}from"./sheet-view-DeS6Ogvs.js";import{I as oe}from"./IconX-CO2qi14K.js";import"./index-C3PGvg8m.js";import"./use-mobile-sheet-gestures-BylpA5u-.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ie=ee("outline","chart-line","IconChartLine",[["path",{d:"M4 19l16 0",key:"svg-0"}],["path",{d:"M4 15l4 -6l4 2l4 -5l4 4",key:"svg-1"}]]),P="Checkbox",[ce,Ee]=J(P),[le,de]=ce(P),O=u.forwardRef((r,t)=>{const{__scopeCheckbox:o,name:h,checked:d,defaultChecked:c,required:x,disabled:l,value:i="on",onCheckedChange:k,form:p,...j}=r,[m,f]=u.useState(null),y=$(t,n=>f(n)),N=u.useRef(!1),w=m?p||!!m.closest("form"):!0,[b=!1,v]=W({prop:d,defaultProp:c,onChange:k}),s=u.useRef(b);return u.useEffect(()=>{const n=m==null?void 0:m.form;if(n){const a=()=>v(s.current);return n.addEventListener("reset",a),()=>n.removeEventListener("reset",a)}},[m,v]),e.jsxs(le,{scope:o,state:b,disabled:l,children:[e.jsx(X.button,{type:"button",role:"checkbox","aria-checked":C(b)?"mixed":b,"aria-required":x,"data-state":q(b),"data-disabled":l?"":void 0,disabled:l,value:i,...j,ref:y,onKeyDown:B(r.onKeyDown,n=>{n.key==="Enter"&&n.preventDefault()}),onClick:B(r.onClick,n=>{v(a=>C(a)?!0:!a),w&&(N.current=n.isPropagationStopped(),N.current||n.stopPropagation())})}),w&&e.jsx(ue,{control:m,bubbles:!N.current,name:h,value:i,checked:b,required:x,disabled:l,form:p,style:{transform:"translateX(-100%)"},defaultChecked:C(c)?!1:c})]})});O.displayName=P;var H="CheckboxIndicator",V=u.forwardRef((r,t)=>{const{__scopeCheckbox:o,forceMount:h,...d}=r,c=de(H,o);return e.jsx(Y,{present:h||C(c.state)||c.state===!0,children:e.jsx(X.span,{"data-state":q(c.state),"data-disabled":c.disabled?"":void 0,...d,ref:t,style:{pointerEvents:"none",...r.style}})})});V.displayName=H;var ue=r=>{const{control:t,checked:o,bubbles:h=!0,defaultChecked:d,...c}=r,x=u.useRef(null),l=Z(o),i=Q(t);u.useEffect(()=>{const p=x.current,j=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(j,"checked").set;if(l!==o&&f){const y=new Event("click",{bubbles:h});p.indeterminate=C(o),f.call(p,C(o)?!1:o),p.dispatchEvent(y)}},[l,o,h]);const k=u.useRef(C(o)?!1:o);return e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:d??k.current,...c,tabIndex:-1,ref:x,style:{...r.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function C(r){return r==="indeterminate"}function q(r){return C(r)?"indeterminate":r?"checked":"unchecked"}var me=O,xe=V;function pe({className:r,...t}){return e.jsx(me,{"data-slot":"checkbox",className:G("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",r),...t,children:e.jsx(xe,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(U,{className:"size-3.5"})})})}function Ae({root:r,chart:t,open:o,onClose:h,onUpdateChart:d,getSelectionRange:c}){var v;const[x,l]=u.useState("");u.useEffect(()=>{l((t==null?void 0:t.sourceRange)||"")},[t==null?void 0:t.id,t==null?void 0:t.sourceRange]);const i=t?se(r,t):{columns:[],xAxisColumn:null,seriesColumns:[]};if(!o||!t)return null;const k=((v=r.tabs[t.sourceTabId])==null?void 0:v.name)||t.sourceTabId,p=i.xAxisColumn,j=i.columns.filter(s=>s.column!==p),m=new Set(i.seriesColumns),f=s=>{const n=ne(s);if(!n){I.error("Enter a valid A1 range like A1:D20.");return}const a=n[1].r-n[0].r+1,g=n[1].c-n[0].c+1;if(a<2||g<2){I.error("Data range must include at least 2 rows and 2 columns.");return}const D=re(n),R=ae(n),z={sourceRange:D,seriesColumns:R.seriesColumns};R.xAxisColumn&&(z.xAxisColumn=R.xAxisColumn),d(t.id,z),l(D)},y=s=>{s.key==="Enter"&&(s.preventDefault(),f(x))},N=()=>{const s=c();if(!s){I.error("Select a cell range first.");return}l(s),f(s)},w=s=>{const n=i.columns.map(g=>g.column).filter(g=>g!==s);let a=i.seriesColumns.filter(g=>n.includes(g));a.length===0&&(a=n.slice(0,1)),d(t.id,{xAxisColumn:s,seriesColumns:a})},b=(s,n)=>{const a=new Set(i.seriesColumns);n?a.add(s):a.delete(s),d(t.id,{seriesColumns:Array.from(a)})};return e.jsxs("aside",{className:"absolute inset-y-0 right-0 z-20 flex w-80 flex-col overflow-hidden border-l bg-background shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Chart editor"}),e.jsxs("p",{className:"truncate text-xs text-muted-foreground",children:["Source: ",k]})]}),e.jsx("button",{type:"button",className:"inline-flex h-7 w-7 items-center justify-center rounded-md text-muted-foreground hover:bg-muted hover:text-foreground",onClick:h,"aria-label":"Close chart editor",children:e.jsx(oe,{size:16})})]}),e.jsxs("div",{className:"min-h-0 flex-1 space-y-4 overflow-y-auto overscroll-contain p-4 pb-6",children:[e.jsxs("section",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"chart-title",children:"Chart title"}),e.jsx(K,{id:"chart-title",value:t.title||"",onChange:s=>d(t.id,{title:s.target.value}),placeholder:"Chart"})]}),e.jsx(A,{}),e.jsxs("section",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"chart-type",children:"Chart type"}),e.jsxs(T,{value:t.type,onValueChange:s=>{d(t.id,{type:s})},children:[e.jsx(M,{id:"chart-type",className:"w-full",children:e.jsx(_,{})}),e.jsxs(F,{children:[e.jsx(E,{value:"bar",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(te,{size:14}),"Bar chart"]})}),e.jsx(E,{value:"line",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ie,{size:14}),"Line chart"]})})]})]})]}),e.jsx(A,{}),e.jsxs("section",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"chart-range",children:"Data range"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{id:"chart-range",value:x,onChange:s=>l(s.target.value),onKeyDown:y,placeholder:"A1:D20"}),e.jsx(L,{type:"button",variant:"outline",size:"sm",onClick:()=>f(x),children:"Apply"})]}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",className:"px-0",onClick:N,children:"Use selected range"})]}),e.jsx(A,{}),e.jsxs("section",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"chart-x-axis",children:"X-axis"}),i.columns.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"Set a valid range to configure X-axis and series."}):e.jsxs(T,{value:p||"",onValueChange:w,children:[e.jsx(M,{id:"chart-x-axis",className:"w-full",children:e.jsx(_,{})}),e.jsx(F,{children:i.columns.map(s=>e.jsxs(E,{value:s.column,children:[s.column," - ",s.label]},s.column))})]})]}),e.jsxs("section",{className:"space-y-2",children:[e.jsx(S,{children:"Series"}),j.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"No series columns available for this range."}):e.jsx("div",{className:"space-y-2",children:j.map(s=>e.jsxs("label",{className:"flex cursor-pointer items-center justify-between rounded-sm border px-2 py-1.5 hover:bg-muted/40",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium",children:s.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.column})]}),e.jsx(pe,{checked:m.has(s.column),onCheckedChange:n=>b(s.column,n===!0)})]},s.column))})]})]})]})}export{Ae as ChartEditorPanel};
