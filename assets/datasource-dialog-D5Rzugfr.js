import{r as a,j as e,t,i as x}from"./index-DBW_otBA.js";import{D as $,a as A,b as M,c as Q,d as R}from"./dialog-XG_4Ukgs.js";import{B as T}from"./button-j48SJuig.js";import{I as n}from"./input-oNzUkWfu.js";import{L as r}from"./label-rWZvJIm1.js";import{S as q}from"./switch-M0bJBBgp.js";import{c as k,t as I}from"./datasources-BB42eeJ-.js";function X({open:L,onOpenChange:j,onCreated:H}){const[i,f]=a.useState(""),[o,v]=a.useState("localhost"),[h,S]=a.useState("5432"),[l,b]=a.useState(""),[c,C]=a.useState(""),[m,D]=a.useState(""),[g,N]=a.useState(!1),[w,d]=a.useState(!1),[y,u]=a.useState(!1),[F,p]=a.useState(null),E=()=>{f(""),v("localhost"),S("5432"),b(""),C(""),D(""),N(!1),p(null)},U=async()=>{u(!0);try{const s=await k({name:i,host:o,port:Number(h),database:l,username:c,password:m,sslEnabled:g});p(s.id),t.success("DataSource created"),H(s),E(),j(!1)}catch(s){if(x(s))return;t.error("Failed to create datasource")}finally{u(!1)}},B=async()=>{if(!F){u(!0);try{const s=await k({name:i||"Untitled",host:o,port:Number(h),database:l,username:c,password:m,sslEnabled:g});p(s.id),d(!0);const P=await I(s.id);P.success?t.success("Connection successful"):t.error(`Connection failed: ${P.error}`)}catch(s){if(x(s))return;t.error("Failed to test connection")}finally{u(!1),d(!1)}return}d(!0);try{const s=await I(F);s.success?t.success("Connection successful"):t.error(`Connection failed: ${s.error}`)}catch(s){if(x(s))return;t.error("Failed to test connection")}finally{d(!1)}};return e.jsx($,{open:L,onOpenChange:s=>{s||E(),j(s)},children:e.jsxs(A,{className:"sm:max-w-md",children:[e.jsxs(M,{children:[e.jsx(Q,{children:"New DataSource Connection"}),e.jsx(R,{children:"Connect to an external PostgreSQL database."})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"ds-name",children:"Name"}),e.jsx(n,{id:"ds-name",placeholder:"My Database",value:i,onChange:s=>f(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"ds-host",children:"Host"}),e.jsx(n,{id:"ds-host",placeholder:"localhost",value:o,onChange:s=>v(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"ds-port",children:"Port"}),e.jsx(n,{id:"ds-port",type:"number",value:h,onChange:s=>S(s.target.value)})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"ds-database",children:"Database"}),e.jsx(n,{id:"ds-database",placeholder:"mydb",value:l,onChange:s=>b(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"ds-username",children:"Username"}),e.jsx(n,{id:"ds-username",placeholder:"postgres",value:c,onChange:s=>C(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"ds-password",children:"Password"}),e.jsx(n,{id:"ds-password",type:"password",value:m,onChange:s=>D(s.target.value)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{id:"ds-ssl",checked:g,onCheckedChange:N}),e.jsx(r,{htmlFor:"ds-ssl",children:"Enable SSL"})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(T,{variant:"outline",onClick:B,disabled:w||!o||!l,children:w?"Testing...":"Test Connection"}),e.jsx(T,{onClick:U,disabled:y||!i||!o||!l||!c,children:y?"Saving...":"Save"})]})]})})}export{X as D};
