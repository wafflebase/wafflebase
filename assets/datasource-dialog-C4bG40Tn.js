import{r as a,j as e}from"./vendor-react-Bg6UneQK.js";import{D as $,a as A,b as M,c as Q,d as R}from"./dialog-CFv6VfMI.js";import{B as T}from"./button-DWQ-sR7I.js";import{I as o}from"./input-BEpJFSyN.js";import{L as r}from"./label-CmhopHze.js";import{S as q}from"./switch-C-9wTfxy.js";import{c as k,t as I}from"./datasources-DS3gjpbF.js";import{i as x}from"./index-Nxuj8kAe.js";import{t}from"./vendor-ui-DUghwSYy.js";function Z({open:L,onOpenChange:f,onCreated:H}){const[i,j]=a.useState(""),[n,v]=a.useState("localhost"),[h,S]=a.useState("5432"),[l,b]=a.useState(""),[c,C]=a.useState(""),[m,D]=a.useState(""),[g,N]=a.useState(!1),[w,d]=a.useState(!1),[y,u]=a.useState(!1),[F,p]=a.useState(null),E=()=>{j(""),v("localhost"),S("5432"),b(""),C(""),D(""),N(!1),p(null)},U=async()=>{u(!0);try{const s=await k({name:i,host:n,port:Number(h),database:l,username:c,password:m,sslEnabled:g});p(s.id),t.success("DataSource created"),H(s),E(),f(!1)}catch(s){if(x(s))return;t.error("Failed to create datasource")}finally{u(!1)}},B=async()=>{if(!F){u(!0);try{const s=await k({name:i||"Untitled",host:n,port:Number(h),database:l,username:c,password:m,sslEnabled:g});p(s.id),d(!0);const P=await I(s.id);P.success?t.success("Connection successful"):t.error(`Connection failed: ${P.error}`)}catch(s){if(x(s))return;t.error("Failed to test connection")}finally{u(!1),d(!1)}return}d(!0);try{const s=await I(F);s.success?t.success("Connection successful"):t.error(`Connection failed: ${s.error}`)}catch(s){if(x(s))return;t.error("Failed to test connection")}finally{d(!1)}};return e.jsx($,{open:L,onOpenChange:s=>{s||E(),f(s)},children:e.jsxs(A,{className:"sm:max-w-md",children:[e.jsxs(M,{children:[e.jsx(Q,{children:"New DataSource Connection"}),e.jsx(R,{children:"Connect to an external PostgreSQL database."})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"ds-name",children:"Name"}),e.jsx(o,{id:"ds-name",placeholder:"My Database",value:i,onChange:s=>j(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(r,{htmlFor:"ds-host",children:"Host"}),e.jsx(o,{id:"ds-host",placeholder:"localhost",value:n,onChange:s=>v(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"ds-port",children:"Port"}),e.jsx(o,{id:"ds-port",type:"number",value:h,onChange:s=>S(s.target.value)})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"ds-database",children:"Database"}),e.jsx(o,{id:"ds-database",placeholder:"mydb",value:l,onChange:s=>b(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"ds-username",children:"Username"}),e.jsx(o,{id:"ds-username",placeholder:"postgres",value:c,onChange:s=>C(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(r,{htmlFor:"ds-password",children:"Password"}),e.jsx(o,{id:"ds-password",type:"password",value:m,onChange:s=>D(s.target.value)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{id:"ds-ssl",checked:g,onCheckedChange:N}),e.jsx(r,{htmlFor:"ds-ssl",children:"Enable SSL"})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(T,{variant:"outline",onClick:B,disabled:w||!n||!l,children:w?"Testing...":"Test Connection"}),e.jsx(T,{onClick:U,disabled:y||!i||!n||!l||!c,children:y?"Saving...":"Save"})]})]})})}export{Z as D};
