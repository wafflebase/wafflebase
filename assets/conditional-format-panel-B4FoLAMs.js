import{r as d,j as e}from"./vendor-react-Bg6UneQK.js";import"./sheet-formula-BihcRaRR.js";import{e as S,b as z}from"./sheet-core-BVN2RP5L.js";import{t as T}from"./vendor-ui-DUghwSYy.js";import{B as g}from"./button-DWQ-sR7I.js";import{I as y}from"./input-BEpJFSyN.js";import{L as v}from"./label-CmhopHze.js";import{S as V}from"./IconDotsVertical-CWmuc0X_.js";import{a as G,T as C,c as X,d as q,e as H,h as A,i as J,j as K,B as Q}from"./sheet-view-BdwUJOPD.js";import{D as E,a as M,b as D}from"./dropdown-menu-CQO2mrpo.js";import{S as W,a as Z,b as ee,c as te,d as se}from"./select-CwTFhjuc.js";import{I as O}from"./IconX-ZR7dAakE.js";import{I as ne}from"./IconPlus-C0ELPC2K.js";import"./index-3UDGtr2f.js";import"./utils-DjqsqOe8.js";import"./index-BkvZ3w4z.js";import"./vendor-app-HGRjaN7r.js";import"./vendor-yorkie-DqSL832E.js";import"./use-mobile-sheet-gestures-D5cbSotk.js";const b={isEmpty:"Is empty",isNotEmpty:"Is not empty",textContains:"Text contains",greaterThan:"Greater than",between:"Is between",dateBefore:"Date before",dateAfter:"Date after"},ae=Object.entries(b).map(([n,l])=>({value:n,label:l}));function w(n){const l=n.toUpperCase().replace(/\$/g,"").split(":").map(c=>c.trim()).filter(Boolean);if(l.length!==2)return null;try{const c=z(l[0]),m=z(l[1]);return[{r:Math.min(c.r,m.r),c:Math.min(c.c,m.c)},{r:Math.max(c.r,m.r),c:Math.max(c.c,m.c)}]}catch{return null}}function $(n){return`${S(n[0])}:${S(n[1])}`}function re(n){return n.op==="between"?`${b[n.op]} ${n.value??""} and ${n.value2??""}`.trim():n.op==="isEmpty"||n.op==="isNotEmpty"?b[n.op]:`${b[n.op]} ${n.value??""}`.trim()}function B(n){return n==="textContains"||n==="greaterThan"||n==="dateBefore"||n==="dateAfter"}function le(n){const l=[];return n.style.b&&l.push("B"),n.style.i&&l.push("I"),n.style.u&&l.push("U"),n.style.tc&&l.push("Text"),n.style.bg&&l.push("Fill"),l.length>0?l.join(" · "):"No style"}function ke({spreadsheet:n,open:l,onClose:c,getSelectionRange:m}){const[i,R]=d.useState([]),[f,j]=d.useState(null),[k,N]=d.useState("");d.useEffect(()=>{if(!l||!n)return;const t=n.getConditionalFormats();R(t),j(a=>{var o;return a&&t.some(r=>r.id===a)?a:((o=t[0])==null?void 0:o.id)??null})},[l,n]);const s=d.useMemo(()=>i.find(t=>t.id===f),[i,f]);d.useEffect(()=>{N(s?$(s.range):"")},[f,s]);const p=d.useCallback(t=>{R(t),n&&n.setConditionalFormats(t)},[n]),u=d.useCallback((t,a)=>{const o=i.map(r=>r.id===t?{...r,...a}:r);p(o)},[p,i]),x=d.useCallback((t,a)=>{const o=i.map(r=>{if(r.id!==t)return r;const h={...r.style,...a};return{...r,style:h}});p(o)},[p,i]);if(!l)return null;const F=()=>{const t=m(),o=(t?w(t):null)||[{r:1,c:1},{r:1,c:1}],r={id:`cf-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,range:o,op:"isNotEmpty",style:{bg:"#fff59d"}},h=[...i,r];p(h),j(r.id)},P=t=>{var o;const a=i.filter(r=>r.id!==t);p(a),f===t&&j(((o=a[0])==null?void 0:o.id)??null)},I=(t,a)=>{const o=i.findIndex(_=>_.id===t);if(o<0)return;const r=o+a;if(r<0||r>=i.length)return;const h=[...i],[Y]=h.splice(o,1);h.splice(r,0,Y),p(h)},L=()=>{if(!s)return;const t=w(k);if(!t){T.error("Enter a valid A1 range like A1:D20.");return}u(s.id,{range:t})},U=()=>{const t=m();if(!t){T.error("Select a cell range first.");return}if(N(t),!s)return;const a=w(t);a&&u(s.id,{range:a})};return e.jsxs("aside",{className:"absolute inset-y-0 right-0 z-20 flex w-[26rem] flex-col overflow-hidden border-l bg-background shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-4 py-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{size:16,className:"text-primary"}),e.jsx("p",{className:"text-sm font-semibold",children:"Conditional formatting"})]}),e.jsx("p",{className:"truncate pt-1 text-xs text-muted-foreground",children:"Rules are applied from top to bottom."})]}),e.jsx("button",{type:"button",className:"inline-flex h-7 w-7 items-center justify-center rounded-md text-muted-foreground hover:bg-muted hover:text-foreground",onClick:c,"aria-label":"Close conditional format panel",children:e.jsx(O,{size:16})})]}),e.jsxs("div",{className:"min-h-0 flex-1 space-y-4 overflow-y-auto overscroll-contain p-4 pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Rules"}),e.jsxs(g,{type:"button",size:"sm",className:"gap-1",onClick:F,children:[e.jsx(ne,{size:14}),"Add"]})]}),i.length===0?e.jsx("div",{className:"rounded-lg border border-dashed bg-muted/20 p-4 text-center text-xs text-muted-foreground",children:"Add a rule and choose a range to start formatting."}):e.jsx("div",{className:"space-y-2",children:i.map((t,a)=>e.jsxs("div",{className:`rounded-lg border bg-card px-3 py-2.5 transition ${f===t.id?"border-primary ring-1 ring-primary/20":"hover:border-muted-foreground/30"}`,children:[e.jsx("button",{type:"button",className:"w-full text-left",onClick:()=>j(t.id),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex h-5 min-w-5 items-center justify-center rounded bg-muted px-1 text-[10px] font-semibold",children:a+1}),e.jsx("p",{className:"truncate text-sm font-medium",children:b[t.op]})]}),e.jsx("p",{className:"truncate pt-1 text-xs text-muted-foreground",children:re(t)}),e.jsx("p",{className:"truncate pt-1 text-xs text-muted-foreground",children:$(t.range)})]}),e.jsxs("div",{className:"shrink-0 space-y-1",children:[e.jsxs("div",{className:"flex justify-end gap-1",children:[t.style.tc&&e.jsx("span",{className:"h-3 w-3 rounded border",style:{backgroundColor:t.style.tc}}),t.style.bg&&e.jsx("span",{className:"h-3 w-3 rounded border",style:{backgroundColor:t.style.bg}})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:le(t)})]})]})}),e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-1",children:[e.jsx(g,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7",disabled:a===0,onClick:()=>I(t.id,-1),"aria-label":"Move rule up",children:e.jsx("span",{className:"text-sm leading-none",children:"↑"})}),e.jsx(g,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7",disabled:a===i.length-1,onClick:()=>I(t.id,1),"aria-label":"Move rule down",children:e.jsx("span",{className:"text-sm leading-none",children:"↓"})}),e.jsx(g,{type:"button",variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive",onClick:()=>P(t.id),"aria-label":"Delete rule",children:e.jsx(O,{size:14})})]})]},t.id))}),s&&e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs("section",{className:"space-y-2 rounded-lg border p-3",children:[e.jsx(v,{htmlFor:"cf-apply-range",children:"Apply to range"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{id:"cf-apply-range",value:k,onChange:t=>N(t.target.value),placeholder:"A1:D20"}),e.jsx(g,{type:"button",variant:"outline",size:"sm",onClick:L,children:"Apply"})]}),e.jsx(g,{type:"button",variant:"ghost",size:"sm",className:"h-8 px-2 text-xs",onClick:U,children:"Use selected range"})]}),e.jsxs("section",{className:"space-y-2 rounded-lg border p-3",children:[e.jsx(v,{htmlFor:"cf-operator",children:"Format rules"}),e.jsxs(W,{value:s.op,onValueChange:t=>{const a=t;if(a==="between"){u(s.id,{op:a,value:s.value||"",value2:s.value2||""});return}if(B(a)){u(s.id,{op:a,value:s.value||"",value2:void 0});return}u(s.id,{op:a,value:void 0,value2:void 0})},children:[e.jsx(Z,{id:"cf-operator",className:"w-full",children:e.jsx(ee,{})}),e.jsx(te,{children:ae.map(t=>e.jsx(se,{value:t.value,children:t.label},t.value))})]}),B(s.op)&&e.jsx(y,{value:s.value||"",placeholder:s.op==="textContains"?"Enter text":s.op==="greaterThan"?"Enter number":"YYYY-MM-DD",onChange:t=>u(s.id,{value:t.target.value})}),s.op==="between"&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(y,{value:s.value||"",placeholder:"Min",onChange:t=>u(s.id,{value:t.target.value})}),e.jsx(y,{value:s.value2||"",placeholder:"Max",onChange:t=>u(s.id,{value2:t.target.value})})]})]}),e.jsxs("section",{className:"space-y-3 rounded-lg border p-3",children:[e.jsx(v,{children:"Formatting style"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{pressed:!!s.style.b,size:"sm",className:"h-8 w-8",onPressedChange:()=>x(s.id,{b:!s.style.b}),"aria-label":"Toggle bold",children:e.jsx(X,{size:14})}),e.jsx(C,{pressed:!!s.style.i,size:"sm",className:"h-8 w-8",onPressedChange:()=>x(s.id,{i:!s.style.i}),"aria-label":"Toggle italic",children:e.jsx(q,{size:14})}),e.jsx(C,{pressed:!!s.style.u,size:"sm",className:"h-8 w-8",onPressedChange:()=>x(s.id,{u:!s.style.u}),"aria-label":"Toggle underline",children:e.jsx("span",{className:"text-xs font-semibold underline",children:"U"})}),e.jsxs(E,{children:[e.jsx(M,{asChild:!0,children:e.jsxs("button",{type:"button",className:"inline-flex h-7 w-7 cursor-pointer items-center justify-center rounded-md text-sm hover:bg-muted","aria-label":"Text color",children:[e.jsx(H,{size:16}),e.jsx("span",{className:"absolute mt-5 h-0.5 w-3.5 rounded",style:{backgroundColor:s.style.tc||"#000000"}})]})}),e.jsxs(D,{className:"w-auto p-2",children:[e.jsxs("button",{type:"button",className:"mb-2 flex w-full items-center gap-2 rounded px-2 py-1 text-xs hover:bg-muted",onClick:()=>x(s.id,{tc:void 0}),children:[e.jsx(A,{size:14}),"Reset"]}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:J.map(t=>e.jsx("button",{type:"button",className:"h-5 w-5 rounded border border-border hover:scale-125 transition-transform",style:{backgroundColor:t},onClick:()=>x(s.id,{tc:t}),"aria-label":`Set text color ${t}`},t))})]})]}),e.jsxs(E,{children:[e.jsx(M,{asChild:!0,children:e.jsxs("button",{type:"button",className:"inline-flex h-7 w-7 cursor-pointer items-center justify-center rounded-md text-sm hover:bg-muted","aria-label":"Background color",children:[e.jsx(K,{size:16}),e.jsx("span",{className:"absolute mt-5 h-0.5 w-3.5 rounded",style:{backgroundColor:s.style.bg||"transparent",border:s.style.bg?"none":"1px solid #ccc"}})]})}),e.jsxs(D,{className:"w-auto p-2",children:[e.jsxs("button",{type:"button",className:"mb-2 flex w-full items-center gap-2 rounded px-2 py-1 text-xs hover:bg-muted",onClick:()=>x(s.id,{bg:void 0}),children:[e.jsx(A,{size:14}),"Reset"]}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:Q.map(t=>e.jsx("button",{type:"button",className:"h-5 w-5 rounded border border-border hover:scale-125 transition-transform",style:{backgroundColor:t},onClick:()=>x(s.id,{bg:t}),"aria-label":`Set background color ${t}`},t))})]})]})]})]})]})]})]})}export{ke as ConditionalFormatPanel};
