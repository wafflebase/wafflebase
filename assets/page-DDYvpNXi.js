import{r as n,j as e}from"./vendor-react-Bg6UneQK.js";import{b as I,c as B,d as Q,f as H,g as A,e as U,h as O,i as z,u as $}from"./vendor-app-HGRjaN7r.js";import{t as q,u as X,d as G,f as J}from"./datasources-Dh6UoFfR.js";import{i as b}from"./index-BFdjMAXD.js";import{B as j}from"./button-DWQ-sR7I.js";import{D as W,a as Y,b as Z,c as L,e as _}from"./dropdown-menu-CQO2mrpo.js";import{I as h}from"./input-BEpJFSyN.js";import{T as ee,a as se,b as V,c as te,d as ae,e as K}from"./table-BcaU83pl.js";import{B as ne}from"./badge-D_FUDBc2.js";import{D as re}from"./datasource-dialog-BsOME_7H.js";import{D as ie,a as le,b as oe,c as de,d as ce}from"./dialog-CFv6VfMI.js";import{L as m}from"./label-CmhopHze.js";import{S as ue}from"./switch-C-9wTfxy.js";import{t as l,P as me,L as he,C as xe,c as ge,E as pe,d as fe,a as je,b as Ce}from"./vendor-ui-DUghwSYy.js";import{f as Se}from"./formatDistanceToNow-DXTjigy3.js";import"./http-error-XKKRT0jQ.js";import"./vendor-yorkie-DqSL832E.js";import"./index-3UDGtr2f.js";import"./utils-DjqsqOe8.js";function ve({datasource:a,open:o,onOpenChange:C,onSaved:d}){const[c,x]=n.useState(""),[g,S]=n.useState(""),[v,p]=n.useState("5432"),[f,y]=n.useState(""),[u,D]=n.useState(""),[N,F]=n.useState(""),[w,P]=n.useState(!1),[E,T]=n.useState(!1),[R,i]=n.useState(!1);n.useEffect(()=>{a&&(x(a.name),S(a.host),p(String(a.port)),y(a.database),D(a.username),F(""),P(a.sslEnabled))},[a]);const M=async()=>{if(a){i(!0);try{const s={};c!==a.name&&(s.name=c),g!==a.host&&(s.host=g),Number(v)!==a.port&&(s.port=Number(v)),f!==a.database&&(s.database=f),u!==a.username&&(s.username=u),N&&(s.password=N),w!==a.sslEnabled&&(s.sslEnabled=w),await X(a.id,s),l.success("DataSource updated"),d()}catch(s){if(b(s))return;l.error("Failed to update datasource")}finally{i(!1)}}},k=async()=>{if(a){T(!0);try{const s=await q(a.id);s.success?l.success("Connection successful"):l.error(`Connection failed: ${s.error}`)}catch(s){if(b(s))return;l.error("Failed to test connection")}finally{T(!1)}}};return e.jsx(ie,{open:o,onOpenChange:C,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Edit DataSource"}),e.jsx(ce,{children:"Update the connection settings for this datasource."})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"edit-ds-name",children:"Name"}),e.jsx(h,{id:"edit-ds-name",value:c,onChange:s=>x(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(m,{htmlFor:"edit-ds-host",children:"Host"}),e.jsx(h,{id:"edit-ds-host",value:g,onChange:s=>S(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"edit-ds-port",children:"Port"}),e.jsx(h,{id:"edit-ds-port",type:"number",value:v,onChange:s=>p(s.target.value)})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"edit-ds-database",children:"Database"}),e.jsx(h,{id:"edit-ds-database",value:f,onChange:s=>y(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"edit-ds-username",children:"Username"}),e.jsx(h,{id:"edit-ds-username",value:u,onChange:s=>D(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"edit-ds-password",children:"Password"}),e.jsx(h,{id:"edit-ds-password",type:"password",placeholder:"Leave blank to keep current",value:N,onChange:s=>F(s.target.value)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{id:"edit-ds-ssl",checked:w,onCheckedChange:P}),e.jsx(m,{htmlFor:"edit-ds-ssl",children:"Enable SSL"})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(j,{variant:"outline",onClick:k,disabled:E,children:E?"Testing...":"Test Connection"}),e.jsx(j,{onClick:M,disabled:R||!c||!g||!f||!u,children:R?"Saving...":"Save Changes"})]})]})})}function Ne({data:a}){var M,k;const o=I(),[C,d]=n.useState(!1),[c,x]=n.useState(null),[g,S]=n.useState(null),[v,p]=n.useState({}),f=B({mutationFn:async s=>await G(s),onSuccess:()=>{o.invalidateQueries({queryKey:["datasources"]}),l.success("DataSource deleted")},onError:s=>{b(s)||l.error("Failed to delete datasource")}}),y=async s=>{S(s),p(t=>({...t,[s]:null}));try{const t=await q(s);p(r=>({...r,[s]:t.success})),t.success?l.success("Connection successful"):l.error(`Connection failed: ${t.error}`)}catch(t){if(b(t))return;p(r=>({...r,[s]:!1})),l.error("Failed to test connection")}finally{S(null)}},u=[{accessorKey:"name",header:"Name",cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.getValue("name")})},{id:"connection",header:"Connection",cell:({row:s})=>{const t=s.original;return e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.host,":",t.port,"/",t.database]})}},{accessorKey:"username",header:"User",cell:({row:s})=>e.jsx("div",{className:"text-sm",children:s.getValue("username")})},{id:"ssl",header:"SSL",cell:({row:s})=>s.original.sslEnabled?e.jsx(ne,{variant:"secondary",children:"SSL"}):null},{id:"status",header:"Status",cell:({row:s})=>{const t=s.original.id,r=v[t];return g===t?e.jsx(he,{className:"h-4 w-4 animate-spin text-muted-foreground"}):r===!0?e.jsx(xe,{className:"h-4 w-4 text-green-500"}):r===!1?e.jsx(ge,{className:"h-4 w-4 text-red-500"}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"â€”"})}},{accessorKey:"createdAt",header:()=>e.jsx("div",{className:"text-right",children:"Created"}),cell:({row:s})=>{const t=s.getValue("createdAt"),r=Se(new Date(t),{includeSeconds:!0,addSuffix:!0});return e.jsx("div",{className:"text-right text-sm",children:r})}},{id:"actions",enableHiding:!1,cell:({row:s})=>{const t=s.original;return e.jsxs(W,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(j,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(pe,{})]})}),e.jsxs(Z,{align:"end",children:[e.jsxs(L,{onClick:r=>{r.stopPropagation(),y(t.id)},children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Test Connection"]}),e.jsxs(L,{onClick:r=>{r.stopPropagation(),x(t)},children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(_,{}),e.jsxs(L,{className:"text-red-500 focus:text-red-500",onClick:r=>{r.stopPropagation(),f.mutate(t.id)},children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}}],[D,N]=n.useState([]),[F,w]=n.useState([]),[P,E]=n.useState({}),[T,R]=n.useState({}),i=Q({data:a,columns:u,onSortingChange:N,onColumnFiltersChange:w,getCoreRowModel:z(),getPaginationRowModel:O(),getSortedRowModel:U(),getFilteredRowModel:A(),onColumnVisibilityChange:E,onRowSelectionChange:R,state:{sorting:D,columnFilters:F,columnVisibility:P,rowSelection:T}});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx(h,{placeholder:"Filter by name...",value:((M=i.getColumn("name"))==null?void 0:M.getFilterValue())??"",onChange:s=>{var t;return(t=i.getColumn("name"))==null?void 0:t.setFilterValue(s.target.value)},className:"max-w-sm"}),e.jsxs(j,{onClick:()=>d(!0),className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"New DataSource"]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ee,{children:[e.jsx(se,{children:i.getHeaderGroups().map(s=>e.jsx(V,{children:s.headers.map(t=>e.jsx(te,{children:t.isPlaceholder?null:H(t.column.columnDef.header,t.getContext())},t.id))},s.id))}),e.jsx(ae,{children:(k=i.getRowModel().rows)!=null&&k.length?i.getRowModel().rows.map(s=>e.jsx(V,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(t=>e.jsx(K,{children:H(t.column.columnDef.cell,t.getContext())},t.id))},s.id)):e.jsx(V,{children:e.jsx(K,{colSpan:u.length,className:"h-24 text-center",children:"No datasources yet. Create one to get started."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage(),children:"Previous"}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage(),children:"Next"})]})]}),e.jsx(re,{open:C,onOpenChange:d,onCreated:()=>{d(!1),o.invalidateQueries({queryKey:["datasources"]})}}),e.jsx(ve,{datasource:c,open:c!==null,onOpenChange:s=>{s||x(null)},onSaved:()=>{x(null),o.invalidateQueries({queryKey:["datasources"]})}})]})}function Ae(){const{data:a=[],isLoading:o,isError:C,error:d}=$({queryKey:["datasources"],queryFn:J});return o?e.jsx("div",{className:"flex flex-col items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Loading datasources..."})}):C?b(d)?null:e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("p",{className:"text-red-500 text-lg",children:"Failed to load datasources."}),e.jsx("p",{className:"text-gray-400",children:"Please try again later."})]}):e.jsx("div",{className:"p-4",children:e.jsx(Ne,{data:a})})}export{Ae as default};
