const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/datasource-view-C1ia2zkj.js","assets/index-CxTJ3nta.js","assets/index-BSRlNbdf.css","assets/use-mobile-sheet-gestures-hVF648tn.js","assets/IconDotsVertical-CcvHTmV4.js","assets/dropdown-menu-4OHTKq_5.js","assets/index-BK9teU9k.js","assets/index-DSKFb7Fz.js","assets/button-BmN0yC3r.js","assets/index-CGGkF8la.js","assets/datasources-Dv3OsMzQ.js"])))=>i.map(i=>d[i]);
import{d as x,r as i,j as e,e as u,b as f,y as m,_ as p,f as h}from"./index-CxTJ3nta.js";import{r as j,i as b,I as v}from"./worksheet-eui2VHxX.js";import{S as y}from"./sheet-view-CqlVIe_H.js";import{I as g}from"./IconDotsVertical-CcvHTmV4.js";import"./use-mobile-sheet-gestures-hVF648tn.js";import"./index-BK9teU9k.js";import"./dropdown-menu-4OHTKq_5.js";import"./index-DSKFb7Fz.js";import"./index-CGGkF8la.js";const k=i.lazy(()=>p(()=>import("./datasource-view-C1ia2zkj.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])).then(s=>({default:s.DataSourceView})));function N({resolved:s}){const t=s.role==="viewer",{doc:o}=m.useDocument(),[r,c]=i.useState(null),a=o==null?void 0:o.getRoot(),n=a?(a.tabOrder||[]).map(d=>a.tabs[d]).filter(Boolean):[];if(i.useEffect(()=>{if(a){if(!n.length){c(null);return}(!r||!a.tabs[r])&&c(n[0].id)}},[r,a,n]),!o||!a)return e.jsx(u,{});if(!r)return e.jsx(u,{});const l=a.tabs[r];return e.jsxs("div",{className:"flex h-screen w-full flex-col",children:[e.jsxs("header",{className:"flex h-14 shrink-0 items-center gap-2 border-b px-4",children:[e.jsx("h1",{className:"text-base font-medium",children:s.title}),t&&e.jsx("span",{className:"rounded bg-muted px-2 py-0.5 text-xs text-muted-foreground",children:"View only"})]}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsx(i.Suspense,{fallback:e.jsx(u,{}),children:(l==null?void 0:l.type)==="datasource"?e.jsx(k,{tabId:r,readOnly:t}):e.jsx(y,{tabId:r,readOnly:t})})}),e.jsx("div",{className:"flex items-center border-t bg-muted/30 px-1 h-9 shrink-0 overflow-x-auto",children:n.map(d=>e.jsxs("button",{className:`flex shrink-0 items-center gap-1.5 px-3 py-1 text-sm rounded-t border-b-2 cursor-pointer select-none hover:bg-muted/50 transition-colors ${d.id===r?"border-primary bg-background text-foreground font-medium":"border-transparent text-muted-foreground"}`,onClick:()=>c(d.id),children:[d.type==="datasource"?e.jsx(g,{className:"size-3.5"}):e.jsx(v,{className:"size-3.5"}),e.jsx("span",{children:d.name})]},d.id))})]})]})}function I({resolved:s}){const{data:t}=f({queryKey:["me"],queryFn:h,retry:!1}),o={username:(t==null?void 0:t.username)||"Anonymous",email:(t==null?void 0:t.email)||"",photo:(t==null?void 0:t.photo)||""};return e.jsx(m.YorkieProvider,{rpcAddr:"https://api.yorkie.dev",apiKey:"fbuqYRxotajGGzb3kUD6aX",metadata:{userID:o.username},children:e.jsx(m.DocumentProvider,{docKey:`sheet-${s.documentId}`,initialRoot:b,initialPresence:o,enableDevtools:!1,children:e.jsx(N,{resolved:s})})})}function z(){const{token:s}=x(),[t,o]=i.useState(null),[r,c]=i.useState(null),[a,n]=i.useState(!0);return i.useEffect(()=>{if(!s){c("No share token provided"),n(!1);return}j(s).then(l=>{o(l),n(!1)}).catch(l=>{c(l.message||"Invalid or expired link"),n(!1)})},[s]),a?e.jsx(u,{}):r||!t?e.jsx("div",{className:"flex h-screen w-full items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Link unavailable"}),e.jsx("p",{className:"text-muted-foreground",children:r||"Invalid or expired link"})]})}):e.jsx(I,{resolved:t})}export{z as SharedDocument,z as default};
