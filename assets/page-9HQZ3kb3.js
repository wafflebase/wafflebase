import{r as h,j as s}from"./vendor-react-Bg6UneQK.js";import"./sheet-formula-parser-O5gici2d.js";import"./sheet-formula-eval-WY_DIXm_.js";import{M as x,f as v,b as u,e as d}from"./sheet-core-C_GwcwCL.js";const m="__WB_INTERACTION__";function C(){const r=new Map([["A1",{v:"10"}],["A2",{v:"20"}],["B1",{v:"Manual Input"}],["C1",{v:"Formula Input"}],["D1",{v:"Scroll Marker"}]]);for(let n=2;n<=240;n++)r.set(`D${n}`,{v:`Row ${n}`});return r}function f(r){return r.querySelector("[data-testid='interaction-scroll-container']")||r.querySelector("div[style*='overflow: auto']")}function p(r){const n=r.querySelectorAll("div[contenteditable='true']");for(const o of n){if(o.style.whiteSpace==="nowrap"){o.setAttribute("data-testid","interaction-formula-input");continue}o.style.whiteSpace==="pre"&&o.setAttribute("data-testid","interaction-cell-input")}const a=f(r);a&&a.setAttribute("data-testid","interaction-scroll-container")}function b(r,n,a){const o={isReady:()=>!0,getCell:async t=>{const e=await a.get(u(t));return e?{v:e.v,f:e.f}:null},getActiveCell:()=>{const t=n.getActiveCell();return t?d(t):null},getSelectionRange:()=>{const t=n.getSelectionRangeOrActiveCell();return t?{start:d(t[0]),end:d(t[1])}:null},getFocusTarget:()=>{const t=document.activeElement;if(!t)return"null";const e=t.getAttribute("data-testid"),i=t.getAttribute("contenteditable"),c=[e?`[data-testid=${e}]`:"",i!==null?`[contenteditable=${i}]`:""].filter(Boolean).join("");return`${t.tagName.toLowerCase()}${c}`},getCellInputState:()=>{const t=r.querySelector("[data-testid='interaction-cell-input']");if(!t)return null;const e=t.parentElement;return{value:t.innerText,pointerEvents:(e==null?void 0:e.style.pointerEvents)||"",caretColor:t.style.caretColor}},getFormulaInputState:()=>{const t=r.querySelector("[data-testid='interaction-formula-input']");return t?{value:t.innerText,focused:document.activeElement===t}:null},editViaFormulaBar:async(t,e,i)=>{const c=u(t),l=n;if(!l.sheet)throw new Error("spreadsheet sheet handle is unavailable");await l.sheet.setData(c,e),await n.focusCell(u(i)),p(r);const g=await a.get(c),w=n.getActiveCell();return{activeCell:w?d(w):null,targetCell:g?{v:g.v,f:g.f}:null}},focusCell:async t=>{await n.focusCell(u(t)),p(r)},getScrollContainerCenterClientPoint:()=>{const t=f(r);if(!t)return null;const e=t.getBoundingClientRect();return{x:Math.round(e.left+e.width/2),y:Math.round(e.top+e.height/2)}},getScrollContainerRect:()=>{const t=f(r);if(!t)return null;const e=t.getBoundingClientRect();return{left:e.left,top:e.top,width:e.width,height:e.height}},panBy:(t,e)=>{n.panBy(t,e)},getCellCenterClientPoint:t=>{const e=n.getCellRect(u(t)),i=r.getBoundingClientRect();return{x:Math.round(i.left+e.left+e.width/2),y:Math.round(i.top+e.top+e.height/2)}},getScrollableViewportCenterClientPoint:()=>{const t=n.getScrollableGridViewportRect(),e=r.getBoundingClientRect();return{x:Math.round(e.left+t.left+t.width/2),y:Math.round(e.top+t.top+t.height/2)}},getScrollPosition:()=>{const t=f(r);return{left:(t==null?void 0:t.scrollLeft)||0,top:(t==null?void 0:t.scrollTop)||0}}};return window[m]=o,o}function S(r){const n=window;n[m]===r&&delete n[m]}function M(){const r=h.useRef(null),[n,a]=h.useState("loading");return h.useEffect(()=>{let o=!0,t,e;const i=r.current;if(!i)return;async function c(){a("loading"),i.innerHTML="";try{const l=new x(C());await l.setDimensionSize("column",1,110),await l.setDimensionSize("column",2,160),await l.setDimensionSize("column",3,180),await l.setDimensionSize("column",4,260),t=await v(i,{theme:"light",store:l}),await t.focusCell({r:1,c:1}),p(i),e=b(i,t,l),o&&a("ready")}catch(l){console.error("[interaction-harness] failed to initialize",l),o&&a("error")}}return c(),()=>{o=!1,e&&S(e),t==null||t.cleanup(),i.innerHTML=""}},[]),s.jsx("main",{className:"h-screen overflow-clip bg-muted/20 p-6 md:p-10","data-testid":"interaction-harness-root","data-interaction-harness-ready":n==="ready"?"true":"false","data-interaction-harness-status":n,children:s.jsxs("div",{className:"mx-auto flex h-full w-full max-w-6xl flex-col gap-4",children:[s.jsxs("header",{className:"rounded-xl border bg-card p-5 shadow-sm",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"Wafflebase Harness"}),s.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Frontend Interaction Regression Harness"}),s.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Status:"," ",s.jsxs("span",{"data-testid":"interaction-harness-status",children:[n==="ready"&&"ready",n==="loading"&&"loading",n==="error"&&"error"]})]})]}),s.jsx("section",{className:"flex flex-1 min-h-0 flex-col rounded-xl border bg-background p-3 shadow-sm",children:s.jsx("div",{className:"flex-1 min-h-0 w-full overflow-hidden rounded-md border bg-white","data-testid":"interaction-sheet-host",ref:r})})]})})}export{M as default};
