import{r as a,j as s,t}from"./index-l-AeDemK.js";import{D as B,a as $,b as M,c as Q,d as R}from"./dialog-BtPEO7Pb.js";import{B as P}from"./button-DscdbcCf.js";import{I as n}from"./input-BS40B3dy.js";import{L as r}from"./label-CbMvr8Ka.js";import{S as q}from"./switch-XXdVmE2h.js";import{c as T,t as k}from"./datasources-DTSR1zVv.js";function W({open:I,onOpenChange:x,onCreated:L}){const[c,j]=a.useState(""),[o,f]=a.useState("localhost"),[h,v]=a.useState("5432"),[l,S]=a.useState(""),[i,b]=a.useState(""),[m,C]=a.useState(""),[g,D]=a.useState(!1),[N,d]=a.useState(!1),[w,u]=a.useState(!1),[y,p]=a.useState(null),F=()=>{j(""),f("localhost"),v("5432"),S(""),b(""),C(""),D(!1),p(null)},H=async()=>{u(!0);try{const e=await T({name:c,host:o,port:Number(h),database:l,username:i,password:m,sslEnabled:g});p(e.id),t.success("DataSource created"),L(e),F(),x(!1)}catch{t.error("Failed to create datasource")}finally{u(!1)}},U=async()=>{if(!y){u(!0);try{const e=await T({name:c||"Untitled",host:o,port:Number(h),database:l,username:i,password:m,sslEnabled:g});p(e.id),d(!0);const E=await k(e.id);E.success?t.success("Connection successful"):t.error(`Connection failed: ${E.error}`)}catch{t.error("Failed to test connection")}finally{u(!1),d(!1)}return}d(!0);try{const e=await k(y);e.success?t.success("Connection successful"):t.error(`Connection failed: ${e.error}`)}catch{t.error("Failed to test connection")}finally{d(!1)}};return s.jsx(B,{open:I,onOpenChange:e=>{e||F(),x(e)},children:s.jsxs($,{className:"sm:max-w-md",children:[s.jsxs(M,{children:[s.jsx(Q,{children:"New DataSource Connection"}),s.jsx(R,{children:"Connect to an external PostgreSQL database."})]}),s.jsxs("div",{className:"grid gap-4 py-2",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"ds-name",children:"Name"}),s.jsx(n,{id:"ds-name",placeholder:"My Database",value:c,onChange:e=>j(e.target.value)})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.jsxs("div",{className:"col-span-2 grid gap-2",children:[s.jsx(r,{htmlFor:"ds-host",children:"Host"}),s.jsx(n,{id:"ds-host",placeholder:"localhost",value:o,onChange:e=>f(e.target.value)})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"ds-port",children:"Port"}),s.jsx(n,{id:"ds-port",type:"number",value:h,onChange:e=>v(e.target.value)})]})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"ds-database",children:"Database"}),s.jsx(n,{id:"ds-database",placeholder:"mydb",value:l,onChange:e=>S(e.target.value)})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"ds-username",children:"Username"}),s.jsx(n,{id:"ds-username",placeholder:"postgres",value:i,onChange:e=>b(e.target.value)})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsx(r,{htmlFor:"ds-password",children:"Password"}),s.jsx(n,{id:"ds-password",type:"password",value:m,onChange:e=>C(e.target.value)})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(q,{id:"ds-ssl",checked:g,onCheckedChange:D}),s.jsx(r,{htmlFor:"ds-ssl",children:"Enable SSL"})]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx(P,{variant:"outline",onClick:U,disabled:N||!o||!l,children:N?"Testing...":"Test Connection"}),s.jsx(P,{onClick:H,disabled:w||!c||!o||!l||!i,children:w?"Saving...":"Save"})]})]})})}export{W as D};
