const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/page-CM4Fo3pR.js","assets/vendor-react-Cfrz2cDt.js","assets/sheet-formula-DZaUwnUa.js","assets/sheet-core-BhuO7eOZ.js","assets/utils-DjqsqOe8.js","assets/button-B3uJWaI4.js","assets/vendor-ui-BLL1eQPV.js","assets/index-3UDGtr2f.js","assets/page-D5AMMD9S.js","assets/vendor-app-BPeRYXo6.js","assets/documents-CtwC8s2S.js","assets/http-error-XKKRT0jQ.js","assets/dialog-DKGUKCQ9.js","assets/dropdown-menu-Dd7Q8E-x.js","assets/input-Diu_BS5q.js","assets/label-DxPdzXgu.js","assets/table-SiA-WvNh.js","assets/formatDistanceToNow-DXTjigy3.js","assets/vendor-yorkie-1SCjNPq-.js","assets/document-detail-BUNP3kT1.js","assets/site-header-D4wP4qbQ.js","assets/IconDotsVertical-Dk2Nm298.js","assets/select-EdoZdTB8.js","assets/worksheet-C9pdL5PU.js","assets/IconTrash-CJi-qAZp.js","assets/IconPlus-CBVlO4vy.js","assets/page-BKKY8cib.js","assets/datasources-BqfuoX_K.js","assets/badge-pjze9gdx.js","assets/datasource-dialog-DJNfX4xI.js","assets/switch-BbOFS8Ma.js","assets/shared-document-DhQuJ-IC.js","assets/sheet-view-aJmgykA3.js","assets/use-mobile-sheet-gestures-AhN9-ykn.js","assets/page-B3TawnDU.js","assets/page-BWimimhW.js","assets/page-akIyuql3.js","assets/Layout-fgfHS7GW.js"])))=>i.map(i=>d[i]);
import{j as e,O as w,N as j,r as n,B as R,g as k,h as m,i as O}from"./vendor-react-Cfrz2cDt.js";import{u as v,Q as A,a as b}from"./vendor-app-BPeRYXo6.js";import{L as D,t as I,T as C}from"./vendor-ui-BLL1eQPV.js";import{y as q}from"./vendor-yorkie-1SCjNPq-.js";import"./sheet-formula-DZaUwnUa.js";import"./sheet-core-BhuO7eOZ.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))u(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&u(i)}).observe(document,{childList:!0,subtree:!0});function l(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function u(t){if(t.ep)return;t.ep=!0;const o=l(t);fetch(t.href,o)}})();const z="modulepreload",V=function(r){return"/"+r},E={},f=function(s,l,u){let t=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),d=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));t=Promise.allSettled(l.map(h=>{if(h=V(h),h in E)return;E[h]=!0;const a=h.endsWith(".css"),p=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${p}`))return;const c=document.createElement("link");if(c.rel=a?"stylesheet":z,a||(c.as="script"),c.crossOrigin="",c.href=h,d&&c.setAttribute("nonce",d),document.head.appendChild(c),a)return new Promise((y,S)=>{c.addEventListener("load",y),c.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(i){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=i,window.dispatchEvent(d),!d.defaultPrevented)throw i}return t.then(i=>{for(const d of i||[])d.status==="rejected"&&o(d.reason);return s().catch(o)})},x=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px]","aria-live":"polite",children:[e.jsx(D,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"Loading..."})]});function F(r){let s=null;return async()=>(s||(s=(async()=>{try{return await r()}finally{s=null}})()),s)}class N extends Error{constructor(){super("Session expired"),this.name="AuthExpiredError"}}function ue(r){return r instanceof Error&&r.name==="AuthExpiredError"}let g=!1;function _(){g||(g=!0,window.location.href="/login")}const L=F(async()=>{try{return(await fetch("https://wafflebase-api.yorkie.dev/auth/refresh",{method:"POST",credentials:"include"})).ok}catch{return!1}});async function $(r={}){const{redirect:s=!0,showSuccessToast:l=!0,suppressFailure:u=!1}=r;let t=null;try{t=await fetch("https://wafflebase-api.yorkie.dev/auth/logout",{method:"POST",credentials:"include"})}catch(o){if(!u)throw o}if(t&&!t.ok&&!u)throw new Error("Failed to log out");l&&(t!=null&&t.ok)&&I.success("Logged out successfully"),s&&_()}async function M(){const r=await T("https://wafflebase-api.yorkie.dev/auth/me",{method:"GET",credentials:"include"});if(!r.ok)throw new Error("Failed to fetch user");return r.json()}async function Q(){const r=()=>fetch("https://wafflebase-api.yorkie.dev/auth/me",{method:"GET",credentials:"include"});let s=await r();if(s.status===401&&(!await L()||(s=await r(),s.status===401)))return null;if(!s.ok)throw new Error("Failed to fetch user");return s.json()}async function T(r,s,l=!1){const u=await fetch(r,{...s,credentials:"include"});if(u.status===401&&!l&&await L())return T(r,s,!0);if(u.status===401)throw await $({redirect:!1,showSuccessToast:!1,suppressFailure:!0}),_(),new N;return u}const B=()=>{const{data:r,isLoading:s}=v({queryKey:["me"],queryFn:M,retry:!1});return s?e.jsx(x,{}):r?e.jsx(q.YorkieProvider,{rpcAddr:"https://api.yorkie.dev",apiKey:"fbuqYRxotajGGzb3kUD6aX",metadata:{userID:r.username||"anonymous-user"},children:e.jsx(w,{})}):e.jsx(j,{to:"/login"})},G=()=>{const{data:r,isLoading:s}=v({queryKey:["me","optional"],queryFn:Q,retry:!1});return s?e.jsx(x,{}):r?e.jsx(j,{to:"/"}):e.jsx(w,{})},K={theme:"system",resolvedTheme:"light",setTheme:()=>null},P=n.createContext(K);function U({children:r,defaultTheme:s="system",storageKey:l="vite-ui-theme",...u}){const[t,o]=n.useState(()=>localStorage.getItem(l)||s),[i,d]=n.useState(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");n.useEffect(()=>{const a=window.document.documentElement;a.classList.remove("light","dark");let p;if(t==="system"){const c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";p=c,a.classList.add(c)}else p=t,a.classList.add(t);d(p)},[t]),n.useEffect(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),p=()=>{if(t==="system"){const c=window.document.documentElement,y=a.matches?"dark":"light";c.classList.remove("light","dark"),c.classList.add(y),d(y)}};return a.addEventListener("change",p),()=>a.removeEventListener("change",p)},[t]);const h={theme:t,resolvedTheme:i,setTheme:a=>{localStorage.setItem(l,a),o(a)}};return e.jsx(P.Provider,{...u,value:h,children:r})}const de=()=>{const r=n.useContext(P);if(r===void 0)throw new Error("useTheme must be used within a ThemeProvider");return r},H=n.lazy(()=>f(()=>import("./page-CM4Fo3pR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),W=n.lazy(()=>f(()=>import("./page-D5AMMD9S.js"),__vite__mapDeps([8,1,2,3,9,10,6,11,5,7,4,12,13,14,15,16,17,18]))),Y=n.lazy(()=>f(()=>import("./document-detail-BUNP3kT1.js"),__vite__mapDeps([19,1,2,3,18,9,10,6,11,20,21,4,13,7,5,12,15,22,23,24,25]))),J=n.lazy(()=>f(()=>import("./page-BKKY8cib.js"),__vite__mapDeps([26,1,2,3,9,27,11,5,6,7,4,13,14,16,28,29,12,15,30,17,18]))),X=n.lazy(()=>f(()=>import("./shared-document-DhQuJ-IC.js"),__vite__mapDeps([31,1,2,3,9,18,23,21,6,4,11,32,7,13,33]))),Z=n.lazy(()=>f(()=>import("./page-B3TawnDU.js"),__vite__mapDeps([34,1,2,3,30,6,4,9,18]))),ee=n.lazy(()=>f(()=>import("./page-BWimimhW.js"),__vite__mapDeps([35,1,2,3,28,6,7,4,5,14,15,16]))),te=n.lazy(()=>f(()=>import("./page-akIyuql3.js"),__vite__mapDeps([36,1,2,3]))),re=n.lazy(()=>f(()=>import("./Layout-fgfHS7GW.js"),__vite__mapDeps([37,1,2,3,20,21,6,4,13,9,7,5,18])));function se(){const[r]=n.useState(()=>new A);return e.jsxs(U,{defaultTheme:"system",storageKey:"vite-ui-theme",children:[e.jsx(b,{client:r,children:e.jsx(R,{basename:"/",children:e.jsx(n.Suspense,{fallback:e.jsx(x,{}),children:e.jsxs(k,{children:[e.jsx(m,{element:e.jsx(G,{}),children:e.jsx(m,{path:"/login",element:e.jsx(H,{})})}),e.jsx(m,{path:"/harness/visual",element:e.jsx(ee,{})}),e.jsx(m,{path:"/harness/interaction",element:e.jsx(te,{})}),e.jsx(m,{path:"/shared/:token",element:e.jsx(X,{})}),e.jsxs(m,{element:e.jsx(B,{}),children:[e.jsxs(m,{element:e.jsx(re,{}),children:[e.jsx(m,{path:"/",element:e.jsx(W,{})}),e.jsx(m,{path:"/datasources",element:e.jsx(J,{})}),e.jsx(m,{path:"/settings",element:e.jsx(Z,{})})]}),e.jsx(m,{path:"/:id",element:e.jsx(Y,{})})]})]})})})}),e.jsx(C,{})]})}O.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(se,{})}));export{x as L,P as T,f as _,T as a,Q as b,M as f,ue as i,$ as l,de as u};
