const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/datasource-view-BW7_nF43.js","assets/vendor-react-B8NMt2sn.js","assets/sheet-formula-DQdd396h.js","assets/sheet-core-CeXbAiwd.js","assets/vendor-yorkie-DBzF6q2y.js","assets/index-BaUwT9On.js","assets/vendor-app-D5iGILfJ.js","assets/vendor-ui-BfXYXQ1K.js","assets/index-Bt5eLwVb.css","assets/button-DYoh-q0M.js","assets/index-3UDGtr2f.js","assets/utils-DjqsqOe8.js","assets/datasources-CYXYo7l4.js","assets/http-error-XKKRT0jQ.js","assets/use-mobile-sheet-gestures-B9Q3judX.js","assets/IconDotsVertical-DL1XgFmZ.js"])))=>i.map(i=>d[i]);
import{L as m,_ as x,b as f}from"./index-BaUwT9On.js";import{k as p,r as n,j as e}from"./vendor-react-B8NMt2sn.js";import{u as h}from"./vendor-app-D5iGILfJ.js";import{y as u}from"./vendor-yorkie-DBzF6q2y.js";import{r as j,i as b,I as v}from"./worksheet-BgBRXJw3.js";import{S as y}from"./sheet-view-C4ZFHLRx.js";import{I as k}from"./IconDotsVertical-DL1XgFmZ.js";import"./vendor-ui-BfXYXQ1K.js";import"./sheet-formula-DQdd396h.js";import"./sheet-core-CeXbAiwd.js";import"./http-error-XKKRT0jQ.js";import"./index-3UDGtr2f.js";import"./utils-DjqsqOe8.js";import"./dropdown-menu-DDPpTlzz.js";import"./use-mobile-sheet-gestures-B9Q3judX.js";const g=n.lazy(()=>x(()=>import("./datasource-view-BW7_nF43.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])).then(s=>({default:s.DataSourceView})));function N({resolved:s}){const t=s.role==="viewer",{doc:a}=u.useDocument(),[r,c]=n.useState(null),o=a==null?void 0:a.getRoot(),i=n.useMemo(()=>o?(o.tabOrder||[]).map(d=>o.tabs[d]).filter(Boolean):[],[o]);if(n.useEffect(()=>{if(o){if(!i.length){c(null);return}(!r||!o.tabs[r])&&c(i[0].id)}},[r,o,i]),!a||!o)return e.jsx(m,{});if(!r)return e.jsx(m,{});const l=o.tabs[r];return e.jsxs("div",{className:"flex h-screen w-full flex-col",children:[e.jsxs("header",{className:"flex h-14 shrink-0 items-center gap-2 border-b px-4",children:[e.jsx("h1",{className:"text-base font-medium",children:s.title}),t&&e.jsx("span",{className:"rounded bg-muted px-2 py-0.5 text-xs text-muted-foreground",children:"View only"})]}),e.jsxs("div",{className:"flex flex-1 flex-col",children:[e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsx(n.Suspense,{fallback:e.jsx(m,{}),children:(l==null?void 0:l.type)==="datasource"?e.jsx(g,{tabId:r,readOnly:t}):e.jsx(y,{tabId:r,readOnly:t})})}),e.jsx("div",{className:"flex items-center border-t bg-muted/30 px-1 h-9 shrink-0 overflow-x-auto",children:i.map(d=>e.jsxs("button",{className:`flex shrink-0 items-center gap-1.5 px-3 py-1 text-sm rounded-t border-b-2 cursor-pointer select-none hover:bg-muted/50 transition-colors ${d.id===r?"border-primary bg-background text-foreground font-medium":"border-transparent text-muted-foreground"}`,onClick:()=>c(d.id),children:[d.type==="datasource"?e.jsx(k,{className:"size-3.5"}):e.jsx(v,{className:"size-3.5"}),e.jsx("span",{children:d.name})]},d.id))})]})]})}function I({resolved:s}){const{data:t}=h({queryKey:["me","optional"],queryFn:f,retry:!1}),a={username:(t==null?void 0:t.username)||"Anonymous",email:(t==null?void 0:t.email)||"",photo:(t==null?void 0:t.photo)||""};return e.jsx(u.YorkieProvider,{rpcAddr:"https://api.yorkie.dev",apiKey:"fbuqYRxotajGGzb3kUD6aX",metadata:{userID:a.username},children:e.jsx(u.DocumentProvider,{docKey:`sheet-${s.documentId}`,initialRoot:b,initialPresence:a,enableDevtools:!1,children:e.jsx(N,{resolved:s})})})}function G(){const{token:s}=p(),[t,a]=n.useState(null),[r,c]=n.useState(null),[o,i]=n.useState(!0);return n.useEffect(()=>{if(!s){c("No share token provided"),i(!1);return}j(s).then(l=>{a(l),i(!1)}).catch(l=>{c(l.message||"Invalid or expired link"),i(!1)})},[s]),o?e.jsx(m,{}):r||!t?e.jsx("div",{className:"flex h-screen w-full items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Link unavailable"}),e.jsx("p",{className:"text-muted-foreground",children:r||"Invalid or expired link"})]})}):e.jsx(I,{resolved:t})}export{G as SharedDocument,G as default};
