const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/page-M9jOKg9L.js","assets/vendor-react-d8e6EPQB.js","assets/sheet-formula-Cvt09-kn.js","assets/sheet-core-CGtQon24.js","assets/utils-DjqsqOe8.js","assets/button-Cwcwq_42.js","assets/vendor-ui-C_nVzOFl.js","assets/index-3UDGtr2f.js","assets/page-C_LY_LVH.js","assets/vendor-app-Y5f1AkIW.js","assets/documents-DyR_7gSS.js","assets/http-error-XKKRT0jQ.js","assets/dialog-O3jdCznk.js","assets/dropdown-menu-CwgpziA2.js","assets/input-lIl-fr1r.js","assets/label-DLS6sb2Q.js","assets/table-CWpFjryS.js","assets/formatDistanceToNow-DXTjigy3.js","assets/vendor-yorkie-DGMBSwmV.js","assets/document-detail-1tyAfHfp.js","assets/site-header-DJz4WsFi.js","assets/IconDotsVertical-CEsfNypO.js","assets/select-BmL_cN7h.js","assets/worksheet-CkEILuJO.js","assets/IconTrash-j0pOvztk.js","assets/IconPlus-BOn5CyQ1.js","assets/page-D4WpovIf.js","assets/datasources-CUVdzJP5.js","assets/badge-DEQTqICn.js","assets/datasource-dialog-BTdAd11z.js","assets/switch-jNDytir8.js","assets/shared-document-CuMRyaWF.js","assets/sheet-view-oDAl8R2U.js","assets/use-mobile-sheet-gestures-CHMx1u0E.js","assets/page-Dd4rjR8f.js","assets/page-Br05oWou.js","assets/Layout-C5lc9Mwr.js"])))=>i.map(i=>d[i]);
import{j as e,O as w,N as j,r as i,B as R,g as k,h,i as O}from"./vendor-react-d8e6EPQB.js";import{u as v,Q as b,a as A}from"./vendor-app-Y5f1AkIW.js";import{L as D,t as I,T as C}from"./vendor-ui-C_nVzOFl.js";import{y as q}from"./vendor-yorkie-DGMBSwmV.js";import"./sheet-formula-Cvt09-kn.js";import"./sheet-core-CGtQon24.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))u(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&u(n)}).observe(document,{childList:!0,subtree:!0});function l(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function u(t){if(t.ep)return;t.ep=!0;const o=l(t);fetch(t.href,o)}})();const z="modulepreload",F=function(r){return"/"+r},E={},p=function(s,l,u){let t=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),d=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));t=Promise.allSettled(l.map(m=>{if(m=F(m),m in E)return;E[m]=!0;const a=m.endsWith(".css"),f=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${f}`))return;const c=document.createElement("link");if(c.rel=a?"stylesheet":z,a||(c.as="script"),c.crossOrigin="",c.href=m,d&&c.setAttribute("nonce",d),document.head.appendChild(c),a)return new Promise((y,S)=>{c.addEventListener("load",y),c.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(n){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=n,window.dispatchEvent(d),!d.defaultPrevented)throw n}return t.then(n=>{for(const d of n||[])d.status==="rejected"&&o(d.reason);return s().catch(o)})},x=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[300px]","aria-live":"polite",children:[e.jsx(D,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:"Loading..."})]});function V(r){let s=null;return async()=>(s||(s=(async()=>{try{return await r()}finally{s=null}})()),s)}class N extends Error{constructor(){super("Session expired"),this.name="AuthExpiredError"}}function le(r){return r instanceof Error&&r.name==="AuthExpiredError"}let g=!1;function _(){g||(g=!0,window.location.href="/login")}const L=V(async()=>{try{return(await fetch("https://wafflebase-api.yorkie.dev/auth/refresh",{method:"POST",credentials:"include"})).ok}catch{return!1}});async function $(r={}){const{redirect:s=!0,showSuccessToast:l=!0,suppressFailure:u=!1}=r;let t=null;try{t=await fetch("https://wafflebase-api.yorkie.dev/auth/logout",{method:"POST",credentials:"include"})}catch(o){if(!u)throw o}if(t&&!t.ok&&!u)throw new Error("Failed to log out");l&&(t!=null&&t.ok)&&I.success("Logged out successfully"),s&&_()}async function M(){const r=await T("https://wafflebase-api.yorkie.dev/auth/me",{method:"GET",credentials:"include"});if(!r.ok)throw new Error("Failed to fetch user");return r.json()}async function Q(){const r=()=>fetch("https://wafflebase-api.yorkie.dev/auth/me",{method:"GET",credentials:"include"});let s=await r();if(s.status===401&&(!await L()||(s=await r(),s.status===401)))return null;if(!s.ok)throw new Error("Failed to fetch user");return s.json()}async function T(r,s,l=!1){const u=await fetch(r,{...s,credentials:"include"});if(u.status===401&&!l&&await L())return T(r,s,!0);if(u.status===401)throw await $({redirect:!1,showSuccessToast:!1,suppressFailure:!0}),_(),new N;return u}const B=()=>{const{data:r,isLoading:s}=v({queryKey:["me"],queryFn:M,retry:!1});return s?e.jsx(x,{}):r?e.jsx(q.YorkieProvider,{rpcAddr:"https://api.yorkie.dev",apiKey:"fbuqYRxotajGGzb3kUD6aX",metadata:{userID:r.username||"anonymous-user"},children:e.jsx(w,{})}):e.jsx(j,{to:"/login"})},G=()=>{const{data:r,isLoading:s}=v({queryKey:["me","optional"],queryFn:Q,retry:!1});return s?e.jsx(x,{}):r?e.jsx(j,{to:"/"}):e.jsx(w,{})},K={theme:"system",resolvedTheme:"light",setTheme:()=>null},P=i.createContext(K);function U({children:r,defaultTheme:s="system",storageKey:l="vite-ui-theme",...u}){const[t,o]=i.useState(()=>localStorage.getItem(l)||s),[n,d]=i.useState(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");i.useEffect(()=>{const a=window.document.documentElement;a.classList.remove("light","dark");let f;if(t==="system"){const c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";f=c,a.classList.add(c)}else f=t,a.classList.add(t);d(f)},[t]),i.useEffect(()=>{const a=window.matchMedia("(prefers-color-scheme: dark)"),f=()=>{if(t==="system"){const c=window.document.documentElement,y=a.matches?"dark":"light";c.classList.remove("light","dark"),c.classList.add(y),d(y)}};return a.addEventListener("change",f),()=>a.removeEventListener("change",f)},[t]);const m={theme:t,resolvedTheme:n,setTheme:a=>{localStorage.setItem(l,a),o(a)}};return e.jsx(P.Provider,{...u,value:m,children:r})}const ue=()=>{const r=i.useContext(P);if(r===void 0)throw new Error("useTheme must be used within a ThemeProvider");return r},W=i.lazy(()=>p(()=>import("./page-M9jOKg9L.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Y=i.lazy(()=>p(()=>import("./page-C_LY_LVH.js"),__vite__mapDeps([8,1,2,3,9,10,6,11,5,7,4,12,13,14,15,16,17,18]))),H=i.lazy(()=>p(()=>import("./document-detail-1tyAfHfp.js"),__vite__mapDeps([19,1,2,3,18,9,10,6,11,20,21,4,13,7,5,12,15,22,23,24,25]))),J=i.lazy(()=>p(()=>import("./page-D4WpovIf.js"),__vite__mapDeps([26,1,2,3,9,27,11,5,6,7,4,13,14,16,28,29,12,15,30,17,18]))),X=i.lazy(()=>p(()=>import("./shared-document-CuMRyaWF.js"),__vite__mapDeps([31,1,2,3,9,18,23,21,6,4,11,32,7,13,33]))),Z=i.lazy(()=>p(()=>import("./page-Dd4rjR8f.js"),__vite__mapDeps([34,1,2,3,30,6,4,9,18]))),ee=i.lazy(()=>p(()=>import("./page-Br05oWou.js"),__vite__mapDeps([35,1,2,3,28,6,7,4,5,14,15,16]))),te=i.lazy(()=>p(()=>import("./Layout-C5lc9Mwr.js"),__vite__mapDeps([36,1,2,3,20,21,6,4,13,9,7,5,18])));function re(){const[r]=i.useState(()=>new b);return e.jsxs(U,{defaultTheme:"system",storageKey:"vite-ui-theme",children:[e.jsx(A,{client:r,children:e.jsx(R,{basename:"/",children:e.jsx(i.Suspense,{fallback:e.jsx(x,{}),children:e.jsxs(k,{children:[e.jsx(h,{element:e.jsx(G,{}),children:e.jsx(h,{path:"/login",element:e.jsx(W,{})})}),e.jsx(h,{path:"/harness/visual",element:e.jsx(ee,{})}),e.jsx(h,{path:"/shared/:token",element:e.jsx(X,{})}),e.jsxs(h,{element:e.jsx(B,{}),children:[e.jsxs(h,{element:e.jsx(te,{}),children:[e.jsx(h,{path:"/",element:e.jsx(Y,{})}),e.jsx(h,{path:"/datasources",element:e.jsx(J,{})}),e.jsx(h,{path:"/settings",element:e.jsx(Z,{})})]}),e.jsx(h,{path:"/:id",element:e.jsx(H,{})})]})]})})})}),e.jsx(C,{})]})}O.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(re,{})}));export{x as L,P as T,p as _,T as a,Q as b,M as f,le as i,$ as l,ue as u};
