import{h as q,j as e,r,t as o,i as N,u as z,k as _,b as Q}from"./index-DBW_otBA.js";import{t as K,u as A,d as B,f as U}from"./datasources-BB42eeJ-.js";import{u as $,a as O,P as X,T as Z,b as G,c as V,d as J,f as H,e as W,g as I,h as Y,i as ee,j as se,k as te,l as ae,E as re,m as ne,n as ie}from"./table-CCD46P_-.js";import{B as v}from"./button-j48SJuig.js";import{D as oe,a as le,b as ce,c as L,e as de}from"./dropdown-menu-CnGRgojj.js";import{I as h}from"./input-oNzUkWfu.js";import{S as ue,c as me}from"./index-DpMR8ASO.js";import{c as ge}from"./index-90cNogIG.js";import{D as he}from"./datasource-dialog-D5Rzugfr.js";import{D as xe,a as pe,b as fe,c as je,d as ve}from"./dialog-XG_4Ukgs.js";import{L as g}from"./label-rWZvJIm1.js";import{S as be}from"./switch-M0bJBBgp.js";import"./index-Ok2w0SJX.js";import"./index-CH1T-SGh.js";import"./index-CDE0Yxpt.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ce=q("circle-check",ye);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ne=q("circle-x",Se);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M9 8V2",key:"14iosj"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z",key:"osxo6l"}]],De=q("plug",we),ke=ge("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Fe({className:a,variant:l,asChild:u=!1,...c}){const d=u?ue:"span";return e.jsx(d,{"data-slot":"badge",className:me(ke({variant:l}),a),...c})}function Pe({datasource:a,open:l,onOpenChange:u,onSaved:c}){const[d,x]=r.useState(""),[p,b]=r.useState(""),[y,f]=r.useState("5432"),[j,w]=r.useState(""),[m,D]=r.useState(""),[C,k]=r.useState(""),[S,F]=r.useState(!1),[P,M]=r.useState(!1),[E,i]=r.useState(!1);r.useEffect(()=>{a&&(x(a.name),b(a.host),f(String(a.port)),w(a.database),D(a.username),k(""),F(a.sslEnabled))},[a]);const T=async()=>{if(a){i(!0);try{const s={};d!==a.name&&(s.name=d),p!==a.host&&(s.host=p),Number(y)!==a.port&&(s.port=Number(y)),j!==a.database&&(s.database=j),m!==a.username&&(s.username=m),C&&(s.password=C),S!==a.sslEnabled&&(s.sslEnabled=S),await A(a.id,s),o.success("DataSource updated"),c()}catch(s){if(N(s))return;o.error("Failed to update datasource")}finally{i(!1)}}},R=async()=>{if(a){M(!0);try{const s=await K(a.id);s.success?o.success("Connection successful"):o.error(`Connection failed: ${s.error}`)}catch(s){if(N(s))return;o.error("Failed to test connection")}finally{M(!1)}}};return e.jsx(xe,{open:l,onOpenChange:u,children:e.jsxs(pe,{className:"sm:max-w-md",children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Edit DataSource"}),e.jsx(ve,{children:"Update the connection settings for this datasource."})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-name",children:"Name"}),e.jsx(h,{id:"edit-ds-name",value:d,onChange:s=>x(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"col-span-2 grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-host",children:"Host"}),e.jsx(h,{id:"edit-ds-host",value:p,onChange:s=>b(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-port",children:"Port"}),e.jsx(h,{id:"edit-ds-port",type:"number",value:y,onChange:s=>f(s.target.value)})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-database",children:"Database"}),e.jsx(h,{id:"edit-ds-database",value:j,onChange:s=>w(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-username",children:"Username"}),e.jsx(h,{id:"edit-ds-username",value:m,onChange:s=>D(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(g,{htmlFor:"edit-ds-password",children:"Password"}),e.jsx(h,{id:"edit-ds-password",type:"password",placeholder:"Leave blank to keep current",value:C,onChange:s=>k(s.target.value)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{id:"edit-ds-ssl",checked:S,onCheckedChange:F}),e.jsx(g,{htmlFor:"edit-ds-ssl",children:"Enable SSL"})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(v,{variant:"outline",onClick:R,disabled:P,children:P?"Testing...":"Test Connection"}),e.jsx(v,{onClick:T,disabled:E||!d||!p||!j||!m,children:E?"Saving...":"Save Changes"})]})]})})}function Me({data:a}){var T,R;const l=z(),[u,c]=r.useState(!1),[d,x]=r.useState(null),[p,b]=r.useState(null),[y,f]=r.useState({}),j=$({mutationFn:async s=>await B(s),onSuccess:()=>{l.invalidateQueries({queryKey:["datasources"]}),o.success("DataSource deleted")},onError:s=>{N(s)||o.error("Failed to delete datasource")}}),w=async s=>{b(s),f(t=>({...t,[s]:null}));try{const t=await K(s);f(n=>({...n,[s]:t.success})),t.success?o.success("Connection successful"):o.error(`Connection failed: ${t.error}`)}catch(t){if(N(t))return;f(n=>({...n,[s]:!1})),o.error("Failed to test connection")}finally{b(null)}},m=[{accessorKey:"name",header:"Name",cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.getValue("name")})},{id:"connection",header:"Connection",cell:({row:s})=>{const t=s.original;return e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.host,":",t.port,"/",t.database]})}},{accessorKey:"username",header:"User",cell:({row:s})=>e.jsx("div",{className:"text-sm",children:s.getValue("username")})},{id:"ssl",header:"SSL",cell:({row:s})=>s.original.sslEnabled?e.jsx(Fe,{variant:"secondary",children:"SSL"}):null},{id:"status",header:"Status",cell:({row:s})=>{const t=s.original.id,n=y[t];return p===t?e.jsx(_,{className:"h-4 w-4 animate-spin text-muted-foreground"}):n===!0?e.jsx(Ce,{className:"h-4 w-4 text-green-500"}):n===!1?e.jsx(Ne,{className:"h-4 w-4 text-red-500"}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"â€”"})}},{accessorKey:"createdAt",header:()=>e.jsx("div",{className:"text-right",children:"Created"}),cell:({row:s})=>{const t=s.getValue("createdAt"),n=ae(new Date(t),{includeSeconds:!0,addSuffix:!0});return e.jsx("div",{className:"text-right text-sm",children:n})}},{id:"actions",enableHiding:!1,cell:({row:s})=>{const t=s.original;return e.jsxs(oe,{children:[e.jsx(le,{asChild:!0,children:e.jsxs(v,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(re,{})]})}),e.jsxs(ce,{align:"end",children:[e.jsxs(L,{onClick:n=>{n.stopPropagation(),w(t.id)},children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Test Connection"]}),e.jsxs(L,{onClick:n=>{n.stopPropagation(),x(t)},children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(de,{}),e.jsxs(L,{className:"text-red-500 focus:text-red-500",onClick:n=>{n.stopPropagation(),j.mutate(t.id)},children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}}],[D,C]=r.useState([]),[k,S]=r.useState([]),[F,P]=r.useState({}),[M,E]=r.useState({}),i=O({data:a,columns:m,onSortingChange:C,onColumnFiltersChange:S,getCoreRowModel:te(),getPaginationRowModel:se(),getSortedRowModel:ee(),getFilteredRowModel:Y(),onColumnVisibilityChange:P,onRowSelectionChange:E,state:{sorting:D,columnFilters:k,columnVisibility:F,rowSelection:M}});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between py-4",children:[e.jsx(h,{placeholder:"Filter by name...",value:((T=i.getColumn("name"))==null?void 0:T.getFilterValue())??"",onChange:s=>{var t;return(t=i.getColumn("name"))==null?void 0:t.setFilterValue(s.target.value)},className:"max-w-sm"}),e.jsxs(v,{onClick:()=>c(!0),className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),"New DataSource"]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Z,{children:[e.jsx(G,{children:i.getHeaderGroups().map(s=>e.jsx(V,{children:s.headers.map(t=>e.jsx(J,{children:t.isPlaceholder?null:H(t.column.columnDef.header,t.getContext())},t.id))},s.id))}),e.jsx(W,{children:(R=i.getRowModel().rows)!=null&&R.length?i.getRowModel().rows.map(s=>e.jsx(V,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(t=>e.jsx(I,{children:H(t.column.columnDef.cell,t.getContext())},t.id))},s.id)):e.jsx(V,{children:e.jsx(I,{colSpan:m.length,className:"h-24 text-center",children:"No datasources yet. Create one to get started."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage(),children:"Previous"}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage(),children:"Next"})]})]}),e.jsx(he,{open:u,onOpenChange:c,onCreated:()=>{c(!1),l.invalidateQueries({queryKey:["datasources"]})}}),e.jsx(Pe,{datasource:d,open:d!==null,onOpenChange:s=>{s||x(null)},onSaved:()=>{x(null),l.invalidateQueries({queryKey:["datasources"]})}})]})}function $e(){const{data:a=[],isLoading:l,isError:u,error:c}=Q({queryKey:["datasources"],queryFn:U});return l?e.jsx("div",{className:"flex flex-col items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"Loading datasources..."})}):u?N(c)?null:e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("p",{className:"text-red-500 text-lg",children:"Failed to load datasources."}),e.jsx("p",{className:"text-gray-400",children:"Please try again later."})]}):e.jsx("div",{className:"p-4",children:e.jsx(Me,{data:a})})}export{$e as default};
