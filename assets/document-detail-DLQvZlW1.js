const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sheet-view-DeS6Ogvs.js","assets/index-DZ-om21y.js","assets/index-DLApyFim.css","assets/use-mobile-sheet-gestures-BylpA5u-.js","assets/IconDotsVertical-rcee167H.js","assets/dropdown-menu-Cgle8vtg.js","assets/index-D7tJshVi.js","assets/index-CWwJWUS2.js","assets/index-C3PGvg8m.js","assets/datasource-view-Cqhvl9Bo.js","assets/button-BOepPbA9.js","assets/datasources-C1ltDLKb.js","assets/datasource-selector-CjdR-eM5.js","assets/dialog-Dcq8tdfp.js","assets/index-BGr-YH8N.js","assets/label-CGM9vF0G.js","assets/datasource-dialog-DP1sQNrF.js","assets/input-Ce4ngwRr.js","assets/switch-D2f1VCZj.js","assets/index-Dzx5yyGq.js","assets/site-header-DFSy3U0A.js","assets/grid-2x2-plus-DkO7wALC.js","assets/IconPlus-SFkcGn1f.js"])))=>i.map(i=>d[i]);
import{b as ot,y as st,j as u,f as Dt,r as i,t as Te,R as P,c as Oe,d as Vn,e as Ze,N as Xn,u as _n,_ as Ct}from"./index-DZ-om21y.js";import{r as Hn,a as Wn}from"./documents-pTEbhOKk.js";import{A as Xt,a as Yn,b as _t,I as Rt,S as qn,c as Kn,d as Gn,e as Jn,f as Qn,g as Zn}from"./site-header-DFSy3U0A.js";import{c as Et,T as er,a as tr,b as nr,d as rr,S as or}from"./IconDotsVertical-rcee167H.js";import{D as sr,f as ir,a as ar,b as lr,c as cr,d as ur}from"./dialog-Dcq8tdfp.js";import{B as qe}from"./button-BOepPbA9.js";import{L as ft}from"./label-CGM9vF0G.js";import{S as Ht,a as Wt,b as Yt,c as qt,d as ht}from"./select-BhQz1P17.js";import{g as dr,d as fr,c as hr,i as gr}from"./worksheet-BErTnzzv.js";import{I as pr}from"./IconTrash-DP6juvqW.js";import{D as Kt,a as Gt,b as Jt,c as Ke,d as vr}from"./dropdown-menu-Cgle8vtg.js";import{c as br}from"./index-CWwJWUS2.js";import{I as mr}from"./IconPlus-SFkcGn1f.js";import"./index-D7tJshVi.js";import"./grid-2x2-plus-DkO7wALC.js";import"./index-C3PGvg8m.js";import"./index-BGr-YH8N.js";import"./index-Dzx5yyGq.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var xr=Et("outline","copy","IconCopy",[["path",{d:"M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z",key:"svg-0"}],["path",{d:"M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var yr=Et("outline","share","IconShare",[["path",{d:"M6 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-0"}],["path",{d:"M18 6m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-1"}],["path",{d:"M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-2"}],["path",{d:"M8.7 10.7l6.6 -3.4",key:"svg-3"}],["path",{d:"M8.7 13.3l6.6 3.4",key:"svg-4"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var fn=Et("outline","table","IconTable",[["path",{d:"M3 5a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-14z",key:"svg-0"}],["path",{d:"M3 10h18",key:"svg-1"}],["path",{d:"M10 3v18",key:"svg-2"}]]);function wr({className:e}){const{data:t}=ot({queryKey:["me"],queryFn:Dt,retry:!1}),r=st.usePresences().reduce((s,a)=>{const l=a.presence.username;return s.find(c=>c.presence.username===l)||s.push(a),s},[]),o=r.length;return u.jsx(er,{children:u.jsx("div",{className:`flex items-center gap-2 min-h-[2.5rem] ${e}`,children:o>0?u.jsx(u.Fragment,{children:u.jsxs("div",{className:"flex items-center -space-x-2",children:[r.slice(0,4).map(s=>{var d,f;const a=(d=s.presence)==null?void 0:d.username,l=(f=s.presence)==null?void 0:f.photo,c=a===(t==null?void 0:t.username);return a?u.jsxs(tr,{children:[u.jsx(nr,{asChild:!0,children:u.jsxs("div",{className:"relative",children:[u.jsxs(Xt,{className:"h-8 w-8 border-2 border-background",children:[l&&u.jsx(Yn,{src:l,alt:a}),u.jsx(_t,{className:"text-xs",children:(a==null?void 0:a.slice(0,2).toUpperCase())||"??"})]}),u.jsx("div",{className:"absolute -bottom-1 -right-1",children:u.jsx("div",{className:"h-3 w-3 rounded-full bg-green-500 border-2 border-background"})})]})}),u.jsx(rr,{children:u.jsxs("p",{children:[a||"Anonymous",c?" (You)":""]})})]},s.clientID):null}).filter(Boolean),o>4&&u.jsx(Xt,{className:"w-8 border-2 border-background",children:u.jsxs(_t,{className:"text-xs bg-muted",children:["+",o-4]})})]})}):u.jsx("div",{className:"w-32 opacity-0"})})})}const Sr=[{value:"none",label:"No limit"},{value:"1h",label:"1 hour"},{value:"8h",label:"8 hours"},{value:"24h",label:"24 hours"},{value:"7d",label:"7 days"}];function Dr(e){if(!e)return"No expiration";const t=new Date(e),n=new Date;if(t<n)return"Expired";const r=t.getTime()-n.getTime(),o=Math.floor(r/(1e3*60*60)),s=Math.floor(o/24);return s>0?`Expires in ${s}d`:o>0?`Expires in ${o}h`:`Expires in ${Math.floor(r/(1e3*60))}m`}function Cr({documentId:e}){const[t,n]=i.useState(!1),[r,o]=i.useState("viewer"),[s,a]=i.useState("none"),[l,c]=i.useState([]),[d,f]=i.useState(!1);i.useEffect(()=>{t&&dr(e).then(c).catch(()=>{})},[t,e]);const h=async()=>{f(!0);try{const w=await hr(e,r,s==="none"?null:s);c(y=>[w,...y]);const v=`${window.location.origin}/shared/${w.token}`;await navigator.clipboard.writeText(v),Te.success("Link created and copied to clipboard")}catch{Te.error("Failed to create share link")}finally{f(!1)}},m=async w=>{const v=`${window.location.origin}/shared/${w}`;await navigator.clipboard.writeText(v),Te.success("Link copied to clipboard")},g=async w=>{try{await fr(w),c(v=>v.filter(y=>y.id!==w)),Te.success("Share link revoked")}catch{Te.error("Failed to revoke share link")}};return u.jsxs(sr,{open:t,onOpenChange:n,children:[u.jsx(ir,{asChild:!0,children:u.jsxs(qe,{variant:"outline",size:"sm",children:[u.jsx(yr,{className:"h-4 w-4 mr-1"}),"Share"]})}),u.jsxs(ar,{className:"sm:max-w-md",children:[u.jsxs(lr,{children:[u.jsx(cr,{children:"Share Document"}),u.jsx(ur,{children:"Create a link to share this document with others."})]}),u.jsxs("div",{className:"grid gap-4 py-2",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[u.jsxs("div",{className:"grid gap-2",children:[u.jsx(ft,{htmlFor:"share-role",children:"Permission"}),u.jsxs(Ht,{value:r,onValueChange:o,children:[u.jsx(Wt,{id:"share-role",className:"w-full",children:u.jsx(Yt,{})}),u.jsxs(qt,{children:[u.jsx(ht,{value:"viewer",children:"Viewer"}),u.jsx(ht,{value:"editor",children:"Editor"})]})]})]}),u.jsxs("div",{className:"grid gap-2",children:[u.jsx(ft,{htmlFor:"share-expiration",children:"Expiration"}),u.jsxs(Ht,{value:s,onValueChange:a,children:[u.jsx(Wt,{id:"share-expiration",className:"w-full",children:u.jsx(Yt,{})}),u.jsx(qt,{children:Sr.map(w=>u.jsx(ht,{value:w.value,children:w.label},w.value))})]})]})]}),l.length>0&&u.jsxs(u.Fragment,{children:[u.jsx(or,{}),u.jsxs("div",{className:"grid gap-2",children:[u.jsx(ft,{children:"Active links"}),u.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:l.map(w=>u.jsxs("div",{className:"flex items-center justify-between rounded-md border px-3 py-2 text-sm",children:[u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"capitalize font-medium",children:w.role}),u.jsx("span",{className:"text-muted-foreground text-xs",children:Dr(w.expiresAt)})]}),u.jsxs("div",{className:"flex items-center gap-1",children:[u.jsx(qe,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>m(w.token),children:u.jsx(xr,{className:"h-3.5 w-3.5"})}),u.jsx(qe,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>g(w.id),children:u.jsx(pr,{className:"h-3.5 w-3.5"})})]})]},w.id))})]})]})]}),u.jsx("div",{className:"flex justify-end",children:u.jsx(qe,{onClick:h,disabled:d,children:d?"Creating...":"Create Link"})})]})]})}function Rr(){const{doc:e}=st.useDocument(),{data:t}=ot({queryKey:["me"],queryFn:Dt,retry:!1});i.useEffect(()=>{!e||!t||e.update((n,r)=>{r.set({username:t.username,email:t.email,photo:t.photo||""})})},[e,t])}function Er(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.useMemo(()=>r=>{t.forEach(o=>o(r))},t)}const it=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function ye(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function It(e){return"nodeType"in e}function F(e){var t,n;return e?ye(e)?e:It(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Mt(e){const{Document:t}=F(e);return e instanceof t}function Be(e){return ye(e)?!1:e instanceof F(e).HTMLElement}function hn(e){return e instanceof F(e).SVGElement}function we(e){return e?ye(e)?e.document:It(e)?Mt(e)?e:Be(e)||hn(e)?e.ownerDocument:document:document:document}const Z=it?i.useLayoutEffect:i.useEffect;function Nt(e){const t=i.useRef(e);return Z(()=>{t.current=e}),i.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}function Ir(){const e=i.useRef(null),t=i.useCallback((r,o)=>{e.current=setInterval(r,o)},[]),n=i.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function ze(e,t){t===void 0&&(t=[e]);const n=i.useRef(e);return Z(()=>{n.current!==e&&(n.current=e)},t),n}function $e(e,t){const n=i.useRef();return i.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function et(e){const t=Nt(e),n=i.useRef(null),r=i.useCallback(o=>{o!==n.current&&(t==null||t(o,n.current)),n.current=o},[]);return[n,r]}function mt(e){const t=i.useRef();return i.useEffect(()=>{t.current=e},[e]),t.current}let gt={};function Ue(e,t){return i.useMemo(()=>{if(t)return t;const n=gt[e]==null?0:gt[e]+1;return gt[e]=n,e+"-"+n},[e,t])}function gn(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.reduce((s,a)=>{const l=Object.entries(a);for(const[c,d]of l){const f=s[c];f!=null&&(s[c]=f+e*d)}return s},{...t})}}const xe=gn(1),tt=gn(-1);function Mr(e){return"clientX"in e&&"clientY"in e}function jt(e){if(!e)return!1;const{KeyboardEvent:t}=F(e.target);return t&&e instanceof t}function Nr(e){if(!e)return!1;const{TouchEvent:t}=F(e.target);return t&&e instanceof t}function xt(e){if(Nr(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Mr(e)?{x:e.clientX,y:e.clientY}:null}const Pe=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Pe.Translate.toString(e),Pe.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Qt="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function jr(e){return e.matches(Qt)?e:e.querySelector(Qt)}const Tr={display:"none"};function Or(e){let{id:t,value:n}=e;return P.createElement("div",{id:t,style:Tr},n)}function Ar(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const o={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return P.createElement("div",{id:t,style:o,role:"status","aria-live":r,"aria-atomic":!0},n)}function kr(){const[e,t]=i.useState("");return{announce:i.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const pn=i.createContext(null);function Lr(e){const t=i.useContext(pn);i.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function zr(){const[e]=i.useState(()=>new Set),t=i.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[i.useCallback(r=>{let{type:o,event:s}=r;e.forEach(a=>{var l;return(l=a[o])==null?void 0:l.call(a,s)})},[e]),t]}const Pr={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Fr={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Br(e){let{announcements:t=Fr,container:n,hiddenTextDescribedById:r,screenReaderInstructions:o=Pr}=e;const{announce:s,announcement:a}=kr(),l=Ue("DndLiveRegion"),[c,d]=i.useState(!1);if(i.useEffect(()=>{d(!0)},[]),Lr(i.useMemo(()=>({onDragStart(h){let{active:m}=h;s(t.onDragStart({active:m}))},onDragMove(h){let{active:m,over:g}=h;t.onDragMove&&s(t.onDragMove({active:m,over:g}))},onDragOver(h){let{active:m,over:g}=h;s(t.onDragOver({active:m,over:g}))},onDragEnd(h){let{active:m,over:g}=h;s(t.onDragEnd({active:m,over:g}))},onDragCancel(h){let{active:m,over:g}=h;s(t.onDragCancel({active:m,over:g}))}}),[s,t])),!c)return null;const f=P.createElement(P.Fragment,null,P.createElement(Or,{id:r,value:o.draggable}),P.createElement(Ar,{id:l,announcement:a}));return n?Oe.createPortal(f,n):f}var T;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(T||(T={}));function nt(){}function $r(e,t){return i.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Ur(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const q=Object.freeze({x:0,y:0});function Vr(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Xr(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function _r(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Hr(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Zt(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const Wr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=Zt(t,t.left,t.top),s=[];for(const a of r){const{id:l}=a,c=n.get(l);if(c){const d=Vr(Zt(c),o);s.push({id:l,data:{droppableContainer:a,value:d}})}}return s.sort(Xr)};function Yr(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),o=Math.min(t.left+t.width,e.left+e.width),s=Math.min(t.top+t.height,e.top+e.height),a=o-r,l=s-n;if(r<o&&n<s){const c=t.width*t.height,d=e.width*e.height,f=a*l,h=f/(c+d-f);return Number(h.toFixed(4))}return 0}const qr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const o=[];for(const s of r){const{id:a}=s,l=n.get(a);if(l){const c=Yr(l,t);c>0&&o.push({id:a,data:{droppableContainer:s,value:c}})}}return o.sort(_r)};function Kr(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function vn(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:q}function Gr(e){return function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return o.reduce((a,l)=>({...a,top:a.top+e*l.y,bottom:a.bottom+e*l.y,left:a.left+e*l.x,right:a.right+e*l.x}),{...n})}}const Jr=Gr(1);function Qr(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Zr(e,t,n){const r=Qr(t);if(!r)return e;const{scaleX:o,scaleY:s,x:a,y:l}=r,c=e.left-a-(1-o)*parseFloat(n),d=e.top-l-(1-s)*parseFloat(n.slice(n.indexOf(" ")+1)),f=o?e.width/o:e.width,h=s?e.height/s:e.height;return{width:f,height:h,top:d,right:c+f,bottom:d+h,left:c}}const eo={ignoreTransform:!1};function Se(e,t){t===void 0&&(t=eo);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:d,transformOrigin:f}=F(e).getComputedStyle(e);d&&(n=Zr(n,d,f))}const{top:r,left:o,width:s,height:a,bottom:l,right:c}=n;return{top:r,left:o,width:s,height:a,bottom:l,right:c}}function en(e){return Se(e,{ignoreTransform:!0})}function to(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function no(e,t){return t===void 0&&(t=F(e).getComputedStyle(e)),t.position==="fixed"}function ro(e,t){t===void 0&&(t=F(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(o=>{const s=t[o];return typeof s=="string"?n.test(s):!1})}function Tt(e,t){const n=[];function r(o){if(t!=null&&n.length>=t||!o)return n;if(Mt(o)&&o.scrollingElement!=null&&!n.includes(o.scrollingElement))return n.push(o.scrollingElement),n;if(!Be(o)||hn(o)||n.includes(o))return n;const s=F(e).getComputedStyle(o);return o!==e&&ro(o,s)&&n.push(o),no(o,s)?n:r(o.parentNode)}return e?r(e):n}function bn(e){const[t]=Tt(e,1);return t??null}function pt(e){return!it||!e?null:ye(e)?e:It(e)?Mt(e)||e===we(e).scrollingElement?window:Be(e)?e:null:null}function mn(e){return ye(e)?e.scrollX:e.scrollLeft}function xn(e){return ye(e)?e.scrollY:e.scrollTop}function yt(e){return{x:mn(e),y:xn(e)}}var A;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(A||(A={}));function yn(e){return!it||!e?!1:e===document.scrollingElement}function wn(e){const t={x:0,y:0},n=yn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},o=e.scrollTop<=t.y,s=e.scrollLeft<=t.x,a=e.scrollTop>=r.y,l=e.scrollLeft>=r.x;return{isTop:o,isLeft:s,isBottom:a,isRight:l,maxScroll:r,minScroll:t}}const oo={x:.2,y:.2};function so(e,t,n,r,o){let{top:s,left:a,right:l,bottom:c}=n;r===void 0&&(r=10),o===void 0&&(o=oo);const{isTop:d,isBottom:f,isLeft:h,isRight:m}=wn(e),g={x:0,y:0},w={x:0,y:0},v={height:t.height*o.y,width:t.width*o.x};return!d&&s<=t.top+v.height?(g.y=A.Backward,w.y=r*Math.abs((t.top+v.height-s)/v.height)):!f&&c>=t.bottom-v.height&&(g.y=A.Forward,w.y=r*Math.abs((t.bottom-v.height-c)/v.height)),!m&&l>=t.right-v.width?(g.x=A.Forward,w.x=r*Math.abs((t.right-v.width-l)/v.width)):!h&&a<=t.left+v.width&&(g.x=A.Backward,w.x=r*Math.abs((t.left+v.width-a)/v.width)),{direction:g,speed:w}}function io(e){if(e===document.scrollingElement){const{innerWidth:s,innerHeight:a}=window;return{top:0,left:0,right:s,bottom:a,width:s,height:a}}const{top:t,left:n,right:r,bottom:o}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:o,width:e.clientWidth,height:e.clientHeight}}function Sn(e){return e.reduce((t,n)=>xe(t,yt(n)),q)}function ao(e){return e.reduce((t,n)=>t+mn(n),0)}function lo(e){return e.reduce((t,n)=>t+xn(n),0)}function co(e,t){if(t===void 0&&(t=Se),!e)return;const{top:n,left:r,bottom:o,right:s}=t(e);bn(e)&&(o<=0||s<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const uo=[["x",["left","right"],ao],["y",["top","bottom"],lo]];class Ot{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Tt(n),o=Sn(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[s,a,l]of uo)for(const c of a)Object.defineProperty(this,c,{get:()=>{const d=l(r),f=o[s]-d;return this.rect[c]+f},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ae{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var o;(o=this.target)==null||o.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function fo(e){const{EventTarget:t}=F(e);return e instanceof t?e:we(e)}function vt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var H;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(H||(H={}));function tn(e){e.preventDefault()}function ho(e){e.stopPropagation()}var I;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(I||(I={}));const Dn={start:[I.Space,I.Enter],cancel:[I.Esc],end:[I.Space,I.Enter,I.Tab]},go=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case I.Right:return{...n,x:n.x+25};case I.Left:return{...n,x:n.x-25};case I.Down:return{...n,y:n.y+25};case I.Up:return{...n,y:n.y-25}}};class Cn{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ae(we(n)),this.windowListeners=new Ae(F(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(H.Resize,this.handleCancel),this.windowListeners.add(H.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(H.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&co(r),n(q)}handleKeyDown(t){if(jt(t)){const{active:n,context:r,options:o}=this.props,{keyboardCodes:s=Dn,coordinateGetter:a=go,scrollBehavior:l="smooth"}=o,{code:c}=t;if(s.end.includes(c)){this.handleEnd(t);return}if(s.cancel.includes(c)){this.handleCancel(t);return}const{collisionRect:d}=r.current,f=d?{x:d.left,y:d.top}:q;this.referenceCoordinates||(this.referenceCoordinates=f);const h=a(t,{active:n,context:r.current,currentCoordinates:f});if(h){const m=tt(h,f),g={x:0,y:0},{scrollableAncestors:w}=r.current;for(const v of w){const y=t.code,{isTop:E,isRight:C,isLeft:b,isBottom:p,maxScroll:D,minScroll:R}=wn(v),x=io(v),S={x:Math.min(y===I.Right?x.right-x.width/2:x.right,Math.max(y===I.Right?x.left:x.left+x.width/2,h.x)),y:Math.min(y===I.Down?x.bottom-x.height/2:x.bottom,Math.max(y===I.Down?x.top:x.top+x.height/2,h.y))},j=y===I.Right&&!C||y===I.Left&&!b,O=y===I.Down&&!p||y===I.Up&&!E;if(j&&S.x!==h.x){const N=v.scrollLeft+m.x,W=y===I.Right&&N<=D.x||y===I.Left&&N>=R.x;if(W&&!m.y){v.scrollTo({left:N,behavior:l});return}W?g.x=v.scrollLeft-N:g.x=y===I.Right?v.scrollLeft-D.x:v.scrollLeft-R.x,g.x&&v.scrollBy({left:-g.x,behavior:l});break}else if(O&&S.y!==h.y){const N=v.scrollTop+m.y,W=y===I.Down&&N<=D.y||y===I.Up&&N>=R.y;if(W&&!m.x){v.scrollTo({top:N,behavior:l});return}W?g.y=v.scrollTop-N:g.y=y===I.Down?v.scrollTop-D.y:v.scrollTop-R.y,g.y&&v.scrollBy({top:-g.y,behavior:l});break}}this.handleMove(t,xe(tt(h,this.referenceCoordinates),g))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Cn.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Dn,onActivation:o}=t,{active:s}=n;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const l=s.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),o==null||o({event:e.nativeEvent}),!0)}return!1}}];function nn(e){return!!(e&&"distance"in e)}function rn(e){return!!(e&&"delay"in e)}class At{constructor(t,n,r){var o;r===void 0&&(r=fo(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:s}=t,{target:a}=s;this.props=t,this.events=n,this.document=we(a),this.documentListeners=new Ae(this.document),this.listeners=new Ae(r),this.windowListeners=new Ae(F(a)),this.initialCoordinates=(o=xt(s))!=null?o:q,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(H.Resize,this.handleCancel),this.windowListeners.add(H.DragStart,tn),this.windowListeners.add(H.VisibilityChange,this.handleCancel),this.windowListeners.add(H.ContextMenu,tn),this.documentListeners.add(H.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(rn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(nn(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:o}=this.props;o(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(H.Click,ho,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(H.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:o,props:s}=this,{onMove:a,options:{activationConstraint:l}}=s;if(!o)return;const c=(n=xt(t))!=null?n:q,d=tt(o,c);if(!r&&l){if(nn(l)){if(l.tolerance!=null&&vt(d,l.tolerance))return this.handleCancel();if(vt(d,l.distance))return this.handleStart()}if(rn(l)&&vt(d,l.tolerance))return this.handleCancel();this.handlePending(l,d);return}t.cancelable&&t.preventDefault(),a(c)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===I.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const po={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class kt extends At{constructor(t){const{event:n}=t,r=we(n.target);super(t,po,r)}}kt.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const vo={move:{name:"mousemove"},end:{name:"mouseup"}};var wt;(function(e){e[e.RightClick=2]="RightClick"})(wt||(wt={}));class bo extends At{constructor(t){super(t,vo,we(t.event.target))}}bo.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===wt.RightClick?!1:(r==null||r({event:n}),!0)}}];const bt={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class mo extends At{constructor(t){super(t,bt)}static setup(){return window.addEventListener(bt.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(bt.move.name,t)};function t(){}}}mo.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:o}=n;return o.length>1?!1:(r==null||r({event:n}),!0)}}];var ke;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(ke||(ke={}));var rt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(rt||(rt={}));function xo(e){let{acceleration:t,activator:n=ke.Pointer,canScroll:r,draggingRect:o,enabled:s,interval:a=5,order:l=rt.TreeOrder,pointerCoordinates:c,scrollableAncestors:d,scrollableAncestorRects:f,delta:h,threshold:m}=e;const g=wo({delta:h,disabled:!s}),[w,v]=Ir(),y=i.useRef({x:0,y:0}),E=i.useRef({x:0,y:0}),C=i.useMemo(()=>{switch(n){case ke.Pointer:return c?{top:c.y,bottom:c.y,left:c.x,right:c.x}:null;case ke.DraggableRect:return o}},[n,o,c]),b=i.useRef(null),p=i.useCallback(()=>{const R=b.current;if(!R)return;const x=y.current.x*E.current.x,S=y.current.y*E.current.y;R.scrollBy(x,S)},[]),D=i.useMemo(()=>l===rt.TreeOrder?[...d].reverse():d,[l,d]);i.useEffect(()=>{if(!s||!d.length||!C){v();return}for(const R of D){if((r==null?void 0:r(R))===!1)continue;const x=d.indexOf(R),S=f[x];if(!S)continue;const{direction:j,speed:O}=so(R,S,C,t,m);for(const N of["x","y"])g[N][j[N]]||(O[N]=0,j[N]=0);if(O.x>0||O.y>0){v(),b.current=R,w(p,a),y.current=O,E.current=j;return}}y.current={x:0,y:0},E.current={x:0,y:0},v()},[t,p,r,v,s,a,JSON.stringify(C),JSON.stringify(g),w,d,D,f,JSON.stringify(m)])}const yo={x:{[A.Backward]:!1,[A.Forward]:!1},y:{[A.Backward]:!1,[A.Forward]:!1}};function wo(e){let{delta:t,disabled:n}=e;const r=mt(t);return $e(o=>{if(n||!r||!o)return yo;const s={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[A.Backward]:o.x[A.Backward]||s.x===-1,[A.Forward]:o.x[A.Forward]||s.x===1},y:{[A.Backward]:o.y[A.Backward]||s.y===-1,[A.Forward]:o.y[A.Forward]||s.y===1}}},[n,t,r])}function So(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return $e(o=>{var s;return t==null?null:(s=r??o)!=null?s:null},[r,t])}function Do(e,t){return i.useMemo(()=>e.reduce((n,r)=>{const{sensor:o}=r,s=o.activators.map(a=>({eventName:a.eventName,handler:t(a.handler,r)}));return[...n,...s]},[]),[e,t])}var Fe;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Fe||(Fe={}));var St;(function(e){e.Optimized="optimized"})(St||(St={}));const on=new Map;function Co(e,t){let{dragging:n,dependencies:r,config:o}=t;const[s,a]=i.useState(null),{frequency:l,measure:c,strategy:d}=o,f=i.useRef(e),h=y(),m=ze(h),g=i.useCallback(function(E){E===void 0&&(E=[]),!m.current&&a(C=>C===null?E:C.concat(E.filter(b=>!C.includes(b))))},[m]),w=i.useRef(null),v=$e(E=>{if(h&&!n)return on;if(!E||E===on||f.current!==e||s!=null){const C=new Map;for(let b of e){if(!b)continue;if(s&&s.length>0&&!s.includes(b.id)&&b.rect.current){C.set(b.id,b.rect.current);continue}const p=b.node.current,D=p?new Ot(c(p),p):null;b.rect.current=D,D&&C.set(b.id,D)}return C}return E},[e,s,n,h,c]);return i.useEffect(()=>{f.current=e},[e]),i.useEffect(()=>{h||g()},[n,h]),i.useEffect(()=>{s&&s.length>0&&a(null)},[JSON.stringify(s)]),i.useEffect(()=>{h||typeof l!="number"||w.current!==null||(w.current=setTimeout(()=>{g(),w.current=null},l))},[l,h,g,...r]),{droppableRects:v,measureDroppableContainers:g,measuringScheduled:s!=null};function y(){switch(d){case Fe.Always:return!1;case Fe.BeforeDragging:return n;default:return!n}}}function Rn(e,t){return $e(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Ro(e,t){return Rn(e,t)}function Eo(e){let{callback:t,disabled:n}=e;const r=Nt(t),o=i.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:s}=window;return new s(r)},[r,n]);return i.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function at(e){let{callback:t,disabled:n}=e;const r=Nt(t),o=i.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:s}=window;return new s(r)},[n]);return i.useEffect(()=>()=>o==null?void 0:o.disconnect(),[o]),o}function Io(e){return new Ot(Se(e),e)}function sn(e,t,n){t===void 0&&(t=Io);const[r,o]=i.useState(null);function s(){o(c=>{if(!e)return null;if(e.isConnected===!1){var d;return(d=c??n)!=null?d:null}const f=t(e);return JSON.stringify(c)===JSON.stringify(f)?c:f})}const a=Eo({callback(c){if(e)for(const d of c){const{type:f,target:h}=d;if(f==="childList"&&h instanceof HTMLElement&&h.contains(e)){s();break}}}}),l=at({callback:s});return Z(()=>{s(),e?(l==null||l.observe(e),a==null||a.observe(document.body,{childList:!0,subtree:!0})):(l==null||l.disconnect(),a==null||a.disconnect())},[e]),r}function Mo(e){const t=Rn(e);return vn(e,t)}const an=[];function No(e){const t=i.useRef(e),n=$e(r=>e?r&&r!==an&&e&&t.current&&e.parentNode===t.current.parentNode?r:Tt(e):an,[e]);return i.useEffect(()=>{t.current=e},[e]),n}function jo(e){const[t,n]=i.useState(null),r=i.useRef(e),o=i.useCallback(s=>{const a=pt(s.target);a&&n(l=>l?(l.set(a,yt(a)),new Map(l)):null)},[]);return i.useEffect(()=>{const s=r.current;if(e!==s){a(s);const l=e.map(c=>{const d=pt(c);return d?(d.addEventListener("scroll",o,{passive:!0}),[d,yt(d)]):null}).filter(c=>c!=null);n(l.length?new Map(l):null),r.current=e}return()=>{a(e),a(s)};function a(l){l.forEach(c=>{const d=pt(c);d==null||d.removeEventListener("scroll",o)})}},[o,e]),i.useMemo(()=>e.length?t?Array.from(t.values()).reduce((s,a)=>xe(s,a),q):Sn(e):q,[e,t])}function ln(e,t){t===void 0&&(t=[]);const n=i.useRef(null);return i.useEffect(()=>{n.current=null},t),i.useEffect(()=>{const r=e!==q;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?tt(e,n.current):q}function To(e){i.useEffect(()=>{if(!it)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function Oo(e,t){return i.useMemo(()=>e.reduce((n,r)=>{let{eventName:o,handler:s}=r;return n[o]=a=>{s(a,t)},n},{}),[e,t])}function En(e){return i.useMemo(()=>e?to(e):null,[e])}const cn=[];function Ao(e,t){t===void 0&&(t=Se);const[n]=e,r=En(n?F(n):null),[o,s]=i.useState(cn);function a(){s(()=>e.length?e.map(c=>yn(c)?r:new Ot(t(c),c)):cn)}const l=at({callback:a});return Z(()=>{l==null||l.disconnect(),a(),e.forEach(c=>l==null?void 0:l.observe(c))},[e]),o}function ko(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Be(t)?t:e}function Lo(e){let{measure:t}=e;const[n,r]=i.useState(null),o=i.useCallback(d=>{for(const{target:f}of d)if(Be(f)){r(h=>{const m=t(f);return h?{...h,width:m.width,height:m.height}:m});break}},[t]),s=at({callback:o}),a=i.useCallback(d=>{const f=ko(d);s==null||s.disconnect(),f&&(s==null||s.observe(f)),r(f?t(f):null)},[t,s]),[l,c]=et(a);return i.useMemo(()=>({nodeRef:l,rect:n,setRef:c}),[n,l,c])}const zo=[{sensor:kt,options:{}},{sensor:Cn,options:{}}],Po={current:{}},Qe={draggable:{measure:en},droppable:{measure:en,strategy:Fe.WhileDragging,frequency:St.Optimized},dragOverlay:{measure:Se}};class Le extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const Fo={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Le,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:nt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Qe,measureDroppableContainers:nt,windowRect:null,measuringScheduled:!1},Bo={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:nt,draggableNodes:new Map,over:null,measureDroppableContainers:nt},lt=i.createContext(Bo),In=i.createContext(Fo);function $o(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Le}}}function Uo(e,t){switch(t.type){case T.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case T.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case T.DragEnd:case T.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case T.RegisterDroppable:{const{element:n}=t,{id:r}=n,o=new Le(e.droppable.containers);return o.set(r,n),{...e,droppable:{...e.droppable,containers:o}}}case T.SetDroppableDisabled:{const{id:n,key:r,disabled:o}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const a=new Le(e.droppable.containers);return a.set(n,{...s,disabled:o}),{...e,droppable:{...e.droppable,containers:a}}}case T.UnregisterDroppable:{const{id:n,key:r}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const s=new Le(e.droppable.containers);return s.delete(n),{...e,droppable:{...e.droppable,containers:s}}}default:return e}}function Vo(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:o}=i.useContext(lt),s=mt(r),a=mt(n==null?void 0:n.id);return i.useEffect(()=>{if(!t&&!r&&s&&a!=null){if(!jt(s)||document.activeElement===s.target)return;const l=o.get(a);if(!l)return;const{activatorNode:c,node:d}=l;if(!c.current&&!d.current)return;requestAnimationFrame(()=>{for(const f of[c.current,d.current]){if(!f)continue;const h=jr(f);if(h){h.focus();break}}})}},[r,t,o,a,s]),null}function Xo(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((o,s)=>s({transform:o,...r}),n):n}function _o(e){return i.useMemo(()=>({draggable:{...Qe.draggable,...e==null?void 0:e.draggable},droppable:{...Qe.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Qe.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Ho(e){let{activeNode:t,measure:n,initialRect:r,config:o=!0}=e;const s=i.useRef(!1),{x:a,y:l}=typeof o=="boolean"?{x:o,y:o}:o;Z(()=>{if(!a&&!l||!t){s.current=!1;return}if(s.current||!r)return;const d=t==null?void 0:t.node.current;if(!d||d.isConnected===!1)return;const f=n(d),h=vn(f,r);if(a||(h.x=0),l||(h.y=0),s.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const m=bn(d);m&&m.scrollBy({top:h.y,left:h.x})}},[t,a,l,r,n])}const Mn=i.createContext({...q,scaleX:1,scaleY:1});var de;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(de||(de={}));const Wo=i.memo(function(t){var n,r,o,s;let{id:a,accessibility:l,autoScroll:c=!0,children:d,sensors:f=zo,collisionDetection:h=qr,measuring:m,modifiers:g,...w}=t;const v=i.useReducer(Uo,void 0,$o),[y,E]=v,[C,b]=zr(),[p,D]=i.useState(de.Uninitialized),R=p===de.Initialized,{draggable:{active:x,nodes:S,translate:j},droppable:{containers:O}}=y,N=x!=null?S.get(x):null,W=i.useRef({initial:null,translated:null}),Y=i.useMemo(()=>{var L;return x!=null?{id:x,data:(L=N==null?void 0:N.data)!=null?L:Po,rect:W}:null},[x,N]),K=i.useRef(null),[De,Ve]=i.useState(null),[B,Xe]=i.useState(null),ee=ze(w,Object.values(w)),Ce=Ue("DndDescribedBy",a),_e=i.useMemo(()=>O.getEnabled(),[O]),z=_o(m),{droppableRects:te,measureDroppableContainers:fe,measuringScheduled:Re}=Co(_e,{dragging:R,dependencies:[j.x,j.y],config:z.droppable}),X=So(S,x),He=i.useMemo(()=>B?xt(B):null,[B]),se=Un(),ne=Ro(X,z.draggable.measure);Ho({activeNode:x!=null?S.get(x):null,config:se.layoutShiftCompensation,initialRect:ne,measure:z.draggable.measure});const M=sn(X,z.draggable.measure,ne),Ee=sn(X?X.parentElement:null),G=i.useRef({activatorEvent:null,active:null,activeNode:X,collisionRect:null,collisions:null,droppableRects:te,draggableNodes:S,draggingNode:null,draggingNodeRect:null,droppableContainers:O,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),he=O.getNodeFor((n=G.current.over)==null?void 0:n.id),re=Lo({measure:z.dragOverlay.measure}),ge=(r=re.nodeRef.current)!=null?r:X,pe=R?(o=re.rect)!=null?o:M:null,Lt=!!(re.nodeRef.current&&re.rect),zt=Mo(Lt?null:M),ct=En(ge?F(ge):null),ie=No(R?he??X:null),We=Ao(ie),Ye=Xo(g,{transform:{x:j.x-zt.x,y:j.y-zt.y,scaleX:1,scaleY:1},activatorEvent:B,active:Y,activeNodeRect:M,containerNodeRect:Ee,draggingNodeRect:pe,over:G.current.over,overlayNodeRect:re.rect,scrollableAncestors:ie,scrollableAncestorRects:We,windowRect:ct}),Pt=He?xe(He,j):null,Ft=jo(ie),kn=ln(Ft),Ln=ln(Ft,[M]),ve=xe(Ye,kn),be=pe?Jr(pe,Ye):null,Ie=Y&&be?h({active:Y,collisionRect:be,droppableRects:te,droppableContainers:_e,pointerCoordinates:Pt}):null,Bt=Hr(Ie,"id"),[ae,$t]=i.useState(null),zn=Lt?Ye:xe(Ye,Ln),Pn=Kr(zn,(s=ae==null?void 0:ae.rect)!=null?s:null,M),ut=i.useRef(null),Ut=i.useCallback((L,$)=>{let{sensor:U,options:le}=$;if(K.current==null)return;const _=S.get(K.current);if(!_)return;const V=L.nativeEvent,J=new U({active:K.current,activeNode:_,event:V,options:le,context:G,onAbort(k){if(!S.get(k))return;const{onDragAbort:Q}=ee.current,oe={id:k};Q==null||Q(oe),C({type:"onDragAbort",event:oe})},onPending(k,ce,Q,oe){if(!S.get(k))return;const{onDragPending:Ne}=ee.current,ue={id:k,constraint:ce,initialCoordinates:Q,offset:oe};Ne==null||Ne(ue),C({type:"onDragPending",event:ue})},onStart(k){const ce=K.current;if(ce==null)return;const Q=S.get(ce);if(!Q)return;const{onDragStart:oe}=ee.current,Me={activatorEvent:V,active:{id:ce,data:Q.data,rect:W}};Oe.unstable_batchedUpdates(()=>{oe==null||oe(Me),D(de.Initializing),E({type:T.DragStart,initialCoordinates:k,active:ce}),C({type:"onDragStart",event:Me}),Ve(ut.current),Xe(V)})},onMove(k){E({type:T.DragMove,coordinates:k})},onEnd:me(T.DragEnd),onCancel:me(T.DragCancel)});ut.current=J;function me(k){return async function(){const{active:Q,collisions:oe,over:Me,scrollAdjustedTranslate:Ne}=G.current;let ue=null;if(Q&&Ne){const{cancelDrop:je}=ee.current;ue={activatorEvent:V,active:Q,collisions:oe,delta:Ne,over:Me},k===T.DragEnd&&typeof je=="function"&&await Promise.resolve(je(ue))&&(k=T.DragCancel)}K.current=null,Oe.unstable_batchedUpdates(()=>{E({type:k}),D(de.Uninitialized),$t(null),Ve(null),Xe(null),ut.current=null;const je=k===T.DragEnd?"onDragEnd":"onDragCancel";if(ue){const dt=ee.current[je];dt==null||dt(ue),C({type:je,event:ue})}})}}},[S]),Fn=i.useCallback((L,$)=>(U,le)=>{const _=U.nativeEvent,V=S.get(le);if(K.current!==null||!V||_.dndKit||_.defaultPrevented)return;const J={active:V};L(U,$.options,J)===!0&&(_.dndKit={capturedBy:$.sensor},K.current=le,Ut(U,$))},[S,Ut]),Vt=Do(f,Fn);To(f),Z(()=>{M&&p===de.Initializing&&D(de.Initialized)},[M,p]),i.useEffect(()=>{const{onDragMove:L}=ee.current,{active:$,activatorEvent:U,collisions:le,over:_}=G.current;if(!$||!U)return;const V={active:$,activatorEvent:U,collisions:le,delta:{x:ve.x,y:ve.y},over:_};Oe.unstable_batchedUpdates(()=>{L==null||L(V),C({type:"onDragMove",event:V})})},[ve.x,ve.y]),i.useEffect(()=>{const{active:L,activatorEvent:$,collisions:U,droppableContainers:le,scrollAdjustedTranslate:_}=G.current;if(!L||K.current==null||!$||!_)return;const{onDragOver:V}=ee.current,J=le.get(Bt),me=J&&J.rect.current?{id:J.id,rect:J.rect.current,data:J.data,disabled:J.disabled}:null,k={active:L,activatorEvent:$,collisions:U,delta:{x:_.x,y:_.y},over:me};Oe.unstable_batchedUpdates(()=>{$t(me),V==null||V(k),C({type:"onDragOver",event:k})})},[Bt]),Z(()=>{G.current={activatorEvent:B,active:Y,activeNode:X,collisionRect:be,collisions:Ie,droppableRects:te,draggableNodes:S,draggingNode:ge,draggingNodeRect:pe,droppableContainers:O,over:ae,scrollableAncestors:ie,scrollAdjustedTranslate:ve},W.current={initial:pe,translated:be}},[Y,X,Ie,be,S,ge,pe,te,O,ae,ie,ve]),xo({...se,delta:j,draggingRect:be,pointerCoordinates:Pt,scrollableAncestors:ie,scrollableAncestorRects:We});const Bn=i.useMemo(()=>({active:Y,activeNode:X,activeNodeRect:M,activatorEvent:B,collisions:Ie,containerNodeRect:Ee,dragOverlay:re,draggableNodes:S,droppableContainers:O,droppableRects:te,over:ae,measureDroppableContainers:fe,scrollableAncestors:ie,scrollableAncestorRects:We,measuringConfiguration:z,measuringScheduled:Re,windowRect:ct}),[Y,X,M,B,Ie,Ee,re,S,O,te,ae,fe,ie,We,z,Re,ct]),$n=i.useMemo(()=>({activatorEvent:B,activators:Vt,active:Y,activeNodeRect:M,ariaDescribedById:{draggable:Ce},dispatch:E,draggableNodes:S,over:ae,measureDroppableContainers:fe}),[B,Vt,Y,M,E,Ce,S,ae,fe]);return P.createElement(pn.Provider,{value:b},P.createElement(lt.Provider,{value:$n},P.createElement(In.Provider,{value:Bn},P.createElement(Mn.Provider,{value:Pn},d)),P.createElement(Vo,{disabled:(l==null?void 0:l.restoreFocus)===!1})),P.createElement(Br,{...l,hiddenTextDescribedById:Ce}));function Un(){const L=(De==null?void 0:De.autoScrollEnabled)===!1,$=typeof c=="object"?c.enabled===!1:c===!1,U=R&&!L&&!$;return typeof c=="object"?{...c,enabled:U}:{enabled:U}}}),Yo=i.createContext(null),un="button",qo="Draggable";function Ko(e){let{id:t,data:n,disabled:r=!1,attributes:o}=e;const s=Ue(qo),{activators:a,activatorEvent:l,active:c,activeNodeRect:d,ariaDescribedById:f,draggableNodes:h,over:m}=i.useContext(lt),{role:g=un,roleDescription:w="draggable",tabIndex:v=0}=o??{},y=(c==null?void 0:c.id)===t,E=i.useContext(y?Mn:Yo),[C,b]=et(),[p,D]=et(),R=Oo(a,t),x=ze(n);Z(()=>(h.set(t,{id:t,key:s,node:C,activatorNode:p,data:x}),()=>{const j=h.get(t);j&&j.key===s&&h.delete(t)}),[h,t]);const S=i.useMemo(()=>({role:g,tabIndex:v,"aria-disabled":r,"aria-pressed":y&&g===un?!0:void 0,"aria-roledescription":w,"aria-describedby":f.draggable}),[r,g,v,y,w,f.draggable]);return{active:c,activatorEvent:l,activeNodeRect:d,attributes:S,isDragging:y,listeners:r?void 0:R,node:C,over:m,setNodeRef:b,setActivatorNodeRef:D,transform:E}}function Go(){return i.useContext(In)}const Jo="Droppable",Qo={timeout:25};function Zo(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:o}=e;const s=Ue(Jo),{active:a,dispatch:l,over:c,measureDroppableContainers:d}=i.useContext(lt),f=i.useRef({disabled:n}),h=i.useRef(!1),m=i.useRef(null),g=i.useRef(null),{disabled:w,updateMeasurementsFor:v,timeout:y}={...Qo,...o},E=ze(v??r),C=i.useCallback(()=>{if(!h.current){h.current=!0;return}g.current!=null&&clearTimeout(g.current),g.current=setTimeout(()=>{d(Array.isArray(E.current)?E.current:[E.current]),g.current=null},y)},[y]),b=at({callback:C,disabled:w||!a}),p=i.useCallback((S,j)=>{b&&(j&&(b.unobserve(j),h.current=!1),S&&b.observe(S))},[b]),[D,R]=et(p),x=ze(t);return i.useEffect(()=>{!b||!D.current||(b.disconnect(),h.current=!1,b.observe(D.current))},[D,b]),i.useEffect(()=>(l({type:T.RegisterDroppable,element:{id:r,key:s,disabled:n,node:D,rect:m,data:x}}),()=>l({type:T.UnregisterDroppable,key:s,id:r})),[r]),i.useEffect(()=>{n!==f.current.disabled&&(l({type:T.SetDroppableDisabled,id:r,key:s,disabled:n}),f.current.disabled=n)},[r,s,n,l]),{active:a,rect:m,isOver:(c==null?void 0:c.id)===r,node:D,over:c,setNodeRef:R}}function Nn(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function es(e,t){return e.reduce((n,r,o)=>{const s=t.get(r);return s&&(n[o]=s),n},Array(e.length))}function Ge(e){return e!==null&&e>=0}function ts(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ns(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Je={scaleX:1,scaleY:1},rs=e=>{var t;let{rects:n,activeNodeRect:r,activeIndex:o,overIndex:s,index:a}=e;const l=(t=n[o])!=null?t:r;if(!l)return null;const c=os(n,a,o);if(a===o){const d=n[s];return d?{x:o<s?d.left+d.width-(l.left+l.width):d.left-l.left,y:0,...Je}:null}return a>o&&a<=s?{x:-l.width-c,y:0,...Je}:a<o&&a>=s?{x:l.width+c,y:0,...Je}:{x:0,y:0,...Je}};function os(e,t,n){const r=e[t],o=e[t-1],s=e[t+1];return!r||!o&&!s?0:n<t?o?r.left-(o.left+o.width):s.left-(r.left+r.width):s?s.left-(r.left+r.width):r.left-(o.left+o.width)}const jn=e=>{let{rects:t,activeIndex:n,overIndex:r,index:o}=e;const s=Nn(t,r,n),a=t[o],l=s[o];return!l||!a?null:{x:l.left-a.left,y:l.top-a.top,scaleX:l.width/a.width,scaleY:l.height/a.height}},Tn="Sortable",On=P.createContext({activeIndex:-1,containerId:Tn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:jn,disabled:{draggable:!1,droppable:!1}});function ss(e){let{children:t,id:n,items:r,strategy:o=jn,disabled:s=!1}=e;const{active:a,dragOverlay:l,droppableRects:c,over:d,measureDroppableContainers:f}=Go(),h=Ue(Tn,n),m=l.rect!==null,g=i.useMemo(()=>r.map(R=>typeof R=="object"&&"id"in R?R.id:R),[r]),w=a!=null,v=a?g.indexOf(a.id):-1,y=d?g.indexOf(d.id):-1,E=i.useRef(g),C=!ts(g,E.current),b=y!==-1&&v===-1||C,p=ns(s);Z(()=>{C&&w&&f(g)},[C,g,w,f]),i.useEffect(()=>{E.current=g},[g]);const D=i.useMemo(()=>({activeIndex:v,containerId:h,disabled:p,disableTransforms:b,items:g,overIndex:y,useDragOverlay:m,sortedRects:es(g,c),strategy:o}),[v,h,p.draggable,p.droppable,b,g,y,c,m,o]);return P.createElement(On.Provider,{value:D},t)}const is=e=>{let{id:t,items:n,activeIndex:r,overIndex:o}=e;return Nn(n,r,o).indexOf(t)},as=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:o,items:s,newIndex:a,previousItems:l,previousContainerId:c,transition:d}=e;return!d||!r||l!==s&&o===a?!1:n?!0:a!==o&&t===c},ls={duration:200,easing:"ease"},An="transform",cs=Pe.Transition.toString({property:An,duration:0,easing:"linear"}),us={roleDescription:"sortable"};function ds(e){let{disabled:t,index:n,node:r,rect:o}=e;const[s,a]=i.useState(null),l=i.useRef(n);return Z(()=>{if(!t&&n!==l.current&&r.current){const c=o.current;if(c){const d=Se(r.current,{ignoreTransform:!0}),f={x:c.left-d.left,y:c.top-d.top,scaleX:c.width/d.width,scaleY:c.height/d.height};(f.x||f.y)&&a(f)}}n!==l.current&&(l.current=n)},[t,n,r,o]),i.useEffect(()=>{s&&a(null)},[s]),s}function fs(e){let{animateLayoutChanges:t=as,attributes:n,disabled:r,data:o,getNewIndex:s=is,id:a,strategy:l,resizeObserverConfig:c,transition:d=ls}=e;const{items:f,containerId:h,activeIndex:m,disabled:g,disableTransforms:w,sortedRects:v,overIndex:y,useDragOverlay:E,strategy:C}=i.useContext(On),b=hs(r,g),p=f.indexOf(a),D=i.useMemo(()=>({sortable:{containerId:h,index:p,items:f},...o}),[h,o,p,f]),R=i.useMemo(()=>f.slice(f.indexOf(a)),[f,a]),{rect:x,node:S,isOver:j,setNodeRef:O}=Zo({id:a,data:D,disabled:b.droppable,resizeObserverConfig:{updateMeasurementsFor:R,...c}}),{active:N,activatorEvent:W,activeNodeRect:Y,attributes:K,setNodeRef:De,listeners:Ve,isDragging:B,over:Xe,setActivatorNodeRef:ee,transform:Ce}=Ko({id:a,data:D,attributes:{...us,...n},disabled:b.draggable}),_e=Er(O,De),z=!!N,te=z&&!w&&Ge(m)&&Ge(y),fe=!E&&B,Re=fe&&te?Ce:null,He=te?Re??(l??C)({rects:v,activeNodeRect:Y,activeIndex:m,overIndex:y,index:p}):null,se=Ge(m)&&Ge(y)?s({id:a,items:f,activeIndex:m,overIndex:y}):p,ne=N==null?void 0:N.id,M=i.useRef({activeId:ne,items:f,newIndex:se,containerId:h}),Ee=f!==M.current.items,G=t({active:N,containerId:h,isDragging:B,isSorting:z,id:a,index:p,items:f,newIndex:M.current.newIndex,previousItems:M.current.items,previousContainerId:M.current.containerId,transition:d,wasDragging:M.current.activeId!=null}),he=ds({disabled:!G,index:p,node:S,rect:x});return i.useEffect(()=>{z&&M.current.newIndex!==se&&(M.current.newIndex=se),h!==M.current.containerId&&(M.current.containerId=h),f!==M.current.items&&(M.current.items=f)},[z,se,h,f]),i.useEffect(()=>{if(ne===M.current.activeId)return;if(ne!=null&&M.current.activeId==null){M.current.activeId=ne;return}const ge=setTimeout(()=>{M.current.activeId=ne},50);return()=>clearTimeout(ge)},[ne]),{active:N,activeIndex:m,attributes:K,data:D,rect:x,index:p,newIndex:se,items:f,isOver:j,isSorting:z,isDragging:B,listeners:Ve,node:S,overIndex:y,over:Xe,setNodeRef:_e,setActivatorNodeRef:ee,setDroppableNodeRef:O,setDraggableNodeRef:De,transform:he??He,transition:re()};function re(){if(he||Ee&&M.current.newIndex===p)return cs;if(!(fe&&!jt(W)||!d)&&(z||G))return Pe.Transition.toString({...d,property:An})}}function hs(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}I.Down,I.Right,I.Up,I.Left;const gs=e=>{let{transform:t}=e;return{...t,y:0}};function ps({tab:e,isActive:t,isEditing:n,editValue:r,onEditValueChange:o,onSelect:s,onStartRename:a,onCommitRename:l,onCancelRename:c,onContextMenu:d,inputRef:f}){const{attributes:h,listeners:m,setNodeRef:g,transform:w,transition:v,isDragging:y}=fs({id:e.id,disabled:n}),E={transform:Pe.Translate.toString(w),transition:v,zIndex:y?10:void 0,opacity:y?.5:void 0};return u.jsxs("button",{ref:g,style:E,className:br("flex items-center gap-1.5 px-3 py-1 text-sm rounded-t border-b-2 cursor-pointer select-none","hover:bg-muted/50 transition-colors",t?"border-primary bg-background text-foreground font-medium":"border-transparent text-muted-foreground"),onClick:s,onDoubleClick:a,onContextMenu:d,...h,...m,children:[e.type==="datasource"?u.jsx(Rt,{className:"size-3.5"}):u.jsx(fn,{className:"size-3.5"}),n?u.jsx("input",{ref:f,className:"w-20 bg-transparent border-b border-primary text-sm outline-none",value:r,onChange:C=>o(C.target.value),onBlur:l,onKeyDown:C=>{C.key==="Enter"&&l(),C.key==="Escape"&&c(),C.stopPropagation()},onMouseDown:C=>C.stopPropagation(),onClick:C=>C.stopPropagation(),onPointerDown:C=>C.stopPropagation()}):u.jsx("span",{children:e.name})]})}function vs({tabs:e,activeTabId:t,onSelectTab:n,onAddTab:r,onRenameTab:o,onDeleteTab:s,onMoveTab:a}){const[l,c]=i.useState(null),[d,f]=i.useState(""),[h,m]=i.useState(null),g=i.useRef(null),w=Ur($r(kt,{activationConstraint:{distance:5}}));i.useEffect(()=>{if(!l)return;const b=setTimeout(()=>{g.current&&(g.current.focus(),g.current.select())},50);return()=>clearTimeout(b)},[l]);const v=i.useCallback(b=>{c(b.id),f(b.name)},[]),y=i.useCallback(()=>{l&&d.trim()&&o(l,d.trim()),c(null)},[l,d,o]),E=i.useCallback(()=>{c(null)},[]),C=i.useCallback(b=>{const{active:p,over:D}=b;if(!D||p.id===D.id||!a)return;const R=e.findIndex(S=>S.id===p.id),x=e.findIndex(S=>S.id===D.id);R!==-1&&x!==-1&&a(R,x)},[e,a]);return u.jsxs("div",{className:"flex items-center border-t bg-muted/30 px-1 h-9 shrink-0",children:[u.jsx(Wo,{sensors:w,collisionDetection:Wr,modifiers:[gs],onDragEnd:C,children:u.jsx(ss,{items:e.map(b=>b.id),strategy:rs,children:e.map(b=>u.jsxs(Kt,{open:h===b.id,onOpenChange:p=>{p||m(null)},children:[u.jsx(Gt,{asChild:!0,children:u.jsx("div",{children:u.jsx(ps,{tab:b,isActive:b.id===t,isEditing:l===b.id,editValue:d,onEditValueChange:f,onSelect:()=>n(b.id),onStartRename:()=>v(b),onCommitRename:y,onCancelRename:E,onContextMenu:p=>{p.preventDefault(),m(b.id)},inputRef:g})})}),u.jsxs(Jt,{align:"start",children:[u.jsx(Ke,{onClick:()=>{m(null),setTimeout(()=>v(b),0)},children:"Rename"}),e.length>1&&u.jsxs(u.Fragment,{children:[u.jsx(vr,{}),u.jsx(Ke,{variant:"destructive",onClick:()=>s(b.id),children:"Delete"})]})]})]},b.id))})}),u.jsxs(Kt,{children:[u.jsx(Gt,{asChild:!0,children:u.jsx("button",{className:"flex items-center justify-center size-7 ml-1 rounded hover:bg-muted/50 text-muted-foreground cursor-pointer",children:u.jsx(mr,{className:"size-4"})})}),u.jsxs(Jt,{align:"start",children:[u.jsxs(Ke,{onClick:()=>r("sheet"),children:[u.jsx(fn,{className:"size-4"}),"New Sheet"]}),u.jsxs(Ke,{onClick:()=>r("datasource"),children:[u.jsx(Rt,{className:"size-4"}),"New DataSource"]})]})]})]})}const bs=i.lazy(()=>Ct(()=>import("./sheet-view-DeS6Ogvs.js").then(e=>e.s),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),ms=i.lazy(()=>Ct(()=>import("./datasource-view-Cqhvl9Bo.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,10,8,11])).then(e=>({default:e.DataSourceView}))),xs=i.lazy(()=>Ct(()=>import("./datasource-selector-CjdR-eM5.js"),__vite__mapDeps([12,1,2,13,14,6,7,5,10,8,15,11,16,17,18,19,20,4,21,22])).then(e=>({default:e.DataSourceSelector}))),ys={main:[{title:"Documents",url:"/",icon:Jn},{title:"Data Sources",url:"/datasources",icon:Rt}],secondary:[{title:"Settings",url:"/settings",icon:Gn}]};function ws(e){if(!e)return;const t=e.getRoot();if(t.tabs||!t.sheet)return;const r="tab-1";e.update(o=>{o.tabs={[r]:{id:r,name:"Sheet1",type:"sheet"}},o.tabOrder=[r],o.sheets={[r]:{sheet:o.sheet||{},rowHeights:o.rowHeights||{},colWidths:o.colWidths||{},colStyles:o.colStyles||{},rowStyles:o.rowStyles||{},sheetStyle:o.sheetStyle,conditionalFormats:[],merges:o.merges||{},charts:{},frozenRows:o.frozenRows||0,frozenCols:o.frozenCols||0}},delete o.sheet,delete o.rowHeights,delete o.colWidths,delete o.colStyles,delete o.rowStyles,delete o.sheetStyle,delete o.merges,delete o.frozenRows,delete o.frozenCols})}function dn(){return`tab-${Date.now()}-${Math.random().toString(36).slice(2,6)}`}function Ss({documentId:e}){Rr();const t=_n(),{doc:n}=st.useDocument(),[r,o]=i.useState(null),[s,a]=i.useState(!1),[l,c]=i.useState(!1),{data:d}=ot({queryKey:["document",e],queryFn:()=>Wn(e)}),f=i.useCallback(async p=>{await Hn(e,p),t.invalidateQueries({queryKey:["document",e]}),t.invalidateQueries({queryKey:["documents"]})},[e,t]);i.useEffect(()=>{n&&(ws(n),a(!0))},[n]),i.useEffect(()=>{if(!n||!s)return;const p=n.getRoot();p.tabOrder&&p.tabOrder.length>0&&!r&&o(p.tabOrder[0])},[n,s,r]);const h=i.useCallback(()=>{if(!n)return;const p=n.getRoot(),D=dn(),R=p.tabOrder.filter(x=>{var S;return((S=p.tabs[x])==null?void 0:S.type)==="sheet"}).length+1;n.update(x=>{x.tabs[D]={id:D,name:`Sheet${R}`,type:"sheet"},x.tabOrder.push(D),x.sheets[D]={sheet:{},rowHeights:{},colWidths:{},colStyles:{},rowStyles:{},conditionalFormats:[],merges:{},charts:{},frozenRows:0,frozenCols:0}}),o(D)},[n]),m=i.useCallback(p=>{if(!n)return;const D=n.getRoot(),R=dn(),x=D.tabOrder.filter(S=>{var j;return((j=D.tabs[S])==null?void 0:j.type)==="datasource"}).length+1;n.update(S=>{S.tabs[R]={id:R,name:p.name||`DataSource${x}`,type:"datasource",datasourceId:p.id,query:""},S.tabOrder.push(R)}),o(R)},[n]),g=i.useCallback(p=>{p==="datasource"?c(!0):h()},[h]),w=i.useCallback((p,D)=>{n&&n.update(R=>{R.tabs[p]&&(R.tabs[p].name=D)})},[n]),v=i.useCallback(p=>{if(!n)return;const D=n.getRoot();if(D.tabOrder.length<=1)return;const R=D.tabOrder.indexOf(p);if(n.update(x=>{delete x.tabs[p],x.sheets[p]&&delete x.sheets[p];const S=x.tabOrder.indexOf(p);S!==-1&&x.tabOrder.splice(S,1)}),r===p){const x=n.getRoot(),S=Math.min(R,x.tabOrder.length-1);o(x.tabOrder[S])}},[n,r]),y=i.useCallback((p,D)=>{n&&n.update(R=>{const[x]=R.tabOrder.splice(p,1);R.tabOrder.splice(D,0,x)})},[n]);if(!n||!s||!r)return u.jsx(Ze,{});const E=n.getRoot(),C=E.tabOrder.map(p=>E.tabs[p]).filter(Boolean),b=E.tabs[r];return u.jsxs(qn,{children:[u.jsx(Kn,{variant:"inset",items:ys}),u.jsxs(Qn,{children:[u.jsx(Zn,{title:(d==null?void 0:d.title)??"Loading...",editable:!0,onRename:f,children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Cr,{documentId:e}),u.jsx(wr,{})]})}),u.jsxs("div",{className:"flex flex-1 flex-col",children:[u.jsx("div",{className:"@container/main flex flex-1 flex-col gap-2",children:u.jsx("div",{className:"flex flex-col h-full",children:u.jsx(i.Suspense,{fallback:u.jsx(Ze,{}),children:(b==null?void 0:b.type)==="datasource"?u.jsx(ms,{tabId:r}):u.jsx(bs,{tabId:r})})})}),u.jsx(vs,{tabs:C,activeTabId:r,onSelectTab:o,onAddTab:g,onRenameTab:w,onDeleteTab:v,onMoveTab:y})]})]}),l&&u.jsx(i.Suspense,{fallback:null,children:u.jsx(xs,{open:l,onOpenChange:c,onSelect:m})})]})}function Us(){const{id:e}=Vn(),{data:t,isLoading:n,isError:r}=ot({queryKey:["me"],queryFn:Dt,retry:!1,staleTime:5*60*1e3});return n?u.jsx(Ze,{}):r||!t?u.jsx(Xn,{to:"/login",replace:!0}):!t.username||!t.email?u.jsx(Ze,{}):u.jsx(st.DocumentProvider,{docKey:`sheet-${e}`,initialRoot:gr,initialPresence:{username:t.username,email:t.email,photo:t.photo||""},enableDevtools:!1,children:u.jsx(Ss,{documentId:e})})}export{Us as DocumentDetail,Us as default};
