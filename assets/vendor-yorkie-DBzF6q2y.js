var Fd=Object.defineProperty;var Kd=(dt,Pe,st)=>Pe in dt?Fd(dt,Pe,{enumerable:!0,configurable:!0,writable:!0,value:st}):dt[Pe]=st;var h=(dt,Pe,st)=>Kd(dt,typeof Pe!="symbol"?Pe+"":Pe,st);import{e as Md,f as Jd}from"./vendor-react-B8NMt2sn.js";var ln={exports:{}},Xd=ln.exports,Ta;function _d(){return Ta||(Ta=1,function(dt,Pe){var st={};(function(ie,kt){kt(Pe,Md(),Jd())})(Xd,function(ie,kt,W){var L;(function(n){n[n.Canceled=1]="Canceled",n[n.Unknown=2]="Unknown",n[n.InvalidArgument=3]="InvalidArgument",n[n.DeadlineExceeded=4]="DeadlineExceeded",n[n.NotFound=5]="NotFound",n[n.AlreadyExists=6]="AlreadyExists",n[n.PermissionDenied=7]="PermissionDenied",n[n.ResourceExhausted=8]="ResourceExhausted",n[n.FailedPrecondition=9]="FailedPrecondition",n[n.Aborted=10]="Aborted",n[n.OutOfRange=11]="OutOfRange",n[n.Unimplemented=12]="Unimplemented",n[n.Internal=13]="Internal",n[n.Unavailable=14]="Unavailable",n[n.DataLoss=15]="DataLoss",n[n.Unauthenticated=16]="Unauthenticated"})(L||(L={}));function Xn(n,e){return n!==null&&typeof n=="object"&&"$typeName"in n&&typeof n.$typeName=="string"?e===void 0?!0:e.typeName===n.$typeName:!1}var p;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(p||(p={}));function Va(){let n=0,e=0;for(let r=0;r<28;r+=7){let s=this.buf[this.pos++];if(n|=(s&127)<<r,(s&128)==0)return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[n,e];for(let r=3;r<=31;r+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<r,(s&128)==0)return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function _n(n,e,t){for(let i=0;i<28;i=i+7){const o=n>>>i,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(t.push(c),!a)return}const r=n>>>28&15|(e&7)<<4,s=e>>3!=0;if(t.push((s?r|128:r)&255),!!s){for(let i=3;i<31;i=i+7){const o=e>>>i,a=!!(o>>>7),c=(a?o|128:o)&255;if(t.push(c),!a)return}t.push(e>>>31&1)}}const hn=4294967296;function os(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let r=0,s=0;function i(o,a){const c=Number(n.slice(o,a));s*=t,r=r*t+c,r>=hn&&(s=s+(r/hn|0),r=r%hn)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),e?cs(r,s):$n(r,s)}function Da(n,e){let t=$n(n,e);const r=t.hi&2147483648;r&&(t=cs(t.lo,t.hi));const s=as(t.lo,t.hi);return r?"-"+s:s}function as(n,e){if({lo:n,hi:e}=xa(n,e),e<=2097151)return String(hn*e+n);const t=n&16777215,r=(n>>>24|e<<8)&16777215,s=e>>16&65535;let i=t+r*6777216+s*6710656,o=r+s*8147497,a=s*2;const c=1e7;return i>=c&&(o+=Math.floor(i/c),i%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+us(o)+us(i)}function xa(n,e){return{lo:n>>>0,hi:e>>>0}}function $n(n,e){return{lo:n|0,hi:e|0}}function cs(n,e){return e=~e,n?n=~n+1:e+=1,$n(n,e)}const us=n=>{const e=String(n);return"0000000".slice(e.length)+e};function zn(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function La(){let n=this.buf[this.pos++],e=n&127;if((n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,(n&128)==0)return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;(n&128)!==0&&t<10;t++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}const M=Ba();function Ba(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(!!globalThis.Deno||typeof process!="object"||typeof st!="object"||st.BUF_BIGINT_DISABLE!=="1")){const t=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),s=BigInt("0"),i=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(o){const a=typeof o=="bigint"?o:BigInt(o);if(a>r||a<t)throw new Error(`invalid int64: ${o}`);return a},uParse(o){const a=typeof o=="bigint"?o:BigInt(o);if(a>i||a<s)throw new Error(`invalid uint64: ${o}`);return a},enc(o){return n.setBigInt64(0,this.parse(o),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(o){return n.setBigInt64(0,this.uParse(o),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(o,a){return n.setInt32(0,o,!0),n.setInt32(4,a,!0),n.getBigInt64(0,!0)},uDec(o,a){return n.setInt32(0,o,!0),n.setInt32(4,a,!0),n.getBigUint64(0,!0)}}}return{zero:"0",supported:!1,parse(t){return typeof t!="string"&&(t=t.toString()),ls(t),t},uParse(t){return typeof t!="string"&&(t=t.toString()),hs(t),t},enc(t){return typeof t!="string"&&(t=t.toString()),ls(t),os(t)},uEnc(t){return typeof t!="string"&&(t=t.toString()),hs(t),os(t)},dec(t,r){return Da(t,r)},uDec(t,r){return as(t,r)}}}function ls(n){if(!/^-?[0-9]+$/.test(n))throw new Error("invalid int64: "+n)}function hs(n){if(!/^[0-9]+$/.test(n))throw new Error("invalid uint64: "+n)}function it(n,e){switch(n){case p.STRING:return"";case p.BOOL:return!1;case p.DOUBLE:case p.FLOAT:return 0;case p.INT64:case p.UINT64:case p.SFIXED64:case p.FIXED64:case p.SINT64:return e?"0":M.zero;case p.BYTES:return new Uint8Array(0);default:return 0}}function Wa(n,e){switch(n){case p.BOOL:return e===!1;case p.STRING:return e==="";case p.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}const ds=2,Ze=Symbol.for("reflect unsafe local");function fs(n,e){const t=n[e.localName].case;return t===void 0?t:e.fields.find(r=>r.localName===t)}function ka(n,e){const t=e.localName;if(e.oneof)return n[e.oneof.localName].case===t;if(e.presence!=ds)return n[t]!==void 0&&Object.prototype.hasOwnProperty.call(n,t);switch(e.fieldKind){case"list":return n[t].length>0;case"map":return Object.keys(n[t]).length>0;case"scalar":return!Wa(e.scalar,n[t]);case"enum":return n[t]!==e.enum.values[0].number}throw new Error("message field with implicit presence")}function Ot(n,e){return Object.prototype.hasOwnProperty.call(n,e)&&n[e]!==void 0}function gs(n,e){if(e.oneof){const t=n[e.oneof.localName];return t.case===e.localName?t.value:void 0}return n[e.localName]}function ms(n,e,t){e.oneof?n[e.oneof.localName]={case:e.localName,value:t}:n[e.localName]=t}function Oa(n,e){const t=e.localName;if(e.oneof){const r=e.oneof.localName;n[r].case===t&&(n[r]={case:void 0})}else if(e.presence!=ds)delete n[t];else switch(e.fieldKind){case"map":n[t]={};break;case"list":n[t]=[];break;case"enum":n[t]=e.enum.values[0].number;break;case"scalar":n[t]=it(e.scalar,e.longAsString);break}}function $e(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function jn(n,e){var t,r,s,i;if($e(n)&&Ze in n&&"add"in n&&"field"in n&&typeof n.field=="function"){if(e!==void 0){const o=e,a=n.field();return o.listKind==a.listKind&&o.scalar===a.scalar&&((t=o.message)===null||t===void 0?void 0:t.typeName)===((r=a.message)===null||r===void 0?void 0:r.typeName)&&((s=o.enum)===null||s===void 0?void 0:s.typeName)===((i=a.enum)===null||i===void 0?void 0:i.typeName)}return!0}return!1}function Qn(n,e){var t,r,s,i;if($e(n)&&Ze in n&&"has"in n&&"field"in n&&typeof n.field=="function"){if(e!==void 0){const o=e,a=n.field();return o.mapKey===a.mapKey&&o.mapKind==a.mapKind&&o.scalar===a.scalar&&((t=o.message)===null||t===void 0?void 0:t.typeName)===((r=a.message)===null||r===void 0?void 0:r.typeName)&&((s=o.enum)===null||s===void 0?void 0:s.typeName)===((i=a.enum)===null||i===void 0?void 0:i.typeName)}return!0}return!1}function Hn(n,e){return $e(n)&&Ze in n&&"desc"in n&&$e(n.desc)&&n.desc.kind==="message"&&(e===void 0||n.desc.typeName==e.typeName)}function Pa(n){return ps(n.$typeName)}function Pt(n){const e=n.fields[0];return ps(n.typeName)&&e!==void 0&&e.fieldKind=="scalar"&&e.name=="value"&&e.number==1}function ps(n){return n.startsWith("google.protobuf.")&&["DoubleValue","FloatValue","Int64Value","UInt64Value","Int32Value","UInt32Value","BoolValue","StringValue","BytesValue"].includes(n.substring(16))}const Za=999,Ua=998,dn=2;function N(n,e){if(Xn(e,n))return e;const t=Ma(n);return e!==void 0&&Ya(n,t,e),t}function Ya(n,e,t){for(const r of n.members){let s=t[r.localName];if(s==null)continue;let i;if(r.kind=="oneof"){const o=fs(t,r);if(!o)continue;i=o,s=gs(t,o)}else i=r;switch(i.fieldKind){case"message":s=qn(i,s);break;case"scalar":s=bs(i,s);break;case"list":s=Fa(i,s);break;case"map":s=Ga(i,s);break}ms(e,i,s)}return e}function bs(n,e){return n.scalar==p.BYTES?er(e):e}function Ga(n,e){if($e(e)){if(n.scalar==p.BYTES)return ys(e,er);if(n.mapKind=="message")return ys(e,t=>qn(n,t))}return e}function Fa(n,e){if(Array.isArray(e)){if(n.scalar==p.BYTES)return e.map(er);if(n.listKind=="message")return e.map(t=>qn(n,t))}return e}function qn(n,e){if(n.fieldKind=="message"&&!n.oneof&&Pt(n.message))return bs(n.message.fields[0],e);if($e(e)){if(n.message.typeName=="google.protobuf.Struct"&&n.parent.typeName!=="google.protobuf.Value")return e;if(!Xn(e,n.message))return N(n.message,e)}return e}function er(n){return Array.isArray(n)?new Uint8Array(n):n}function ys(n,e){const t={};for(const r of Object.entries(n))t[r[0]]=e(r[1]);return t}const Ka=Symbol(),As=new WeakMap;function Ma(n){let e;if(Ja(n)){const t=As.get(n);let r,s;if(t)({prototype:r,members:s}=t);else{r={},s=new Set;for(const i of n.members)i.kind!="oneof"&&(i.fieldKind!="scalar"&&i.fieldKind!="enum"||i.presence!=dn&&(s.add(i),r[i.localName]=tr(i)));As.set(n,{prototype:r,members:s})}e=Object.create(r),e.$typeName=n.typeName;for(const i of n.members)s.has(i)||i.kind=="field"&&(i.fieldKind=="message"||(i.fieldKind=="scalar"||i.fieldKind=="enum")&&i.presence!=dn)||(e[i.localName]=tr(i))}else{e={$typeName:n.typeName};for(const t of n.members)(t.kind=="oneof"||t.presence==dn)&&(e[t.localName]=tr(t))}return e}function Ja(n){switch(n.file.edition){case Za:return!1;case Ua:return!0;default:return n.fields.some(e=>e.presence!=dn&&e.fieldKind!="message"&&!e.oneof)}}function tr(n){if(n.kind=="oneof")return{case:void 0};if(n.fieldKind=="list")return[];if(n.fieldKind=="map")return{};if(n.fieldKind=="message")return Ka;const e=n.getDefaultValue();return e!==void 0?n.fieldKind=="scalar"&&n.longAsString?e.toString():e:n.fieldKind=="scalar"?it(n.scalar,n.longAsString):n.enum.values[0].number}const Xa=["FieldValueInvalidError","FieldListRangeError","ForeignFieldError"];class oe extends Error{constructor(e,t,r="FieldValueInvalidError"){super(t),this.name=r,this.field=()=>e}}function _a(n){return n instanceof Error&&Xa.includes(n.name)&&"field"in n&&typeof n.field=="function"}const nr=Symbol.for("@bufbuild/protobuf/text-encoding");function rr(){if(globalThis[nr]==null){const n=new globalThis.TextEncoder,e=new globalThis.TextDecoder;globalThis[nr]={encodeUtf8(t){return n.encode(t)},decodeUtf8(t){return e.decode(t)},checkUtf8(t){try{return encodeURIComponent(t),!0}catch{return!1}}}}return globalThis[nr]}var $;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})($||($={}));const vs=34028234663852886e22,Ss=-34028234663852886e22,Is=4294967295,Es=2147483647,Ns=-2147483648;class ws{constructor(e=rr().encodeUtf8){this.encodeUtf8=e,this.stack=[],this.chunks=[],this.buf=[]}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let t=new Uint8Array(e),r=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],r),r+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Rs(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return ir(e),zn(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.encodeUtf8(e);return this.uint32(t.byteLength),this.raw(t)}float(e){$a(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){Rs(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){ir(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return ir(e),e=(e<<1^e>>31)>>>0,zn(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),s=M.enc(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),s=M.uEnc(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=M.enc(e);return _n(t.lo,t.hi,this.buf),this}sint64(e){const t=M.enc(e),r=t.hi>>31,s=t.lo<<1^r,i=(t.hi<<1|t.lo>>>31)^r;return _n(s,i,this.buf),this}uint64(e){const t=M.uEnc(e);return _n(t.lo,t.hi,this.buf),this}}class sr{constructor(e,t=rr().decodeUtf8){this.decodeUtf8=t,this.varint64=Va,this.uint32=La,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength)}tag(){let e=this.uint32(),t=e>>>3,r=e&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e,t){let r=this.pos;switch(e){case $.Varint:for(;this.buf[this.pos++]&128;);break;case $.Bit64:this.pos+=4;case $.Bit32:this.pos+=4;break;case $.LengthDelimited:let s=this.uint32();this.pos+=s;break;case $.StartGroup:for(;;){const[i,o]=this.tag();if(o===$.EndGroup){if(t!==void 0&&i!==t)throw new Error("invalid end group tag");break}this.skip(o,i)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return M.dec(...this.varint64())}uint64(){return M.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(e&1);return e=(e>>>1|(t&1)<<31)^r,t=t>>>1^r,M.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return M.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return M.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.decodeUtf8(this.bytes())}}function ir(n){if(typeof n=="string")n=Number(n);else if(typeof n!="number")throw new Error("invalid int32: "+typeof n);if(!Number.isInteger(n)||n>Es||n<Ns)throw new Error("invalid int32: "+n)}function Rs(n){if(typeof n=="string")n=Number(n);else if(typeof n!="number")throw new Error("invalid uint32: "+typeof n);if(!Number.isInteger(n)||n>Is||n<0)throw new Error("invalid uint32: "+n)}function $a(n){if(typeof n=="string"){const e=n;if(n=Number(n),Number.isNaN(n)&&e!=="NaN")throw new Error("invalid float32: "+e)}else if(typeof n!="number")throw new Error("invalid float32: "+typeof n);if(Number.isFinite(n)&&(n>vs||n<Ss))throw new Error("invalid float32: "+n)}function ot(n,e){const t=n.fieldKind=="list"?jn(e,n):n.fieldKind=="map"?Qn(e,n):or(n,e);if(t===!0)return;let r;switch(n.fieldKind){case"list":r=`expected ${Ds(n)}, got ${H(e)}`;break;case"map":r=`expected ${xs(n)}, got ${H(e)}`;break;default:r=fn(n,e,t)}return new oe(n,r)}function Cs(n,e,t){const r=or(n,t);if(r!==!0)return new oe(n,`list item #${e+1}: ${fn(n,t,r)}`)}function za(n,e,t){const r=Ts(e,n.mapKey);if(r!==!0)return new oe(n,`invalid map key: ${fn({scalar:n.mapKey},e,r)}`);const s=or(n,t);if(s!==!0)return new oe(n,`map entry ${H(e)}: ${fn(n,t,s)}`)}function or(n,e){return n.scalar!==void 0?Ts(e,n.scalar):n.enum!==void 0?n.enum.open?Number.isInteger(e):n.enum.values.some(t=>t.number===e):Hn(e,n.message)}function Ts(n,e){switch(e){case p.DOUBLE:return typeof n=="number";case p.FLOAT:return typeof n!="number"?!1:Number.isNaN(n)||!Number.isFinite(n)?!0:n>vs||n<Ss?`${n.toFixed()} out of range`:!0;case p.INT32:case p.SFIXED32:case p.SINT32:return typeof n!="number"||!Number.isInteger(n)?!1:n>Es||n<Ns?`${n.toFixed()} out of range`:!0;case p.FIXED32:case p.UINT32:return typeof n!="number"||!Number.isInteger(n)?!1:n>Is||n<0?`${n.toFixed()} out of range`:!0;case p.BOOL:return typeof n=="boolean";case p.STRING:return typeof n!="string"?!1:rr().checkUtf8(n)||"invalid UTF8";case p.BYTES:return n instanceof Uint8Array;case p.INT64:case p.SFIXED64:case p.SINT64:if(typeof n=="bigint"||typeof n=="number"||typeof n=="string"&&n.length>0)try{return M.parse(n),!0}catch{return`${n} out of range`}return!1;case p.FIXED64:case p.UINT64:if(typeof n=="bigint"||typeof n=="number"||typeof n=="string"&&n.length>0)try{return M.uParse(n),!0}catch{return`${n} out of range`}return!1}}function fn(n,e,t){return t=typeof t=="string"?`: ${t}`:`, got ${H(e)}`,n.scalar!==void 0?`expected ${ja(n.scalar)}`+t:n.enum!==void 0?`expected ${n.enum.toString()}`+t:`expected ${Vs(n.message)}`+t}function H(n){switch(typeof n){case"object":return n===null?"null":n instanceof Uint8Array?`Uint8Array(${n.length})`:Array.isArray(n)?`Array(${n.length})`:jn(n)?Ds(n.field()):Qn(n)?xs(n.field()):Hn(n)?Vs(n.desc):Xn(n)?`message ${n.$typeName}`:"object";case"string":return n.length>30?"string":`"${n.split('"').join('\\"')}"`;case"boolean":return String(n);case"number":return String(n);case"bigint":return String(n)+"n";default:return typeof n}}function Vs(n){return`ReflectMessage (${n.typeName})`}function Ds(n){switch(n.listKind){case"message":return`ReflectList (${n.message.toString()})`;case"enum":return`ReflectList (${n.enum.toString()})`;case"scalar":return`ReflectList (${p[n.scalar]})`}}function xs(n){switch(n.mapKind){case"message":return`ReflectMap (${p[n.mapKey]}, ${n.message.toString()})`;case"enum":return`ReflectMap (${p[n.mapKey]}, ${n.enum.toString()})`;case"scalar":return`ReflectMap (${p[n.mapKey]}, ${p[n.scalar]})`}}function ja(n){switch(n){case p.STRING:return"string";case p.BOOL:return"boolean";case p.INT64:case p.SINT64:case p.SFIXED64:return"bigint (int64)";case p.UINT64:case p.FIXED64:return"bigint (uint64)";case p.BYTES:return"Uint8Array";case p.DOUBLE:return"number (float64)";case p.FLOAT:return"number (float32)";case p.FIXED32:case p.UINT32:return"number (uint32)";case p.INT32:case p.SFIXED32:case p.SINT32:return"number (int32)"}}function fe(n,e,t=!0){return new Bs(n,e,t)}const Ls=new WeakMap;class Bs{get sortedFields(){const e=Ls.get(this.desc);if(e)return e;const t=this.desc.fields.concat().sort((r,s)=>r.number-s.number);return Ls.set(this.desc,t),t}constructor(e,t,r=!0){this.lists=new Map,this.maps=new Map,this.check=r,this.desc=e,this.message=this[Ze]=t??N(e),this.fields=e.fields,this.oneofs=e.oneofs,this.members=e.members}findNumber(e){return this._fieldsByNumber||(this._fieldsByNumber=new Map(this.desc.fields.map(t=>[t.number,t]))),this._fieldsByNumber.get(e)}oneofCase(e){return Zt(this.message,e),fs(this.message,e)}isSet(e){return Zt(this.message,e),ka(this.message,e)}clear(e){Zt(this.message,e),Oa(this.message,e)}get(e){Zt(this.message,e);const t=gs(this.message,e);switch(e.fieldKind){case"list":let r=this.lists.get(e);return(!r||r[Ze]!==t)&&this.lists.set(e,r=new Qa(e,t,this.check)),r;case"map":let s=this.maps.get(e);return(!s||s[Ze]!==t)&&this.maps.set(e,s=new Ha(e,t,this.check)),s;case"message":return cr(e,t,this.check);case"scalar":return t===void 0?it(e.scalar,!1):hr(e,t);case"enum":return t??e.enum.values[0].number}}set(e,t){if(Zt(this.message,e),this.check){const s=ot(e,t);if(s)throw s}let r;e.fieldKind=="message"?r=ar(e,t):Qn(t)||jn(t)?r=t[Ze]:r=dr(e,t),ms(this.message,e,r)}getUnknown(){return this.message.$unknown}setUnknown(e){this.message.$unknown=e}}function Zt(n,e){if(e.parent.typeName!==n.$typeName)throw new oe(e,`cannot use ${e.toString()} with message ${n.$typeName}`,"ForeignFieldError")}class Qa{field(){return this._field}get size(){return this._arr.length}constructor(e,t,r){this._field=e,this._arr=this[Ze]=t,this.check=r}get(e){const t=this._arr[e];return t===void 0?void 0:ur(this._field,t,this.check)}set(e,t){if(e<0||e>=this._arr.length)throw new oe(this._field,`list item #${e+1}: out of range`);if(this.check){const r=Cs(this._field,e,t);if(r)throw r}this._arr[e]=Ws(this._field,t)}add(e){if(this.check){const t=Cs(this._field,this._arr.length,e);if(t)throw t}this._arr.push(Ws(this._field,e))}clear(){this._arr.splice(0,this._arr.length)}[Symbol.iterator](){return this.values()}keys(){return this._arr.keys()}*values(){for(const e of this._arr)yield ur(this._field,e,this.check)}*entries(){for(let e=0;e<this._arr.length;e++)yield[e,ur(this._field,this._arr[e],this.check)]}}class Ha{constructor(e,t,r=!0){this.obj=this[Ze]=t??{},this.check=r,this._field=e}field(){return this._field}set(e,t){if(this.check){const r=za(this._field,e,t);if(r)throw r}return this.obj[gn(e)]=qa(this._field,t),this}delete(e){const t=gn(e),r=Object.prototype.hasOwnProperty.call(this.obj,t);return r&&delete this.obj[t],r}clear(){for(const e of Object.keys(this.obj))delete this.obj[e]}get(e){let t=this.obj[gn(e)];return t!==void 0&&(t=lr(this._field,t,this.check)),t}has(e){return Object.prototype.hasOwnProperty.call(this.obj,gn(e))}*keys(){for(const e of Object.keys(this.obj))yield ks(e,this._field.mapKey)}*entries(){for(const e of Object.entries(this.obj))yield[ks(e[0],this._field.mapKey),lr(this._field,e[1],this.check)]}[Symbol.iterator](){return this.entries()}get size(){return Object.keys(this.obj).length}*values(){for(const e of Object.values(this.obj))yield lr(this._field,e,this.check)}forEach(e,t){for(const r of this.entries())e.call(t,r[1],r[0],this)}}function ar(n,e){return Hn(e)?Pa(e.message)&&!n.oneof&&n.fieldKind=="message"?e.message.value:e.desc.typeName=="google.protobuf.Struct"&&n.parent.typeName!="google.protobuf.Value"?Ps(e.message):e.message:e}function cr(n,e,t){return e!==void 0&&(Pt(n.message)&&!n.oneof&&n.fieldKind=="message"?e={$typeName:n.message.typeName,value:hr(n.message.fields[0],e)}:n.message.typeName=="google.protobuf.Struct"&&n.parent.typeName!="google.protobuf.Value"&&$e(e)&&(e=Os(e))),new Bs(n.message,e,t)}function Ws(n,e){return n.listKind=="message"?ar(n,e):dr(n,e)}function ur(n,e,t){return n.listKind=="message"?cr(n,e,t):hr(n,e)}function qa(n,e){return n.mapKind=="message"?ar(n,e):dr(n,e)}function lr(n,e,t){return n.mapKind=="message"?cr(n,e,t):e}function gn(n){return typeof n=="string"||typeof n=="number"?n:String(n)}function ks(n,e){switch(e){case p.STRING:return n;case p.INT32:case p.FIXED32:case p.UINT32:case p.SFIXED32:case p.SINT32:{const t=Number.parseInt(n);if(Number.isFinite(t))return t;break}case p.BOOL:switch(n){case"true":return!0;case"false":return!1}break;case p.UINT64:case p.FIXED64:try{return M.uParse(n)}catch{}break;default:try{return M.parse(n)}catch{}break}return n}function hr(n,e){switch(n.scalar){case p.INT64:case p.SFIXED64:case p.SINT64:"longAsString"in n&&n.longAsString&&typeof e=="string"&&(e=M.parse(e));break;case p.FIXED64:case p.UINT64:"longAsString"in n&&n.longAsString&&typeof e=="string"&&(e=M.uParse(e));break}return e}function dr(n,e){switch(n.scalar){case p.INT64:case p.SFIXED64:case p.SINT64:"longAsString"in n&&n.longAsString?e=String(e):(typeof e=="string"||typeof e=="number")&&(e=M.parse(e));break;case p.FIXED64:case p.UINT64:"longAsString"in n&&n.longAsString?e=String(e):(typeof e=="string"||typeof e=="number")&&(e=M.uParse(e));break}return e}function Os(n){const e={$typeName:"google.protobuf.Struct",fields:{}};if($e(n))for(const[t,r]of Object.entries(n))e.fields[t]=Us(r);return e}function Ps(n){const e={};for(const[t,r]of Object.entries(n.fields))e[t]=Zs(r);return e}function Zs(n){switch(n.kind.case){case"structValue":return Ps(n.kind.value);case"listValue":return n.kind.value.values.map(Zs);case"nullValue":case void 0:return null;default:return n.kind.value}}function Us(n){const e={$typeName:"google.protobuf.Value",kind:{case:void 0}};switch(typeof n){case"number":e.kind={case:"numberValue",value:n};break;case"string":e.kind={case:"stringValue",value:n};break;case"boolean":e.kind={case:"boolValue",value:n};break;case"object":if(n===null)e.kind={case:"nullValue",value:0};else if(Array.isArray(n)){const t={$typeName:"google.protobuf.ListValue",values:[]};if(Array.isArray(n))for(const r of n)t.values.push(Us(r));e.kind={case:"listValue",value:t}}else e.kind={case:"structValue",value:Os(n)};break}return e}function fr(n){const e=tc();let t=n.length*3/4;n[n.length-2]=="="?t-=2:n[n.length-1]=="="&&(t-=1);let r=new Uint8Array(t),s=0,i=0,o,a=0;for(let c=0;c<n.length;c++){if(o=e[n.charCodeAt(c)],o===void 0)switch(n[c]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string")}switch(i){case 0:a=o,i=1;break;case 1:r[s++]=a<<2|(o&48)>>4,a=o,i=2;break;case 2:r[s++]=(a&15)<<4|(o&60)>>2,a=o,i=3;break;case 3:r[s++]=(a&3)<<6|o,i=0;break}}if(i==1)throw Error("invalid base64 string");return r.subarray(0,s)}function ec(n,e="std"){const t=Gs(e),r=e=="std";let s="",i=0,o,a=0;for(let c=0;c<n.length;c++)switch(o=n[c],i){case 0:s+=t[o>>2],a=(o&3)<<4,i=1;break;case 1:s+=t[a|o>>4],a=(o&15)<<2,i=2;break;case 2:s+=t[a|o>>6],s+=t[o&63],i=0;break}return i&&(s+=t[a],r&&(s+="=",i==1&&(s+="="))),s}let mn,Ys,ft;function Gs(n){return mn||(mn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Ys=mn.slice(0,-2).concat("-","_")),n=="url"?Ys:mn}function tc(){if(!ft){ft=[];const n=Gs("std");for(let e=0;e<n.length;e++)ft[n[e].charCodeAt(0)]=e;ft[45]=n.indexOf("+"),ft[95]=n.indexOf("/")}return ft}function Ut(n){let e=!1;const t=[];for(let r=0;r<n.length;r++){let s=n.charAt(r);switch(s){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(s),e=!1;break;default:e&&(e=!1,s=s.toUpperCase()),t.push(s);break}}return t.join("")}const nc=new Set(["constructor","toString","toJSON","valueOf"]);function Yt(n){return nc.has(n)?n+"$":n}function gr(n){for(const e of n.field)Ot(e,"jsonName")||(e.jsonName=Ut(e.name));n.nestedType.forEach(gr)}function rc(n,e){const t=n.values.find(r=>r.name===e);if(!t)throw new Error(`cannot parse ${n} default value: ${e}`);return t.number}function sc(n,e){switch(n){case p.STRING:return e;case p.BYTES:{const t=ic(e);if(t===!1)throw new Error(`cannot parse ${p[n]} default value: ${e}`);return t}case p.INT64:case p.SFIXED64:case p.SINT64:return M.parse(e);case p.UINT64:case p.FIXED64:return M.uParse(e);case p.DOUBLE:case p.FLOAT:switch(e){case"inf":return Number.POSITIVE_INFINITY;case"-inf":return Number.NEGATIVE_INFINITY;case"nan":return Number.NaN;default:return parseFloat(e)}case p.BOOL:return e==="true";case p.INT32:case p.UINT32:case p.SINT32:case p.FIXED32:case p.SFIXED32:return parseInt(e,10)}}function ic(n){const e=[],t={tail:n,c:"",next(){return this.tail.length==0?!1:(this.c=this.tail[0],this.tail=this.tail.substring(1),!0)},take(r){if(this.tail.length>=r){const s=this.tail.substring(0,r);return this.tail=this.tail.substring(r),s}return!1}};for(;t.next();)switch(t.c){case"\\":if(t.next())switch(t.c){case"\\":e.push(t.c.charCodeAt(0));break;case"b":e.push(8);break;case"f":e.push(12);break;case"n":e.push(10);break;case"r":e.push(13);break;case"t":e.push(9);break;case"v":e.push(11);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":{const r=t.c,s=t.take(2);if(s===!1)return!1;const i=parseInt(r+s,8);if(Number.isNaN(i))return!1;e.push(i);break}case"x":{const r=t.c,s=t.take(2);if(s===!1)return!1;const i=parseInt(r+s,16);if(Number.isNaN(i))return!1;e.push(i);break}case"u":{const r=t.c,s=t.take(4);if(s===!1)return!1;const i=parseInt(r+s,16);if(Number.isNaN(i))return!1;const o=new Uint8Array(4);new DataView(o.buffer).setInt32(0,i,!0),e.push(o[0],o[1],o[2],o[3]);break}case"U":{const r=t.c,s=t.take(8);if(s===!1)return!1;const i=M.uEnc(r+s),o=new Uint8Array(8),a=new DataView(o.buffer);a.setInt32(0,i.lo,!0),a.setInt32(4,i.hi,!0),e.push(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7]);break}}break;default:e.push(t.c.charCodeAt(0))}return new Uint8Array(e)}function*mr(n){switch(n.kind){case"file":for(const e of n.messages)yield e,yield*mr(e);yield*n.enums,yield*n.services,yield*n.extensions;break;case"message":for(const e of n.nestedMessages)yield e,yield*mr(e);yield*n.nestedEnums,yield*n.nestedExtensions;break}}function Fs(...n){const e=oc();if(!n.length)return e;if("$typeName"in n[0]&&n[0].$typeName=="google.protobuf.FileDescriptorSet"){for(const t of n[0].file)_s(t,e);return e}if("$typeName"in n[0]){let t=function(o){const a=[];for(const c of o.dependency){if(e.getFile(c)!=null||i.has(c))continue;const u=s(c);if(!u)throw new Error(`Unable to resolve ${c}, imported by ${o.name}`);"kind"in u?e.addFile(u,!1,!0):(i.add(u.name),a.push(u))}return a.concat(...a.map(t))};const r=n[0],s=n[1],i=new Set;for(const o of[r,...t(r)].reverse())_s(o,e)}else for(const t of n)for(const r of t.files)e.addFile(r);return e}function oc(){const n=new Map,e=new Map,t=new Map;return{kind:"registry",types:n,extendees:e,[Symbol.iterator](){return n.values()},get files(){return t.values()},addFile(r,s,i){if(t.set(r.proto.name,r),!s)for(const o of mr(r))this.add(o);if(i)for(const o of r.dependencies)this.addFile(o,s,i)},add(r){if(r.kind=="extension"){let s=e.get(r.extendee.typeName);s||e.set(r.extendee.typeName,s=new Map),s.set(r.number,r)}n.set(r.typeName,r)},get(r){return n.get(r)},getFile(r){return t.get(r)},getMessage(r){const s=n.get(r);return(s==null?void 0:s.kind)=="message"?s:void 0},getEnum(r){const s=n.get(r);return(s==null?void 0:s.kind)=="enum"?s:void 0},getExtension(r){const s=n.get(r);return(s==null?void 0:s.kind)=="extension"?s:void 0},getExtensionFor(r,s){var i;return(i=e.get(r.typeName))===null||i===void 0?void 0:i.get(s)},getService(r){const s=n.get(r);return(s==null?void 0:s.kind)=="service"?s:void 0}}}const ac=998,cc=999,uc=9,Gt=10,Ft=11,lc=12,Ks=14,pr=3,hc=2,Ms=1,dc=0,br=1,Js=2,fc=3,gc=1,mc=2,pc=1,Xs={998:{fieldPresence:1,enumType:2,repeatedFieldEncoding:2,utf8Validation:3,messageEncoding:1,jsonFormat:2,enforceNamingStyle:2,defaultSymbolVisibility:1},999:{fieldPresence:2,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:2,defaultSymbolVisibility:1},1e3:{fieldPresence:1,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:2,defaultSymbolVisibility:1},1001:{fieldPresence:1,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:1,defaultSymbolVisibility:2}};function _s(n,e){var t,r;const s={kind:"file",proto:n,deprecated:(r=(t=n.options)===null||t===void 0?void 0:t.deprecated)!==null&&r!==void 0?r:!1,edition:vc(n),name:n.name.replace(/\.proto$/,""),dependencies:Sc(n,e),enums:[],messages:[],extensions:[],services:[],toString(){return`file ${n.name}`}},i=new Map,o={get(a){return i.get(a)},add(a){var c;ve(((c=a.proto.options)===null||c===void 0?void 0:c.mapEntry)===!0),i.set(a.typeName,a)}};for(const a of n.enumType)$s(a,s,void 0,e);for(const a of n.messageType)zs(a,s,void 0,e,o);for(const a of n.service)bc(a,s,e);yr(s,e);for(const a of i.values())Ar(a,e,o);for(const a of s.messages)Ar(a,e,o),yr(a,e);e.addFile(s,!0)}function yr(n,e){switch(n.kind){case"file":for(const t of n.proto.extension){const r=vr(t,n,e);n.extensions.push(r),e.add(r)}break;case"message":for(const t of n.proto.extension){const r=vr(t,n,e);n.nestedExtensions.push(r),e.add(r)}for(const t of n.nestedMessages)yr(t,e);break}}function Ar(n,e,t){const r=n.proto.oneofDecl.map(i=>Ac(i,n)),s=new Set;for(const i of n.proto.field){const o=Nc(i,r),a=vr(i,n,e,o,t);n.fields.push(a),n.field[a.localName]=a,o===void 0?n.members.push(a):(o.fields.push(a),s.has(o)||(s.add(o),n.members.push(o)))}for(const i of r.filter(o=>s.has(o)))n.oneofs.push(i);for(const i of n.nestedMessages)Ar(i,e,t)}function $s(n,e,t,r){var s,i,o,a,c;const u=Ic(n.name,n.value),l={kind:"enum",proto:n,deprecated:(i=(s=n.options)===null||s===void 0?void 0:s.deprecated)!==null&&i!==void 0?i:!1,file:e,parent:t,open:!0,name:n.name,typeName:pn(n,t,e),value:{},values:[],sharedPrefix:u,toString(){return`enum ${this.typeName}`}};l.open=Tc(l),r.add(l);for(const g of n.value){const b=g.name;l.values.push(l.value[g.number]={kind:"enum_value",proto:g,deprecated:(a=(o=g.options)===null||o===void 0?void 0:o.deprecated)!==null&&a!==void 0?a:!1,parent:l,name:b,localName:Yt(u==null?b:b.substring(u.length)),number:g.number,toString(){return`enum value ${l.typeName}.${b}`}})}((c=t==null?void 0:t.nestedEnums)!==null&&c!==void 0?c:e.enums).push(l)}function zs(n,e,t,r,s){var i,o,a,c;const u={kind:"message",proto:n,deprecated:(o=(i=n.options)===null||i===void 0?void 0:i.deprecated)!==null&&o!==void 0?o:!1,file:e,parent:t,name:n.name,typeName:pn(n,t,e),fields:[],field:{},oneofs:[],members:[],nestedEnums:[],nestedMessages:[],nestedExtensions:[],toString(){return`message ${this.typeName}`}};((a=n.options)===null||a===void 0?void 0:a.mapEntry)===!0?s.add(u):(((c=t==null?void 0:t.nestedMessages)!==null&&c!==void 0?c:e.messages).push(u),r.add(u));for(const l of n.enumType)$s(l,e,u,r);for(const l of n.nestedType)zs(l,e,u,r,s)}function bc(n,e,t){var r,s;const i={kind:"service",proto:n,deprecated:(s=(r=n.options)===null||r===void 0?void 0:r.deprecated)!==null&&s!==void 0?s:!1,file:e,name:n.name,typeName:pn(n,void 0,e),methods:[],method:{},toString(){return`service ${this.typeName}`}};e.services.push(i),t.add(i);for(const o of n.method){const a=yc(o,i,t);i.methods.push(a),i.method[a.localName]=a}}function yc(n,e,t){var r,s,i,o;let a;n.clientStreaming&&n.serverStreaming?a="bidi_streaming":n.clientStreaming?a="client_streaming":n.serverStreaming?a="server_streaming":a="unary";const c=t.getMessage(Ue(n.inputType)),u=t.getMessage(Ue(n.outputType));ve(c,`invalid MethodDescriptorProto: input_type ${n.inputType} not found`),ve(u,`invalid MethodDescriptorProto: output_type ${n.inputType} not found`);const l=n.name;return{kind:"rpc",proto:n,deprecated:(s=(r=n.options)===null||r===void 0?void 0:r.deprecated)!==null&&s!==void 0?s:!1,parent:e,name:l,localName:Yt(l.length?Yt(l[0].toLowerCase()+l.substring(1)):l),methodKind:a,input:c,output:u,idempotency:(o=(i=n.options)===null||i===void 0?void 0:i.idempotencyLevel)!==null&&o!==void 0?o:dc,toString(){return`rpc ${e.typeName}.${l}`}}}function Ac(n,e){return{kind:"oneof",proto:n,deprecated:!1,parent:e,fields:[],name:n.name,localName:Yt(Ut(n.name)),toString(){return`oneof ${e.typeName}.${this.name}`}}}function vr(n,e,t,r,s){var i,o,a;const c=s===void 0,u={kind:"field",proto:n,deprecated:(o=(i=n.options)===null||i===void 0?void 0:i.deprecated)!==null&&o!==void 0?o:!1,name:n.name,number:n.number,scalar:void 0,message:void 0,enum:void 0,presence:wc(n,r,c,e),listKind:void 0,mapKind:void 0,mapKey:void 0,delimitedEncoding:void 0,packed:void 0,longAsString:!1,getDefaultValue:void 0};if(c){const m=e.kind=="file"?e:e.file,y=e.kind=="file"?void 0:e,A=pn(n,y,m);u.kind="extension",u.file=m,u.parent=y,u.oneof=void 0,u.typeName=A,u.jsonName=`[${A}]`,u.toString=()=>`extension ${A}`;const I=t.getMessage(Ue(n.extendee));ve(I,`invalid FieldDescriptorProto: extendee ${n.extendee} not found`),u.extendee=I}else{const m=e;ve(m.kind=="message"),u.parent=m,u.oneof=r,u.localName=r?Ut(n.name):Yt(Ut(n.name)),u.jsonName=n.jsonName,u.toString=()=>`field ${m.typeName}.${n.name}`}const l=n.label,g=n.type,b=(a=n.options)===null||a===void 0?void 0:a.jstype;if(l===pr){const m=g==Ft?s==null?void 0:s.get(Ue(n.typeName)):void 0;if(m){u.fieldKind="map";const{key:y,value:A}=Cc(m);return u.mapKey=y.scalar,u.mapKind=A.fieldKind,u.message=A.message,u.delimitedEncoding=!1,u.enum=A.enum,u.scalar=A.scalar,u}switch(u.fieldKind="list",g){case Ft:case Gt:u.listKind="message",u.message=t.getMessage(Ue(n.typeName)),ve(u.message),u.delimitedEncoding=js(n,e);break;case Ks:u.listKind="enum",u.enum=t.getEnum(Ue(n.typeName)),ve(u.enum);break;default:u.listKind="scalar",u.scalar=g,u.longAsString=b==Ms;break}return u.packed=Rc(n,e),u}switch(g){case Ft:case Gt:u.fieldKind="message",u.message=t.getMessage(Ue(n.typeName)),ve(u.message,`invalid FieldDescriptorProto: type_name ${n.typeName} not found`),u.delimitedEncoding=js(n,e),u.getDefaultValue=()=>{};break;case Ks:{const m=t.getEnum(Ue(n.typeName));ve(m!==void 0,`invalid FieldDescriptorProto: type_name ${n.typeName} not found`),u.fieldKind="enum",u.enum=t.getEnum(Ue(n.typeName)),u.getDefaultValue=()=>Ot(n,"defaultValue")?rc(m,n.defaultValue):void 0;break}default:{u.fieldKind="scalar",u.scalar=g,u.longAsString=b==Ms,u.getDefaultValue=()=>Ot(n,"defaultValue")?sc(g,n.defaultValue):void 0;break}}return u}function vc(n){switch(n.syntax){case"":case"proto2":return ac;case"proto3":return cc;case"editions":if(n.edition in Xs)return n.edition;throw new Error(`${n.name}: unsupported edition`);default:throw new Error(`${n.name}: unsupported syntax "${n.syntax}"`)}}function Sc(n,e){return n.dependency.map(t=>{const r=e.getFile(t);if(!r)throw new Error(`Cannot find ${t}, imported by ${n.name}`);return r})}function Ic(n,e){const t=Ec(n)+"_";for(const r of e){if(!r.name.toLowerCase().startsWith(t))return;const s=r.name.substring(t.length);if(s.length==0||/^\d/.test(s))return}return t}function Ec(n){return(n.substring(0,1)+n.substring(1).replace(/[A-Z]/g,e=>"_"+e)).toLowerCase()}function pn(n,e,t){let r;return e?r=`${e.typeName}.${n.name}`:t.proto.package.length>0?r=`${t.proto.package}.${n.name}`:r=`${n.name}`,r}function Ue(n){return n.startsWith(".")?n.substring(1):n}function Nc(n,e){if(!Ot(n,"oneofIndex")||n.proto3Optional)return;const t=e[n.oneofIndex];return ve(t,`invalid FieldDescriptorProto: oneof #${n.oneofIndex} for field #${n.number} not found`),t}function wc(n,e,t,r){if(n.label==hc)return fc;if(n.label==pr)return Js;if(e||n.proto3Optional||t)return br;const s=gt("fieldPresence",{proto:n,parent:r});return s==Js&&(n.type==Ft||n.type==Gt)?br:s}function Rc(n,e){if(n.label!=pr)return!1;switch(n.type){case uc:case lc:case Gt:case Ft:return!1}const t=n.options;return t&&Ot(t,"packed")?t.packed:gc==gt("repeatedFieldEncoding",{proto:n,parent:e})}function Cc(n){const e=n.fields.find(r=>r.number===1),t=n.fields.find(r=>r.number===2);return ve(e&&e.fieldKind=="scalar"&&e.scalar!=p.BYTES&&e.scalar!=p.FLOAT&&e.scalar!=p.DOUBLE&&t&&t.fieldKind!="list"&&t.fieldKind!="map"),{key:e,value:t}}function Tc(n){var e;return pc==gt("enumType",{proto:n.proto,parent:(e=n.parent)!==null&&e!==void 0?e:n.file})}function js(n,e){return n.type==Gt?!0:mc==gt("messageEncoding",{proto:n,parent:e})}function gt(n,e){var t,r;const s=(t=e.proto.options)===null||t===void 0?void 0:t.features;if(s){const i=s[n];if(i!=0)return i}if("kind"in e){if(e.kind=="message")return gt(n,(r=e.parent)!==null&&r!==void 0?r:e.file);const i=Xs[e.edition];if(!i)throw new Error(`feature default for edition ${e.edition} not found`);return i[n]}return gt(n,e.parent)}function ve(n,e){if(!n)throw new Error(e)}function Vc(n){const e=Dc(n);return e.messageType.forEach(gr),Fs(e,()=>{}).getFile(e.name)}function Dc(n){return Object.assign(Object.create({syntax:"",edition:0}),Object.assign(Object.assign({$typeName:"google.protobuf.FileDescriptorProto",dependency:[],publicDependency:[],weakDependency:[],optionDependency:[],service:[],extension:[]},n),{messageType:n.messageType.map(Qs),enumType:n.enumType.map(Hs)}))}function Qs(n){var e,t,r,s,i,o,a,c;return Object.assign(Object.create({visibility:0}),{$typeName:"google.protobuf.DescriptorProto",name:n.name,field:(t=(e=n.field)===null||e===void 0?void 0:e.map(xc))!==null&&t!==void 0?t:[],extension:[],nestedType:(s=(r=n.nestedType)===null||r===void 0?void 0:r.map(Qs))!==null&&s!==void 0?s:[],enumType:(o=(i=n.enumType)===null||i===void 0?void 0:i.map(Hs))!==null&&o!==void 0?o:[],extensionRange:(c=(a=n.extensionRange)===null||a===void 0?void 0:a.map(l=>Object.assign({$typeName:"google.protobuf.DescriptorProto.ExtensionRange"},l)))!==null&&c!==void 0?c:[],oneofDecl:[],reservedRange:[],reservedName:[]})}function xc(n){return Object.assign(Object.create({label:1,typeName:"",extendee:"",defaultValue:"",oneofIndex:0,jsonName:"",proto3Optional:!1}),Object.assign(Object.assign({$typeName:"google.protobuf.FieldDescriptorProto"},n),{options:n.options?Lc(n.options):void 0}))}function Lc(n){var e,t,r;return Object.assign(Object.create({ctype:0,packed:!1,jstype:0,lazy:!1,unverifiedLazy:!1,deprecated:!1,weak:!1,debugRedact:!1,retention:0}),Object.assign(Object.assign({$typeName:"google.protobuf.FieldOptions"},n),{targets:(e=n.targets)!==null&&e!==void 0?e:[],editionDefaults:(r=(t=n.editionDefaults)===null||t===void 0?void 0:t.map(i=>Object.assign({$typeName:"google.protobuf.FieldOptions.EditionDefault"},i)))!==null&&r!==void 0?r:[],uninterpretedOption:[]}))}function Hs(n){return Object.assign(Object.create({visibility:0}),{$typeName:"google.protobuf.EnumDescriptorProto",name:n.name,reservedName:[],reservedRange:[],value:n.value.map(t=>Object.assign({$typeName:"google.protobuf.EnumValueDescriptorProto"},t))})}function T(n,e,...t){return t.reduce((r,s)=>r.nestedMessages[s],n.messages[e])}const Bc=T(Vc({name:"google/protobuf/descriptor.proto",package:"google.protobuf",messageType:[{name:"FileDescriptorSet",field:[{name:"file",number:1,type:11,label:3,typeName:".google.protobuf.FileDescriptorProto"}],extensionRange:[{start:536e6,end:536000001}]},{name:"FileDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"package",number:2,type:9,label:1},{name:"dependency",number:3,type:9,label:3},{name:"public_dependency",number:10,type:5,label:3},{name:"weak_dependency",number:11,type:5,label:3},{name:"option_dependency",number:15,type:9,label:3},{name:"message_type",number:4,type:11,label:3,typeName:".google.protobuf.DescriptorProto"},{name:"enum_type",number:5,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto"},{name:"service",number:6,type:11,label:3,typeName:".google.protobuf.ServiceDescriptorProto"},{name:"extension",number:7,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"options",number:8,type:11,label:1,typeName:".google.protobuf.FileOptions"},{name:"source_code_info",number:9,type:11,label:1,typeName:".google.protobuf.SourceCodeInfo"},{name:"syntax",number:12,type:9,label:1},{name:"edition",number:14,type:14,label:1,typeName:".google.protobuf.Edition"}]},{name:"DescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"field",number:2,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"extension",number:6,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"nested_type",number:3,type:11,label:3,typeName:".google.protobuf.DescriptorProto"},{name:"enum_type",number:4,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto"},{name:"extension_range",number:5,type:11,label:3,typeName:".google.protobuf.DescriptorProto.ExtensionRange"},{name:"oneof_decl",number:8,type:11,label:3,typeName:".google.protobuf.OneofDescriptorProto"},{name:"options",number:7,type:11,label:1,typeName:".google.protobuf.MessageOptions"},{name:"reserved_range",number:9,type:11,label:3,typeName:".google.protobuf.DescriptorProto.ReservedRange"},{name:"reserved_name",number:10,type:9,label:3},{name:"visibility",number:11,type:14,label:1,typeName:".google.protobuf.SymbolVisibility"}],nestedType:[{name:"ExtensionRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.ExtensionRangeOptions"}]},{name:"ReservedRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1}]}]},{name:"ExtensionRangeOptions",field:[{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"},{name:"declaration",number:2,type:11,label:3,typeName:".google.protobuf.ExtensionRangeOptions.Declaration",options:{retention:2}},{name:"features",number:50,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"verification",number:3,type:14,label:1,typeName:".google.protobuf.ExtensionRangeOptions.VerificationState",defaultValue:"UNVERIFIED",options:{retention:2}}],nestedType:[{name:"Declaration",field:[{name:"number",number:1,type:5,label:1},{name:"full_name",number:2,type:9,label:1},{name:"type",number:3,type:9,label:1},{name:"reserved",number:5,type:8,label:1},{name:"repeated",number:6,type:8,label:1}]}],enumType:[{name:"VerificationState",value:[{name:"DECLARATION",number:0},{name:"UNVERIFIED",number:1}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"FieldDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"number",number:3,type:5,label:1},{name:"label",number:4,type:14,label:1,typeName:".google.protobuf.FieldDescriptorProto.Label"},{name:"type",number:5,type:14,label:1,typeName:".google.protobuf.FieldDescriptorProto.Type"},{name:"type_name",number:6,type:9,label:1},{name:"extendee",number:2,type:9,label:1},{name:"default_value",number:7,type:9,label:1},{name:"oneof_index",number:9,type:5,label:1},{name:"json_name",number:10,type:9,label:1},{name:"options",number:8,type:11,label:1,typeName:".google.protobuf.FieldOptions"},{name:"proto3_optional",number:17,type:8,label:1}],enumType:[{name:"Type",value:[{name:"TYPE_DOUBLE",number:1},{name:"TYPE_FLOAT",number:2},{name:"TYPE_INT64",number:3},{name:"TYPE_UINT64",number:4},{name:"TYPE_INT32",number:5},{name:"TYPE_FIXED64",number:6},{name:"TYPE_FIXED32",number:7},{name:"TYPE_BOOL",number:8},{name:"TYPE_STRING",number:9},{name:"TYPE_GROUP",number:10},{name:"TYPE_MESSAGE",number:11},{name:"TYPE_BYTES",number:12},{name:"TYPE_UINT32",number:13},{name:"TYPE_ENUM",number:14},{name:"TYPE_SFIXED32",number:15},{name:"TYPE_SFIXED64",number:16},{name:"TYPE_SINT32",number:17},{name:"TYPE_SINT64",number:18}]},{name:"Label",value:[{name:"LABEL_OPTIONAL",number:1},{name:"LABEL_REPEATED",number:3},{name:"LABEL_REQUIRED",number:2}]}]},{name:"OneofDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"options",number:2,type:11,label:1,typeName:".google.protobuf.OneofOptions"}]},{name:"EnumDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"value",number:2,type:11,label:3,typeName:".google.protobuf.EnumValueDescriptorProto"},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.EnumOptions"},{name:"reserved_range",number:4,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto.EnumReservedRange"},{name:"reserved_name",number:5,type:9,label:3},{name:"visibility",number:6,type:14,label:1,typeName:".google.protobuf.SymbolVisibility"}],nestedType:[{name:"EnumReservedRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1}]}]},{name:"EnumValueDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"number",number:2,type:5,label:1},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.EnumValueOptions"}]},{name:"ServiceDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"method",number:2,type:11,label:3,typeName:".google.protobuf.MethodDescriptorProto"},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.ServiceOptions"}]},{name:"MethodDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"input_type",number:2,type:9,label:1},{name:"output_type",number:3,type:9,label:1},{name:"options",number:4,type:11,label:1,typeName:".google.protobuf.MethodOptions"},{name:"client_streaming",number:5,type:8,label:1,defaultValue:"false"},{name:"server_streaming",number:6,type:8,label:1,defaultValue:"false"}]},{name:"FileOptions",field:[{name:"java_package",number:1,type:9,label:1},{name:"java_outer_classname",number:8,type:9,label:1},{name:"java_multiple_files",number:10,type:8,label:1,defaultValue:"false"},{name:"java_generate_equals_and_hash",number:20,type:8,label:1,options:{deprecated:!0}},{name:"java_string_check_utf8",number:27,type:8,label:1,defaultValue:"false"},{name:"optimize_for",number:9,type:14,label:1,typeName:".google.protobuf.FileOptions.OptimizeMode",defaultValue:"SPEED"},{name:"go_package",number:11,type:9,label:1},{name:"cc_generic_services",number:16,type:8,label:1,defaultValue:"false"},{name:"java_generic_services",number:17,type:8,label:1,defaultValue:"false"},{name:"py_generic_services",number:18,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:23,type:8,label:1,defaultValue:"false"},{name:"cc_enable_arenas",number:31,type:8,label:1,defaultValue:"true"},{name:"objc_class_prefix",number:36,type:9,label:1},{name:"csharp_namespace",number:37,type:9,label:1},{name:"swift_prefix",number:39,type:9,label:1},{name:"php_class_prefix",number:40,type:9,label:1},{name:"php_namespace",number:41,type:9,label:1},{name:"php_metadata_namespace",number:44,type:9,label:1},{name:"ruby_package",number:45,type:9,label:1},{name:"features",number:50,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],enumType:[{name:"OptimizeMode",value:[{name:"SPEED",number:1},{name:"CODE_SIZE",number:2},{name:"LITE_RUNTIME",number:3}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"MessageOptions",field:[{name:"message_set_wire_format",number:1,type:8,label:1,defaultValue:"false"},{name:"no_standard_descriptor_accessor",number:2,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"map_entry",number:7,type:8,label:1},{name:"deprecated_legacy_json_field_conflicts",number:11,type:8,label:1,options:{deprecated:!0}},{name:"features",number:12,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"FieldOptions",field:[{name:"ctype",number:1,type:14,label:1,typeName:".google.protobuf.FieldOptions.CType",defaultValue:"STRING"},{name:"packed",number:2,type:8,label:1},{name:"jstype",number:6,type:14,label:1,typeName:".google.protobuf.FieldOptions.JSType",defaultValue:"JS_NORMAL"},{name:"lazy",number:5,type:8,label:1,defaultValue:"false"},{name:"unverified_lazy",number:15,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"weak",number:10,type:8,label:1,defaultValue:"false",options:{deprecated:!0}},{name:"debug_redact",number:16,type:8,label:1,defaultValue:"false"},{name:"retention",number:17,type:14,label:1,typeName:".google.protobuf.FieldOptions.OptionRetention"},{name:"targets",number:19,type:14,label:3,typeName:".google.protobuf.FieldOptions.OptionTargetType"},{name:"edition_defaults",number:20,type:11,label:3,typeName:".google.protobuf.FieldOptions.EditionDefault"},{name:"features",number:21,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"feature_support",number:22,type:11,label:1,typeName:".google.protobuf.FieldOptions.FeatureSupport"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],nestedType:[{name:"EditionDefault",field:[{name:"edition",number:3,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"value",number:2,type:9,label:1}]},{name:"FeatureSupport",field:[{name:"edition_introduced",number:1,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"edition_deprecated",number:2,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"deprecation_warning",number:3,type:9,label:1},{name:"edition_removed",number:4,type:14,label:1,typeName:".google.protobuf.Edition"}]}],enumType:[{name:"CType",value:[{name:"STRING",number:0},{name:"CORD",number:1},{name:"STRING_PIECE",number:2}]},{name:"JSType",value:[{name:"JS_NORMAL",number:0},{name:"JS_STRING",number:1},{name:"JS_NUMBER",number:2}]},{name:"OptionRetention",value:[{name:"RETENTION_UNKNOWN",number:0},{name:"RETENTION_RUNTIME",number:1},{name:"RETENTION_SOURCE",number:2}]},{name:"OptionTargetType",value:[{name:"TARGET_TYPE_UNKNOWN",number:0},{name:"TARGET_TYPE_FILE",number:1},{name:"TARGET_TYPE_EXTENSION_RANGE",number:2},{name:"TARGET_TYPE_MESSAGE",number:3},{name:"TARGET_TYPE_FIELD",number:4},{name:"TARGET_TYPE_ONEOF",number:5},{name:"TARGET_TYPE_ENUM",number:6},{name:"TARGET_TYPE_ENUM_ENTRY",number:7},{name:"TARGET_TYPE_SERVICE",number:8},{name:"TARGET_TYPE_METHOD",number:9}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"OneofOptions",field:[{name:"features",number:1,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"EnumOptions",field:[{name:"allow_alias",number:2,type:8,label:1},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"deprecated_legacy_json_field_conflicts",number:6,type:8,label:1,options:{deprecated:!0}},{name:"features",number:7,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"EnumValueOptions",field:[{name:"deprecated",number:1,type:8,label:1,defaultValue:"false"},{name:"features",number:2,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"debug_redact",number:3,type:8,label:1,defaultValue:"false"},{name:"feature_support",number:4,type:11,label:1,typeName:".google.protobuf.FieldOptions.FeatureSupport"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"ServiceOptions",field:[{name:"features",number:34,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"deprecated",number:33,type:8,label:1,defaultValue:"false"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"MethodOptions",field:[{name:"deprecated",number:33,type:8,label:1,defaultValue:"false"},{name:"idempotency_level",number:34,type:14,label:1,typeName:".google.protobuf.MethodOptions.IdempotencyLevel",defaultValue:"IDEMPOTENCY_UNKNOWN"},{name:"features",number:35,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],enumType:[{name:"IdempotencyLevel",value:[{name:"IDEMPOTENCY_UNKNOWN",number:0},{name:"NO_SIDE_EFFECTS",number:1},{name:"IDEMPOTENT",number:2}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"UninterpretedOption",field:[{name:"name",number:2,type:11,label:3,typeName:".google.protobuf.UninterpretedOption.NamePart"},{name:"identifier_value",number:3,type:9,label:1},{name:"positive_int_value",number:4,type:4,label:1},{name:"negative_int_value",number:5,type:3,label:1},{name:"double_value",number:6,type:1,label:1},{name:"string_value",number:7,type:12,label:1},{name:"aggregate_value",number:8,type:9,label:1}],nestedType:[{name:"NamePart",field:[{name:"name_part",number:1,type:9,label:2},{name:"is_extension",number:2,type:8,label:2}]}]},{name:"FeatureSet",field:[{name:"field_presence",number:1,type:14,label:1,typeName:".google.protobuf.FeatureSet.FieldPresence",options:{retention:1,targets:[4,1],editionDefaults:[{value:"EXPLICIT",edition:900},{value:"IMPLICIT",edition:999},{value:"EXPLICIT",edition:1e3}]}},{name:"enum_type",number:2,type:14,label:1,typeName:".google.protobuf.FeatureSet.EnumType",options:{retention:1,targets:[6,1],editionDefaults:[{value:"CLOSED",edition:900},{value:"OPEN",edition:999}]}},{name:"repeated_field_encoding",number:3,type:14,label:1,typeName:".google.protobuf.FeatureSet.RepeatedFieldEncoding",options:{retention:1,targets:[4,1],editionDefaults:[{value:"EXPANDED",edition:900},{value:"PACKED",edition:999}]}},{name:"utf8_validation",number:4,type:14,label:1,typeName:".google.protobuf.FeatureSet.Utf8Validation",options:{retention:1,targets:[4,1],editionDefaults:[{value:"NONE",edition:900},{value:"VERIFY",edition:999}]}},{name:"message_encoding",number:5,type:14,label:1,typeName:".google.protobuf.FeatureSet.MessageEncoding",options:{retention:1,targets:[4,1],editionDefaults:[{value:"LENGTH_PREFIXED",edition:900}]}},{name:"json_format",number:6,type:14,label:1,typeName:".google.protobuf.FeatureSet.JsonFormat",options:{retention:1,targets:[3,6,1],editionDefaults:[{value:"LEGACY_BEST_EFFORT",edition:900},{value:"ALLOW",edition:999}]}},{name:"enforce_naming_style",number:7,type:14,label:1,typeName:".google.protobuf.FeatureSet.EnforceNamingStyle",options:{retention:2,targets:[1,2,3,4,5,6,7,8,9],editionDefaults:[{value:"STYLE_LEGACY",edition:900},{value:"STYLE2024",edition:1001}]}},{name:"default_symbol_visibility",number:8,type:14,label:1,typeName:".google.protobuf.FeatureSet.VisibilityFeature.DefaultSymbolVisibility",options:{retention:2,targets:[1],editionDefaults:[{value:"EXPORT_ALL",edition:900},{value:"EXPORT_TOP_LEVEL",edition:1001}]}}],nestedType:[{name:"VisibilityFeature",enumType:[{name:"DefaultSymbolVisibility",value:[{name:"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN",number:0},{name:"EXPORT_ALL",number:1},{name:"EXPORT_TOP_LEVEL",number:2},{name:"LOCAL_ALL",number:3},{name:"STRICT",number:4}]}]}],enumType:[{name:"FieldPresence",value:[{name:"FIELD_PRESENCE_UNKNOWN",number:0},{name:"EXPLICIT",number:1},{name:"IMPLICIT",number:2},{name:"LEGACY_REQUIRED",number:3}]},{name:"EnumType",value:[{name:"ENUM_TYPE_UNKNOWN",number:0},{name:"OPEN",number:1},{name:"CLOSED",number:2}]},{name:"RepeatedFieldEncoding",value:[{name:"REPEATED_FIELD_ENCODING_UNKNOWN",number:0},{name:"PACKED",number:1},{name:"EXPANDED",number:2}]},{name:"Utf8Validation",value:[{name:"UTF8_VALIDATION_UNKNOWN",number:0},{name:"VERIFY",number:2},{name:"NONE",number:3}]},{name:"MessageEncoding",value:[{name:"MESSAGE_ENCODING_UNKNOWN",number:0},{name:"LENGTH_PREFIXED",number:1},{name:"DELIMITED",number:2}]},{name:"JsonFormat",value:[{name:"JSON_FORMAT_UNKNOWN",number:0},{name:"ALLOW",number:1},{name:"LEGACY_BEST_EFFORT",number:2}]},{name:"EnforceNamingStyle",value:[{name:"ENFORCE_NAMING_STYLE_UNKNOWN",number:0},{name:"STYLE2024",number:1},{name:"STYLE_LEGACY",number:2}]}],extensionRange:[{start:1e3,end:9995},{start:9995,end:1e4},{start:1e4,end:10001}]},{name:"FeatureSetDefaults",field:[{name:"defaults",number:1,type:11,label:3,typeName:".google.protobuf.FeatureSetDefaults.FeatureSetEditionDefault"},{name:"minimum_edition",number:4,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"maximum_edition",number:5,type:14,label:1,typeName:".google.protobuf.Edition"}],nestedType:[{name:"FeatureSetEditionDefault",field:[{name:"edition",number:3,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"overridable_features",number:4,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"fixed_features",number:5,type:11,label:1,typeName:".google.protobuf.FeatureSet"}]}]},{name:"SourceCodeInfo",field:[{name:"location",number:1,type:11,label:3,typeName:".google.protobuf.SourceCodeInfo.Location"}],nestedType:[{name:"Location",field:[{name:"path",number:1,type:5,label:3,options:{packed:!0}},{name:"span",number:2,type:5,label:3,options:{packed:!0}},{name:"leading_comments",number:3,type:9,label:1},{name:"trailing_comments",number:4,type:9,label:1},{name:"leading_detached_comments",number:6,type:9,label:3}]}],extensionRange:[{start:536e6,end:536000001}]},{name:"GeneratedCodeInfo",field:[{name:"annotation",number:1,type:11,label:3,typeName:".google.protobuf.GeneratedCodeInfo.Annotation"}],nestedType:[{name:"Annotation",field:[{name:"path",number:1,type:5,label:3,options:{packed:!0}},{name:"source_file",number:2,type:9,label:1},{name:"begin",number:3,type:5,label:1},{name:"end",number:4,type:5,label:1},{name:"semantic",number:5,type:14,label:1,typeName:".google.protobuf.GeneratedCodeInfo.Annotation.Semantic"}],enumType:[{name:"Semantic",value:[{name:"NONE",number:0},{name:"SET",number:1},{name:"ALIAS",number:2}]}]}]}],enumType:[{name:"Edition",value:[{name:"EDITION_UNKNOWN",number:0},{name:"EDITION_LEGACY",number:900},{name:"EDITION_PROTO2",number:998},{name:"EDITION_PROTO3",number:999},{name:"EDITION_2023",number:1e3},{name:"EDITION_2024",number:1001},{name:"EDITION_1_TEST_ONLY",number:1},{name:"EDITION_2_TEST_ONLY",number:2},{name:"EDITION_99997_TEST_ONLY",number:99997},{name:"EDITION_99998_TEST_ONLY",number:99998},{name:"EDITION_99999_TEST_ONLY",number:99999},{name:"EDITION_MAX",number:2147483647}]},{name:"SymbolVisibility",value:[{name:"VISIBILITY_UNSET",number:0},{name:"VISIBILITY_LOCAL",number:1},{name:"VISIBILITY_EXPORT",number:2}]}]}),1);var qs;(function(n){n[n.DECLARATION=0]="DECLARATION",n[n.UNVERIFIED=1]="UNVERIFIED"})(qs||(qs={}));var ei;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.GROUP=10]="GROUP",n[n.MESSAGE=11]="MESSAGE",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.ENUM=14]="ENUM",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(ei||(ei={}));var ti;(function(n){n[n.OPTIONAL=1]="OPTIONAL",n[n.REPEATED=3]="REPEATED",n[n.REQUIRED=2]="REQUIRED"})(ti||(ti={}));var ni;(function(n){n[n.SPEED=1]="SPEED",n[n.CODE_SIZE=2]="CODE_SIZE",n[n.LITE_RUNTIME=3]="LITE_RUNTIME"})(ni||(ni={}));var ri;(function(n){n[n.STRING=0]="STRING",n[n.CORD=1]="CORD",n[n.STRING_PIECE=2]="STRING_PIECE"})(ri||(ri={}));var si;(function(n){n[n.JS_NORMAL=0]="JS_NORMAL",n[n.JS_STRING=1]="JS_STRING",n[n.JS_NUMBER=2]="JS_NUMBER"})(si||(si={}));var ii;(function(n){n[n.RETENTION_UNKNOWN=0]="RETENTION_UNKNOWN",n[n.RETENTION_RUNTIME=1]="RETENTION_RUNTIME",n[n.RETENTION_SOURCE=2]="RETENTION_SOURCE"})(ii||(ii={}));var oi;(function(n){n[n.TARGET_TYPE_UNKNOWN=0]="TARGET_TYPE_UNKNOWN",n[n.TARGET_TYPE_FILE=1]="TARGET_TYPE_FILE",n[n.TARGET_TYPE_EXTENSION_RANGE=2]="TARGET_TYPE_EXTENSION_RANGE",n[n.TARGET_TYPE_MESSAGE=3]="TARGET_TYPE_MESSAGE",n[n.TARGET_TYPE_FIELD=4]="TARGET_TYPE_FIELD",n[n.TARGET_TYPE_ONEOF=5]="TARGET_TYPE_ONEOF",n[n.TARGET_TYPE_ENUM=6]="TARGET_TYPE_ENUM",n[n.TARGET_TYPE_ENUM_ENTRY=7]="TARGET_TYPE_ENUM_ENTRY",n[n.TARGET_TYPE_SERVICE=8]="TARGET_TYPE_SERVICE",n[n.TARGET_TYPE_METHOD=9]="TARGET_TYPE_METHOD"})(oi||(oi={}));var ai;(function(n){n[n.IDEMPOTENCY_UNKNOWN=0]="IDEMPOTENCY_UNKNOWN",n[n.NO_SIDE_EFFECTS=1]="NO_SIDE_EFFECTS",n[n.IDEMPOTENT=2]="IDEMPOTENT"})(ai||(ai={}));var ci;(function(n){n[n.DEFAULT_SYMBOL_VISIBILITY_UNKNOWN=0]="DEFAULT_SYMBOL_VISIBILITY_UNKNOWN",n[n.EXPORT_ALL=1]="EXPORT_ALL",n[n.EXPORT_TOP_LEVEL=2]="EXPORT_TOP_LEVEL",n[n.LOCAL_ALL=3]="LOCAL_ALL",n[n.STRICT=4]="STRICT"})(ci||(ci={}));var ui;(function(n){n[n.FIELD_PRESENCE_UNKNOWN=0]="FIELD_PRESENCE_UNKNOWN",n[n.EXPLICIT=1]="EXPLICIT",n[n.IMPLICIT=2]="IMPLICIT",n[n.LEGACY_REQUIRED=3]="LEGACY_REQUIRED"})(ui||(ui={}));var li;(function(n){n[n.ENUM_TYPE_UNKNOWN=0]="ENUM_TYPE_UNKNOWN",n[n.OPEN=1]="OPEN",n[n.CLOSED=2]="CLOSED"})(li||(li={}));var hi;(function(n){n[n.REPEATED_FIELD_ENCODING_UNKNOWN=0]="REPEATED_FIELD_ENCODING_UNKNOWN",n[n.PACKED=1]="PACKED",n[n.EXPANDED=2]="EXPANDED"})(hi||(hi={}));var di;(function(n){n[n.UTF8_VALIDATION_UNKNOWN=0]="UTF8_VALIDATION_UNKNOWN",n[n.VERIFY=2]="VERIFY",n[n.NONE=3]="NONE"})(di||(di={}));var fi;(function(n){n[n.MESSAGE_ENCODING_UNKNOWN=0]="MESSAGE_ENCODING_UNKNOWN",n[n.LENGTH_PREFIXED=1]="LENGTH_PREFIXED",n[n.DELIMITED=2]="DELIMITED"})(fi||(fi={}));var gi;(function(n){n[n.JSON_FORMAT_UNKNOWN=0]="JSON_FORMAT_UNKNOWN",n[n.ALLOW=1]="ALLOW",n[n.LEGACY_BEST_EFFORT=2]="LEGACY_BEST_EFFORT"})(gi||(gi={}));var mi;(function(n){n[n.ENFORCE_NAMING_STYLE_UNKNOWN=0]="ENFORCE_NAMING_STYLE_UNKNOWN",n[n.STYLE2024=1]="STYLE2024",n[n.STYLE_LEGACY=2]="STYLE_LEGACY"})(mi||(mi={}));var pi;(function(n){n[n.NONE=0]="NONE",n[n.SET=1]="SET",n[n.ALIAS=2]="ALIAS"})(pi||(pi={}));var bi;(function(n){n[n.EDITION_UNKNOWN=0]="EDITION_UNKNOWN",n[n.EDITION_LEGACY=900]="EDITION_LEGACY",n[n.EDITION_PROTO2=998]="EDITION_PROTO2",n[n.EDITION_PROTO3=999]="EDITION_PROTO3",n[n.EDITION_2023=1e3]="EDITION_2023",n[n.EDITION_2024=1001]="EDITION_2024",n[n.EDITION_1_TEST_ONLY=1]="EDITION_1_TEST_ONLY",n[n.EDITION_2_TEST_ONLY=2]="EDITION_2_TEST_ONLY",n[n.EDITION_99997_TEST_ONLY=99997]="EDITION_99997_TEST_ONLY",n[n.EDITION_99998_TEST_ONLY=99998]="EDITION_99998_TEST_ONLY",n[n.EDITION_99999_TEST_ONLY=99999]="EDITION_99999_TEST_ONLY",n[n.EDITION_MAX=2147483647]="EDITION_MAX"})(bi||(bi={}));var yi;(function(n){n[n.VISIBILITY_UNSET=0]="VISIBILITY_UNSET",n[n.VISIBILITY_LOCAL=1]="VISIBILITY_LOCAL",n[n.VISIBILITY_EXPORT=2]="VISIBILITY_EXPORT"})(yi||(yi={}));const Ai={readUnknownFields:!0};function Wc(n){return n?Object.assign(Object.assign({},Ai),n):Ai}function ge(n,e,t){const r=fe(n,void 0,!1);return vi(r,new sr(e),Wc(t),!1,e.byteLength),r.message}function vi(n,e,t,r,s){var i;const o=r?e.len:e.pos+s;let a,c;const u=(i=n.getUnknown())!==null&&i!==void 0?i:[];for(;e.pos<o&&([a,c]=e.tag(),!(r&&c==$.EndGroup));){const l=n.findNumber(a);if(!l){const g=e.skip(c,a);t.readUnknownFields&&u.push({no:a,wireType:c,data:g});continue}Si(n,e,l,c,t)}if(r&&(c!=$.EndGroup||a!==s))throw new Error("invalid end group tag");u.length>0&&n.setUnknown(u)}function Si(n,e,t,r,s){var i;switch(t.fieldKind){case"scalar":n.set(t,mt(e,t.scalar));break;case"enum":const o=mt(e,p.INT32);if(t.enum.open)n.set(t,o);else if(t.enum.values.some(c=>c.number===o))n.set(t,o);else if(s.readUnknownFields){const c=[];zn(o,c);const u=(i=n.getUnknown())!==null&&i!==void 0?i:[];u.push({no:t.number,wireType:r,data:new Uint8Array(c)}),n.setUnknown(u)}break;case"message":n.set(t,Sr(e,s,t,n.get(t)));break;case"list":Oc(e,r,n.get(t),s);break;case"map":kc(e,n.get(t),s);break}}function kc(n,e,t){const r=e.field();let s,i;const o=n.uint32(),a=n.pos+o;for(;n.pos<a;){const[c]=n.tag();switch(c){case 1:s=mt(n,r.mapKey);break;case 2:switch(r.mapKind){case"scalar":i=mt(n,r.scalar);break;case"enum":i=n.int32();break;case"message":i=Sr(n,t,r);break}break}}if(s===void 0&&(s=it(r.mapKey,!1)),i===void 0)switch(r.mapKind){case"scalar":i=it(r.scalar,!1);break;case"enum":i=r.enum.values[0].number;break;case"message":i=fe(r.message,void 0,!1);break}e.set(s,i)}function Oc(n,e,t,r){var s;const i=t.field();if(i.listKind==="message"){t.add(Sr(n,r,i));return}const o=(s=i.scalar)!==null&&s!==void 0?s:p.INT32;if(!(e==$.LengthDelimited&&o!=p.STRING&&o!=p.BYTES)){t.add(mt(n,o));return}const c=n.uint32()+n.pos;for(;n.pos<c;)t.add(mt(n,o))}function Sr(n,e,t,r){const s=t.delimitedEncoding,i=r??fe(t.message,void 0,!1);return vi(i,n,e,s,s?t.number:n.uint32()),i}function mt(n,e){switch(e){case p.STRING:return n.string();case p.BOOL:return n.bool();case p.DOUBLE:return n.double();case p.FLOAT:return n.float();case p.INT32:return n.int32();case p.INT64:return n.int64();case p.UINT64:return n.uint64();case p.FIXED64:return n.fixed64();case p.BYTES:return n.bytes();case p.FIXED32:return n.fixed32();case p.SFIXED32:return n.sfixed32();case p.SFIXED64:return n.sfixed64();case p.SINT64:return n.sint64();case p.UINT32:return n.uint32();case p.SINT32:return n.sint32()}}function Ye(n,e){var t;const r=ge(Bc,fr(n));return r.messageType.forEach(gr),r.dependency=(t=e==null?void 0:e.map(i=>i.proto.name))!==null&&t!==void 0?t:[],Fs(r,i=>e==null?void 0:e.find(o=>o.proto.name===i)).getFile(r.name)}const Pc=Ye("Ch9nb29nbGUvcHJvdG9idWYvdGltZXN0YW1wLnByb3RvEg9nb29nbGUucHJvdG9idWYiKwoJVGltZXN0YW1wEg8KB3NlY29uZHMYASABKAMSDQoFbmFub3MYAiABKAVChQEKE2NvbS5nb29nbGUucHJvdG9idWZCDlRpbWVzdGFtcFByb3RvUAFaMmdvb2dsZS5nb2xhbmcub3JnL3Byb3RvYnVmL3R5cGVzL2tub3duL3RpbWVzdGFtcHBi+AEBogIDR1BCqgIeR29vZ2xlLlByb3RvYnVmLldlbGxLbm93blR5cGVzYgZwcm90bzM");function Zc(n){return new Date(Uc(n))}function Uc(n){return Number(n.seconds)*1e3+Math.round(n.nanos/1e6)}const Yc=Ye("Ch5nb29nbGUvcHJvdG9idWYvZHVyYXRpb24ucHJvdG8SD2dvb2dsZS5wcm90b2J1ZiIqCghEdXJhdGlvbhIPCgdzZWNvbmRzGAEgASgDEg0KBW5hbm9zGAIgASgFQoMBChNjb20uZ29vZ2xlLnByb3RvYnVmQg1EdXJhdGlvblByb3RvUAFaMWdvb2dsZS5nb2xhbmcub3JnL3Byb3RvYnVmL3R5cGVzL2tub3duL2R1cmF0aW9ucGL4AQGiAgNHUEKqAh5Hb29nbGUuUHJvdG9idWYuV2VsbEtub3duVHlwZXNiBnByb3RvMw"),Ii=Ye("Chlnb29nbGUvcHJvdG9idWYvYW55LnByb3RvEg9nb29nbGUucHJvdG9idWYiJgoDQW55EhAKCHR5cGVfdXJsGAEgASgJEg0KBXZhbHVlGAIgASgMQnYKE2NvbS5nb29nbGUucHJvdG9idWZCCEFueVByb3RvUAFaLGdvb2dsZS5nb2xhbmcub3JnL3Byb3RvYnVmL3R5cGVzL2tub3duL2FueXBiogIDR1BCqgIeR29vZ2xlLlByb3RvYnVmLldlbGxLbm93blR5cGVzYgZwcm90bzM"),Gc=T(Ii,0),Fc=3,Ei={writeUnknownFields:!0};function Kc(n){return n?Object.assign(Object.assign({},Ei),n):Ei}function ze(n,e,t){return bn(new ws,Kc(t),fe(n,e)).finish()}function bn(n,e,t){var r;for(const s of t.sortedFields){if(!t.isSet(s)){if(s.presence==Fc)throw new Error(`cannot encode ${s} to binary: required field not set`);continue}Ni(n,e,t,s)}if(e.writeUnknownFields)for(const{no:s,wireType:i,data:o}of(r=t.getUnknown())!==null&&r!==void 0?r:[])n.tag(s,i).raw(o);return n}function Ni(n,e,t,r){var s;switch(r.fieldKind){case"scalar":case"enum":yn(n,t.desc.typeName,r.name,(s=r.scalar)!==null&&s!==void 0?s:p.INT32,r.number,t.get(r));break;case"list":Mc(n,e,r,t.get(r));break;case"message":wi(n,e,r,t.get(r));break;case"map":for(const[i,o]of t.get(r))Jc(n,e,r,i,o);break}}function yn(n,e,t,r,s,i){Ri(n.tag(s,Xc(r)),e,t,r,i)}function wi(n,e,t,r){t.delimitedEncoding?bn(n.tag(t.number,$.StartGroup),e,r).tag(t.number,$.EndGroup):bn(n.tag(t.number,$.LengthDelimited).fork(),e,r).join()}function Mc(n,e,t,r){var s;if(t.listKind=="message"){for(const o of r)wi(n,e,t,o);return}const i=(s=t.scalar)!==null&&s!==void 0?s:p.INT32;if(t.packed){if(!r.size)return;n.tag(t.number,$.LengthDelimited).fork();for(const o of r)Ri(n,t.parent.typeName,t.name,i,o);n.join();return}for(const o of r)yn(n,t.parent.typeName,t.name,i,t.number,o)}function Jc(n,e,t,r,s){var i;switch(n.tag(t.number,$.LengthDelimited).fork(),yn(n,t.parent.typeName,t.name,t.mapKey,1,r),t.mapKind){case"scalar":case"enum":yn(n,t.parent.typeName,t.name,(i=t.scalar)!==null&&i!==void 0?i:p.INT32,2,s);break;case"message":bn(n.tag(2,$.LengthDelimited).fork(),e,s).join();break}n.join()}function Ri(n,e,t,r,s){try{switch(r){case p.STRING:n.string(s);break;case p.BOOL:n.bool(s);break;case p.DOUBLE:n.double(s);break;case p.FLOAT:n.float(s);break;case p.INT32:n.int32(s);break;case p.INT64:n.int64(s);break;case p.UINT64:n.uint64(s);break;case p.FIXED64:n.fixed64(s);break;case p.BYTES:n.bytes(s);break;case p.FIXED32:n.fixed32(s);break;case p.SFIXED32:n.sfixed32(s);break;case p.SFIXED64:n.sfixed64(s);break;case p.SINT64:n.sint64(s);break;case p.UINT32:n.uint32(s);break;case p.SINT32:n.sint32(s);break}}catch(i){throw i instanceof Error?new Error(`cannot encode field ${e}.${t} to binary: ${i.message}`):i}}function Xc(n){switch(n){case p.BYTES:case p.STRING:return $.LengthDelimited;case p.DOUBLE:case p.FIXED64:case p.SFIXED64:return $.Bit64;case p.FIXED32:case p.SFIXED32:case p.FLOAT:return $.Bit32;default:return $.Varint}}function _c(n,e,t){let r=!1;return t||(t=N(Gc),r=!0),t.value=ze(n,e),t.typeUrl=jc(e.$typeName),r?t:void 0}function $c(n,e){if(n.typeUrl==="")return!1;const t=typeof e=="string"?e:e.typeName,r=Ci(n.typeUrl);return t===r}function zc(n,e){if(n.typeUrl==="")return;const t=e.kind=="message"?e:e.getMessage(Ci(n.typeUrl));if(!(!t||!$c(n,t)))return ge(t,n.value)}function jc(n){return`type.googleapis.com/${n}`}function Ci(n){const e=n.lastIndexOf("/"),t=e>=0?n.substring(e+1):n;if(!t.length)throw new Error(`invalid type url: ${n}`);return t}const Ir=Ye("Chxnb29nbGUvcHJvdG9idWYvc3RydWN0LnByb3RvEg9nb29nbGUucHJvdG9idWYihAEKBlN0cnVjdBIzCgZmaWVsZHMYASADKAsyIy5nb29nbGUucHJvdG9idWYuU3RydWN0LkZpZWxkc0VudHJ5GkUKC0ZpZWxkc0VudHJ5EgsKA2tleRgBIAEoCRIlCgV2YWx1ZRgCIAEoCzIWLmdvb2dsZS5wcm90b2J1Zi5WYWx1ZToCOAEi6gEKBVZhbHVlEjAKCm51bGxfdmFsdWUYASABKA4yGi5nb29nbGUucHJvdG9idWYuTnVsbFZhbHVlSAASFgoMbnVtYmVyX3ZhbHVlGAIgASgBSAASFgoMc3RyaW5nX3ZhbHVlGAMgASgJSAASFAoKYm9vbF92YWx1ZRgEIAEoCEgAEi8KDHN0cnVjdF92YWx1ZRgFIAEoCzIXLmdvb2dsZS5wcm90b2J1Zi5TdHJ1Y3RIABIwCgpsaXN0X3ZhbHVlGAYgASgLMhouZ29vZ2xlLnByb3RvYnVmLkxpc3RWYWx1ZUgAQgYKBGtpbmQiMwoJTGlzdFZhbHVlEiYKBnZhbHVlcxgBIAMoCzIWLmdvb2dsZS5wcm90b2J1Zi5WYWx1ZSobCglOdWxsVmFsdWUSDgoKTlVMTF9WQUxVRRAAQn8KE2NvbS5nb29nbGUucHJvdG9idWZCC1N0cnVjdFByb3RvUAFaL2dvb2dsZS5nb2xhbmcub3JnL3Byb3RvYnVmL3R5cGVzL2tub3duL3N0cnVjdHBi+AEBogIDR1BCqgIeR29vZ2xlLlByb3RvYnVmLldlbGxLbm93blR5cGVzYgZwcm90bzM"),Qc=T(Ir,0),Ti=T(Ir,1),Hc=T(Ir,2);var Er;(function(n){n[n.NULL_VALUE=0]="NULL_VALUE"})(Er||(Er={}));const qc=Ye("Ch5nb29nbGUvcHJvdG9idWYvd3JhcHBlcnMucHJvdG8SD2dvb2dsZS5wcm90b2J1ZiIcCgtEb3VibGVWYWx1ZRINCgV2YWx1ZRgBIAEoASIbCgpGbG9hdFZhbHVlEg0KBXZhbHVlGAEgASgCIhsKCkludDY0VmFsdWUSDQoFdmFsdWUYASABKAMiHAoLVUludDY0VmFsdWUSDQoFdmFsdWUYASABKAQiGwoKSW50MzJWYWx1ZRINCgV2YWx1ZRgBIAEoBSIcCgtVSW50MzJWYWx1ZRINCgV2YWx1ZRgBIAEoDSIaCglCb29sVmFsdWUSDQoFdmFsdWUYASABKAgiHAoLU3RyaW5nVmFsdWUSDQoFdmFsdWUYASABKAkiGwoKQnl0ZXNWYWx1ZRINCgV2YWx1ZRgBIAEoDEKDAQoTY29tLmdvb2dsZS5wcm90b2J1ZkINV3JhcHBlcnNQcm90b1ABWjFnb29nbGUuZ29sYW5nLm9yZy9wcm90b2J1Zi90eXBlcy9rbm93bi93cmFwcGVyc3Bi+AEBogIDR1BCqgIeR29vZ2xlLlByb3RvYnVmLldlbGxLbm93blR5cGVzYgZwcm90bzM");function eu(n,e){Vi(e,n);const t=nu(n.$unknown,e),[r,s,i]=An(e);for(const o of t)Si(r,new sr(o.data),s,o.wireType,{readUnknownFields:!0});return i()}function tu(n,e,t){var r;Vi(e,n);const s=((r=n.$unknown)!==null&&r!==void 0?r:[]).filter(u=>u.no!==e.number),[i,o]=An(e,t),a=new ws;Ni(a,{writeUnknownFields:!0},i,o);const c=new sr(a.finish());for(;c.pos<c.len;){const[u,l]=c.tag(),g=c.skip(l,u);s.push({no:u,wireType:l,data:g})}n.$unknown=s}function nu(n,e){if(n===void 0)return[];if(e.fieldKind==="enum"||e.fieldKind==="scalar"){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.number)return[n[t]];return[]}return n.filter(t=>t.no===e.number)}function An(n,e){const t=n.typeName,r=Object.assign(Object.assign({},n),{kind:"field",parent:n.extendee,localName:t}),s=Object.assign(Object.assign({},n.extendee),{fields:[r],members:[r],oneofs:[]}),i=N(s,e!==void 0?{[t]:e}:void 0);return[fe(s,i),r,()=>{const o=i[t];if(o===void 0){const a=n.message;return Pt(a)?it(a.fields[0].scalar,a.fields[0].longAsString):N(a)}return o}]}function Vi(n,e){if(n.extendee.typeName!=e.$typeName)throw new Error(`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}const ru=3,su=2,Di={alwaysEmitImplicit:!1,enumAsInteger:!1,useProtoFieldName:!1};function iu(n){return n?Object.assign(Object.assign({},Di),n):Di}function ou(n,e,t){return Kt(fe(n,e),iu(t))}function au(n,e,t){var r;const s=ou(n,e,t);return JSON.stringify(s,null,(r=t==null?void 0:t.prettySpaces)!==null&&r!==void 0?r:0)}function Kt(n,e){var t;const r=hu(n,e);if(r!==void 0)return r;const s={};for(const i of n.sortedFields){if(!n.isSet(i)){if(i.presence==ru)throw new Error(`cannot encode ${i} to JSON: required field not set`);if(!e.alwaysEmitImplicit||i.presence!==su)continue}const o=xi(i,n.get(i),e);o!==void 0&&(s[lu(i,e)]=o)}if(e.registry){const i=new Set;for(const{no:o}of(t=n.getUnknown())!==null&&t!==void 0?t:[])if(!i.has(o)){i.add(o);const a=e.registry.getExtensionFor(n.desc,o);if(!a)continue;const c=eu(n.message,a),[u,l]=An(a,c),g=xi(l,u.get(l),e);g!==void 0&&(s[a.jsonName]=g)}}return s}function xi(n,e,t){switch(n.fieldKind){case"scalar":return vn(n,e);case"message":return Kt(e,t);case"enum":return Nr(n.enum,e,t.enumAsInteger);case"list":return uu(e,t);case"map":return cu(e,t)}}function cu(n,e){const t=n.field(),r={};switch(t.mapKind){case"scalar":for(const[s,i]of n)r[s]=vn(t,i);break;case"message":for(const[s,i]of n)r[s]=Kt(i,e);break;case"enum":for(const[s,i]of n)r[s]=Nr(t.enum,i,e.enumAsInteger);break}return e.alwaysEmitImplicit||n.size>0?r:void 0}function uu(n,e){const t=n.field(),r=[];switch(t.listKind){case"scalar":for(const s of n)r.push(vn(t,s));break;case"enum":for(const s of n)r.push(Nr(t.enum,s,e.enumAsInteger));break;case"message":for(const s of n)r.push(Kt(s,e));break}return e.alwaysEmitImplicit||r.length>0?r:void 0}function Nr(n,e,t){var r;if(typeof e!="number")throw new Error(`cannot encode ${n} to JSON: expected number, got ${H(e)}`);if(n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const s=n.value[e];return(r=s==null?void 0:s.name)!==null&&r!==void 0?r:e}function vn(n,e){var t,r,s,i,o,a;switch(n.scalar){case p.INT32:case p.SFIXED32:case p.SINT32:case p.FIXED32:case p.UINT32:if(typeof e!="number")throw new Error(`cannot encode ${n} to JSON: ${(t=ot(n,e))===null||t===void 0?void 0:t.message}`);return e;case p.FLOAT:case p.DOUBLE:if(typeof e!="number")throw new Error(`cannot encode ${n} to JSON: ${(r=ot(n,e))===null||r===void 0?void 0:r.message}`);return Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case p.STRING:if(typeof e!="string")throw new Error(`cannot encode ${n} to JSON: ${(s=ot(n,e))===null||s===void 0?void 0:s.message}`);return e;case p.BOOL:if(typeof e!="boolean")throw new Error(`cannot encode ${n} to JSON: ${(i=ot(n,e))===null||i===void 0?void 0:i.message}`);return e;case p.UINT64:case p.FIXED64:case p.INT64:case p.SFIXED64:case p.SINT64:if(typeof e!="bigint"&&typeof e!="string")throw new Error(`cannot encode ${n} to JSON: ${(o=ot(n,e))===null||o===void 0?void 0:o.message}`);return e.toString();case p.BYTES:if(e instanceof Uint8Array)return ec(e);throw new Error(`cannot encode ${n} to JSON: ${(a=ot(n,e))===null||a===void 0?void 0:a.message}`)}}function lu(n,e){return e.useProtoFieldName?n.name:n.jsonName}function hu(n,e){if(n.desc.typeName.startsWith("google.protobuf."))switch(n.desc.typeName){case"google.protobuf.Any":return du(n.message,e);case"google.protobuf.Timestamp":return mu(n.message);case"google.protobuf.Duration":return fu(n.message);case"google.protobuf.FieldMask":return gu(n.message);case"google.protobuf.Struct":return Li(n.message);case"google.protobuf.Value":return wr(n.message);case"google.protobuf.ListValue":return Bi(n.message);default:if(Pt(n.desc)){const t=n.desc.fields[0];return vn(t,n.get(t))}return}}function du(n,e){if(n.typeUrl==="")return{};const{registry:t}=e;let r,s;if(t&&(r=zc(n,t),r&&(s=t.getMessage(r.$typeName))),!s||!r)throw new Error(`cannot encode message ${n.$typeName} to JSON: "${n.typeUrl}" is not in the type registry`);let i=Kt(fe(s,r),e);return(s.typeName.startsWith("google.protobuf.")||i===null||Array.isArray(i)||typeof i!="object")&&(i={value:i}),i["@type"]=n.typeUrl,i}function fu(n){const e=Number(n.seconds),t=n.nanos;if(e>315576e6||e<-315576e6)throw new Error(`cannot encode message ${n.$typeName} to JSON: value out of range`);if(e>0&&t<0||e<0&&t>0)throw new Error(`cannot encode message ${n.$typeName} to JSON: nanos sign must match seconds sign`);let r=n.seconds.toString();if(t!==0){let s=Math.abs(t).toString();s="0".repeat(9-s.length)+s,s.substring(3)==="000000"?s=s.substring(0,3):s.substring(6)==="000"&&(s=s.substring(0,6)),r+="."+s,t<0&&e==0&&(r="-"+r)}return r+"s"}function gu(n){return n.paths.map(e=>{if(e.match(/_[0-9]?_/g)||e.match(/[A-Z]/g))throw new Error(`cannot encode message ${n.$typeName} to JSON: lowerCamelCase of path name "`+e+'" is irreversible');return Ut(e)}).join(",")}function Li(n){const e={};for(const[t,r]of Object.entries(n.fields))e[t]=wr(r);return e}function wr(n){switch(n.kind.case){case"nullValue":return null;case"numberValue":if(!Number.isFinite(n.kind.value))throw new Error(`${n.$typeName} cannot be NaN or Infinity`);return n.kind.value;case"boolValue":return n.kind.value;case"stringValue":return n.kind.value;case"structValue":return Li(n.kind.value);case"listValue":return Bi(n.kind.value);default:throw new Error(`${n.$typeName} must have a value`)}}function Bi(n){return n.values.map(wr)}function mu(n){const e=Number(n.seconds)*1e3;if(e<Date.parse("0001-01-01T00:00:00Z")||e>Date.parse("9999-12-31T23:59:59Z"))throw new Error(`cannot encode message ${n.$typeName} to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive`);if(n.nanos<0)throw new Error(`cannot encode message ${n.$typeName} to JSON: nanos must not be negative`);if(n.nanos>999999999)throw new Error(`cannot encode message ${n.$typeName} to JSON: nanos must not be greater than 99999999`);let t="Z";if(n.nanos>0){const r=(n.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?t="."+r.substring(0,3)+"Z":r.substring(6)==="000"?t="."+r.substring(0,6)+"Z":t="."+r+"Z"}return new Date(e).toISOString().replace(".000Z",t)}const Wi={ignoreUnknownFields:!1};function pu(n){return n?Object.assign(Object.assign({},Wi),n):Wi}function bu(n,e,t){return yu(n,wu(e,n.typeName),t)}function yu(n,e,t){const r=fe(n);try{pt(r,e,pu(t))}catch(s){throw _a(s)?new Error(`cannot decode ${s.field()} from JSON: ${s.message}`,{cause:s}):s}return r.message}function pt(n,e,t){var r;if(Ru(n,e,t))return;if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode ${n.desc} from JSON: ${H(e)}`);const s=new Map,i=new Map;for(const o of n.desc.fields)i.set(o.name,o).set(o.jsonName,o);for(const[o,a]of Object.entries(e)){const c=i.get(o);if(c){if(c.oneof){if(a===null&&c.fieldKind=="scalar")continue;const u=s.get(c.oneof);if(u!==void 0)throw new oe(c.oneof,`oneof set multiple times by ${u.name} and ${c.name}`);s.set(c.oneof,c)}ki(n,c,a,t)}else{let u;if(o.startsWith("[")&&o.endsWith("]")&&(u=(r=t.registry)===null||r===void 0?void 0:r.getExtension(o.substring(1,o.length-1)))&&u.extendee.typeName===n.desc.typeName){const[l,g,b]=An(u);ki(l,g,a,t),tu(n.message,u,b())}if(!u&&!t.ignoreUnknownFields)throw new Error(`cannot decode ${n.desc} from JSON: key "${o}" is unknown`)}}}function ki(n,e,t,r){switch(e.fieldKind){case"scalar":Eu(n,e,t);break;case"enum":Iu(n,e,t,r);break;case"message":Su(n,e,t,r);break;case"list":vu(n.get(e),t,r);break;case"map":Au(n.get(e),t,r);break}}function Au(n,e,t){if(e===null)return;const r=n.field();if(typeof e!="object"||Array.isArray(e))throw new oe(r,"expected object, got "+H(e));for(const[s,i]of Object.entries(e)){if(i===null)throw new oe(r,"map value must not be null");let o;switch(r.mapKind){case"message":const c=fe(r.message);pt(c,i,t),o=c;break;case"enum":if(o=Rr(r.enum,i,t.ignoreUnknownFields,!0),o===Sn)return;break;case"scalar":o=En(r,i,!0);break}const a=Nu(r.mapKey,s);n.set(a,o)}}function vu(n,e,t){if(e===null)return;const r=n.field();if(!Array.isArray(e))throw new oe(r,"expected Array, got "+H(e));for(const s of e){if(s===null)throw new oe(r,"list item must not be null");switch(r.listKind){case"message":const i=fe(r.message);pt(i,s,t),n.add(i);break;case"enum":const o=Rr(r.enum,s,t.ignoreUnknownFields,!0);o!==Sn&&n.add(o);break;case"scalar":n.add(En(r,s,!0));break}}}function Su(n,e,t,r){if(t===null&&e.message.typeName!="google.protobuf.Value"){n.clear(e);return}const s=n.isSet(e)?n.get(e):fe(e.message);pt(s,t,r),n.set(e,s)}function Iu(n,e,t,r){const s=Rr(e.enum,t,r.ignoreUnknownFields,!1);s===In?n.clear(e):s!==Sn&&n.set(e,s)}function Eu(n,e,t){const r=En(e,t,!1);r===In?n.clear(e):n.set(e,r)}const Sn=Symbol();function Rr(n,e,t,r){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:r?n.values[0].number:In;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const s=n.values.find(i=>i.name===e);if(s!==void 0)return s.number;if(t)return Sn;break}throw new Error(`cannot decode ${n} from JSON: ${H(e)}`)}const In=Symbol();function En(n,e,t){if(e===null)return t?it(n.scalar,!1):In;switch(n.scalar){case p.DOUBLE:case p.FLOAT:if(e==="NaN")return NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(typeof e=="number"){if(Number.isNaN(e))throw new oe(n,"unexpected NaN number");if(!Number.isFinite(e))throw new oe(n,"unexpected infinite number");break}if(typeof e=="string"){if(e===""||e.trim().length!==e.length)break;const r=Number(e);if(!Number.isFinite(r))break;return r}break;case p.INT32:case p.FIXED32:case p.SFIXED32:case p.SINT32:case p.UINT32:return Oi(e);case p.BYTES:if(typeof e=="string"){if(e==="")return new Uint8Array(0);try{return fr(e)}catch(r){const s=r instanceof Error?r.message:String(r);throw new oe(n,s)}}break}return e}function Nu(n,e){switch(n){case p.BOOL:switch(e){case"true":return!0;case"false":return!1}return e;case p.INT32:case p.FIXED32:case p.UINT32:case p.SFIXED32:case p.SINT32:return Oi(e);default:return e}}function Oi(n){if(typeof n=="string"){if(n===""||n.trim().length!==n.length)return n;const e=Number(n);return Number.isNaN(e)?n:e}return n}function wu(n,e){try{return JSON.parse(n)}catch(t){const r=t instanceof Error?t.message:String(t);throw new Error(`cannot decode message ${e} from JSON: ${r}`,{cause:t})}}function Ru(n,e,t){if(!n.desc.typeName.startsWith("google.protobuf."))return!1;switch(n.desc.typeName){case"google.protobuf.Any":return Cu(n.message,e,t),!0;case"google.protobuf.Timestamp":return Tu(n.message,e),!0;case"google.protobuf.Duration":return Vu(n.message,e),!0;case"google.protobuf.FieldMask":return Du(n.message,e),!0;case"google.protobuf.Struct":return Pi(n.message,e),!0;case"google.protobuf.Value":return Cr(n.message,e),!0;case"google.protobuf.ListValue":return Zi(n.message,e),!0;default:if(Pt(n.desc)){const r=n.desc.fields[0];return e===null?n.clear(r):n.set(r,En(r,e,!0)),!0}return!1}}function Cu(n,e,t){var r;if(e===null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${n.$typeName} from JSON: expected object but got ${H(e)}`);if(Object.keys(e).length==0)return;const s=e["@type"];if(typeof s!="string"||s=="")throw new Error(`cannot decode message ${n.$typeName} from JSON: "@type" is empty`);const i=s.includes("/")?s.substring(s.lastIndexOf("/")+1):s;if(!i.length)throw new Error(`cannot decode message ${n.$typeName} from JSON: "@type" is invalid`);const o=(r=t.registry)===null||r===void 0?void 0:r.getMessage(i);if(!o)throw new Error(`cannot decode message ${n.$typeName} from JSON: ${s} is not in the type registry`);const a=fe(o);if(i.startsWith("google.protobuf.")&&Object.prototype.hasOwnProperty.call(e,"value")){const c=e.value;pt(a,c,t)}else{const c=Object.assign({},e);delete c["@type"],pt(a,c,t)}_c(a.desc,a.message,n)}function Tu(n,e){if(typeof e!="string")throw new Error(`cannot decode message ${n.$typeName} from JSON: ${H(e)}`);const t=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:\.([0-9]{1,9}))?(?:Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!t)throw new Error(`cannot decode message ${n.$typeName} from JSON: invalid RFC 3339 string`);const r=Date.parse(t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+(t[8]?t[8]:"Z"));if(Number.isNaN(r))throw new Error(`cannot decode message ${n.$typeName} from JSON: invalid RFC 3339 string`);if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error(`cannot decode message ${n.$typeName} from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive`);n.seconds=M.parse(r/1e3),n.nanos=0,t[7]&&(n.nanos=parseInt("1"+t[7]+"0".repeat(9-t[7].length))-1e9)}function Vu(n,e){if(typeof e!="string")throw new Error(`cannot decode message ${n.$typeName} from JSON: ${H(e)}`);const t=e.match(/^(-?[0-9]+)(?:\.([0-9]+))?s/);if(t===null)throw new Error(`cannot decode message ${n.$typeName} from JSON: ${H(e)}`);const r=Number(t[1]);if(r>315576e6||r<-315576e6)throw new Error(`cannot decode message ${n.$typeName} from JSON: ${H(e)}`);if(n.seconds=M.parse(r),typeof t[2]!="string")return;const s=t[2]+"0".repeat(9-t[2].length);n.nanos=parseInt(s),(r<0||Object.is(r,-0))&&(n.nanos=-n.nanos)}function Du(n,e){if(typeof e!="string")throw new Error(`cannot decode message ${n.$typeName} from JSON: ${H(e)}`);if(e==="")return;function t(r){if(r.includes("_"))throw new Error(`cannot decode message ${n.$typeName} from JSON: path names must be lowerCamelCase`);const s=r.replace(/[A-Z]/g,i=>"_"+i.toLowerCase());return s[0]==="_"?s.substring(1):s}n.paths=e.split(",").map(t)}function Pi(n,e){if(typeof e!="object"||e==null||Array.isArray(e))throw new Error(`cannot decode message ${n.$typeName} from JSON ${H(e)}`);for(const[t,r]of Object.entries(e)){const s=N(Ti);Cr(s,r),n.fields[t]=s}}function Cr(n,e){switch(typeof e){case"number":n.kind={case:"numberValue",value:e};break;case"string":n.kind={case:"stringValue",value:e};break;case"boolean":n.kind={case:"boolValue",value:e};break;case"object":if(e===null)n.kind={case:"nullValue",value:Er.NULL_VALUE};else if(Array.isArray(e)){const t=N(Hc);Zi(t,e),n.kind={case:"listValue",value:t}}else{const t=N(Qc);Pi(t,e),n.kind={case:"structValue",value:t}}break;default:throw new Error(`cannot decode message ${n.$typeName} from JSON ${H(e)}`)}return n}function Zi(n,e){if(!Array.isArray(e))throw new Error(`cannot decode message ${n.$typeName} from JSON ${H(e)}`);for(const t of e){const r=N(Ti);Cr(r,t),n.values.push(r)}}function Ui(n){const e=L[n];return typeof e!="string"?n.toString():e[0].toLowerCase()+e.substring(1).replace(/[A-Z]/g,t=>"_"+t.toLowerCase())}class Y extends Error{constructor(e,t=L.Unknown,r,s,i){super(xu(e,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=e,this.code=t,this.metadata=new Headers(r??{}),this.details=s??[],this.cause=i}static from(e,t=L.Unknown){return e instanceof Y?e:e instanceof Error?e.name=="AbortError"||e.name=="TimeoutError"?new Y(e.message,L.Canceled):new Y(e.message,t,void 0,void 0,e):new Y(String(e),t,void 0,void 0,e)}static[Symbol.hasInstance](e){return e instanceof Error?Object.getPrototypeOf(e)===Y.prototype?!0:e.name==="ConnectError"&&"code"in e&&typeof e.code=="number"&&"metadata"in e&&"details"in e&&Array.isArray(e.details)&&"rawMessage"in e&&typeof e.rawMessage=="string"&&"cause"in e:!1}findDetails(e){const t=e.kind==="message"?{getMessage:s=>s===e.typeName?e:void 0}:e,r=[];for(const s of this.details){if("desc"in s){t.getMessage(s.desc.typeName)&&r.push(N(s.desc,s.value));continue}const i=t.getMessage(s.type);if(i)try{r.push(ge(i,s.value))}catch{}}return r}}function xu(n,e){return n.length?`[${Ui(e)}] ${n}`:`[${Ui(e)}]`}function Lu(n,e,t){try{const r=fr(n);return e?ge(e,r,t):r}catch(r){throw Y.from(r,L.DataLoss)}}function Bu(n,e){const t={};for(const r of n.methods){const s=e(r);s!=null&&(t[r.localName]=s)}return t}const Yi=1;function Wu(n,e,t=!1){if(e>n){let r=`message size is larger than configured readMaxBytes ${n}`;throw t&&(r=`message size ${e} is larger than configured readMaxBytes ${n}`),new Y(r,L.ResourceExhausted)}}function ku(n){return new Ou(n)}class Ou{constructor(e){this.readMaxBytes=e,this.header=new Uint8Array(5),this.headerView=new DataView(this.header.buffer),this.buf=[]}get byteLength(){return this.buf.reduce((e,t)=>e+t.byteLength,0)}decode(e){this.buf.push(e);const t=[];for(;;){let r=this.pop();if(!r)break;t.push(r)}return t}pop(){if(!(!this.env&&(this.env=this.head(),!this.env))&&this.cons(this.env.data)){const e=this.env;return this.env=void 0,e}}head(){if(!this.cons(this.header))return;const e=this.headerView.getUint8(0),t=this.headerView.getUint32(1);return Wu(this.readMaxBytes,t,!0),{flags:e,data:new Uint8Array(t)}}cons(e){const t=e.byteLength;if(this.byteLength<t)return!1;let r=0;for(;r<t;){const s=this.buf.shift();s.byteLength>t-r?(e.set(s.subarray(0,t-r),r),this.buf.unshift(s.subarray(t-r)),r+=t-r):(e.set(s,r),r+=s.byteLength)}return!0}}function Gi(n){let e;const t=ku(4294967295);return new ReadableStream({start(){e=n.getReader()},async pull(r){let s=!1;for(;!s;){const i=await e.read();if(i.done)t.byteLength>0&&r.error(new Y("protocol error: incomplete envelope",L.InvalidArgument)),r.close();else for(const o of t.decode(i.value))r.enqueue(o),s=!0}}})}function Fi(n,e){const t=new Uint8Array(e.length+5);t.set(e,5);const r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.setUint8(0,n),r.setUint32(1,e.length),t}var Pu=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(a,c){o=n[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},o)}},Mt=function(n){return this instanceof Mt?(this.v=n,this):new Mt(n)},Zu=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(m){return function(y){return Promise.resolve(y).then(m,g)}}function a(m,y){r[m]&&(s[m]=function(A){return new Promise(function(I,E){i.push([m,A,I,E])>1||c(m,A)})},y&&(s[m]=y(s[m])))}function c(m,y){try{u(r[m](y))}catch(A){b(i[0][3],A)}}function u(m){m.value instanceof Mt?Promise.resolve(m.value.v).then(l,g):b(i[0][2],m)}function l(m){c("next",m)}function g(m){c("throw",m)}function b(m,y){m(y),i.shift(),i.length&&c(i[0][0],i[0][1])}},Uu=function(n){var e,t;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=n[s]?function(o){return(t=!t)?{value:Mt(n[s](o)),done:!1}:i?i(o):o}:i}};function Yu(n){return Zu(this,arguments,function*(){yield Mt(yield*Uu(Pu(n)))})}var Ki=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(a,c){o=n[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(u){i({value:u,done:a})},o)}},bt=function(n){return this instanceof bt?(this.v=n,this):new bt(n)},Gu=function(n){var e,t;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=n[s]?function(o){return(t=!t)?{value:bt(n[s](o)),done:!1}:i?i(o):o}:i}},Fu=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(m){return function(y){return Promise.resolve(y).then(m,g)}}function a(m,y){r[m]&&(s[m]=function(A){return new Promise(function(I,E){i.push([m,A,I,E])>1||c(m,A)})},y&&(s[m]=y(s[m])))}function c(m,y){try{u(r[m](y))}catch(A){b(i[0][3],A)}}function u(m){m.value instanceof bt?Promise.resolve(m.value.v).then(l,g):b(i[0][2],m)}function l(m){c("next",m)}function g(m){c("throw",m)}function b(m,y){m(y),i.shift(),i.length&&c(i[0][0],i[0][1])}};function Ku(n,e){return Bu(n,t=>{switch(t.methodKind){case"unary":return Mu(e,t);case"server_streaming":return Ju(e,t);case"client_streaming":return Xu(e,t);case"bidi_streaming":return _u(e,t);default:return null}})}function Mu(n,e){return async(t,r)=>{var s,i;const o=await n.unary(e,r==null?void 0:r.signal,r==null?void 0:r.timeoutMs,r==null?void 0:r.headers,t,r==null?void 0:r.contextValues);return(s=r==null?void 0:r.onHeader)===null||s===void 0||s.call(r,o.header),(i=r==null?void 0:r.onTrailer)===null||i===void 0||i.call(r,o.trailer),o.message}}function Ju(n,e){return(t,r)=>Mi(n.stream(e,r==null?void 0:r.signal,r==null?void 0:r.timeoutMs,r==null?void 0:r.headers,Yu([t]),r==null?void 0:r.contextValues),r)}function Xu(n,e){return async(t,r)=>{var s,i,o,a,c,u;const l=await n.stream(e,r==null?void 0:r.signal,r==null?void 0:r.timeoutMs,r==null?void 0:r.headers,t,r==null?void 0:r.contextValues);(c=r==null?void 0:r.onHeader)===null||c===void 0||c.call(r,l.header);let g,b=0;try{for(var m=!0,y=Ki(l.message),A;A=await y.next(),s=A.done,!s;m=!0)a=A.value,m=!1,g=a,b++}catch(I){i={error:I}}finally{try{!m&&!s&&(o=y.return)&&await o.call(y)}finally{if(i)throw i.error}}if(!g)throw new Y("protocol error: missing response message",L.Unimplemented);if(b>1)throw new Y("protocol error: received extra messages for client streaming method",L.Unimplemented);return(u=r==null?void 0:r.onTrailer)===null||u===void 0||u.call(r,l.trailer),g}}function _u(n,e){return(t,r)=>Mi(n.stream(e,r==null?void 0:r.signal,r==null?void 0:r.timeoutMs,r==null?void 0:r.headers,t,r==null?void 0:r.contextValues),r)}function Mi(n,e){const t=function(){return Fu(this,arguments,function*(){var r,s;const i=yield bt(n);(r=e==null?void 0:e.onHeader)===null||r===void 0||r.call(e,i.header),yield bt(yield*Gu(Ki(i.message))),(s=e==null?void 0:e.onTrailer)===null||s===void 0||s.call(e,i.trailer)})}()[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:()=>t.next()})}}function $u(...n){const e=new AbortController,t=n.filter(s=>s!==void 0).concat(e.signal);for(const s of t){if(s.aborted){r.apply(s);break}s.addEventListener("abort",r)}function r(){e.signal.aborted||e.abort(Ji(this));for(const s of t)s.removeEventListener("abort",r)}return e}function zu(n){const e=new AbortController,t=()=>{e.abort(new Y("the operation timed out",L.DeadlineExceeded))};let r;return n!==void 0&&(n<=0?t():r=setTimeout(t,n)),{signal:e.signal,cleanup:()=>clearTimeout(r)}}function Ji(n){if(!n.aborted)return;if(n.reason!==void 0)return n.reason;const e=new Error("This operation was aborted");return e.name="AbortError",e}function Xi(){return{get(n){return n.id in this?this[n.id]:n.defaultValue},set(n,e){return this[n.id]=e,this},delete(n){return delete this[n.id],this}}}const Tr=128;function _i(n){const e=new Headers,t=new TextDecoder().decode(n).split(`\r
`);for(const r of t){if(r==="")continue;const s=r.indexOf(":");if(s>0){const i=r.substring(0,s).trim(),o=r.substring(s+1).trim();e.append(i,o)}}return e}const ju="Content-Type",Qu="Grpc-Timeout",yt="Grpc-Status",$i="Grpc-Message",Hu="Grpc-Status-Details-Bin",qu="User-Agent",zi="X-User-Agent",el="X-Grpc-Web",tl="application/grpc-web+proto",nl="application/grpc-web+json";function rl(n,e,...t){if(t.length>0)throw new Error;return n.services[e]}const sl=T(Ye("CgxzdGF0dXMucHJvdG8SCmdvb2dsZS5ycGMiTgoGU3RhdHVzEgwKBGNvZGUYASABKAUSDwoHbWVzc2FnZRgCIAEoCRIlCgdkZXRhaWxzGAMgAygLMhQuZ29vZ2xlLnByb3RvYnVmLkFueUJeCg5jb20uZ29vZ2xlLnJwY0ILU3RhdHVzUHJvdG9QAVo3Z29vZ2xlLmdvbGFuZy5vcmcvZ2VucHJvdG8vZ29vZ2xlYXBpcy9ycGMvc3RhdHVzO3N0YXR1c6ICA1JQQ2IGcHJvdG8z",[Ii]),0),il="0";function ji(n){var e;const t=n.get(Hu);if(t!=null){const s=Lu(t,sl);if(s.code==0)return;const i=new Y(s.message,s.code,n);return i.details=s.details.map(o=>({type:o.typeUrl.substring(o.typeUrl.lastIndexOf("/")+1),value:o.value})),i}const r=n.get(yt);if(r!=null){if(r===il)return;const s=parseInt(r,10);return s in L?new Y(decodeURIComponent((e=n.get($i))!==null&&e!==void 0?e:""),s,n):new Y(`invalid grpc-status: ${r}`,L.Internal,n)}}function Qi(n,e){return n.toString().replace(/\/?$/,`/${e.parent.typeName}/${e.name}`)}function Hi(n,e){return N(n,e)}function ol(n,e){function t(r){return r.done===!0?r:{done:r.done,value:Hi(n,r.value)}}return{[Symbol.asyncIterator](){const r=e[Symbol.asyncIterator](),s={next:()=>r.next().then(t)};return r.throw!==void 0&&(s.throw=i=>r.throw(i).then(t)),r.return!==void 0&&(s.return=i=>r.return(i).then(t)),s}}}function qi(n,e){if(!e)return n;for(const t of e.concat().reverse())n=t(n);return n}function al(n){var e;const t=Object.assign({},n);return(e=t.ignoreUnknownFields)!==null&&e!==void 0||(t.ignoreUnknownFields=!0),t}function eo(n,e,t,r){const s=e?to(n.input,r):no(n.input,t);return{parse:(e?to(n.output,r):no(n.output,t)).parse,serialize:s.serialize}}function to(n,e){return{parse(t){try{return ge(n,t,e)}catch(r){const s=r instanceof Error?r.message:String(r);throw new Y(`parse binary: ${s}`,L.Internal)}},serialize(t){try{return ze(n,t,e)}catch(r){const s=r instanceof Error?r.message:String(r);throw new Y(`serialize binary: ${s}`,L.Internal)}}}}function no(n,e){var t,r;const s=(t=e==null?void 0:e.textEncoder)!==null&&t!==void 0?t:new TextEncoder,i=(r=e==null?void 0:e.textDecoder)!==null&&r!==void 0?r:new TextDecoder,o=al(e);return{parse(a){try{const c=i.decode(a);return bu(n,c,o)}catch(c){throw Y.from(c,L.InvalidArgument)}},serialize(a){try{const c=au(n,a,o);return s.encode(c)}catch(c){throw Y.from(c,L.Internal)}}}}function cl(n){const e=qi(n.next,n.interceptors),[t,r,s]=ro(n),i=Object.assign(Object.assign({},n.req),{message:Hi(n.req.method.input,n.req.message),signal:t});return e(i).then(o=>(s(),o),r)}function ul(n){const e=qi(n.next,n.interceptors),[t,r,s]=ro(n),i=Object.assign(Object.assign({},n.req),{message:ol(n.req.method.input,n.req.message),signal:t});let o=!1;return t.addEventListener("abort",function(){var a,c;const u=n.req.message[Symbol.asyncIterator]();o||(a=u.throw)===null||a===void 0||a.call(u,this.reason).catch(()=>{}),(c=u.return)===null||c===void 0||c.call(u).catch(()=>{})}),e(i).then(a=>Object.assign(Object.assign({},a),{message:{[Symbol.asyncIterator](){const c=a.message[Symbol.asyncIterator]();return{next(){return c.next().then(u=>(u.done==!0&&(o=!0,s()),u),r)}}}}}),r)}function ro(n){const{signal:e,cleanup:t}=zu(n.timeoutMs),r=$u(n.signal,e);return[r.signal,function(i){const o=Y.from(e.aborted?Ji(e):i);return r.abort(o),t(),Promise.reject(o)},function(){t(),r.abort()}]}function ll(){try{new Headers}catch{throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}function so(n,e){const t=ji(n);if(t)throw e.forEach((r,s)=>{t.metadata.append(s,r)}),t;if(!e.has(yt)&&!n.has(yt))throw new Y("protocol error: missing status",L.Internal)}function io(n,e,t,r){var s,i;const o=new Headers(t??{});o.set(ju,n?tl:nl),o.set(el,"1");const a=(i=(s=o.get(qu))!==null&&s!==void 0?s:o.get(zi))!==null&&i!==void 0?i:"connect-es/2.1.1";return o.set(zi,a),e!==void 0&&o.set(Qu,`${e}m`),o}function hl(n){switch(n){case 400:return L.Internal;case 401:return L.Unauthenticated;case 403:return L.PermissionDenied;case 404:return L.Unimplemented;case 429:return L.Unavailable;case 502:return L.Unavailable;case 503:return L.Unavailable;case 504:return L.Unavailable;default:return L.Unknown}}function oo(n,e){var t;if(n>=200&&n<300)return{foundStatus:e.has(yt),headerError:ji(e)};throw new Y(decodeURIComponent((t=e.get($i))!==null&&t!==void 0?t:`HTTP ${n}`),hl(n),e)}var at=function(n){return this instanceof at?(this.v=n,this):new at(n)},dl=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(m){return function(y){return Promise.resolve(y).then(m,g)}}function a(m,y){r[m]&&(s[m]=function(A){return new Promise(function(I,E){i.push([m,A,I,E])>1||c(m,A)})},y&&(s[m]=y(s[m])))}function c(m,y){try{u(r[m](y))}catch(A){b(i[0][3],A)}}function u(m){m.value instanceof at?Promise.resolve(m.value.v).then(l,g):b(i[0][2],m)}function l(m){c("next",m)}function g(m){c("throw",m)}function b(m,y){m(y),i.shift(),i.length&&c(i[0][0],i[0][1])}};const ao={redirect:"error"};function fl(n){var e;ll();const t=(e=n.useBinaryFormat)!==null&&e!==void 0?e:!0;return{async unary(r,s,i,o,a,c){const{serialize:u,parse:l}=eo(r,t,n.jsonOptions,n.binaryOptions);return i=i===void 0?n.defaultTimeoutMs:i<=0?void 0:i,await cl({interceptors:n.interceptors,signal:s,timeoutMs:i,req:{stream:!1,service:r.parent,method:r,requestMethod:"POST",url:Qi(n.baseUrl,r),header:io(t,i,o),contextValues:c??Xi(),message:a},next:async g=>{var b;const y=await((b=n.fetch)!==null&&b!==void 0?b:globalThis.fetch)(g.url,Object.assign(Object.assign({},ao),{method:g.requestMethod,headers:g.header,signal:g.signal,body:Fi(0,u(g.message))})),{headerError:A}=oo(y.status,y.headers);if(!y.body)throw A!==void 0?A:"missing response body";const I=Gi(y.body).getReader();let E,C;for(;;){const k=await I.read();if(k.done)break;const{flags:O,data:U}=k.value;if((O&Yi)===Yi)throw new Y("protocol error: received unsupported compressed output",L.Internal);if(O===Tr){if(E!==void 0)throw"extra trailer";E=_i(U);continue}if(C!==void 0)throw new Y("extra message",L.Unimplemented);C=l(U)}if(E===void 0)throw A!==void 0?A:new Y("missing trailer",y.headers.has(yt)?L.Unimplemented:L.Unknown);if(so(E,y.headers),C===void 0)throw new Y("missing message",E.has(yt)?L.Unimplemented:L.Unknown);return{stream:!1,service:r.parent,method:r,header:y.headers,message:C,trailer:E}}})},async stream(r,s,i,o,a,c){const{serialize:u,parse:l}=eo(r,t,n.jsonOptions,n.binaryOptions);function g(m,y,A,I,E){return dl(this,arguments,function*(){const k=Gi(m).getReader();if(y){if(!(yield at(k.read())).done)throw"extra data for trailers-only";return yield at(void 0)}let O=!1;for(;;){const U=yield at(k.read());if(U.done)break;const{flags:V,data:F}=U.value;if((V&Tr)===Tr){if(O)throw"extra trailer";O=!0;const _=_i(F);so(_,I),_.forEach((j,Ve)=>A.set(Ve,j));continue}if(O)throw"extra message";yield yield at(l(F))}if("throwIfAborted"in E&&E.throwIfAborted(),!O)throw"missing trailer"})}async function b(m){if(r.methodKind!="server_streaming")throw"The fetch API does not support streaming request bodies";const y=await m[Symbol.asyncIterator]().next();if(y.done==!0)throw"missing request message";return Fi(0,u(y.value))}return i=i===void 0?n.defaultTimeoutMs:i<=0?void 0:i,ul({interceptors:n.interceptors,signal:s,timeoutMs:i,req:{stream:!0,service:r.parent,method:r,requestMethod:"POST",url:Qi(n.baseUrl,r),header:io(t,i,o),contextValues:c??Xi(),message:a},next:async m=>{var y;const I=await((y=n.fetch)!==null&&y!==void 0?y:globalThis.fetch)(m.url,Object.assign(Object.assign({},ao),{method:m.requestMethod,headers:m.header,signal:m.signal,body:await b(m.message)})),{foundStatus:E,headerError:C}=oo(I.status,I.headers);if(C!=null)throw C;if(!I.body)throw"missing response body";const k=new Headers;return Object.assign(Object.assign({},m),{header:I.headers,trailer:k,message:g(I.body,E,k,I.headers,m.signal)})}})}}}const D=Ye("CiFzcmMvYXBpL3lvcmtpZS92MS9yZXNvdXJjZXMucHJvdG8SCXlvcmtpZS52MSKuAQoIU25hcHNob3QSJAoEcm9vdBgBIAEoCzIWLnlvcmtpZS52MS5KU09ORWxlbWVudBI1CglwcmVzZW5jZXMYAiADKAsyIi55b3JraWUudjEuU25hcHNob3QuUHJlc2VuY2VzRW50cnkaRQoOUHJlc2VuY2VzRW50cnkSCwoDa2V5GAEgASgJEiIKBXZhbHVlGAIgASgLMhMueW9ya2llLnYxLlByZXNlbmNlOgI4ASL7AQoKQ2hhbmdlUGFjaxIUCgxkb2N1bWVudF9rZXkYASABKAkSKQoKY2hlY2twb2ludBgCIAEoCzIVLnlvcmtpZS52MS5DaGVja3BvaW50EhAKCHNuYXBzaG90GAMgASgMEiIKB2NoYW5nZXMYBCADKAsyES55b3JraWUudjEuQ2hhbmdlEjAKEW1pbl9zeW5jZWRfdGlja2V0GAUgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSEgoKaXNfcmVtb3ZlZBgGIAEoCBIwCg52ZXJzaW9uX3ZlY3RvchgHIAEoCzIYLnlvcmtpZS52MS5WZXJzaW9uVmVjdG9yIpgBCgZDaGFuZ2USHwoCaWQYASABKAsyEy55b3JraWUudjEuQ2hhbmdlSUQSDwoHbWVzc2FnZRgCIAEoCRIoCgpvcGVyYXRpb25zGAMgAygLMhQueW9ya2llLnYxLk9wZXJhdGlvbhIyCg9wcmVzZW5jZV9jaGFuZ2UYBCABKAsyGS55b3JraWUudjEuUHJlc2VuY2VDaGFuZ2UihwEKCENoYW5nZUlEEhIKCmNsaWVudF9zZXEYASABKA0SEgoKc2VydmVyX3NlcRgCIAEoAxIPCgdsYW1wb3J0GAMgASgDEhAKCGFjdG9yX2lkGAQgASgMEjAKDnZlcnNpb25fdmVjdG9yGAUgASgLMhgueW9ya2llLnYxLlZlcnNpb25WZWN0b3IidAoNVmVyc2lvblZlY3RvchI0CgZ2ZWN0b3IYASADKAsyJC55b3JraWUudjEuVmVyc2lvblZlY3Rvci5WZWN0b3JFbnRyeRotCgtWZWN0b3JFbnRyeRILCgNrZXkYASABKAkSDQoFdmFsdWUYAiABKAM6AjgBIsoaCglPcGVyYXRpb24SJwoDc2V0GAEgASgLMhgueW9ya2llLnYxLk9wZXJhdGlvbi5TZXRIABInCgNhZGQYAiABKAsyGC55b3JraWUudjEuT3BlcmF0aW9uLkFkZEgAEikKBG1vdmUYAyABKAsyGS55b3JraWUudjEuT3BlcmF0aW9uLk1vdmVIABItCgZyZW1vdmUYBCABKAsyGy55b3JraWUudjEuT3BlcmF0aW9uLlJlbW92ZUgAEikKBGVkaXQYBSABKAsyGS55b3JraWUudjEuT3BlcmF0aW9uLkVkaXRIABIrCgVzdHlsZRgHIAEoCzIaLnlvcmtpZS52MS5PcGVyYXRpb24uU3R5bGVIABIxCghpbmNyZWFzZRgIIAEoCzIdLnlvcmtpZS52MS5PcGVyYXRpb24uSW5jcmVhc2VIABIyCgl0cmVlX2VkaXQYCSABKAsyHS55b3JraWUudjEuT3BlcmF0aW9uLlRyZWVFZGl0SAASNAoKdHJlZV9zdHlsZRgKIAEoCzIeLnlvcmtpZS52MS5PcGVyYXRpb24uVHJlZVN0eWxlSAASMgoJYXJyYXlfc2V0GAsgASgLMh0ueW9ya2llLnYxLk9wZXJhdGlvbi5BcnJheVNldEgAGp0BCgNTZXQSMAoRcGFyZW50X2NyZWF0ZWRfYXQYASABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBILCgNrZXkYAiABKAkSKwoFdmFsdWUYAyABKAsyHC55b3JraWUudjEuSlNPTkVsZW1lbnRTaW1wbGUSKgoLZXhlY3V0ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBrAAQoDQWRkEjAKEXBhcmVudF9jcmVhdGVkX2F0GAEgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSLgoPcHJldl9jcmVhdGVkX2F0GAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKwoFdmFsdWUYAyABKAsyHC55b3JraWUudjEuSlNPTkVsZW1lbnRTaW1wbGUSKgoLZXhlY3V0ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBq/AQoETW92ZRIwChFwYXJlbnRfY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0Ei4KD3ByZXZfY3JlYXRlZF9hdBgCIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EikKCmNyZWF0ZWRfYXQYAyABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIqCgtleGVjdXRlZF9hdBgEIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0GpEBCgZSZW1vdmUSMAoRcGFyZW50X2NyZWF0ZWRfYXQYASABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIpCgpjcmVhdGVkX2F0GAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKgoLZXhlY3V0ZWRfYXQYAyABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBrZAwoERWRpdBIwChFwYXJlbnRfY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EiQKBGZyb20YAiABKAsyFi55b3JraWUudjEuVGV4dE5vZGVQb3MSIgoCdG8YAyABKAsyFi55b3JraWUudjEuVGV4dE5vZGVQb3MSUwoXY3JlYXRlZF9hdF9tYXBfYnlfYWN0b3IYBCADKAsyMi55b3JraWUudjEuT3BlcmF0aW9uLkVkaXQuQ3JlYXRlZEF0TWFwQnlBY3RvckVudHJ5Eg8KB2NvbnRlbnQYBSABKAkSKgoLZXhlY3V0ZWRfYXQYBiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBI9CgphdHRyaWJ1dGVzGAcgAygLMikueW9ya2llLnYxLk9wZXJhdGlvbi5FZGl0LkF0dHJpYnV0ZXNFbnRyeRpRChhDcmVhdGVkQXRNYXBCeUFjdG9yRW50cnkSCwoDa2V5GAEgASgJEiQKBXZhbHVlGAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQ6AjgBGjEKD0F0dHJpYnV0ZXNFbnRyeRILCgNrZXkYASABKAkSDQoFdmFsdWUYAiABKAk6AjgBGukDCgVTdHlsZRIwChFwYXJlbnRfY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EiQKBGZyb20YAiABKAsyFi55b3JraWUudjEuVGV4dE5vZGVQb3MSIgoCdG8YAyABKAsyFi55b3JraWUudjEuVGV4dE5vZGVQb3MSPgoKYXR0cmlidXRlcxgEIAMoCzIqLnlvcmtpZS52MS5PcGVyYXRpb24uU3R5bGUuQXR0cmlidXRlc0VudHJ5EioKC2V4ZWN1dGVkX2F0GAUgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSVAoXY3JlYXRlZF9hdF9tYXBfYnlfYWN0b3IYBiADKAsyMy55b3JraWUudjEuT3BlcmF0aW9uLlN0eWxlLkNyZWF0ZWRBdE1hcEJ5QWN0b3JFbnRyeRIcChRhdHRyaWJ1dGVzX3RvX3JlbW92ZRgHIAMoCRoxCg9BdHRyaWJ1dGVzRW50cnkSCwoDa2V5GAEgASgJEg0KBXZhbHVlGAIgASgJOgI4ARpRChhDcmVhdGVkQXRNYXBCeUFjdG9yRW50cnkSCwoDa2V5GAEgASgJEiQKBXZhbHVlGAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQ6AjgBGpUBCghJbmNyZWFzZRIwChFwYXJlbnRfY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EisKBXZhbHVlGAIgASgLMhwueW9ya2llLnYxLkpTT05FbGVtZW50U2ltcGxlEioKC2V4ZWN1dGVkX2F0GAMgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQakwMKCFRyZWVFZGl0EjAKEXBhcmVudF9jcmVhdGVkX2F0GAEgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSIAoEZnJvbRgCIAEoCzISLnlvcmtpZS52MS5UcmVlUG9zEh4KAnRvGAMgASgLMhIueW9ya2llLnYxLlRyZWVQb3MSVwoXY3JlYXRlZF9hdF9tYXBfYnlfYWN0b3IYBCADKAsyNi55b3JraWUudjEuT3BlcmF0aW9uLlRyZWVFZGl0LkNyZWF0ZWRBdE1hcEJ5QWN0b3JFbnRyeRImCghjb250ZW50cxgFIAMoCzIULnlvcmtpZS52MS5UcmVlTm9kZXMSEwoLc3BsaXRfbGV2ZWwYByABKAUSKgoLZXhlY3V0ZWRfYXQYBiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBpRChhDcmVhdGVkQXRNYXBCeUFjdG9yRW50cnkSCwoDa2V5GAEgASgJEiQKBXZhbHVlGAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQ6AjgBGu0DCglUcmVlU3R5bGUSMAoRcGFyZW50X2NyZWF0ZWRfYXQYASABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIgCgRmcm9tGAIgASgLMhIueW9ya2llLnYxLlRyZWVQb3MSHgoCdG8YAyABKAsyEi55b3JraWUudjEuVHJlZVBvcxJCCgphdHRyaWJ1dGVzGAQgAygLMi4ueW9ya2llLnYxLk9wZXJhdGlvbi5UcmVlU3R5bGUuQXR0cmlidXRlc0VudHJ5EioKC2V4ZWN1dGVkX2F0GAUgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSHAoUYXR0cmlidXRlc190b19yZW1vdmUYBiADKAkSWAoXY3JlYXRlZF9hdF9tYXBfYnlfYWN0b3IYByADKAsyNy55b3JraWUudjEuT3BlcmF0aW9uLlRyZWVTdHlsZS5DcmVhdGVkQXRNYXBCeUFjdG9yRW50cnkaMQoPQXR0cmlidXRlc0VudHJ5EgsKA2tleRgBIAEoCRINCgV2YWx1ZRgCIAEoCToCOAEaUQoYQ3JlYXRlZEF0TWFwQnlBY3RvckVudHJ5EgsKA2tleRgBIAEoCRIkCgV2YWx1ZRgCIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0OgI4ARrAAQoIQXJyYXlTZXQSMAoRcGFyZW50X2NyZWF0ZWRfYXQYASABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIpCgpjcmVhdGVkX2F0GAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKwoFdmFsdWUYAyABKAsyHC55b3JraWUudjEuSlNPTkVsZW1lbnRTaW1wbGUSKgoLZXhlY3V0ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldEIGCgRib2R5IsUBChFKU09ORWxlbWVudFNpbXBsZRIpCgpjcmVhdGVkX2F0GAEgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSJwoIbW92ZWRfYXQYAiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIpCgpyZW1vdmVkX2F0GAMgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSIgoEdHlwZRgEIAEoDjIULnlvcmtpZS52MS5WYWx1ZVR5cGUSDQoFdmFsdWUYBSABKAwiggsKC0pTT05FbGVtZW50EjgKC2pzb25fb2JqZWN0GAEgASgLMiEueW9ya2llLnYxLkpTT05FbGVtZW50LkpTT05PYmplY3RIABI2Cgpqc29uX2FycmF5GAIgASgLMiAueW9ya2llLnYxLkpTT05FbGVtZW50LkpTT05BcnJheUgAEjUKCXByaW1pdGl2ZRgDIAEoCzIgLnlvcmtpZS52MS5KU09ORWxlbWVudC5QcmltaXRpdmVIABIrCgR0ZXh0GAUgASgLMhsueW9ya2llLnYxLkpTT05FbGVtZW50LlRleHRIABIxCgdjb3VudGVyGAYgASgLMh4ueW9ya2llLnYxLkpTT05FbGVtZW50LkNvdW50ZXJIABIrCgR0cmVlGAcgASgLMhsueW9ya2llLnYxLkpTT05FbGVtZW50LlRyZWVIABquAQoKSlNPTk9iamVjdBIhCgVub2RlcxgBIAMoCzISLnlvcmtpZS52MS5SSFROb2RlEikKCmNyZWF0ZWRfYXQYAiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBInCghtb3ZlZF9hdBgDIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EikKCnJlbW92ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBqtAQoJSlNPTkFycmF5EiEKBW5vZGVzGAEgAygLMhIueW9ya2llLnYxLlJHQU5vZGUSKQoKY3JlYXRlZF9hdBgCIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EicKCG1vdmVkX2F0GAMgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKQoKcmVtb3ZlZF9hdBgEIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0Gr0BCglQcmltaXRpdmUSIgoEdHlwZRgBIAEoDjIULnlvcmtpZS52MS5WYWx1ZVR5cGUSDQoFdmFsdWUYAiABKAwSKQoKY3JlYXRlZF9hdBgDIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EicKCG1vdmVkX2F0GAQgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKQoKcmVtb3ZlZF9hdBgFIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0GqkBCgRUZXh0EiIKBW5vZGVzGAEgAygLMhMueW9ya2llLnYxLlRleHROb2RlEikKCmNyZWF0ZWRfYXQYAiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBInCghtb3ZlZF9hdBgDIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EikKCnJlbW92ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBq7AQoHQ291bnRlchIiCgR0eXBlGAEgASgOMhQueW9ya2llLnYxLlZhbHVlVHlwZRINCgV2YWx1ZRgCIAEoDBIpCgpjcmVhdGVkX2F0GAMgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSJwoIbW92ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIpCgpyZW1vdmVkX2F0GAUgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQaqQEKBFRyZWUSIgoFbm9kZXMYASADKAsyEy55b3JraWUudjEuVHJlZU5vZGUSKQoKY3JlYXRlZF9hdBgCIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EicKCG1vdmVkX2F0GAMgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKQoKcmVtb3ZlZF9hdBgEIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0QgYKBGJvZHkiPwoHUkhUTm9kZRILCgNrZXkYASABKAkSJwoHZWxlbWVudBgCIAEoCzIWLnlvcmtpZS52MS5KU09ORWxlbWVudCJUCgdSR0FOb2RlEiAKBG5leHQYASABKAsyEi55b3JraWUudjEuUkdBTm9kZRInCgdlbGVtZW50GAIgASgLMhYueW9ya2llLnYxLkpTT05FbGVtZW50IlgKCE5vZGVBdHRyEg0KBXZhbHVlGAEgASgJEikKCnVwZGF0ZWRfYXQYAiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBISCgppc19yZW1vdmVkGAMgASgIIpQCCghUZXh0Tm9kZRIhCgJpZBgBIAEoCzIVLnlvcmtpZS52MS5UZXh0Tm9kZUlEEg0KBXZhbHVlGAIgASgJEikKCnJlbW92ZWRfYXQYAyABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIqCgtpbnNfcHJldl9pZBgEIAEoCzIVLnlvcmtpZS52MS5UZXh0Tm9kZUlEEjcKCmF0dHJpYnV0ZXMYBSADKAsyIy55b3JraWUudjEuVGV4dE5vZGUuQXR0cmlidXRlc0VudHJ5GkYKD0F0dHJpYnV0ZXNFbnRyeRILCgNrZXkYASABKAkSIgoFdmFsdWUYAiABKAsyEy55b3JraWUudjEuTm9kZUF0dHI6AjgBIkcKClRleHROb2RlSUQSKQoKY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0Eg4KBm9mZnNldBgCIAEoBSLdAgoIVHJlZU5vZGUSIQoCaWQYASABKAsyFS55b3JraWUudjEuVHJlZU5vZGVJRBIMCgR0eXBlGAIgASgJEg0KBXZhbHVlGAMgASgJEikKCnJlbW92ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIqCgtpbnNfcHJldl9pZBgFIAEoCzIVLnlvcmtpZS52MS5UcmVlTm9kZUlEEioKC2luc19uZXh0X2lkGAYgASgLMhUueW9ya2llLnYxLlRyZWVOb2RlSUQSDQoFZGVwdGgYByABKAUSNwoKYXR0cmlidXRlcxgIIAMoCzIjLnlvcmtpZS52MS5UcmVlTm9kZS5BdHRyaWJ1dGVzRW50cnkaRgoPQXR0cmlidXRlc0VudHJ5EgsKA2tleRgBIAEoCRIiCgV2YWx1ZRgCIAEoCzITLnlvcmtpZS52MS5Ob2RlQXR0cjoCOAEiMQoJVHJlZU5vZGVzEiQKB2NvbnRlbnQYASADKAsyEy55b3JraWUudjEuVHJlZU5vZGUiRwoKVHJlZU5vZGVJRBIpCgpjcmVhdGVkX2F0GAEgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSDgoGb2Zmc2V0GAIgASgFImMKB1RyZWVQb3MSKAoJcGFyZW50X2lkGAEgASgLMhUueW9ya2llLnYxLlRyZWVOb2RlSUQSLgoPbGVmdF9zaWJsaW5nX2lkGAIgASgLMhUueW9ya2llLnYxLlRyZWVOb2RlSUQiawoEVXNlchIKCgJpZBgBIAEoCRIVCg1hdXRoX3Byb3ZpZGVyGAIgASgJEhAKCHVzZXJuYW1lGAMgASgJEi4KCmNyZWF0ZWRfYXQYBCABKAsyGi5nb29nbGUucHJvdG9idWYuVGltZXN0YW1wIokBCgZNZW1iZXISCgoCaWQYASABKAkSEgoKcHJvamVjdF9pZBgCIAEoCRIPCgd1c2VyX2lkGAMgASgJEhAKCHVzZXJuYW1lGAQgASgJEgwKBHJvbGUYBSABKAkSLgoKaW52aXRlZF9hdBgGIAEoCzIaLmdvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXAi6QYKB1Byb2plY3QSCgoCaWQYASABKAkSDAoEbmFtZRgCIAEoCRISCgpwdWJsaWNfa2V5GAMgASgJEhIKCnNlY3JldF9rZXkYBCABKAkSGAoQYXV0aF93ZWJob29rX3VybBgFIAEoCRIcChRhdXRoX3dlYmhvb2tfbWV0aG9kcxgGIAMoCRIgChhhdXRoX3dlYmhvb2tfbWF4X3JldHJpZXMYESABKAQSJgoeYXV0aF93ZWJob29rX21pbl93YWl0X2ludGVydmFsGBIgASgJEiYKHmF1dGhfd2ViaG9va19tYXhfd2FpdF9pbnRlcnZhbBgTIAEoCRIkChxhdXRoX3dlYmhvb2tfcmVxdWVzdF90aW1lb3V0GBQgASgJEhkKEWV2ZW50X3dlYmhvb2tfdXJsGAcgASgJEhwKFGV2ZW50X3dlYmhvb2tfZXZlbnRzGAggAygJEiEKGWV2ZW50X3dlYmhvb2tfbWF4X3JldHJpZXMYFSABKAQSJwofZXZlbnRfd2ViaG9va19taW5fd2FpdF9pbnRlcnZhbBgWIAEoCRInCh9ldmVudF93ZWJob29rX21heF93YWl0X2ludGVydmFsGBcgASgJEiUKHWV2ZW50X3dlYmhvb2tfcmVxdWVzdF90aW1lb3V0GBggASgJEiMKG2NsaWVudF9kZWFjdGl2YXRlX3RocmVzaG9sZBgJIAEoCRIaChJzbmFwc2hvdF90aHJlc2hvbGQYGSABKAMSGQoRc25hcHNob3RfaW50ZXJ2YWwYGiABKAMSJAocbWF4X3N1YnNjcmliZXJzX3Blcl9kb2N1bWVudBgKIAEoBRIkChxtYXhfYXR0YWNobWVudHNfcGVyX2RvY3VtZW50GAsgASgFEh0KFW1heF9zaXplX3Blcl9kb2N1bWVudBgPIAEoBRIYChByZW1vdmVfb25fZGV0YWNoGBAgASgIEh0KFWF1dG9fcmV2aXNpb25fZW5hYmxlZBgbIAEoCBIXCg9hbGxvd2VkX29yaWdpbnMYDiADKAkSLgoKY3JlYXRlZF9hdBgMIAEoCzIaLmdvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXASLgoKdXBkYXRlZF9hdBgNIAEoCzIaLmdvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXAiLwoLTWV0cmljUG9pbnQSEQoJdGltZXN0YW1wGAEgASgDEg0KBXZhbHVlGAIgASgFIqMMChZVcGRhdGFibGVQcm9qZWN0RmllbGRzEioKBG5hbWUYASABKAsyHC5nb29nbGUucHJvdG9idWYuU3RyaW5nVmFsdWUSNgoQYXV0aF93ZWJob29rX3VybBgCIAEoCzIcLmdvb2dsZS5wcm90b2J1Zi5TdHJpbmdWYWx1ZRJSChRhdXRoX3dlYmhvb2tfbWV0aG9kcxgDIAEoCzI0LnlvcmtpZS52MS5VcGRhdGFibGVQcm9qZWN0RmllbGRzLkF1dGhXZWJob29rTWV0aG9kcxI+ChhhdXRoX3dlYmhvb2tfbWF4X3JldHJpZXMYDCABKAsyHC5nb29nbGUucHJvdG9idWYuVUludDY0VmFsdWUSRAoeYXV0aF93ZWJob29rX21pbl93YWl0X2ludGVydmFsGA0gASgLMhwuZ29vZ2xlLnByb3RvYnVmLlN0cmluZ1ZhbHVlEkQKHmF1dGhfd2ViaG9va19tYXhfd2FpdF9pbnRlcnZhbBgOIAEoCzIcLmdvb2dsZS5wcm90b2J1Zi5TdHJpbmdWYWx1ZRJCChxhdXRoX3dlYmhvb2tfcmVxdWVzdF90aW1lb3V0GA8gASgLMhwuZ29vZ2xlLnByb3RvYnVmLlN0cmluZ1ZhbHVlEjcKEWV2ZW50X3dlYmhvb2tfdXJsGAQgASgLMhwuZ29vZ2xlLnByb3RvYnVmLlN0cmluZ1ZhbHVlElIKFGV2ZW50X3dlYmhvb2tfZXZlbnRzGAUgASgLMjQueW9ya2llLnYxLlVwZGF0YWJsZVByb2plY3RGaWVsZHMuRXZlbnRXZWJob29rRXZlbnRzEj8KGWV2ZW50X3dlYmhvb2tfbWF4X3JldHJpZXMYECABKAsyHC5nb29nbGUucHJvdG9idWYuVUludDY0VmFsdWUSRQofZXZlbnRfd2ViaG9va19taW5fd2FpdF9pbnRlcnZhbBgRIAEoCzIcLmdvb2dsZS5wcm90b2J1Zi5TdHJpbmdWYWx1ZRJFCh9ldmVudF93ZWJob29rX21heF93YWl0X2ludGVydmFsGBIgASgLMhwuZ29vZ2xlLnByb3RvYnVmLlN0cmluZ1ZhbHVlEkMKHWV2ZW50X3dlYmhvb2tfcmVxdWVzdF90aW1lb3V0GBMgASgLMhwuZ29vZ2xlLnByb3RvYnVmLlN0cmluZ1ZhbHVlEjcKEnNuYXBzaG90X3RocmVzaG9sZBgUIAEoCzIbLmdvb2dsZS5wcm90b2J1Zi5JbnQ2NFZhbHVlEjYKEXNuYXBzaG90X2ludGVydmFsGBUgASgLMhsuZ29vZ2xlLnByb3RvYnVmLkludDY0VmFsdWUSQQobY2xpZW50X2RlYWN0aXZhdGVfdGhyZXNob2xkGAYgASgLMhwuZ29vZ2xlLnByb3RvYnVmLlN0cmluZ1ZhbHVlEkEKHG1heF9zdWJzY3JpYmVyc19wZXJfZG9jdW1lbnQYByABKAsyGy5nb29nbGUucHJvdG9idWYuSW50MzJWYWx1ZRJBChxtYXhfYXR0YWNobWVudHNfcGVyX2RvY3VtZW50GAggASgLMhsuZ29vZ2xlLnByb3RvYnVmLkludDMyVmFsdWUSOgoVbWF4X3NpemVfcGVyX2RvY3VtZW50GAogASgLMhsuZ29vZ2xlLnByb3RvYnVmLkludDMyVmFsdWUSNAoQcmVtb3ZlX29uX2RldGFjaBgLIAEoCzIaLmdvb2dsZS5wcm90b2J1Zi5Cb29sVmFsdWUSOQoVYXV0b19yZXZpc2lvbl9lbmFibGVkGBYgASgLMhouZ29vZ2xlLnByb3RvYnVmLkJvb2xWYWx1ZRJJCg9hbGxvd2VkX29yaWdpbnMYCSABKAsyMC55b3JraWUudjEuVXBkYXRhYmxlUHJvamVjdEZpZWxkcy5BbGxvd2VkT3JpZ2lucxolChJBdXRoV2ViaG9va01ldGhvZHMSDwoHbWV0aG9kcxgBIAMoCRokChJFdmVudFdlYmhvb2tFdmVudHMSDgoGZXZlbnRzGAEgAygJGiEKDkFsbG93ZWRPcmlnaW5zEg8KB29yaWdpbnMYASADKAkipwMKD0RvY3VtZW50U3VtbWFyeRIKCgJpZBgBIAEoCRILCgNrZXkYAiABKAkSDAoEcm9vdBgDIAEoCRIYChBhdHRhY2hlZF9jbGllbnRzGAcgASgFEikKDWRvY3VtZW50X3NpemUYCCABKAsyEi55b3JraWUudjEuRG9jU2l6ZRISCgpzY2hlbWFfa2V5GAkgASgJEjwKCXByZXNlbmNlcxgKIAMoCzIpLnlvcmtpZS52MS5Eb2N1bWVudFN1bW1hcnkuUHJlc2VuY2VzRW50cnkSLgoKY3JlYXRlZF9hdBgEIAEoCzIaLmdvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXASLwoLYWNjZXNzZWRfYXQYBSABKAsyGi5nb29nbGUucHJvdG9idWYuVGltZXN0YW1wEi4KCnVwZGF0ZWRfYXQYBiABKAsyGi5nb29nbGUucHJvdG9idWYuVGltZXN0YW1wGkUKDlByZXNlbmNlc0VudHJ5EgsKA2tleRgBIAEoCRIiCgV2YWx1ZRgCIAEoCzITLnlvcmtpZS52MS5QcmVzZW5jZToCOAEi2gEKDlByZXNlbmNlQ2hhbmdlEjIKBHR5cGUYASABKA4yJC55b3JraWUudjEuUHJlc2VuY2VDaGFuZ2UuQ2hhbmdlVHlwZRIlCghwcmVzZW5jZRgCIAEoCzITLnlvcmtpZS52MS5QcmVzZW5jZSJtCgpDaGFuZ2VUeXBlEhsKF0NIQU5HRV9UWVBFX1VOU1BFQ0lGSUVEEAASEwoPQ0hBTkdFX1RZUEVfUFVUEAESFgoSQ0hBTkdFX1RZUEVfREVMRVRFEAISFQoRQ0hBTkdFX1RZUEVfQ0xFQVIQAyJkCghQcmVzZW5jZRIrCgRkYXRhGAEgAygLMh0ueW9ya2llLnYxLlByZXNlbmNlLkRhdGFFbnRyeRorCglEYXRhRW50cnkSCwoDa2V5GAEgASgJEg0KBXZhbHVlGAIgASgJOgI4ASI0Cg5DaGFubmVsU3VtbWFyeRILCgNrZXkYASABKAkSFQoNc2Vzc2lvbl9jb3VudBgCIAEoBSI0CgpDaGVja3BvaW50EhIKCnNlcnZlcl9zZXEYASABKAMSEgoKY2xpZW50X3NlcRgCIAEoDSJhCgtUZXh0Tm9kZVBvcxIpCgpjcmVhdGVkX2F0GAEgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSDgoGb2Zmc2V0GAIgASgFEhcKD3JlbGF0aXZlX29mZnNldBgDIAEoBSJCCgpUaW1lVGlja2V0Eg8KB2xhbXBvcnQYASABKAMSEQoJZGVsaW1pdGVyGAIgASgNEhAKCGFjdG9yX2lkGAMgASgMIi4KDERvY0V2ZW50Qm9keRINCgV0b3BpYxgBIAEoCRIPCgdwYXlsb2FkGAIgASgMImsKCERvY0V2ZW50EiUKBHR5cGUYASABKA4yFy55b3JraWUudjEuRG9jRXZlbnRUeXBlEhEKCXB1Ymxpc2hlchgCIAEoCRIlCgRib2R5GAMgASgLMhcueW9ya2llLnYxLkRvY0V2ZW50Qm9keSLWAQoMQ2hhbm5lbEV2ZW50EioKBHR5cGUYASABKA4yHC55b3JraWUudjEuQ2hhbm5lbEV2ZW50LlR5cGUSEQoJcHVibGlzaGVyGAIgASgJEhUKDXNlc3Npb25fY291bnQYAyABKAMSCwoDc2VxGAQgASgDEg0KBXRvcGljGAUgASgJEg8KB3BheWxvYWQYBiABKAwiQwoEVHlwZRIUChBUWVBFX1VOU1BFQ0lGSUVEEAASEQoNVFlQRV9QUkVTRU5DRRABEhIKDlRZUEVfQlJPQURDQVNUEAIiJgoIRGF0YVNpemUSDAoEZGF0YRgBIAEoBRIMCgRtZXRhGAIgASgFIk0KB0RvY1NpemUSIQoEbGl2ZRgBIAEoCzITLnlvcmtpZS52MS5EYXRhU2l6ZRIfCgJnYxgCIAEoCzITLnlvcmtpZS52MS5EYXRhU2l6ZSKRAQoGU2NoZW1hEgoKAmlkGAEgASgJEgwKBG5hbWUYAiABKAkSDwoHdmVyc2lvbhgDIAEoBRIMCgRib2R5GAQgASgJEh4KBXJ1bGVzGAUgAygLMg8ueW9ya2llLnYxLlJ1bGUSLgoKY3JlYXRlZF9hdBgGIAEoCzIaLmdvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXAiIgoEUnVsZRIMCgRwYXRoGAEgASgJEgwKBHR5cGUYAiABKAkigwEKD1JldmlzaW9uU3VtbWFyeRIKCgJpZBgBIAEoCRINCgVsYWJlbBgCIAEoCRITCgtkZXNjcmlwdGlvbhgDIAEoCRIQCghzbmFwc2hvdBgEIAEoCRIuCgpjcmVhdGVkX2F0GAUgASgLMhouZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcCrUAgoJVmFsdWVUeXBlEhMKD1ZBTFVFX1RZUEVfTlVMTBAAEhYKElZBTFVFX1RZUEVfQk9PTEVBThABEhYKElZBTFVFX1RZUEVfSU5URUdFUhACEhMKD1ZBTFVFX1RZUEVfTE9ORxADEhUKEVZBTFVFX1RZUEVfRE9VQkxFEAQSFQoRVkFMVUVfVFlQRV9TVFJJTkcQBRIUChBWQUxVRV9UWVBFX0JZVEVTEAYSEwoPVkFMVUVfVFlQRV9EQVRFEAcSGgoWVkFMVUVfVFlQRV9KU09OX09CSkVDVBAIEhkKFVZBTFVFX1RZUEVfSlNPTl9BUlJBWRAJEhMKD1ZBTFVFX1RZUEVfVEVYVBAKEhoKFlZBTFVFX1RZUEVfSU5URUdFUl9DTlQQCxIXChNWQUxVRV9UWVBFX0xPTkdfQ05UEAwSEwoPVkFMVUVfVFlQRV9UUkVFEA0qpgEKDERvY0V2ZW50VHlwZRIjCh9ET0NfRVZFTlRfVFlQRV9ET0NVTUVOVF9DSEFOR0VEEAASIwofRE9DX0VWRU5UX1RZUEVfRE9DVU1FTlRfV0FUQ0hFRBABEiUKIURPQ19FVkVOVF9UWVBFX0RPQ1VNRU5UX1VOV0FUQ0hFRBACEiUKIURPQ19FVkVOVF9UWVBFX0RPQ1VNRU5UX0JST0FEQ0FTVBADQkUKEWRldi55b3JraWUuYXBpLnYxUAFaLmdpdGh1Yi5jb20veW9ya2llLXRlYW0veW9ya2llL2FwaS95b3JraWUvdjE7djFiBnByb3RvMw",[Pc,qc]),gl=T(D,0),ml=T(D,1),pl=T(D,2),Vr=T(D,3),Dr=T(D,4),xr=T(D,5),bl=T(D,5,0),yl=T(D,5,1),Al=T(D,5,2),vl=T(D,5,3),Sl=T(D,5,4),Il=T(D,5,5),El=T(D,5,6),Nl=T(D,5,7),wl=T(D,5,8),Rl=T(D,5,9),At=T(D,6),me=T(D,7),Cl=T(D,7,0),Tl=T(D,7,1),Vl=T(D,7,2),Dl=T(D,7,3),xl=T(D,7,4),Ll=T(D,7,5),Bl=T(D,8),Wl=T(D,9),co=T(D,10),kl=T(D,11),Ol=T(D,12),Pl=T(D,13),Zl=T(D,14),Ul=T(D,15),Yl=T(D,16),uo=T(D,23);var Jt=(n=>(n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.PUT=1]="PUT",n[n.DELETE=2]="DELETE",n[n.CLEAR=3]="CLEAR",n))(Jt||{});const Gl=T(D,24),Fl=T(D,26),Kl=T(D,27),Ml=T(D,28);var lo=(n=>(n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.PRESENCE=1]="PRESENCE",n[n.BROADCAST=2]="BROADCAST",n))(lo||{}),x=(n=>(n[n.NULL=0]="NULL",n[n.BOOLEAN=1]="BOOLEAN",n[n.INTEGER=2]="INTEGER",n[n.LONG=3]="LONG",n[n.DOUBLE=4]="DOUBLE",n[n.STRING=5]="STRING",n[n.BYTES=6]="BYTES",n[n.DATE=7]="DATE",n[n.JSON_OBJECT=8]="JSON_OBJECT",n[n.JSON_ARRAY=9]="JSON_ARRAY",n[n.TEXT=10]="TEXT",n[n.INTEGER_CNT=11]="INTEGER_CNT",n[n.LONG_CNT=12]="LONG_CNT",n[n.TREE=13]="TREE",n))(x||{}),Nn=(n=>(n[n.DOCUMENT_CHANGED=0]="DOCUMENT_CHANGED",n[n.DOCUMENT_WATCHED=1]="DOCUMENT_WATCHED",n[n.DOCUMENT_UNWATCHED=2]="DOCUMENT_UNWATCHED",n[n.DOCUMENT_BROADCAST=3]="DOCUMENT_BROADCAST",n))(Nn||{});const Jl=rl(Ye("Ch5zcmMvYXBpL3lvcmtpZS92MS95b3JraWUucHJvdG8SCXlvcmtpZS52MSKeAQoVQWN0aXZhdGVDbGllbnRSZXF1ZXN0EhIKCmNsaWVudF9rZXkYASABKAkSQAoIbWV0YWRhdGEYAiADKAsyLi55b3JraWUudjEuQWN0aXZhdGVDbGllbnRSZXF1ZXN0Lk1ldGFkYXRhRW50cnkaLwoNTWV0YWRhdGFFbnRyeRILCgNrZXkYASABKAkSDQoFdmFsdWUYAiABKAk6AjgBIisKFkFjdGl2YXRlQ2xpZW50UmVzcG9uc2USEQoJY2xpZW50X2lkGAEgASgJIkEKF0RlYWN0aXZhdGVDbGllbnRSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtzeW5jaHJvbm91cxgCIAEoCCIaChhEZWFjdGl2YXRlQ2xpZW50UmVzcG9uc2UiagoVQXR0YWNoRG9jdW1lbnRSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRIqCgtjaGFuZ2VfcGFjaxgCIAEoCzIVLnlvcmtpZS52MS5DaGFuZ2VQYWNrEhIKCnNjaGVtYV9rZXkYAyABKAkinwEKFkF0dGFjaERvY3VtZW50UmVzcG9uc2USEwoLZG9jdW1lbnRfaWQYASABKAkSKgoLY2hhbmdlX3BhY2sYAiABKAsyFS55b3JraWUudjEuQ2hhbmdlUGFjaxIdChVtYXhfc2l6ZV9wZXJfZG9jdW1lbnQYAyABKAUSJQoMc2NoZW1hX3J1bGVzGAQgAygLMg8ueW9ya2llLnYxLlJ1bGUiiwEKFURldGFjaERvY3VtZW50UmVxdWVzdBIRCgljbGllbnRfaWQYASABKAkSEwoLZG9jdW1lbnRfaWQYAiABKAkSKgoLY2hhbmdlX3BhY2sYAyABKAsyFS55b3JraWUudjEuQ2hhbmdlUGFjaxIeChZyZW1vdmVfaWZfbm90X2F0dGFjaGVkGAQgASgIIkQKFkRldGFjaERvY3VtZW50UmVzcG9uc2USKgoLY2hhbmdlX3BhY2sYAiABKAsyFS55b3JraWUudjEuQ2hhbmdlUGFjayJTCgxXYXRjaFJlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEjAKCXJlc291cmNlcxgCIAMoCzIdLnlvcmtpZS52MS5SZXNvdXJjZURlc2NyaXB0b3IihAEKElJlc291cmNlRGVzY3JpcHRvchIxCghkb2N1bWVudBgBIAEoCzIdLnlvcmtpZS52MS5Eb2N1bWVudERlc2NyaXB0b3JIABIvCgdjaGFubmVsGAIgASgLMhwueW9ya2llLnYxLkNoYW5uZWxEZXNjcmlwdG9ySABCCgoIcmVzb3VyY2UiKQoSRG9jdW1lbnREZXNjcmlwdG9yEhMKC2RvY3VtZW50X2lkGAEgASgJIigKEUNoYW5uZWxEZXNjcmlwdG9yEhMKC2NoYW5uZWxfa2V5GAEgASgJInkKDVdhdGNoUmVzcG9uc2USOAoOaW5pdGlhbGl6YXRpb24YASABKAsyHi55b3JraWUudjEuV2F0Y2hJbml0aWFsaXphdGlvbkgAEiYKBWV2ZW50GAIgASgLMhUueW9ya2llLnYxLldhdGNoRXZlbnRIAEIGCgRib2R5IkYKE1dhdGNoSW5pdGlhbGl6YXRpb24SLwoOcmVzb3VyY2VfaW5pdHMYASADKAsyFy55b3JraWUudjEuUmVzb3VyY2VJbml0IngKDFJlc291cmNlSW5pdBIwCg1kb2N1bWVudF9pbml0GAEgASgLMhcueW9ya2llLnYxLkRvY3VtZW50SW5pdEgAEi4KDGNoYW5uZWxfaW5pdBgCIAEoCzIWLnlvcmtpZS52MS5DaGFubmVsSW5pdEgAQgYKBGluaXQiNwoMRG9jdW1lbnRJbml0EhMKC2RvY3VtZW50X2lkGAEgASgJEhIKCmNsaWVudF9pZHMYAiADKAkiRgoLQ2hhbm5lbEluaXQSEwoLY2hhbm5lbF9rZXkYASABKAkSFQoNc2Vzc2lvbl9jb3VudBgCIAEoAxILCgNzZXEYAyABKAMiewoKV2F0Y2hFdmVudBItCglkb2NfZXZlbnQYASABKAsyGC55b3JraWUudjEuRG9jV2F0Y2hFdmVudEgAEjUKDWNoYW5uZWxfZXZlbnQYAiABKAsyHC55b3JraWUudjEuQ2hhbm5lbFdhdGNoRXZlbnRIAEIHCgVldmVudCJICg1Eb2NXYXRjaEV2ZW50EhMKC2RvY3VtZW50X2lkGAEgASgJEiIKBWV2ZW50GAIgASgLMhMueW9ya2llLnYxLkRvY0V2ZW50IlAKEUNoYW5uZWxXYXRjaEV2ZW50EhMKC2NoYW5uZWxfa2V5GAEgASgJEiYKBWV2ZW50GAIgASgLMhcueW9ya2llLnYxLkNoYW5uZWxFdmVudCJrChVSZW1vdmVEb2N1bWVudFJlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEhMKC2RvY3VtZW50X2lkGAIgASgJEioKC2NoYW5nZV9wYWNrGAMgASgLMhUueW9ya2llLnYxLkNoYW5nZVBhY2siRAoWUmVtb3ZlRG9jdW1lbnRSZXNwb25zZRIqCgtjaGFuZ2VfcGFjaxgBIAEoCzIVLnlvcmtpZS52MS5DaGFuZ2VQYWNrIn8KFlB1c2hQdWxsQ2hhbmdlc1JlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEhMKC2RvY3VtZW50X2lkGAIgASgJEioKC2NoYW5nZV9wYWNrGAMgASgLMhUueW9ya2llLnYxLkNoYW5nZVBhY2sSEQoJcHVzaF9vbmx5GAQgASgIIkUKF1B1c2hQdWxsQ2hhbmdlc1Jlc3BvbnNlEioKC2NoYW5nZV9wYWNrGAEgASgLMhUueW9ya2llLnYxLkNoYW5nZVBhY2siYwoVQ3JlYXRlUmV2aXNpb25SZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtkb2N1bWVudF9pZBgCIAEoCRINCgVsYWJlbBgDIAEoCRITCgtkZXNjcmlwdGlvbhgEIAEoCSJGChZDcmVhdGVSZXZpc2lvblJlc3BvbnNlEiwKCHJldmlzaW9uGAEgASgLMhoueW9ya2llLnYxLlJldmlzaW9uU3VtbWFyeSJRChJHZXRSZXZpc2lvblJlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEhMKC2RvY3VtZW50X2lkGAIgASgJEhMKC3JldmlzaW9uX2lkGAMgASgJIkMKE0dldFJldmlzaW9uUmVzcG9uc2USLAoIcmV2aXNpb24YASABKAsyGi55b3JraWUudjEuUmV2aXNpb25TdW1tYXJ5InUKFExpc3RSZXZpc2lvbnNSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtkb2N1bWVudF9pZBgCIAEoCRIRCglwYWdlX3NpemUYAyABKAUSDgoGb2Zmc2V0GAQgASgFEhIKCmlzX2ZvcndhcmQYBSABKAgiRgoVTGlzdFJldmlzaW9uc1Jlc3BvbnNlEi0KCXJldmlzaW9ucxgBIAMoCzIaLnlvcmtpZS52MS5SZXZpc2lvblN1bW1hcnkiVQoWUmVzdG9yZVJldmlzaW9uUmVxdWVzdBIRCgljbGllbnRfaWQYASABKAkSEwoLZG9jdW1lbnRfaWQYAiABKAkSEwoLcmV2aXNpb25faWQYBCABKAkiGQoXUmVzdG9yZVJldmlzaW9uUmVzcG9uc2UiPgoUQXR0YWNoQ2hhbm5lbFJlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEhMKC2NoYW5uZWxfa2V5GAIgASgJIkIKFUF0dGFjaENoYW5uZWxSZXNwb25zZRISCgpzZXNzaW9uX2lkGAEgASgJEhUKDXNlc3Npb25fY291bnQYAiABKAMiUgoURGV0YWNoQ2hhbm5lbFJlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEhMKC2NoYW5uZWxfa2V5GAIgASgJEhIKCnNlc3Npb25faWQYAyABKAkiLgoVRGV0YWNoQ2hhbm5lbFJlc3BvbnNlEhUKDXNlc3Npb25fY291bnQYASABKAMiUwoVUmVmcmVzaENoYW5uZWxSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtjaGFubmVsX2tleRgCIAEoCRISCgpzZXNzaW9uX2lkGAMgASgJIi8KFlJlZnJlc2hDaGFubmVsUmVzcG9uc2USFQoNc2Vzc2lvbl9jb3VudBgBIAEoAyJaChBCcm9hZGNhc3RSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtjaGFubmVsX2tleRgCIAEoCRINCgV0b3BpYxgDIAEoCRIPCgdwYXlsb2FkGAQgASgMIhMKEUJyb2FkY2FzdFJlc3BvbnNlMpgKCg1Zb3JraWVTZXJ2aWNlElcKDkFjdGl2YXRlQ2xpZW50EiAueW9ya2llLnYxLkFjdGl2YXRlQ2xpZW50UmVxdWVzdBohLnlvcmtpZS52MS5BY3RpdmF0ZUNsaWVudFJlc3BvbnNlIgASXQoQRGVhY3RpdmF0ZUNsaWVudBIiLnlvcmtpZS52MS5EZWFjdGl2YXRlQ2xpZW50UmVxdWVzdBojLnlvcmtpZS52MS5EZWFjdGl2YXRlQ2xpZW50UmVzcG9uc2UiABJXCg5BdHRhY2hEb2N1bWVudBIgLnlvcmtpZS52MS5BdHRhY2hEb2N1bWVudFJlcXVlc3QaIS55b3JraWUudjEuQXR0YWNoRG9jdW1lbnRSZXNwb25zZSIAElcKDkRldGFjaERvY3VtZW50EiAueW9ya2llLnYxLkRldGFjaERvY3VtZW50UmVxdWVzdBohLnlvcmtpZS52MS5EZXRhY2hEb2N1bWVudFJlc3BvbnNlIgASVwoOUmVtb3ZlRG9jdW1lbnQSIC55b3JraWUudjEuUmVtb3ZlRG9jdW1lbnRSZXF1ZXN0GiEueW9ya2llLnYxLlJlbW92ZURvY3VtZW50UmVzcG9uc2UiABJaCg9QdXNoUHVsbENoYW5nZXMSIS55b3JraWUudjEuUHVzaFB1bGxDaGFuZ2VzUmVxdWVzdBoiLnlvcmtpZS52MS5QdXNoUHVsbENoYW5nZXNSZXNwb25zZSIAEj4KBVdhdGNoEhcueW9ya2llLnYxLldhdGNoUmVxdWVzdBoYLnlvcmtpZS52MS5XYXRjaFJlc3BvbnNlIgAwARJXCg5DcmVhdGVSZXZpc2lvbhIgLnlvcmtpZS52MS5DcmVhdGVSZXZpc2lvblJlcXVlc3QaIS55b3JraWUudjEuQ3JlYXRlUmV2aXNpb25SZXNwb25zZSIAEk4KC0dldFJldmlzaW9uEh0ueW9ya2llLnYxLkdldFJldmlzaW9uUmVxdWVzdBoeLnlvcmtpZS52MS5HZXRSZXZpc2lvblJlc3BvbnNlIgASVAoNTGlzdFJldmlzaW9ucxIfLnlvcmtpZS52MS5MaXN0UmV2aXNpb25zUmVxdWVzdBogLnlvcmtpZS52MS5MaXN0UmV2aXNpb25zUmVzcG9uc2UiABJaCg9SZXN0b3JlUmV2aXNpb24SIS55b3JraWUudjEuUmVzdG9yZVJldmlzaW9uUmVxdWVzdBoiLnlvcmtpZS52MS5SZXN0b3JlUmV2aXNpb25SZXNwb25zZSIAElQKDUF0dGFjaENoYW5uZWwSHy55b3JraWUudjEuQXR0YWNoQ2hhbm5lbFJlcXVlc3QaIC55b3JraWUudjEuQXR0YWNoQ2hhbm5lbFJlc3BvbnNlIgASVAoNRGV0YWNoQ2hhbm5lbBIfLnlvcmtpZS52MS5EZXRhY2hDaGFubmVsUmVxdWVzdBogLnlvcmtpZS52MS5EZXRhY2hDaGFubmVsUmVzcG9uc2UiABJXCg5SZWZyZXNoQ2hhbm5lbBIgLnlvcmtpZS52MS5SZWZyZXNoQ2hhbm5lbFJlcXVlc3QaIS55b3JraWUudjEuUmVmcmVzaENoYW5uZWxSZXNwb25zZSIAEkgKCUJyb2FkY2FzdBIbLnlvcmtpZS52MS5Ccm9hZGNhc3RSZXF1ZXN0GhwueW9ya2llLnYxLkJyb2FkY2FzdFJlc3BvbnNlIgBCRQoRZGV2LnlvcmtpZS5hcGkudjFQAVouZ2l0aHViLmNvbS95b3JraWUtdGVhbS95b3JraWUvYXBpL3lvcmtpZS92MTt2MWIGcHJvdG8z",[D]),0),Xl=T(Ye("Ch5nb29nbGUvcnBjL2Vycm9yX2RldGFpbHMucHJvdG8SCmdvb2dsZS5ycGMikwEKCUVycm9ySW5mbxIOCgZyZWFzb24YASABKAkSDgoGZG9tYWluGAIgASgJEjUKCG1ldGFkYXRhGAMgAygLMiMuZ29vZ2xlLnJwYy5FcnJvckluZm8uTWV0YWRhdGFFbnRyeRovCg1NZXRhZGF0YUVudHJ5EgsKA2tleRgBIAEoCRINCgV2YWx1ZRgCIAEoCToCOAEiOwoJUmV0cnlJbmZvEi4KC3JldHJ5X2RlbGF5GAEgASgLMhkuZ29vZ2xlLnByb3RvYnVmLkR1cmF0aW9uIjIKCURlYnVnSW5mbxIVCg1zdGFja19lbnRyaWVzGAEgAygJEg4KBmRldGFpbBgCIAEoCSKPAwoMUXVvdGFGYWlsdXJlEjYKCnZpb2xhdGlvbnMYASADKAsyIi5nb29nbGUucnBjLlF1b3RhRmFpbHVyZS5WaW9sYXRpb24axgIKCVZpb2xhdGlvbhIPCgdzdWJqZWN0GAEgASgJEhMKC2Rlc2NyaXB0aW9uGAIgASgJEhMKC2FwaV9zZXJ2aWNlGAMgASgJEhQKDHF1b3RhX21ldHJpYxgEIAEoCRIQCghxdW90YV9pZBgFIAEoCRJRChBxdW90YV9kaW1lbnNpb25zGAYgAygLMjcuZ29vZ2xlLnJwYy5RdW90YUZhaWx1cmUuVmlvbGF0aW9uLlF1b3RhRGltZW5zaW9uc0VudHJ5EhMKC3F1b3RhX3ZhbHVlGAcgASgDEh8KEmZ1dHVyZV9xdW90YV92YWx1ZRgIIAEoA0gAiAEBGjYKFFF1b3RhRGltZW5zaW9uc0VudHJ5EgsKA2tleRgBIAEoCRINCgV2YWx1ZRgCIAEoCToCOAFCFQoTX2Z1dHVyZV9xdW90YV92YWx1ZSKVAQoTUHJlY29uZGl0aW9uRmFpbHVyZRI9Cgp2aW9sYXRpb25zGAEgAygLMikuZ29vZ2xlLnJwYy5QcmVjb25kaXRpb25GYWlsdXJlLlZpb2xhdGlvbho/CglWaW9sYXRpb24SDAoEdHlwZRgBIAEoCRIPCgdzdWJqZWN0GAIgASgJEhMKC2Rlc2NyaXB0aW9uGAMgASgJIswBCgpCYWRSZXF1ZXN0Ej8KEGZpZWxkX3Zpb2xhdGlvbnMYASADKAsyJS5nb29nbGUucnBjLkJhZFJlcXVlc3QuRmllbGRWaW9sYXRpb24afQoORmllbGRWaW9sYXRpb24SDQoFZmllbGQYASABKAkSEwoLZGVzY3JpcHRpb24YAiABKAkSDgoGcmVhc29uGAMgASgJEjcKEWxvY2FsaXplZF9tZXNzYWdlGAQgASgLMhwuZ29vZ2xlLnJwYy5Mb2NhbGl6ZWRNZXNzYWdlIjcKC1JlcXVlc3RJbmZvEhIKCnJlcXVlc3RfaWQYASABKAkSFAoMc2VydmluZ19kYXRhGAIgASgJImAKDFJlc291cmNlSW5mbxIVCg1yZXNvdXJjZV90eXBlGAEgASgJEhUKDXJlc291cmNlX25hbWUYAiABKAkSDQoFb3duZXIYAyABKAkSEwoLZGVzY3JpcHRpb24YBCABKAkiVgoESGVscBIkCgVsaW5rcxgBIAMoCzIVLmdvb2dsZS5ycGMuSGVscC5MaW5rGigKBExpbmsSEwoLZGVzY3JpcHRpb24YASABKAkSCwoDdXJsGAIgASgJIjMKEExvY2FsaXplZE1lc3NhZ2USDgoGbG9jYWxlGAEgASgJEg8KB21lc3NhZ2UYAiABKAlCbAoOY29tLmdvb2dsZS5ycGNCEUVycm9yRGV0YWlsc1Byb3RvUAFaP2dvb2dsZS5nb2xhbmcub3JnL2dlbnByb3RvL2dvb2dsZWFwaXMvcnBjL2VycmRldGFpbHM7ZXJyZGV0YWlsc6ICA1JQQ2IGcHJvdG8z",[Yc]),0);var d=(n=>(n.Ok="ok",n.ErrClientNotActivated="ErrClientNotActivated",n.ErrClientNotFound="ErrClientNotFound",n.ErrUnimplemented="ErrUnimplemented",n.ErrInvalidType="ErrInvalidType",n.ErrDummy="ErrDummy",n.ErrNotAttached="ErrNotAttached",n.ErrNotDetached="ErrNotDetached",n.ErrDocumentRemoved="ErrDocumentRemoved",n.ErrDocumentSizeExceedsLimit="ErrDocumentSizeExceedsLimit",n.ErrDocumentSchemaValidationFailed="ErrDocumentSchemaValidationFailed",n.ErrInvalidObjectKey="ErrInvalidObjectKey",n.ErrInvalidArgument="ErrInvalidArgument",n.ErrNotInitialized="ErrNotInitialized",n.ErrNotReady="ErrNotReady",n.ErrRefused="ErrRefused",n.ErrContextNotProvided="ErrContextNotProvided",n.ErrPermissionDenied="ErrPermissionDenied",n.ErrUnauthenticated="ErrUnauthenticated",n.ErrTooManySubscribers="ErrTooManySubscribers",n.ErrTooManyAttachments="ErrTooManyAttachments",n))(d||{});class f extends Error{constructor(t,r){super(r);h(this,"name","YorkieError");h(this,"stack");this.code=t,this.message=r,this.toString=()=>`[code=${this.code}]: ${this.message}`}}var De=(n=>(n.Put="put",n.Clear="clear",n))(De||{});const Lr="000000000000000000000000",xe=24;class pe{constructor(e,t,r){h(this,"lamport");h(this,"delimiter");h(this,"actorID");this.lamport=e,this.delimiter=t,this.actorID=r}static of(e,t,r){return new pe(e,t,r)}static fromStruct(e){return pe.of(BigInt(e.lamport),e.delimiter,e.actorID)}toIDString(){return`${this.lamport.toString()}:${this.actorID}:${this.delimiter}`}toStruct(){return{lamport:this.getLamportAsString(),delimiter:this.getDelimiter(),actorID:this.getActorID()}}toTestString(){return`${this.lamport.toString()}:${this.actorID.slice(-2)}:${this.delimiter}`}setActor(e){return new pe(this.lamport,this.delimiter,e)}getLamportAsString(){return this.lamport.toString()}getLamport(){return this.lamport}getDelimiter(){return this.delimiter}getActorID(){return this.actorID}after(e){return this.compare(e)>0}equals(e){return this.compare(e)===0}compare(e){if(this.lamport>e.lamport)return 1;if(e.lamport>this.lamport)return-1;const t=this.actorID.localeCompare(e.actorID);return t!==0?t:this.delimiter>e.delimiter?1:e.delimiter>this.delimiter?-1:0}}const Br=0n,ho=0,wn=9223372036854775807n,vt=new pe(Br,ho,Lr);function Le(n){return n.replace(/["'\\\n\r\f\b\t\u2028\u2029]/g,function(e){switch(e){case'"':case"\\":return"\\"+e;case`
`:return"\\n";case"\r":return"\\r";case"\f":return"\\f";case"\b":return"\\b";case"	":return"\\t";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e}})}class Xt{constructor(e){h(this,"createdAt");h(this,"movedAt");h(this,"removedAt");this.createdAt=e}getCreatedAt(){return this.createdAt}getID(){return this.createdAt}getMovedAt(){return this.movedAt}getRemovedAt(){return this.removedAt}getPositionedAt(){return this.movedAt?this.movedAt:this.createdAt}setCreatedAt(e){this.createdAt=e}setMovedAt(e){return!this.movedAt||e&&e.after(this.movedAt)?(this.movedAt=e,!0):!1}setRemovedAt(e){this.removedAt=e}remove(e){return e&&e.after(this.createdAt)&&(!this.removedAt||e.after(this.removedAt))?(this.removedAt=e,!0):!1}isRemoved(){return!!this.removedAt}getMetaUsage(){let e=0;return this.getCreatedAt()&&(e+=xe),this.getMovedAt()&&(e+=xe),this.getRemovedAt()&&(e+=xe),e}}class je extends Xt{constructor(e){super(e)}}class Rn{constructor(e,t){h(this,"strKey");h(this,"value");this.strKey=e,this.value=t}static of(e,t){return new Rn(e,t)}isRemoved(){return this.value.isRemoved()}getStrKey(){return this.strKey}getValue(){return this.value}remove(e){return this.value.remove(e)}}class St{constructor(){h(this,"nodeMapByKey");h(this,"nodeMapByCreatedAt");this.nodeMapByKey=new Map,this.nodeMapByCreatedAt=new Map}static create(){return new St}set(e,t,r){let s;const i=this.nodeMapByKey.get(e);i&&!i.isRemoved()&&i.remove(r)&&(s=i.getValue());const o=Rn.of(e,t);return this.nodeMapByCreatedAt.set(t.getCreatedAt().toIDString(),o),(!i||r.after(i.getValue().getPositionedAt()))&&(this.nodeMapByKey.set(e,o),t.setMovedAt(r)),s}delete(e,t){if(!this.nodeMapByCreatedAt.has(e.toIDString()))throw new f(d.ErrInvalidArgument,`fail to find ${e.toIDString()}`);const r=this.nodeMapByCreatedAt.get(e.toIDString());return r.remove(t),r.getValue()}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return t.getStrKey()}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new f(d.ErrInvalidArgument,`fail to find ${e.getCreatedAt().toIDString()}`);const r=this.nodeMapByKey.get(t.getStrKey());t===r&&this.nodeMapByKey.delete(r.getStrKey()),this.nodeMapByCreatedAt.delete(t.getValue().getCreatedAt().toIDString())}deleteByKey(e,t){const r=this.nodeMapByKey.get(e);if(r&&r.remove(t))return r.getValue()}has(e){const t=this.nodeMapByKey.get(e);return t?!t.isRemoved():!1}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}get(e){const t=this.nodeMapByKey.get(e);if(!(!t||t.isRemoved()))return t}deepcopy(){const e=St.create();for(const[,t]of this.nodeMapByCreatedAt)e.nodeMapByCreatedAt.set(t.getValue().getCreatedAt().toIDString(),Rn.of(t.getStrKey(),t.getValue().deepcopy()));for(const[t,r]of this.nodeMapByKey)e.nodeMapByKey.set(t,e.nodeMapByCreatedAt.get(r.getValue().getCreatedAt().toIDString()));return e}*[Symbol.iterator](){for(const[,e]of this.nodeMapByCreatedAt)yield e}}class te extends je{constructor(t,r){super(t);h(this,"memberNodes");this.memberNodes=r}static create(t,r){if(!r)return new te(t,St.create());const s=St.create();for(const[i,o]of Object.entries(r))s.set(i,o.deepcopy(),o.getCreatedAt());return new te(t,s)}subPathOf(t){return this.memberNodes.subPathOf(t)}purge(t){this.memberNodes.purge(t)}set(t,r,s){return this.memberNodes.set(t,r,s)}delete(t,r){return this.memberNodes.delete(t,r)}deleteByKey(t,r){return this.memberNodes.deleteByKey(t,r)}get(t){const r=this.memberNodes.get(t);return r==null?void 0:r.getValue()}getByID(t){const r=this.memberNodes.getByID(t);return r==null?void 0:r.getValue()}has(t){return this.memberNodes.has(t)}getDataSize(){return{data:0,meta:this.getMetaUsage()}}toJSON(){const t=[];for(const[r,s]of this)t.push(`"${Le(r)}":${s.toJSON()}`);return`{${t.join(",")}}`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const t={};for(const[r,s]of this){const{createdAt:i,value:o,type:a}=s.toJSForTest();t[r]={key:r,createdAt:i,value:o,type:a}}return{createdAt:this.getCreatedAt().toTestString(),value:t,type:"YORKIE_OBJECT"}}getKeys(){const t=Array();for(const[r]of this)t.push(r);return t}toSortedJSON(){var s;const t=new Set;for(const[i]of this)t.add(i);const r=[];for(const i of Array.from(t).sort()){const o=(s=this.memberNodes.get(i))==null?void 0:s.getValue();r.push(`"${Le(i)}":${o.toSortedJSON()}`)}return`{${r.join(",")}}`}getRHT(){return this.memberNodes}deepcopy(){const t=te.create(this.getCreatedAt());return t.memberNodes=this.memberNodes.deepcopy(),t.setRemovedAt(this.getRemovedAt()),t.setMovedAt(this.getMovedAt()),t}getDescendants(t){for(const r of this.memberNodes){const s=r.getValue();if(t(s,this))return;s instanceof je&&s.getDescendants(t)}}*[Symbol.iterator](){for(const t of this.memberNodes)t.isRemoved()||(yield[t.getStrKey(),t.getValue()])}}var J=(n=>(n.Local="local",n.Remote="remote",n.UndoRedo="undoredo",n))(J||{});class Se{constructor(e,t){h(this,"parentCreatedAt");h(this,"executedAt");this.parentCreatedAt=e,this.executedAt=t}getParentCreatedAt(){return this.parentCreatedAt}getExecutedAt(){if(!this.executedAt)throw new f(d.ErrNotReady,"executedAt is not set yet");return this.executedAt}setActor(e){this.executedAt&&(this.executedAt=this.executedAt.setActor(e))}setExecutedAt(e){this.executedAt=e}}class fo{constructor(e){h(this,"value");h(this,"left");h(this,"right");h(this,"parent");h(this,"weight");this.value=e,this.initWeight()}getNodeString(){return`${this.weight}${this.value}`}getValue(){return this.value}getLeftWeight(){return this.hasLeft()?this.left.getWeight():0}getRightWeight(){return this.hasRight()?this.right.getWeight():0}getWeight(){return this.weight}getLeft(){return this.left}getRight(){return this.right}getParent(){return this.parent}hasLeft(){return!!this.left}hasRight(){return!!this.right}hasParent(){return!!this.parent}setLeft(e){this.left=e}setRight(e){this.right=e}setParent(e){this.parent=e}unlink(){this.parent=void 0,this.right=void 0,this.left=void 0}hasLinks(){return this.hasParent()||this.hasLeft()||this.hasRight()}increaseWeight(e){this.weight+=e}initWeight(){this.weight=this.getLength()}}class _t{constructor(e){h(this,"root");this.root=e}get length(){return this.root?this.root.getWeight():0}findForText(e){if(!this.root||e<0)return[void 0,0];let t=this.root;for(;;)if(t.hasLeft()&&e<=t.getLeftWeight())t=t.getLeft();else if(t.hasRight()&&t.getLeftWeight()+t.getLength()<e)e-=t.getLeftWeight()+t.getLength(),t=t.getRight();else{e-=t.getLeftWeight();break}if(e>t.getLength())throw new f(d.ErrInvalidArgument,`out of index range: pos: ${e} > node.length: ${t.getLength()}`);return this.splayNode(t),[t,e]}findForArray(e){if(!this.root)return;if(e<0||e>=this.length)throw new f(d.ErrInvalidArgument,`out of index range: idx: ${e}, length: ${this.length}`);let t=this.root;for(;;)if(t.hasLeft()&&e<t.getLeftWeight())t=t.getLeft();else if(t.hasRight()&&t.getLeftWeight()+t.getLength()<=e)e-=t.getLeftWeight()+t.getLength(),t=t.getRight();else break;return this.splayNode(t),t}indexOf(e){return!e||e!==this.root&&!e.hasLinks()?-1:(this.splayNode(e),this.root.getLeftWeight())}getRoot(){return this.root}insert(e){return this.insertAfter(this.root,e)}insertAfter(e,t){return e?(this.splayNode(e),this.root=t,t.setRight(e.getRight()),e.hasRight()&&e.getRight().setParent(t),t.setLeft(e),e.setParent(t),e.setRight(),this.updateWeight(e),this.updateWeight(t),t):(this.root=t,t)}updateWeight(e){e.initWeight(),e.hasLeft()&&e.increaseWeight(e.getLeftWeight()),e.hasRight()&&e.increaseWeight(e.getRightWeight())}updateTreeWeight(e){for(;e;)this.updateWeight(e),e=e.getParent()}splayNode(e){if(e)for(;;)if(this.isLeftChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e),this.rotateLeft(e);else if(this.isLeftChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e.getParent()),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e.getParent()),this.rotateLeft(e);else{this.isLeftChild(e)?this.rotateRight(e):this.isRightChild(e)&&this.rotateLeft(e),this.updateWeight(e);return}}delete(e){this.splayNode(e);const t=new _t(e.getLeft());t.root&&t.root.setParent();const r=new _t(e.getRight());if(r.root&&r.root.setParent(),t.root){const s=t.getRightmost();t.splayNode(s),t.root.setRight(r.root),r.root&&r.root.setParent(t.root),this.root=t.root}else this.root=r.root;e.unlink(),this.root&&this.updateWeight(this.root)}deleteRange(e,t){if(!t){this.splayNode(e),this.cutOffRight(e);return}this.splayNode(e),this.splayNode(t),t.getLeft()!=e&&this.rotateRight(e),this.cutOffRight(e)}cutOffRight(e){const t=[];this.traversePostorder(e.getRight(),t);for(const r of t)r.initWeight();this.updateTreeWeight(e)}toTestString(){const e=[];return this.traverseInorder(this.root,e),e.map(t=>`[${t.getWeight()},${t.getLength()}]${t.getValue()||""}`).join("")}checkWeight(){const e=[];this.traverseInorder(this.root,e);for(const t of e)if(t.getWeight()!=t.getLength()+t.getLeftWeight()+t.getRightWeight())return!1;return!0}getRightmost(){let e=this.root;for(;e.hasRight();)e=e.getRight();return e}traverseInorder(e,t){e&&(this.traverseInorder(e.getLeft(),t),t.push(e),this.traverseInorder(e.getRight(),t))}traversePostorder(e,t){e&&(this.traversePostorder(e.getLeft(),t),this.traversePostorder(e.getRight(),t),t.push(e))}rotateLeft(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setRight(e.getLeft()),t.hasRight()&&t.getRight().setParent(t),e.setLeft(t),e.getLeft().setParent(e),this.updateWeight(t),this.updateWeight(e)}rotateRight(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setLeft(e.getRight()),t.hasLeft()&&t.getLeft().setParent(t),e.setRight(t),e.getRight().setParent(e),this.updateWeight(t),this.updateWeight(e)}isLeftChild(e){return e&&e.hasParent()?e.getParent().getLeft()===e:!1}isRightChild(e){return e&&e.hasParent()?e.getParent().getRight()===e:!1}}var be=null;try{be=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function B(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}B.prototype.__isLong__,Object.defineProperty(B.prototype,"__isLong__",{value:!0});function ne(n){return(n&&n.__isLong__)===!0}function go(n){var e=Math.clz32(n&-n);return n?31-e:e}B.isLong=ne;var mo={},po={};function ct(n,e){var t,r,s;return e?(n>>>=0,(s=0<=n&&n<256)&&(r=po[n],r)?r:(t=P(n,0,!0),s&&(po[n]=t),t)):(n|=0,(s=-128<=n&&n<128)&&(r=mo[n],r)?r:(t=P(n,n<0?-1:0,!1),s&&(mo[n]=t),t))}B.fromInt=ct;function ye(n,e){if(isNaN(n))return e?Ge:Ie;if(e){if(n<0)return Ge;if(n>=yo)return Io}else{if(n<=-9223372036854776e3)return ae;if(n+1>=$l)return So}return n<0?ye(-n,e).neg():P(n%It|0,n/It|0,e)}B.fromNumber=ye;function P(n,e,t){return new B(n,e,t)}B.fromBits=P;var Cn=Math.pow;function Wr(n,e,t){if(n.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return e?Ge:Ie;if(t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Wr(n.substring(1),e,t).neg();for(var s=ye(Cn(t,8)),i=Ie,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),c=parseInt(n.substring(o,o+a),t);if(a<8){var u=ye(Cn(t,a));i=i.mul(u).add(ye(c))}else i=i.mul(s),i=i.add(ye(c))}return i.unsigned=e,i}B.fromString=Wr;function Ae(n,e){return typeof n=="number"?ye(n,e):typeof n=="string"?Wr(n,e):P(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}B.fromValue=Ae;var bo=65536,_l=1<<24,It=bo*bo,yo=It*It,$l=yo/2,Ao=ct(_l),Ie=ct(0);B.ZERO=Ie;var Ge=ct(0,!0);B.UZERO=Ge;var Et=ct(1);B.ONE=Et;var vo=ct(1,!0);B.UONE=vo;var kr=ct(-1);B.NEG_ONE=kr;var So=P(-1,2147483647,!1);B.MAX_VALUE=So;var Io=P(-1,-1,!0);B.MAX_UNSIGNED_VALUE=Io;var ae=P(0,-2147483648,!1);B.MIN_VALUE=ae;var v=B.prototype;v.toInt=function(){return this.unsigned?this.low>>>0:this.low},v.toNumber=function(){return this.unsigned?(this.high>>>0)*It+(this.low>>>0):this.high*It+(this.low>>>0)},v.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ae)){var t=ye(e),r=this.div(t),s=r.mul(t).sub(this);return r.toString(e)+s.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=ye(Cn(e,6),this.unsigned),o=this,a="";;){var c=o.div(i),u=o.sub(c.mul(i)).toInt()>>>0,l=u.toString(e);if(o=c,o.isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},v.getHighBits=function(){return this.high},v.getHighBitsUnsigned=function(){return this.high>>>0},v.getLowBits=function(){return this.low},v.getLowBitsUnsigned=function(){return this.low>>>0},v.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ae)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1},v.isSafeInteger=function(){var e=this.high>>21;return e?this.unsigned?!1:e===-1&&!(this.low===0&&this.high===-2097152):!0},v.isZero=function(){return this.high===0&&this.low===0},v.eqz=v.isZero,v.isNegative=function(){return!this.unsigned&&this.high<0},v.isPositive=function(){return this.unsigned||this.high>=0},v.isOdd=function(){return(this.low&1)===1},v.isEven=function(){return(this.low&1)===0},v.equals=function(e){return ne(e)||(e=Ae(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},v.eq=v.equals,v.notEquals=function(e){return!this.eq(e)},v.neq=v.notEquals,v.ne=v.notEquals,v.lessThan=function(e){return this.comp(e)<0},v.lt=v.lessThan,v.lessThanOrEqual=function(e){return this.comp(e)<=0},v.lte=v.lessThanOrEqual,v.le=v.lessThanOrEqual,v.greaterThan=function(e){return this.comp(e)>0},v.gt=v.greaterThan,v.greaterThanOrEqual=function(e){return this.comp(e)>=0},v.gte=v.greaterThanOrEqual,v.ge=v.greaterThanOrEqual,v.compare=function(e){if(ne(e)||(e=Ae(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},v.comp=v.compare,v.negate=function(){return!this.unsigned&&this.eq(ae)?ae:this.not().add(Et)},v.neg=v.negate,v.add=function(e){ne(e)||(e=Ae(e));var t=this.high>>>16,r=this.high&65535,s=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,c=e.low>>>16,u=e.low&65535,l=0,g=0,b=0,m=0;return m+=i+u,b+=m>>>16,m&=65535,b+=s+c,g+=b>>>16,b&=65535,g+=r+a,l+=g>>>16,g&=65535,l+=t+o,l&=65535,P(b<<16|m,l<<16|g,this.unsigned)},v.subtract=function(e){return ne(e)||(e=Ae(e)),this.add(e.neg())},v.sub=v.subtract,v.multiply=function(e){if(this.isZero())return this;if(ne(e)||(e=Ae(e)),be){var t=be.mul(this.low,this.high,e.low,e.high);return P(t,be.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Ge:Ie;if(this.eq(ae))return e.isOdd()?ae:Ie;if(e.eq(ae))return this.isOdd()?ae:Ie;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Ao)&&e.lt(Ao))return ye(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,c=e.high&65535,u=e.low>>>16,l=e.low&65535,g=0,b=0,m=0,y=0;return y+=o*l,m+=y>>>16,y&=65535,m+=i*l,b+=m>>>16,m&=65535,m+=o*u,b+=m>>>16,m&=65535,b+=s*l,g+=b>>>16,b&=65535,b+=i*u,g+=b>>>16,b&=65535,b+=o*c,g+=b>>>16,b&=65535,g+=r*l+s*u+i*c+o*a,g&=65535,P(m<<16|y,g<<16|b,this.unsigned)},v.mul=v.multiply,v.divide=function(e){if(ne(e)||(e=Ae(e)),e.isZero())throw Error("division by zero");if(be){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?be.div_u:be.div_s)(this.low,this.high,e.low,e.high);return P(t,be.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ge:Ie;var r,s,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ge;if(e.gt(this.shru(1)))return vo;i=Ge}else{if(this.eq(ae)){if(e.eq(Et)||e.eq(kr))return ae;if(e.eq(ae))return Et;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ie)?e.isNegative()?Et:kr:(s=this.sub(e.mul(r)),i=r.add(s.div(e)),i)}else if(e.eq(ae))return this.unsigned?Ge:Ie;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ie}for(s=this;s.gte(e);){r=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),c=a<=48?1:Cn(2,a-48),u=ye(r),l=u.mul(e);l.isNegative()||l.gt(s);)r-=c,u=ye(r,this.unsigned),l=u.mul(e);u.isZero()&&(u=Et),i=i.add(u),s=s.sub(l)}return i},v.div=v.divide,v.modulo=function(e){if(ne(e)||(e=Ae(e)),be){var t=(this.unsigned?be.rem_u:be.rem_s)(this.low,this.high,e.low,e.high);return P(t,be.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},v.mod=v.modulo,v.rem=v.modulo,v.not=function(){return P(~this.low,~this.high,this.unsigned)},v.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},v.clz=v.countLeadingZeros,v.countTrailingZeros=function(){return this.low?go(this.low):go(this.high)+32},v.ctz=v.countTrailingZeros,v.and=function(e){return ne(e)||(e=Ae(e)),P(this.low&e.low,this.high&e.high,this.unsigned)},v.or=function(e){return ne(e)||(e=Ae(e)),P(this.low|e.low,this.high|e.high,this.unsigned)},v.xor=function(e){return ne(e)||(e=Ae(e)),P(this.low^e.low,this.high^e.high,this.unsigned)},v.shiftLeft=function(e){return ne(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?P(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):P(0,this.low<<e-32,this.unsigned)},v.shl=v.shiftLeft,v.shiftRight=function(e){return ne(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?P(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):P(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},v.shr=v.shiftRight,v.shiftRightUnsigned=function(e){return ne(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?P(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?P(this.high,0,this.unsigned):P(this.high>>>e-32,0,this.unsigned)},v.shru=v.shiftRightUnsigned,v.shr_u=v.shiftRightUnsigned,v.rotateLeft=function(e){var t;return ne(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?P(this.high,this.low,this.unsigned):e<32?(t=32-e,P(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,P(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},v.rotl=v.rotateLeft,v.rotateRight=function(e){var t;return ne(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?P(this.high,this.low,this.unsigned):e<32?(t=32-e,P(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,P(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},v.rotr=v.rotateRight,v.toSigned=function(){return this.unsigned?P(this.low,this.high,!1):this},v.toUnsigned=function(){return this.unsigned?this:P(this.low,this.high,!0)},v.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},v.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},v.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},B.fromBytes=function(e,t,r){return r?B.fromBytesLE(e,t):B.fromBytesBE(e,t)},B.fromBytesLE=function(e,t){return new B(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},B.fromBytesBE=function(e,t){return new B(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},typeof BigInt=="function"&&(B.fromBigInt=function(e,t){var r=Number(BigInt.asIntN(32,e)),s=Number(BigInt.asIntN(32,e>>BigInt(32)));return P(r,s,t)},B.fromValue=function(e,t){return typeof e=="bigint"?B.fromBigInt(e,t):Ae(e,t)},v.toBigInt=function(){var e=BigInt(this.low>>>0),t=BigInt(this.unsigned?this.high>>>0:this.high);return t<<BigInt(32)|e});var G=(n=>(n[n.Null=0]="Null",n[n.Boolean=1]="Boolean",n[n.Integer=2]="Integer",n[n.Long=3]="Long",n[n.Double=4]="Double",n[n.String=5]="String",n[n.Bytes=6]="Bytes",n[n.Date=7]="Date",n))(G||{});class X extends Xt{constructor(t,r){super(r);h(this,"valueType");h(this,"value");this.valueType=X.getPrimitiveType(t),this.value=t===void 0?null:t}static of(t,r){return new X(t,r)}static valueFromBytes(t,r){switch(t){case 0:return null;case 1:return!!r[0];case 2:return r[0]|r[1]<<8|r[2]<<16|r[3]<<24;case 4:{const s=new DataView(r.buffer);return r.forEach(function(i,o){s.setUint8(o,i)}),s.getFloat64(0,!0)}case 5:return new TextDecoder("utf-8").decode(r);case 3:return B.fromBytesLE(Array.from(r));case 6:return r;case 7:return new Date(B.fromBytesLE(Array.from(r),!0).toNumber());default:throw new f(d.ErrUnimplemented,`unimplemented type: ${t}`)}}getValueSize(){switch(this.valueType){case 0:return 8;case 1:return 4;case 2:return 4;case 3:return 8;case 4:return 8;case 5:return this.value.length*2;case 6:return this.value.length;case 7:return 8;default:throw new f(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}getDataSize(){return{data:this.getValueSize(),meta:this.getMetaUsage()}}toJSON(){return this.valueType===5?`"${Le(this.value)}"`:`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_PRIMITIVE"}}deepcopy(){const t=X.of(this.value,this.getCreatedAt());return t.setMovedAt(this.getMovedAt()),t.setRemovedAt(this.getRemovedAt()),t}getType(){return this.valueType}static getPrimitiveType(t){switch(typeof t){case"undefined":return 0;case"boolean":return 1;case"number":return this.isInteger(t)?2:4;case"string":return 5;case"object":if(t===null)return 0;if(t instanceof B)return 3;if(t instanceof Uint8Array)return 6;if(t instanceof Date)return 7}}static isSupport(t){return X.getPrimitiveType(t)!==void 0}static isInteger(t){return t%1===0}isNumericType(){const t=this.valueType;return t===2||t===3||t===4}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:return new Uint8Array;case 1:return this.value?new Uint8Array([1]):new Uint8Array([0]);case 2:{const t=this.value;return new Uint8Array([t&255,t>>8&255,t>>16&255,t>>24&255])}case 4:{const t=this.value,r=new Uint8Array(8);return new DataView(r.buffer).setFloat64(0,t,!0),r}case 5:return new TextEncoder().encode(this.value);case 3:{const r=this.value.toBytesLE();return Uint8Array.from(r)}case 6:return this.value;case 7:{const t=this.value,r=B.fromNumber(t.getTime(),!0).toBytesLE();return Uint8Array.from(r)}default:throw new f(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}}class Tn extends fo{constructor(t){super(t);h(this,"prev");h(this,"next");h(this,"movedFrom");this.value=t}static createAfter(t,r){const s=new Tn(r),i=t.next;return t.next=s,s.prev=t,s.next=i,i&&(i.prev=s),s}remove(t){return this.value.remove(t)}getCreatedAt(){return this.value.getCreatedAt()}getPositionedAt(){return this.value.getPositionedAt()}release(){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.prev=void 0,this.next=void 0}getLength(){return this.value.isRemoved()?0:1}getPrev(){return this.prev}getNext(){return this.next}getMovedFrom(){return this.movedFrom}setMovedFrom(t){this.movedFrom=t}getValue(){return this.value}isRemoved(){return this.value.isRemoved()}}class $t{constructor(){h(this,"dummyHead");h(this,"last");h(this,"nodeMapByIndex");h(this,"nodeMapByCreatedAt");const e=X.of(0,vt);e.setRemovedAt(vt),this.dummyHead=new Tn(e),this.last=this.dummyHead,this.nodeMapByIndex=new _t,this.nodeMapByCreatedAt=new Map,this.nodeMapByIndex.insert(this.dummyHead),this.nodeMapByCreatedAt.set(this.dummyHead.getCreatedAt().toIDString(),this.dummyHead)}static create(){return new $t}get length(){return this.nodeMapByIndex.length}findNextBeforeExecutedAt(e,t){let r=this.nodeMapByCreatedAt.get(e.toIDString());if(!r)throw new f(d.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);for(;r.getValue().getMovedAt()&&r.getValue().getMovedAt().after(t)&&r.getMovedFrom();)r=r.getMovedFrom();for(;r.getNext()&&r.getNext().getPositionedAt().after(t);)r=r.getNext();return r}release(e){this.last===e&&(this.last=e.getPrev()),e.release(),this.nodeMapByIndex.delete(e),this.nodeMapByCreatedAt.delete(e.getValue().getCreatedAt().toIDString())}insertAfter(e,t,r=t.getCreatedAt()){const s=this.findNextBeforeExecutedAt(e,r),i=Tn.createAfter(s,t);return s===this.last&&(this.last=i),this.nodeMapByIndex.insertAfter(s,i),this.nodeMapByCreatedAt.set(i.getCreatedAt().toIDString(),i),i}moveAfter(e,t,r){let s=this.nodeMapByCreatedAt.get(e.toIDString());if(!s)throw new f(d.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);let i=this.nodeMapByCreatedAt.get(t.toIDString());if(!i)throw new f(d.ErrInvalidArgument,`cant find the given node: ${t.toIDString()}`);if(s!==i&&r.after(i.getPositionedAt())){const o=i.getPrev();let a=i.getNext();for(this.release(i),i=this.insertAfter(s.getCreatedAt(),i.getValue(),r),i.getValue().setMovedAt(r),i.setMovedFrom(o);a&&a.getPositionedAt().after(r);)s=i,i=a,a=i.getNext(),this.release(i),i=this.insertAfter(s.getCreatedAt(),i.getValue(),r),i.getValue().setMovedAt(r),i.setMovedFrom(o)}}insert(e){this.insertAfter(this.last.getCreatedAt(),e)}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return String(this.nodeMapByIndex.indexOf(t))}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new f(d.ErrInvalidArgument,`fail to find the given createdAt: ${e.getCreatedAt().toIDString()}`);this.release(t)}getByIndex(e){return e>=this.length?void 0:this.nodeMapByIndex.findForArray(e)}getPrevCreatedAt(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());do t=t.getPrev();while(this.dummyHead!==t&&t.isRemoved());return t.getValue().getCreatedAt()}delete(e,t){const r=this.nodeMapByCreatedAt.get(e.toIDString()),s=r.isRemoved();return r.remove(t)&&!s&&this.nodeMapByIndex.splayNode(r),r.getValue()}set(e,t,r){const s=this.nodeMapByCreatedAt.get(e.toIDString());if(!s)throw new f(d.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);return this.insertAfter(s.getCreatedAt(),t,r),this.delete(e,r)}deleteByIndex(e,t){const r=this.getByIndex(e);if(r)return r.remove(t)&&this.nodeMapByIndex.splayNode(r),r.getValue()}getHead(){return this.dummyHead.getValue()}getLast(){return this.last.getValue()}getLastCreatedAt(){return this.last.getCreatedAt()}toTestString(){const e=[];for(const t of this){const r=`${t.getCreatedAt().toIDString()}:${t.getValue().toJSON()}`;t.isRemoved()?e.push(`{${r}}`):e.push(`[${r}]`)}return e.join("")}*[Symbol.iterator](){let e=this.dummyHead.getNext();for(;e;)yield e,e=e.getNext()}}class re extends je{constructor(t,r){super(t);h(this,"elements");this.elements=r}static create(t,r){if(!r)return new re(t,$t.create());const s=$t.create();for(const i of r)s.insertAfter(s.getLastCreatedAt(),i.deepcopy());return new re(t,s)}subPathOf(t){return this.elements.subPathOf(t)}purge(t){this.elements.purge(t)}insertAfter(t,r,s){this.elements.insertAfter(t,r,s)}moveAfter(t,r,s){this.elements.moveAfter(t,r,s)}get(t){const r=this.elements.getByIndex(t);return r==null?void 0:r.getValue()}getByID(t){const r=this.elements.getByID(t);return r==null?void 0:r.getValue()}getHead(){return this.elements.getHead()}getLast(){return this.elements.getLast()}getPrevCreatedAt(t){return this.elements.getPrevCreatedAt(t)}delete(t,r){return this.elements.delete(t,r)}deleteByIndex(t,r){return this.elements.deleteByIndex(t,r)}set(t,r,s){return this.elements.set(t,r,s)}getLastCreatedAt(){return this.elements.getLastCreatedAt()}get length(){return this.elements.length}*[Symbol.iterator](){for(const t of this.elements)t.isRemoved()||(yield t.getValue())}toTestString(){return this.elements.toTestString()}getDescendants(t){for(const r of this.elements){const s=r.getValue();if(t(s,this))return;s instanceof je&&s.getDescendants(t)}}getDataSize(){return{data:0,meta:this.getMetaUsage()}}toJSON(){const t=[];for(const r of this)t.push(r.toJSON());return`[${t.join(",")}]`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const t={};for(let r=0;r<this.length;r++){const{createdAt:s,value:i,type:o}=this.get(r).toJSForTest();t[r]={key:String(r),createdAt:s,value:i,type:o}}return{createdAt:this.getCreatedAt().toTestString(),value:t,type:"YORKIE_ARRAY"}}toSortedJSON(){return this.toJSON()}getElements(){return this.elements}deepcopy(){const t=re.create(this.getCreatedAt());for(const r of this.elements)t.elements.insertAfter(t.getLastCreatedAt(),r.getValue().deepcopy());return t.setRemovedAt(this.getRemovedAt()),t.setMovedAt(this.getMovedAt()),t}}class Qe extends Se{constructor(t,r,s,i){super(t,i);h(this,"prevCreatedAt");h(this,"value");this.prevCreatedAt=r,this.value=s}static create(t,r,s,i){return new Qe(t,r,s,i)}execute(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof re))throw new f(d.ErrInvalidArgument,"fail to execute, only array can execute add");const s=r,i=this.value.deepcopy();return s.insertAfter(this.prevCreatedAt,i,this.getExecutedAt()),t.registerElement(i,s),{opInfos:[{type:"add",path:t.createPath(this.getParentCreatedAt()),index:Number(s.subPathOf(this.getEffectedCreatedAt()))}],reverseOp:this.toReverseOperation()}}toReverseOperation(){return Be.create(this.getParentCreatedAt(),this.value.getCreatedAt())}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ADD.${this.value.toJSON()}`}getPrevCreatedAt(){return this.prevCreatedAt}getValue(){return this.value}setPrevCreatedAt(t){this.prevCreatedAt=t}}class Be extends Se{constructor(t,r,s){super(t,s);h(this,"createdAt");this.createdAt=r}static create(t,r,s){return new Be(t,r,s)}execute(t,r){var u;const s=t.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof je))throw new f(d.ErrInvalidArgument,`only object and array can execute remove: ${s}`);if(r===J.UndoRedo){let l=s.getByID(this.createdAt);for(;l;){if(l.getRemovedAt())return;l=(u=t.findElementPairByCreatedAt(l.getCreatedAt()))==null?void 0:u.parent}}const i=s.subPathOf(this.createdAt),o=this.toReverseOperation(s),a=s.delete(this.createdAt,this.getExecutedAt());return t.registerRemovedElement(a),{opInfos:s instanceof re?[{type:"remove",path:t.createPath(this.getParentCreatedAt()),index:Number(i)}]:[{type:"remove",path:t.createPath(this.getParentCreatedAt()),key:i}],reverseOp:o}}toReverseOperation(t){if(t instanceof re){const r=t.getByID(this.createdAt);if(r!==void 0){const s=t.getPrevCreatedAt(this.createdAt);return Qe.create(this.getParentCreatedAt(),s,r.deepcopy())}}if(t instanceof te){const r=t.subPathOf(this.createdAt);if(r!==void 0){const s=t.get(r);if(s!==void 0)return ut.create(r,s.deepcopy(),this.getParentCreatedAt())}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.REMOVE.${this.createdAt.toTestString()}`}getCreatedAt(){return this.createdAt}setCreatedAt(t){this.createdAt=t}}class ut extends Se{constructor(t,r,s,i){super(s,i);h(this,"key");h(this,"value");this.key=t,this.value=r}static create(t,r,s,i){return new ut(t,r,s,i)}execute(t,r){var u;const s=t.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof te))throw new f(d.ErrInvalidArgument,"fail to execute, only object can execute set");if(r===J.UndoRedo){let l=s;for(;l;){if(l.getRemovedAt())return;l=(u=t.findElementPairByCreatedAt(l.getCreatedAt()))==null?void 0:u.parent}}const i=s.get(this.key),o=this.toReverseOperation(i),a=this.value.deepcopy(),c=s.set(this.key,a,this.getExecutedAt());return r===J.UndoRedo&&t.findByCreatedAt(a.getCreatedAt())&&t.deregisterElement(a),t.registerElement(a,s),c&&t.registerRemovedElement(c),{opInfos:[{type:"set",path:t.createPath(this.getParentCreatedAt()),key:this.key}],reverseOp:o}}toReverseOperation(t){let r=Be.create(this.getParentCreatedAt(),this.value.getCreatedAt());return t!==void 0&&!t.isRemoved()&&(r=ut.create(this.key,t.deepcopy(),this.getParentCreatedAt())),r}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.SET.${this.key}=${this.value.toSortedJSON()}`}getKey(){return this.key}getValue(){return this.value}}class Ee extends Se{constructor(t,r,s,i){super(t,i);h(this,"prevCreatedAt");h(this,"createdAt");this.prevCreatedAt=r,this.createdAt=s}static create(t,r,s,i){return new Ee(t,r,s,i)}execute(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof re))throw new f(d.ErrInvalidArgument,"fail to execute, only array can execute move");const s=r,i=this.toReverseOperation(s),o=Number(s.subPathOf(this.createdAt));s.moveAfter(this.prevCreatedAt,this.createdAt,this.getExecutedAt());const a=Number(s.subPathOf(this.createdAt));return{opInfos:[{type:"move",path:t.createPath(this.getParentCreatedAt()),index:a,previousIndex:o}],reverseOp:i}}toReverseOperation(t){const r=t.getPrevCreatedAt(this.createdAt);return Ee.create(this.getParentCreatedAt(),r,this.createdAt)}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.MOVE`}getPrevCreatedAt(){return this.prevCreatedAt}getCreatedAt(){return this.createdAt}setPrevCreatedAt(t){this.prevCreatedAt=t}setCreatedAt(t){this.createdAt=t}}const zl=(n,e)=>n===e?0:n<e?-1:1;class jl{constructor(e,t,r){h(this,"key");h(this,"value");h(this,"left");h(this,"right");h(this,"isRed");this.key=e,this.value=t,this.isRed=r}}class Ql{constructor(e){h(this,"stack");this.stack=[],this.traverseInorder(e)}traverseInorder(e){e&&(this.traverseInorder(e.left),this.stack.push({key:e.key,value:e.value}),this.traverseInorder(e.right))}}class Eo{constructor(e){h(this,"root");h(this,"comparator");h(this,"counter");this.comparator=typeof e<"u"?e:zl,this.counter=0}put(e,t){return this.root=this.putInternal(e,t,this.root),this.root.isRed=!1,t}get(e){const t=this.getInternal(e,this.root);return t?t.value:void 0}remove(e){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.isRed=!0),this.root=this.removeInternal(this.root,e),this.root&&(this.root.isRed=!1)}getIterator(){return new Ql(this.root)}values(){const e=[];for(const t of this.getIterator().stack)e.push(t.value);return e}floorEntry(e){let t=this.root,r;for(;t;){const s=this.comparator(e,t.key);if(s===0)return t;s<0?t=t.left:(r=t,t=t.right)}return r}lastEntry(){if(!this.root)return this.root;let e=this.root;for(;e.right;)e=e.right;return e}size(){return this.counter}isEmpty(){return this.counter===0}getInternal(e,t){for(;t;){const r=this.comparator(e,t.key);if(r===0)return t;r<0?t=t.left:r>0&&(t=t.right)}}putInternal(e,t,r){if(!r)return this.counter+=1,new jl(e,t,!0);const s=this.comparator(e,r.key);return s<0?r.left=this.putInternal(e,t,r.left):s>0?r.right=this.putInternal(e,t,r.right):r.value=t,this.isRed(r.right)&&!this.isRed(r.left)&&(r=this.rotateLeft(r)),this.isRed(r.left)&&this.isRed(r.left.left)&&(r=this.rotateRight(r)),this.isRed(r.left)&&this.isRed(r.right)&&this.flipColors(r),r}removeInternal(e,t){if(this.comparator(t,e.key)<0)!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeInternal(e.left,t);else{if(this.isRed(e.left)&&(e=this.rotateRight(e)),this.comparator(t,e.key)===0&&!e.right){this.counter-=1;return}if(!this.isRed(e.right)&&!this.isRed(e.right.left)&&(e=this.moveRedRight(e)),this.comparator(t,e.key)===0){this.counter-=1;const r=this.min(e.right);e.value=r.value,e.key=r.key,e.right=this.removeMin(e.right)}else e.right=this.removeInternal(e.right,t)}return this.fixUp(e)}min(e){return e.left?this.min(e.left):e}removeMin(e){if(e.left)return!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeMin(e.left),this.fixUp(e)}fixUp(e){return this.isRed(e.right)&&(e=this.rotateLeft(e)),this.isRed(e.left)&&this.isRed(e.left.left)&&(e=this.rotateRight(e)),this.isRed(e.left)&&this.isRed(e.right)&&this.flipColors(e),e}moveRedLeft(e){return this.flipColors(e),this.isRed(e.right.left)&&(e.right=this.rotateRight(e.right),e=this.rotateLeft(e),this.flipColors(e)),e}moveRedRight(e){return this.flipColors(e),this.isRed(e.left.left)&&(e=this.rotateRight(e),this.flipColors(e)),e}isRed(e){return e&&e.isRed}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.isRed=t.left.isRed,t.left.isRed=!0,t}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.isRed=t.right.isRed,t.right.isRed=!0,t}flipColors(e){e.isRed=!e.isRed,e.left.isRed=!e.left.isRed,e.right.isRed=!e.right.isRed}}function Hl(n){return n?No(n.live)+No(n.gc):0}function No(n){return n.data+n.meta}function Q(n,...e){for(const t of e)n.data+=t.data,n.meta+=t.meta}function lt(n,e){n.data-=e.data,n.meta-=e.meta}class We{constructor(e,t){h(this,"createdAt");h(this,"offset");this.createdAt=e,this.offset=t}static of(e,t){return new We(e,t)}static fromStruct(e){return We.of(pe.fromStruct(e.createdAt),e.offset)}getCreatedAt(){return this.createdAt}getOffset(){return this.offset}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}hasSameCreatedAt(e){return this.createdAt.compare(e.createdAt)===0}split(e){return new We(this.createdAt,this.offset+e)}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toTestString(){return`${this.createdAt.toTestString()}:${this.offset}`}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}}const ql=We.of(vt,0);class q{constructor(e,t){h(this,"id");h(this,"relativeOffset");this.id=e,this.relativeOffset=t}static of(e,t){return new q(e,t)}static fromStruct(e){const t=We.fromStruct(e.id);return q.of(t,e.relativeOffset)}getID(){return this.id}getRelativeOffset(){return this.relativeOffset}getAbsoluteID(){return We.of(this.id.getCreatedAt(),this.id.getOffset()+this.relativeOffset)}toTestString(){return`${this.id.toTestString()}:${this.relativeOffset}`}toStruct(){return{id:this.id.toStruct(),relativeOffset:this.relativeOffset}}equals(e){return this.id.equals(e.id)?this.relativeOffset===e.relativeOffset:!1}}class He extends fo{constructor(t,r,s){super(r);h(this,"id");h(this,"removedAt");h(this,"prev");h(this,"next");h(this,"insPrev");h(this,"insNext");this.id=t,this.removedAt=s}static create(t,r){return new He(t,r)}static createComparator(){return(t,r)=>{const s=t.getCreatedAt().compare(r.getCreatedAt());return s!==0?s:t.getOffset()>r.getOffset()?1:t.getOffset()<r.getOffset()?-1:0}}getID(){return this.id}getCreatedAt(){return this.id.getCreatedAt()}getLength(){return this.removedAt?0:this.getContentLength()}getContentLength(){return this.value&&this.value.length||0}getPrev(){return this.prev}getNext(){return this.next}getInsPrev(){return this.insPrev}getInsNext(){return this.insNext}getInsPrevID(){return this.insPrev.getID()}setPrev(t){this.prev=t,t&&(t.next=this)}setNext(t){this.next=t,t&&(t.prev=this)}setInsPrev(t){this.insPrev=t,t&&(t.insNext=this)}setInsNext(t){this.insNext=t,t&&(t.insPrev=this)}hasNext(){return!!this.next}hasInsPrev(){return!!this.insPrev}isRemoved(){return!!this.removedAt}getRemovedAt(){return this.removedAt}split(t){return new He(this.id.split(t),this.splitValue(t),this.removedAt)}canRemove(t,r,s){return r?!!(!this.removedAt||!s&&(t!=null&&t.after(this.removedAt))):!1}canStyle(t,r){return this.getCreatedAt().getLamport()<=r&&(!this.removedAt||t.after(this.removedAt))}setRemovedAt(t){this.removedAt=t}remove(t){if(!this.removedAt){this.removedAt=t;return}t.after(this.removedAt)&&(this.removedAt=t)}createPosRange(){return[q.of(this.id,0),q.of(this.id,this.getLength())]}getDataSize(){const t=this.value.getDataSize();return this.id&&(t.meta+=xe),this.removedAt&&(t.meta+=xe),t}deepcopy(){return new He(this.id,this.value,this.removedAt)}toTestString(){return`${this.id.toTestString()} ${this.value?this.value:""}`}splitValue(t){const r=this.value;return this.value=r.substring(0,t),r.substring(t,r.length)}toIDString(){return this.id.toIDString()}}class Nt{constructor(){h(this,"head");h(this,"treeByIndex");h(this,"treeByID");this.head=He.create(ql),this.treeByIndex=new _t,this.treeByID=new Eo(He.createComparator()),this.treeByIndex.insert(this.head),this.treeByID.put(this.head.getID(),this.head)}static create(){return new Nt}edit(e,t,r,s){const i={data:0,meta:0},[o,a,c]=this.findNodeWithSplit(e[1],t),[u,l,g]=this.findNodeWithSplit(e[0],t);Q(i,a,l);const b=this.findBetween(g,c),[m,y]=this.deleteNodes(b,t,s),A=c?c.getID():o.getID();let I=q.of(A,0);if(r){const k=this.posToIndex(u.createPosRange()[1],!0),O=this.insertAfter(u,He.create(We.of(t,0),r));Q(i,O.getDataSize()),m.length&&m[m.length-1].from===k?m[m.length-1].value=r:m.push({actor:t.getActorID(),from:k,to:k,value:r}),I=q.of(O.getID(),O.getContentLength())}const E=[],C=[];for(const[,k]of y)E.push({parent:this,child:k}),C.push(k.getValue());return[I,E,i,m,C]}indexToPos(e){const[t,r]=this.treeByIndex.findForText(e),s=t;return q.of(s.getID(),r)}findIndexesFromRange(e){const[t,r]=e;return[this.posToIndex(t,!1),this.posToIndex(r,!0)]}posToIndex(e,t){const r=e.getAbsoluteID(),s=t?this.findFloorNodePreferToLeft(r):this.findFloorNode(r);if(!s)throw new f(d.ErrInvalidArgument,`the node of the given id should be found: ${r.toTestString()}`);const i=this.treeByIndex.indexOf(s),o=s.isRemoved()?0:r.getOffset()-s.getID().getOffset();return i+o}findNode(e){return this.findFloorNode(e)}get length(){return this.treeByIndex.length}getTreeByIndex(){return this.treeByIndex}getTreeByID(){return this.treeByID}toString(){const e=[];for(const t of this)t.isRemoved()||e.push(t.getValue());return e.join("")}*[Symbol.iterator](){let e=this.head.getNext();for(;e;)yield e,e=e.getNext()}getHead(){return this.head}deepcopy(){const e=new Nt;let t=this.head.getNext(),r=e.head,s;for(;t;){if(s=e.insertAfter(r,t.deepcopy()),t.hasInsPrev()){const i=e.findNode(t.getInsPrevID());s.setInsPrev(i)}r=s,t=t.getNext()}return e}normalizePos(e){const t=this.findFloorNode(e.getID());if(!t)throw new f(d.ErrInvalidArgument,`the node of the given id should be found: ${e.getID().toTestString()}`);let r=e.getRelativeOffset(),s=t,i=t.getPrev();for(;i;)r+=i.getLength(),s=i,i=i.getPrev();return q.of(s.getID(),r)}refinePos(e){let t=this.findFloorNode(e.getID());if(!t)throw new f(d.ErrInvalidArgument,`the node of the given id should be found: ${e.getID().toTestString()}`);let r=e.getRelativeOffset(),s=t.getContentLength();for(;r>s;){r-=s;const i=t.getNext();if(!i)return q.of(t.getID(),s);t=i,s=t.getLength()}return q.of(t.getID(),r)}toTestString(){const e=[];let t=this.head;for(;t;)t.isRemoved()?e.push(`{${t.toTestString()}}`):e.push(`[${t.toTestString()}]`),t=t.getNext();return e.join("")}insertAfter(e,t){const r=e.getNext();return t.setPrev(e),r&&r.setPrev(t),this.treeByID.put(t.getID(),t),this.treeByIndex.insertAfter(e,t),t}findNodeWithSplit(e,t){const r=e.getAbsoluteID();let s=this.findFloorNodePreferToLeft(r);const i=r.getOffset()-s.getID().getOffset(),[,o]=this.splitNode(s,i);for(;s.hasNext()&&s.getNext().getCreatedAt().after(t);)s=s.getNext();return[s,o,s.getNext()]}findFloorNodePreferToLeft(e){let t=this.findFloorNode(e);if(!t)throw new f(d.ErrInvalidArgument,`the node of the given id should be found: ${e.toTestString()}`);if(e.getOffset()>0&&t.getID().getOffset()==e.getOffset()){if(!t.hasInsPrev())return t;t=t.getInsPrev()}return t}findFloorNode(e){const t=this.treeByID.floorEntry(e);if(t&&!(!t.key.equals(e)&&!t.key.hasSameCreatedAt(e)))return t.value}findBetween(e,t){const r=[];let s=e;for(;s&&s!==t;)r.push(s),s=s.getNext();return r}splitNode(e,t){const r={data:0,meta:0};if(t>e.getContentLength())throw new f(d.ErrInvalidArgument,"offset should be less than or equal to length");if(t===0)return[e,r];if(t===e.getContentLength())return[e.getNext(),r];const s=e.getDataSize(),i=e.split(t);this.treeByIndex.updateWeight(i),this.insertAfter(e,i);const o=e.getInsNext();return o&&o.setInsPrev(i),i.setInsPrev(e),Q(r,e.getDataSize(),i.getDataSize()),lt(r,s),[i,r]}deleteNodes(e,t,r){if(!e.length)return[[],new Map];const s=r===void 0||r.size()===0,i=[],o=[],[a,c]=this.findEdgesOfCandidates(e);o.push(a);for(const g of e){let b=!1;if(s)b=!0;else{const y=r==null?void 0:r.get(g.getCreatedAt().getActorID());y&&y>=g.getCreatedAt().getLamport()&&(b=!0)}let m=!1;if(g.getRemovedAt()){const y=r==null?void 0:r.get(g.getRemovedAt().getActorID());(s||y&&y>=g.getRemovedAt().getLamport())&&(m=!0)}g.canRemove(t,b,m)?i.push(g):o.push(g)}o.push(c);const u=this.makeChanges(o,t),l=new Map;for(const g of i)l.set(g.getID().toIDString(),g),g.remove(t);return this.deleteIndexNodes(o),[u,l]}findEdgesOfCandidates(e){return[e[0].getPrev(),e[e.length-1].getNext()]}makeChanges(e,t){const r=[];let s,i;for(let o=0;o<e.length-1;o++){const a=e[o],c=e[o+1];a.getNext()!=c&&([s]=this.findIndexesFromRange(a.getNext().createPosRange()),c?[,i]=this.findIndexesFromRange(c.getPrev().createPosRange()):i=this.treeByIndex.length,s<i&&r.push({actor:t.getActorID(),from:s,to:i}))}return r.reverse()}deleteIndexNodes(e){for(let t=0;t<e.length-1;t++){const r=e[t],s=e[t+1];r.getNext()!=s&&this.treeByIndex.deleteRange(r,s)}}purge(e){this.treeByIndex.delete(e),this.treeByID.remove(e.getID());const t=e.getPrev(),r=e.getNext(),s=e.getInsPrev(),i=e.getInsNext();t&&t.setNext(r),r&&r.setPrev(t),e.setPrev(void 0),e.setNext(void 0),s&&s.setInsNext(i),i&&i.setInsPrev(s),e.setInsPrev(void 0),e.setInsNext(void 0)}}class qe{constructor(e,t,r,s){h(this,"key");h(this,"value");h(this,"updatedAt");h(this,"_isRemoved");this.key=e,this.value=t,this.updatedAt=r,this._isRemoved=s}static of(e,t,r,s){return new qe(e,t,r,s)}getKey(){return this.key}getValue(){return this.value}getUpdatedAt(){return this.updatedAt}isRemoved(){return this._isRemoved}toIDString(){return`${this.updatedAt.toIDString()}:${this.key}`}getRemovedAt(){if(this._isRemoved)return this.updatedAt}getDataSize(){return{data:(this.key.length+this.value.length)*2,meta:xe}}}class Fe{constructor(){h(this,"nodeMapByKey");h(this,"numberOfRemovedElement");this.nodeMapByKey=new Map,this.numberOfRemovedElement=0}static create(){return new Fe}getNodeMapByKey(){return this.nodeMapByKey}set(e,t,r){const s=this.nodeMapByKey.get(e);if(s&&s.isRemoved()&&r.after(s.getUpdatedAt())&&(this.numberOfRemovedElement-=1),s===void 0||r.after(s.getUpdatedAt())){const i=qe.of(e,t,r,!1);return this.nodeMapByKey.set(e,i),s!==void 0&&s.isRemoved()?[s,i]:[void 0,i]}return s.isRemoved()?[s,void 0]:[void 0,void 0]}setInternal(e,t,r,s){const i=qe.of(e,t,r,s);this.nodeMapByKey.set(e,i),s&&this.numberOfRemovedElement++}remove(e,t){const r=this.nodeMapByKey.get(e),s=[];if(r===void 0||t.after(r.getUpdatedAt())){if(r===void 0){this.numberOfRemovedElement+=1;const a=qe.of(e,"",t,!0);return this.nodeMapByKey.set(e,a),s.push(a),s}const i=r.isRemoved();i||(this.numberOfRemovedElement+=1),i&&s.push(r);const o=qe.of(e,r.getValue(),t,!0);return this.nodeMapByKey.set(e,o),s.push(o),s}return s}has(e){if(this.nodeMapByKey.has(e)){const t=this.nodeMapByKey.get(e);return t!==void 0&&!t.isRemoved()}return!1}get(e){if(this.nodeMapByKey.has(e))return this.nodeMapByKey.get(e).getValue()}deepcopy(){const e=new Fe;for(const[,t]of this.nodeMapByKey)e.setInternal(t.getKey(),t.getValue(),t.getUpdatedAt(),t.isRemoved());return e}toJSON(){if(!this.size())return"{}";const e=[];for(const[t,r]of this.nodeMapByKey)r.isRemoved()||e.push(`"${Le(t)}":"${Le(r.getValue())}"`);return`{${e.join(",")}}`}size(){return this.nodeMapByKey.size-this.numberOfRemovedElement}toObject(){const e={};for(const[t,r]of this.nodeMapByKey)r.isRemoved()||(e[t]=r.getValue());return e}*[Symbol.iterator](){for(const[,e]of this.nodeMapByKey)yield e}purge(e){const t=this.nodeMapByKey.get(e.getKey());t==null||t.toIDString()!=e.toIDString()||(this.nodeMapByKey.delete(e.getKey()),this.numberOfRemovedElement--)}}function Ne(n){if(n instanceof Map){const e=Array.from(n);return new Map(JSON.parse(JSON.stringify(e)))}return JSON.parse(JSON.stringify(n))}const wo=n=>n?Object.entries(n).length===0:!0,wt=n=>{const e={};for(const[t,r]of Object.entries(n))e[t]=JSON.stringify(r);return e},Ke=n=>{const e={};for(const[t,r]of Object.entries(n))e[t]=JSON.parse(r);return e};class zt{constructor(e){h(this,"attributes");h(this,"content");this.attributes=Fe.create(),this.content=e}static create(e){return new zt(e)}get length(){return this.content.length}substring(e,t){const r=new zt(this.content.substring(e,t));return r.attributes=this.attributes.deepcopy(),r}setAttr(e,t,r){return this.attributes.set(e,t,r)}getAttrs(){return this.attributes}toString(){return this.content}getDataSize(){const e={data:0,meta:0};e.data+=this.content.length*2;for(const t of this.attributes){const r=t.getDataSize();e.meta+=r.meta,e.data+=r.data}return e}toJSON(){const e=Le(this.content),t=this.attributes.toObject(),r=[];for(const[s,i]of Object.entries(t)){const o=JSON.parse(i),a=typeof o=="string"?`"${Le(s)}":"${Le(o)}"`:`"${Le(s)}":${String(o)}`;r.push(a)}return r.sort(),r.length===0?`{"val":"${e}"}`:`{"attrs":{${r.join(",")}},"val":"${e}"}`}getAttributes(){return this.attributes.toObject()}getContent(){return this.content}purge(e){this.attributes&&e instanceof qe&&this.attributes.purge(e)}getGCPairs(){const e=[];for(const t of this.attributes)t.getRemovedAt()&&e.push({parent:this,child:t});return e}}class ce extends Xt{constructor(t,r){super(r);h(this,"rgaTreeSplit");this.rgaTreeSplit=t}static create(t,r){return new ce(t,r)}edit(t,r,s,i,o){const a=r?zt.create(r):void 0;if(a&&i)for(const[y,A]of Object.entries(i))a.setAttr(y,A,s);const[c,u,l,g,b]=this.rgaTreeSplit.edit(t,s,a,o);return[g.map(y=>({...y,value:y.value?{attributes:Ke(y.value.getAttributes()),content:y.value.getContent()}:{attributes:void 0,content:""},type:"content"})),u,l,[c,c],b]}setStyle(t,r,s,i){const o={data:0,meta:0},[,a,c]=this.rgaTreeSplit.findNodeWithSplit(t[1],s),[,u,l]=this.rgaTreeSplit.findNodeWithSplit(t[0],s);Q(o,a,u);const g=[],b=this.rgaTreeSplit.findBetween(l,c),m=[];for(const C of b){const k=C.getCreatedAt().getActorID();let O=wn;i!=null&&(O=i.get(k)?i.get(k):0n),C.canStyle(s,O)&&m.push(C)}const y=new Map,A=[];let I=!1;const E=[];for(const C of m){if(C.isRemoved())continue;if(!I){for(const U of Object.keys(r)){const V=C.getValue().getAttrs();V.has(U)?y.set(U,V.get(U)):A.push(U)}I=!0}const[k,O]=this.rgaTreeSplit.findIndexesFromRange(C.createPosRange());g.push({type:"style",actor:s.getActorID(),from:k,to:O,value:{attributes:Ke(r)}});for(const[U,V]of Object.entries(r)){const[F]=C.getValue().setAttr(U,V,s);F!==void 0&&E.push({parent:C.getValue(),child:F});const _=C.getValue().getAttrs().getNodeMapByKey().get(U);_!==void 0&&Q(o,_.getDataSize())}}return[E,o,g,y,A]}removeStyle(t,r,s,i){const o={data:0,meta:0},[,a,c]=this.rgaTreeSplit.findNodeWithSplit(t[1],s),[,u,l]=this.rgaTreeSplit.findNodeWithSplit(t[0],s);Q(o,a,u);const g=[],b=this.rgaTreeSplit.findBetween(l,c),m=[];for(const E of b){const C=E.getCreatedAt().getActorID();let k=wn;i!=null&&(k=i.get(C)?i.get(C):0n),E.canStyle(s,k)&&m.push(E)}const y=new Map;let A=!1;const I=[];for(const E of m){if(E.isRemoved())continue;if(!A){for(const U of r){const V=E.getValue().getAttrs();V.has(U)&&y.set(U,V.get(U))}A=!0}const[C,k]=this.rgaTreeSplit.findIndexesFromRange(E.createPosRange()),O={};for(const U of r)O[U]=null;g.push({type:"style",actor:s.getActorID(),from:C,to:k,value:{attributes:O}});for(const U of r){const V=E.getValue().getAttrs().remove(U,s);for(const F of V)I.push({parent:E.getValue(),child:F}),Q(o,F.getDataSize())}}return[I,o,g,y]}indexRangeToPosRange(t,r){const s=this.rgaTreeSplit.indexToPos(t);return t===r?[s,s]:[s,this.rgaTreeSplit.indexToPos(r)]}get length(){return this.rgaTreeSplit.length}getTreeByIndex(){return this.rgaTreeSplit.getTreeByIndex()}getTreeByID(){return this.rgaTreeSplit.getTreeByID()}refinePos(t){return this.rgaTreeSplit.refinePos(t)}normalizePos(t){return this.rgaTreeSplit.normalizePos(t)}getDataSize(){const t={data:0,meta:0};for(const r of this.rgaTreeSplit){if(r.isRemoved())continue;const s=r.getDataSize();t.data+=s.data,t.meta+=s.meta}return{data:t.data,meta:t.meta+this.getMetaUsage()}}toJSON(){const t=[];for(const r of this.rgaTreeSplit)r.isRemoved()||t.push(r.getValue().toJSON());return`[${t.join(",")}]`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TEXT"}}toString(){return this.rgaTreeSplit.toString()}values(){const t=[];for(const r of this.rgaTreeSplit)if(!r.isRemoved()){const s=r.getValue();t.push({attributes:Ke(s.getAttributes()),content:s.getContent()})}return t}getRGATreeSplit(){return this.rgaTreeSplit}toTestString(){return this.rgaTreeSplit.toTestString()}deepcopy(){const t=new ce(this.rgaTreeSplit.deepcopy(),this.getCreatedAt());return t.setRemovedAt(this.getRemovedAt()),t.setMovedAt(this.getMovedAt()),t}findIndexesFromRange(t){return this.rgaTreeSplit.findIndexesFromRange(t)}posToIndex(t,r=!1){return this.rgaTreeSplit.posToIndex(t,r)}getGCPairs(){const t=[];for(const r of this.rgaTreeSplit){r.getRemovedAt()&&t.push({parent:this.rgaTreeSplit,child:r});for(const s of r.getValue().getGCPairs())t.push(s)}return t}}class et extends Se{constructor(t,r,s,i,o,a,c){super(t,a);h(this,"fromPos");h(this,"toPos");h(this,"content");h(this,"attributes");h(this,"isUndoOp");this.fromPos=r,this.toPos=s,this.content=i,this.attributes=o,this.isUndoOp=c}static create(t,r,s,i,o,a,c){return new et(t,r,s,i,o,a,c)}execute(t,r,s){const i=t.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof ce))throw new f(d.ErrInvalidArgument,"fail to execute, only Text can execute edit");const o=i;this.isUndoOp&&(this.fromPos=o.refinePos(this.fromPos),this.toPos=o.refinePos(this.toPos));const[a,c,u,,l]=o.edit([this.fromPos,this.toPos],this.content,this.getExecutedAt(),Object.fromEntries(this.attributes),s),g=this.toReverseOperation(l,o.normalizePos(this.fromPos));t.acc(u);for(const b of c)t.registerGCPair(b);return{opInfos:a.map(({from:b,to:m,value:y})=>({type:"edit",from:b,to:m,value:y,path:t.createPath(this.getParentCreatedAt())})),reverseOp:g}}toReverseOperation(t,r){var o;const s=t!=null&&t.length?t.map(a=>a.getContent()).join(""):"";let i;if(t.length===1){const a=t[0].getAttributes();a&&(i=Array.from(Object.entries(a)))}return et.create(this.getParentCreatedAt(),r,q.of(r.getID(),r.getRelativeOffset()+(((o=this.content)==null?void 0:o.length)??0)),s,i?new Map(i):new Map,void 0,!0)}normalizePos(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof ce))throw new f(d.ErrInvalidArgument,"only Text can normalize edit");const s=r,i=s.normalizePos(this.fromPos).getRelativeOffset(),o=s.normalizePos(this.toPos).getRelativeOffset();return[i,o]}reconcileOperation(t,r,s){if(!this.isUndoOp||t>r)return;const i=r-t,o=this.fromPos.getRelativeOffset(),a=this.toPos.getRelativeOffset(),c=(u,l)=>{this.fromPos=q.of(this.fromPos.getID(),Math.max(0,u)),this.toPos=q.of(this.toPos.getID(),Math.max(0,l))};if(r<=o){c(o-i+s,a-i+s);return}if(!(a<=t)){if(t<=o&&a<=r&&t!==r){c(t,t);return}if(o<=t&&r<=a&&o!==a){c(o,a-i+s);return}if(t<o&&o<r&&r<a){c(t,t+(a-r));return}if(o<t&&t<a&&a<r){c(o,t);return}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const t=this.getParentCreatedAt().toTestString(),r=this.fromPos.toTestString(),s=this.toPos.toTestString(),i=this.content;return`${t}.EDIT(${r},${s},${i})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContent(){return this.content}getAttributes(){return this.attributes||new Map}}class Me extends Se{constructor(t,r,s,i,o,a){super(t,a);h(this,"fromPos");h(this,"toPos");h(this,"attributes");h(this,"attributesToRemove");this.fromPos=r,this.toPos=s,this.attributes=i,this.attributesToRemove=o}static create(t,r,s,i,o){return new Me(t,r,s,i,[],o)}static createRemoveStyleOperation(t,r,s,i,o){return new Me(t,r,s,new Map,i,o)}execute(t,r,s){const i=t.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof ce))throw new f(d.ErrInvalidArgument,"fail to execute, only Text can execute edit");const o=i,a=[],c=[];let u={data:0,meta:0};const l=new Map,g=[];if(this.attributesToRemove.length>0){const[m,y,A,I]=o.removeStyle([this.fromPos,this.toPos],this.attributesToRemove,this.getExecutedAt(),s);u={data:u.data+y.data,meta:u.meta+y.meta},a.push(...m),c.push(...A);for(const[E,C]of I)l.set(E,C)}if(this.attributes.size>0){const[m,y,A,I,E]=o.setStyle([this.fromPos,this.toPos],Object.fromEntries(this.attributes),this.getExecutedAt(),s);u={data:u.data+y.data,meta:u.meta+y.meta},a.push(...m),c.push(...A);for(const[C,k]of I)l.set(C,k);g.push(...E)}t.acc(u);for(const m of a)t.registerGCPair(m);let b;return(l.size>0||g.length>0)&&(l.size>0&&g.length>0?b=new Me(this.getParentCreatedAt(),this.fromPos,this.toPos,l,g):g.length>0?b=Me.createRemoveStyleOperation(this.getParentCreatedAt(),this.fromPos,this.toPos,g):b=Me.create(this.getParentCreatedAt(),this.fromPos,this.toPos,l)),{opInfos:c.map(({from:m,to:y,value:A})=>({type:"style",from:m,to:y,value:A,path:t.createPath(this.getParentCreatedAt())})),reverseOp:b}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const t=this.getParentCreatedAt().toTestString(),r=this.fromPos.toTestString(),s=this.toPos.toTestString(),i=this.attributes;return`${t}.STYL(${r},${s},${JSON.stringify(i)})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}}const eh=2,th="root",ke="text";function jt(n,e,t=!1){let r=0;const s=t?n.allChildren:n.children;for(let i=0;i<e;i++){const o=s[i];!o||!t&&o.isRemoved||(r+=o.paddedSize(t))}return r}class nh{constructor(e,t=[]){h(this,"type");h(this,"parent");h(this,"_children");h(this,"visibleSize");h(this,"totalSize");if(this.type=e,this.visibleSize=0,this.totalSize=0,this._children=t,this.isText&&this._children.length>0)throw new f(d.ErrRefused,"Text node cannot have children")}updateAncestorsSize(e,t=!1){let r=this.parent;for(;r;){if(t)r.totalSize+=e;else if(r.visibleSize+=e,r.isRemoved)break;r=r.parent}}updateDescendantsSize(e=!1){let t=0;for(const r of this._children){const s=r.updateDescendantsSize(e);!e&&r.isRemoved||(t+=s)}return e?this.totalSize+=t:this.visibleSize+=t,this.paddedSize(e)}get isText(){return this.type===ke}paddedSize(e=!1){let t=this.visibleSize;return e&&(t=this.totalSize),this.isText||(t+=eh),t}isAncestorOf(e){return rh(this,e)}get nextSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e+1];if(t)return t}get prevSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e-1];if(t)return t}splitText(e,t){const r={data:0,meta:0};if(e===0||e===this.visibleSize)return[void 0,r];const s=this.value.slice(0,e),i=this.value.slice(e);if(!i.length)return[void 0,r];const o=this.getDataSize();this.value=s;const a=this.cloneText(e+t);return a.value=i,this.parent.insertAfterInternal(a,this),Q(r,this.getDataSize(),a.getDataSize()),lt(r,o),[a,r]}get children(){return this._children.filter(e=>!e.isRemoved)}get allChildren(){return[...this._children]}hasTextChild(){return this.children.length>0&&this.children.every(e=>e.isText)}getChildrenText(){return this.isText?this.value:this.hasTextChild()?this.children.map(e=>e.value).join(""):""}append(...e){if(this.isText)throw new f(d.ErrRefused,"Text node cannot have children");this._children.push(...e);for(const t of e)t.parent=this,t.updateAncestorsSize(t.paddedSize()),t.updateAncestorsSize(t.paddedSize(!0),!0)}prepend(...e){if(this.isText)throw new f(d.ErrRefused,"Text node cannot have children");this._children.unshift(...e);for(const t of e)t.parent=this}insertBefore(e,t){if(this.isText)throw new f(d.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new f(d.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r),e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}insertAfter(e,t){if(this.isText)throw new f(d.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new f(d.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r+1),e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}insertAt(e,t){if(this.isText)throw new f(d.ErrRefused,"Text node cannot have children");this.insertAtInternal(e,t),e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}removeChild(e){if(this.isText)throw new f(d.ErrRefused,"Text node cannot have children");const t=this._children.indexOf(e);if(t===-1)throw new f(d.ErrInvalidArgument,"child not found");this._children.splice(t,1),e.updateAncestorsSize(-e.paddedSize(!0),!0),e.parent=void 0}splitElement(e,t){const r={data:0,meta:0},s=this.getDataSize(),i=this.cloneElement(t);this.parent.insertAfterInternal(i,this),i.updateAncestorsSize(i.paddedSize()),i.updateAncestorsSize(i.paddedSize(!0),!0);const o=this.children.slice(0,e),a=this.children.slice(e);this._children=o,i._children=a,this.visibleSize=this._children.reduce((c,u)=>c+u.paddedSize(),0),this.totalSize=this._children.reduce((c,u)=>c+u.paddedSize(!0),0),i.visibleSize=i._children.reduce((c,u)=>c+u.paddedSize(!0),0),i.totalSize=i._children.reduce((c,u)=>c+u.paddedSize(!0),0);for(const c of i._children)c.parent=i;return Q(r,this.getDataSize(),i.getDataSize()),lt(r,s),[i,r]}insertAfterInternal(e,t){if(this.isText)throw new f(d.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new f(d.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r+1)}insertAtInternal(e,t){if(this.isText)throw new f(d.ErrRefused,"Text node cannot have children");this._children.splice(t,0,e),e.parent=this}findOffset(e,t=!1){if(this.isText)throw new f(d.ErrRefused,"Text node cannot have children");if(t)return this._children.indexOf(e);if(e.isRemoved){const r=this._children.indexOf(e);return this.allChildren.splice(0,r).filter(i=>!i.isRemoved).length}return this.children.indexOf(e)}findBranchOffset(e){if(this.isText)throw new f(d.ErrRefused,"Text node cannot have children");let t=e;for(;t;){const r=this._children.indexOf(t);if(r!==-1)return r;t=t.parent}return-1}}function rh(n,e){if(n===e)return!1;for(;e.parent;){if(e.parent===n)return!0;e=e.parent}return!1}var z=(n=>(n.Start="Start",n.End="End",n.Text="Text",n))(z||{});function Ro(n,e,t,r,s=!1){if(e>t)throw new f(d.ErrInvalidArgument,`from is greater than to: ${e} > ${t}`);const i=s?n.totalSize:n.visibleSize;if(e>i)throw new f(d.ErrInvalidArgument,`from is out of range: ${e} > ${i}`);if(t>i)throw new f(d.ErrInvalidArgument,`to is out of range: ${t} > ${i}`);if(e===t)return;let o=0;const a=s?n._children:n.children;for(const c of a){if(e-c.paddedSize(s)<o&&o<t){const u=c.isText?e-o:e-o-1,l=c.isText?t-o:t-o-1,g=s?c.totalSize:c.visibleSize,b=!c.isText&&u<0,m=!c.isText&&l>g;(c.isText||b)&&r([c,c.isText?"Text":"Start"],m),Ro(c,Math.max(0,u),Math.min(l,g),r,s),m&&r([c,"End"],m)}o+=c.paddedSize(s)}}function Co(n,e,t=0){for(const r of n.children)Co(r,e,t+1);e(n,t)}function Vn(n,e,t=0){for(const r of n._children)Vn(r,e,t+1);e(n,t)}function Or(n,e,t=!0){if(e>n.visibleSize)throw new f(d.ErrInvalidArgument,`index is out of range: ${e} > ${n.visibleSize}`);if(n.isText)return{node:n,offset:e};let r=0,s=0;for(const i of n.children){if(t&&i.isText&&i.visibleSize>=e-s)return Or(i,e-s,t);if(e===s)return{node:n,offset:r};if(!t&&i.paddedSize()===e-s)return{node:n,offset:r+1};if(i.paddedSize()>e-s)return Or(i,e-s-1,t);s+=i.paddedSize(),r+=1}return{node:n,offset:r}}function To(n){return n.isText||n.children.length===0?n:To(n.children[0])}function sh(n,e){if(n.visibleSize<e)throw new f(d.ErrInvalidArgument,"unacceptable path");for(let t=0;t<n.children.length;t++){const r=n.children[t];if(r.visibleSize<e)e-=r.visibleSize;else{n=r;break}}return{node:n,offset:e}}class ih{constructor(e){h(this,"root");this.root=e}tokensBetween(e,t,r,s=!1){Ro(this.root,e,t,r,s)}traverse(e){Co(this.root,e,0)}traverseAll(e){Vn(this.root,e,0)}findTreePos(e,t=!0){return Or(this.root,e,t)}treePosToPath(e){const t=[];let r=e.node;if(r.isText){const s=r.parent.findOffset(r);if(s===-1)throw new f(d.ErrInvalidArgument,"invalid treePos");const i=jt(r.parent,s);t.push(i+e.offset),r=r.parent}else if(r.hasTextChild()){const s=jt(r,e.offset);t.push(s)}else t.push(e.offset);for(;r.parent;){const s=r.parent.findOffset(r);if(s===-1)throw new f(d.ErrInvalidArgument,"invalid treePos");t.push(s),r=r.parent}return t.reverse()}pathToIndex(e){const t=this.pathToTreePos(e);return this.indexOf(t)}pathToTreePos(e){if(!e.length)throw new f(d.ErrInvalidArgument,"unacceptable path");let t=this.root;for(let r=0;r<e.length-1;r++){const s=e[r];if(t=t.children[s],!t)throw new f(d.ErrInvalidArgument,"unacceptable path")}if(t.hasTextChild())return sh(t,e[e.length-1]);if(t.children.length<e[e.length-1])throw new f(d.ErrInvalidArgument,"unacceptable path");return{node:t,offset:e[e.length-1]}}getRoot(){return this.root}get size(){return this.root.visibleSize}findPostorderRight(e){const{node:t,offset:r}=e;if(t.isText){if(t.visibleSize===r){const s=t.nextSibling;return s||t.parent}return t}return t.children.length===r?t:To(t.children[r])}indexOf(e,t=!1){let{node:r}=e;const{offset:s}=e;let i=0,o=1;if(r.isText){i+=s;const a=r.parent,c=a.findOffset(r,t);if(c===-1)throw new f(d.ErrInvalidArgument,"invalid pos");i+=jt(a,c,t),r=r.parent}else i+=jt(r,s,t);for(;r!=null&&r.parent;){const a=r.parent,c=a.findOffset(r,t);if(c===-1)throw new f(d.ErrInvalidArgument,"invalid pos");i+=jt(a,c,t),o++,r=r.parent}return i+o-1}indexToPath(e){const t=this.findTreePos(e);return this.treePosToPath(t)}}class we{constructor(e,t){h(this,"parentID");h(this,"leftSiblingID");this.parentID=e,this.leftSiblingID=t}static of(e,t){return new we(e,t)}static fromTreePos(e){const{offset:t}=e;let{node:r}=e,s;return r.isText?(r.parent.children[0]===r&&t===0?s=r.parent:s=r,r=r.parent):t===0?s=r:s=r.children[t-1],we.of(r.id,ee.of(s.getCreatedAt(),s.getOffset()+t))}getParentID(){return this.parentID}static fromStruct(e){return we.of(ee.of(pe.fromStruct(e.parentID.createdAt),e.parentID.offset),ee.of(pe.fromStruct(e.leftSiblingID.createdAt),e.leftSiblingID.offset))}toStruct(){return{parentID:{createdAt:this.getParentID().getCreatedAt().toStruct(),offset:this.getParentID().getOffset()},leftSiblingID:{createdAt:this.getLeftSiblingID().getCreatedAt().toStruct(),offset:this.getLeftSiblingID().getOffset()}}}toTreeNodePair(e){const t=this.getParentID(),r=this.getLeftSiblingID(),s=e.findFloorNode(t);let i=e.findFloorNode(r);if(!s||!i)throw new f(d.ErrRefused,`cannot find node of CRDTTreePos(${t.toTestString()}, ${r.toTestString()})`);return!r.equals(t)&&r.getOffset()>0&&r.getOffset()===i.id.getOffset()&&i.insPrevID&&(i=e.findFloorNode(i.insPrevID)),[s,i]}getLeftSiblingID(){return this.leftSiblingID}equals(e){return this.getParentID().getCreatedAt().equals(e.getParentID().getCreatedAt())&&this.getParentID().getOffset()===e.getParentID().getOffset()&&this.getLeftSiblingID().getCreatedAt().equals(e.getLeftSiblingID().getCreatedAt())&&this.getLeftSiblingID().getOffset()===e.getLeftSiblingID().getOffset()}}class ee{constructor(e,t){h(this,"createdAt");h(this,"offset");this.createdAt=e,this.offset=t}static of(e,t){return new ee(e,t)}static fromStruct(e){return ee.of(pe.fromStruct(e.createdAt),e.offset)}static createComparator(){return(e,t)=>{const r=e.getCreatedAt().compare(t.getCreatedAt());return r!==0?r:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getCreatedAt(){return this.createdAt}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}getOffset(){return this.offset}setOffset(e){this.offset=e}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}toTestString(){return`${this.createdAt.toTestString()}/${this.offset}`}}class he extends nh{constructor(t,r,s,i,o){super(r);h(this,"id");h(this,"removedAt");h(this,"attrs");h(this,"insPrevID");h(this,"insNextID");h(this,"_value","");this.id=t,this.removedAt=o,i&&(this.attrs=i),typeof s=="string"?this.value=s:Array.isArray(s)&&(this._children=s)}toIDString(){return this.id.toIDString()}getRemovedAt(){return this.removedAt}static create(t,r,s,i){return new he(t,r,s,i)}deepcopy(){var r;const t=new he(this.id,this.type);return t.removedAt=this.removedAt,t._value=this._value,t.visibleSize=this.visibleSize,t.totalSize=this.totalSize,t.attrs=(r=this.attrs)==null?void 0:r.deepcopy(),t._children=this._children.map(s=>{const i=s.deepcopy();return i.parent=t,i}),t.insPrevID=this.insPrevID,t.insNextID=this.insNextID,t}get value(){if(!this.isText)throw new f(d.ErrInvalidType,`cannot get value of element node: ${this.type}`);return this._value}set value(t){if(!this.isText)throw new f(d.ErrInvalidType,`cannot set value of element node: ${this.type}`);this._value=t,this.visibleSize=t.length,this.totalSize=t.length}get isRemoved(){return!!this.removedAt}remove(t){return this.removedAt?(t.after(this.removedAt)&&(this.removedAt=t),!1):(this.removedAt=t,this.updateAncestorsSize(-this.paddedSize()),!0)}cloneText(t){return new he(ee.of(this.id.getCreatedAt(),t),this.type,void 0,void 0,this.removedAt)}cloneElement(t){return new he(ee.of(t(),0),this.type,void 0,void 0,this.removedAt)}split(t,r,s){const[i,o]=this.isText?this.splitText(r,this.id.getOffset()):this.splitElement(r,s);if(i){if(i.insPrevID=this.id,this.insNextID){const a=t.findFloorNode(this.insNextID);a.insPrevID=i.id,i.insNextID=this.insNextID}this.insNextID=i.id,t.registerNode(i)}return[i,o]}getCreatedAt(){return this.id.getCreatedAt()}getOffset(){return this.id.getOffset()}canDelete(t,r,s){return r?!!(!this.removedAt||!s&&(t!=null&&t.after(this.removedAt))):!1}canStyle(t,r){return this.isText?!1:this.getCreatedAt().getLamport()<=r&&(!this.removedAt||t.after(this.removedAt))}setAttrs(t,r){this.attrs||(this.attrs=new Fe);const s=[];for(const[i,o]of Object.entries(t))s.push(this.attrs.set(i,o,r));return s}purge(t){this.attrs&&this.attrs.purge(t)}getDataSize(){const t={data:0,meta:0};if(this.isText&&(t.data+=this.visibleSize*2),this.id&&(t.meta+=xe),this.removedAt&&(t.meta+=xe),this.attrs)for(const r of this.attrs){if(r.getRemovedAt())continue;const s=r.getDataSize();t.meta+=s.meta,t.data+=s.data}return t}getGCPairs(){const t=[];if(!this.attrs)return t;for(const r of this.attrs)r.getRemovedAt()&&t.push({parent:this,child:r});return t}}function Pr(n){var t;if(n.isText){const r=n;return{type:r.type,value:r.value}}const e={type:n.type,children:n.children.map(Pr)};return n.attrs&&(e.attributes=Ke((t=n.attrs)==null?void 0:t.toObject())),e}function Zr(n){if(n.isText)return n.value;let e="";return n.attrs&&n.attrs.size()&&(e=" "+Array.from(n.attrs).filter(t=>!t.isRemoved()).sort((t,r)=>t.getKey().localeCompare(r.getKey())).map(t=>{const r=JSON.parse(t.getValue());return typeof r=="string"?`${t.getKey()}="${r}"`:`${t.getKey()}="${Le(t.getValue())}"`}).join(" ")),`<${n.type}${e}>${n.children.map(t=>Zr(t)).join("")}</${n.type}>`}function Vo(n){if(n.isText){const e=n;return{type:e.type,value:e.value,visibleSize:e.visibleSize,isRemoved:e.isRemoved}}return{type:n.type,children:n.children.map(Vo),visibleSize:n.visibleSize,isRemoved:n.isRemoved}}class de extends Xt{constructor(t,r){super(r);h(this,"indexTree");h(this,"nodeMapByID");this.indexTree=new ih(t),this.nodeMapByID=new Eo(ee.createComparator()),this.indexTree.traverseAll(s=>{this.nodeMapByID.put(s.id,s)})}static create(t,r){return new de(t,r)}findFloorNode(t){const r=this.nodeMapByID.floorEntry(t);if(!(!r||!r.key.getCreatedAt().equals(t.getCreatedAt())))return r.value}registerNode(t){this.nodeMapByID.put(t.id,t)}findNodesAndSplitText(t,r){let s={data:0,meta:0};const[i,o]=t.toTreeNodePair(this);let a=o;const c=i===a,u=a.parent&&!c?a.parent:i;if(a.isText){const[,l]=a.split(this,t.getLeftSiblingID().getOffset()-a.id.getOffset());s=l}if(r){const l=u.allChildren,g=c?0:l.indexOf(a)+1;for(let b=g;b<l.length;b++){const m=l[b];if(!m.id.getCreatedAt().after(r))break;a=m}}return[[u,a],s]}style(t,r,s,i){const o={data:0,meta:0},[[a,c],u]=this.findNodesAndSplitText(t[0],s),[[l,g],b]=this.findNodesAndSplitText(t[1],s);Q(o,b,u);const m=[],y=r?Ke(r):{},A=[];return this.traverseInPosRange(a,c,l,g,([I,E])=>{var O;const C=I.getCreatedAt().getActorID();let k=wn;if(i!=null&&(k=i.get(C)?i.get(C):0n),I.canStyle(s,k)&&r){const U=I.setAttrs(r,s),V=U.reduce((j,[,Ve])=>(Ve&&(j[Ve.getKey()]=y[Ve.getKey()]),j),{}),F=I.parent,_=I.prevSibling||I.parent;Object.keys(V).length>0&&m.push({type:"style",from:this.toIndex(F,_),to:this.toIndex(I,I),fromPath:this.toPath(F,_),toPath:this.toPath(I,I),actor:s.getActorID(),value:V});for(const[j]of U)j&&A.push({parent:I,child:j});for(const[j]of Object.entries(y)){const Ve=(O=I.attrs)==null?void 0:O.getNodeMapByKey().get(j);Ve!==void 0&&E!==z.End&&Q(o,Ve.getDataSize())}}}),[A,m,o]}removeStyle(t,r,s,i){const o={data:0,meta:0},[[a,c],u]=this.findNodesAndSplitText(t[0],s),[[l,g],b]=this.findNodesAndSplitText(t[1],s);Q(o,b,u);const m=[],y=[];return this.traverseInPosRange(a,c,l,g,([A])=>{const I=A.getCreatedAt().getActorID();let E=wn;if(i!=null&&(E=i.get(I)?i.get(I):0n),A.canStyle(s,E)&&r){A.attrs||(A.attrs=new Fe);for(const O of r){const U=A.attrs.remove(O,s);for(const V of U)y.push({parent:A,child:V})}const C=A.parent,k=A.prevSibling||A.parent;m.push({actor:s.getActorID(),type:"removeStyle",from:this.toIndex(C,k),to:this.toIndex(A,A),fromPath:this.toPath(C,k),toPath:this.toPath(A,A),value:r})}}),[y,m,o]}edit(t,r,s,i,o,a){const c={data:0,meta:0},[[u,l],g]=this.findNodesAndSplitText(t[0],i),[[b,m],y]=this.findNodesAndSplitText(t[1],i);Q(c,y,g);const A=this.toIndex(u,l),I=this.toPath(u,l),E=[],C=[],k=[];this.traverseInPosRange(u,l,b,m,([V,F],_)=>{if(F===z.Start&&!_)for(const Jn of V.children)k.push(Jn);const j=a===void 0;let Ve=!1;const Ra=a==null?void 0:a.get(V.id.getCreatedAt().getActorID());Ve=j||Ra!==void 0&&Ra>=V.id.getCreatedAt().getLamport();let Ca=!1;if(V.removedAt){const Jn=a==null?void 0:a.get(V.removedAt.getActorID());Ca=j||Jn!==void 0&&Jn>=V.removedAt.getLamport()}(V.canDelete(i,Ve,Ca)||E.includes(V.parent))&&((F===z.Text||F===z.Start)&&E.push(V),C.push([V,F]))},!0);const O=this.makeDeletionChanges(C,i),U=[];for(const V of E)V.remove(i),V.isRemoved&&U.push({parent:this,child:V});for(const V of k)V.removedAt||u.append(V);if(s>0){let V=0,F=u,_=l;for(;V<s;)F.split(this,F.findOffset(_)+1,o),_=F,F=F.parent,V++;O.push({type:"content",from:A,to:A,fromPath:I,toPath:I,actor:i.getActorID()})}if(r!=null&&r.length){const V=[];let F=l;for(const _ of r)F===u?u.insertAt(_,0):u.insertAfter(_,F),F=_,Vn(_,j=>{u.isRemoved?(j.remove(i),U.push({parent:this,child:j})):Q(c,j.getDataSize()),this.nodeMapByID.put(j.id,j)}),_.isRemoved||V.push(_);if(V.length){const _=V.map(j=>Pr(j));O.length&&O[O.length-1].from===A?O[O.length-1].value=_:O.push({type:"content",from:A,to:A,fromPath:I,toPath:I,actor:i.getActorID(),value:_})}}return[O,U,c]}editT(t,r,s,i,o){const a=this.findPos(t[0]),c=this.findPos(t[1]);return this.edit([a,c],r,s,i,o)}move(t,r,s){throw new f(d.ErrUnimplemented,`not implemented: ${t}, ${r}, ${s}`)}pathToTreePos(t){return this.indexTree.pathToTreePos(t)}purge(t){var i;(i=t.parent)==null||i.removeChild(t),this.nodeMapByID.remove(t.id);const r=t.insPrevID,s=t.insNextID;if(r){const o=this.findFloorNode(r);o.insNextID=s}if(s){const o=this.findFloorNode(s);o.insPrevID=r}t.insPrevID=void 0,t.insNextID=void 0}getGCPairs(){const t=[];return this.indexTree.traverse(r=>{r.getRemovedAt()&&t.push({parent:this,child:r});for(const s of r.getGCPairs())t.push(s)}),t}findPos(t,r=!0){const s=this.indexTree.findTreePos(t,r);return we.fromTreePos(s)}pathToPosRange(t){const r=this.pathToIndex(t);return[this.findPos(r),this.findPos(r+1)]}pathToPos(t){const r=this.indexTree.pathToIndex(t);return this.findPos(r)}getRoot(){return this.indexTree.getRoot()}getSize(){return this.indexTree.size}getNodeSize(){return this.nodeMapByID.size()}getIndexTree(){return this.indexTree}toXML(){return Zr(this.indexTree.getRoot())}getDataSize(){const t={data:0,meta:0};return this.indexTree.traverse(r=>{if(r.getRemovedAt())return;const s=r.getDataSize();t.data+=s.data,t.meta+=s.meta}),{data:t.data,meta:t.meta+this.getMetaUsage()}}toJSON(){return JSON.stringify(this.getRootTreeNode())}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TREE"}}toJSInfoForTest(){const t=this.indexTree.getRoot(),r=(s,i=void 0,o=void 0,a=0)=>{var m,y,A,I;let c,u,l;const g=s.isText?{node:s,offset:0}:i&&o?this.toTreePos(i,o):null;g&&(c=this.indexTree.indexOf(g),u=this.indexTree.treePosToPath(g),l=we.fromTreePos(g).toStruct());const b={type:s.type,parent:i==null?void 0:i.id.toTestString(),size:s.visibleSize,id:s.id.toTestString(),removedAt:(m=s.removedAt)==null?void 0:m.toTestString(),insPrev:(y=s.insPrevID)==null?void 0:y.toTestString(),insNext:(A=s.insNextID)==null?void 0:A.toTestString(),value:s.isText?s.value:void 0,isRemoved:s.isRemoved,children:[],depth:a,attributes:s.attrs?Ke((I=s.attrs)==null?void 0:I.toObject()):void 0,index:c,path:u,pos:l};for(let E=0;E<s.allChildren.length;E++){const C=E===0?s:s.allChildren[E-1];b.children.push(r(s.allChildren[E],s,C,a+1))}return b};return r(t)}getRootTreeNode(){return Pr(this.indexTree.getRoot())}toTestTreeNode(){return Vo(this.indexTree.getRoot())}toSortedJSON(){return this.toJSON()}deepcopy(){const t=this.getRoot(),r=new de(t.deepcopy(),this.getCreatedAt());return r.setRemovedAt(this.getRemovedAt()),r.setMovedAt(this.getMovedAt()),r}toPath(t,r){const s=this.toTreePos(t,r);return s?this.indexTree.treePosToPath(s):[]}toIndex(t,r,s=!1){const i=this.toTreePos(t,r,s);return i?this.indexTree.indexOf(i,s):-1}indexToPath(t){return this.indexTree.indexToPath(t)}pathToIndex(t){return this.indexTree.pathToIndex(t)}indexRangeToPosRange(t){const r=this.findPos(t[0]);return t[0]===t[1]?[r,r]:[r,this.findPos(t[1])]}indexRangeToPosStructRange(t){const[r,s]=t,i=this.findPos(r);return r===s?[i.toStruct(),i.toStruct()]:[i.toStruct(),this.findPos(s).toStruct()]}posRangeToPathRange(t){const[[r,s]]=this.findNodesAndSplitText(t[0]),[[i,o]]=this.findNodesAndSplitText(t[1]);return[this.toPath(r,s),this.toPath(i,o)]}posRangeToIndexRange(t){const[[r,s]]=this.findNodesAndSplitText(t[0]),[[i,o]]=this.findNodesAndSplitText(t[1]);return[this.toIndex(r,s),this.toIndex(i,o)]}traverseInPosRange(t,r,s,i,o,a=!1){const c=this.toIndex(t,r,a),u=this.toIndex(s,i,a);this.indexTree.tokensBetween(c,u,o,a)}toTreePos(t,r,s=!1){if(!t||!r)return;if(!s&&t.isRemoved){let o;for(;t.isRemoved;)o=t,t=o.parent;const a=t.findOffset(o,s);return{node:t,offset:a}}if(t===r)return{node:t,offset:0};let i=t.findOffset(r,s);if(s||!r.isRemoved){if(r.isText)return{node:r,offset:r.paddedSize(s)};i++}return{node:t,offset:i}}makeDeletionChanges(t,r){const s=[],i=[];let o=null,a=null;for(let c=0;c<t.length;c++){const u=t[c],l=t[c+1];o||(o=u),a=u;const g=this.findRightToken(u);(!g||!l||g[0]!==l[0]||g[1]!==l[1])&&(i.push([o,a]),o=null,a=null)}for(const c of i){const[u,l]=c,[g,b]=this.findLeftToken(u),[m,y]=l,A=b===z.Start?g:g.parent,I=y===z.Start?m:m.parent,E=this.toIndex(A,g),C=this.toIndex(I,m);E<C&&(s.length>0&&E===s[s.length-1].to?(s[s.length-1].to=C,s[s.length-1].toPath=this.toPath(I,m)):s.push({type:"content",from:E,to:C,fromPath:this.toPath(A,g),toPath:this.toPath(I,m),actor:r.getActorID()}))}return s.reverse()}findRightToken([t,r]){if(r===z.Start){const c=t.allChildren;return c.length>0?[c[0],c[0].isText?z.Text:z.Start]:[t,z.End]}const s=t.parent,i=s.allChildren,o=i.indexOf(t);if(s&&o===i.length-1)return[s,z.End];const a=i[o+1];return[a,a.isText?z.Text:z.Start]}findLeftToken([t,r]){if(r===z.End){const c=t.allChildren;if(c.length>0){const u=c[c.length-1];return[u,u.isText?z.Text:z.End]}return[t,z.Start]}const s=t.parent,i=s.allChildren,o=i.indexOf(t);if(s&&o===0)return[s,z.Start];const a=i[o-1];return[a,a.isText?z.Text:z.End]}}class Qt extends Se{constructor(t,r,s,i,o,a){super(t,a);h(this,"fromPos");h(this,"toPos");h(this,"contents");h(this,"splitLevel");this.fromPos=r,this.toPos=s,this.contents=i,this.splitLevel=o}static create(t,r,s,i,o,a){return new Qt(t,r,s,i,o,a)}execute(t,r,s){var g;const i=t.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof de))throw new f(d.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const o=this.getExecutedAt(),a=i,[c,u,l]=a.edit([this.fromPos,this.toPos],(g=this.contents)==null?void 0:g.map(b=>b.deepcopy()),this.splitLevel,o,(()=>{let b=o.getDelimiter();return this.contents!==void 0&&(b+=this.contents.length),()=>pe.of(o.getLamport(),++b,o.getActorID())})(),s);t.acc(l);for(const b of u)t.registerGCPair(b);return{opInfos:c.map(({from:b,to:m,value:y,splitLevel:A,fromPath:I,toPath:E})=>({type:"tree-edit",path:t.createPath(this.getParentCreatedAt()),from:b,to:m,value:y,splitLevel:A,fromPath:I,toPath:E}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const t=this.getParentCreatedAt().toTestString(),r=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.fromPos.getLeftSiblingID().getOffset()}`,s=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.toPos.getLeftSiblingID().getOffset()}`,i=this.contents||[];return`${t}.EDIT(${r},${s},${i.map(o=>Zr(o)).join("")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContents(){return this.contents}getSplitLevel(){return this.splitLevel}}class Rt{constructor(e){h(this,"vector");this.vector=e||new Map}set(e,t){this.vector.set(e,t)}unset(e){this.vector.delete(e)}get(e){return this.vector.get(e)}has(e){return this.vector.has(e)}maxLamport(){let e=BigInt(0);for(const[,t]of this)t>e&&(e=t);return e}max(e){const t=new Map;for(const[r,s]of e){const i=this.vector.get(r),o=i&&i>s?i:s;t.set(r,o)}for(const[r,s]of this){const i=e.get(r),o=i&&i>s?i:s;t.set(r,o)}return new Rt(t)}afterOrEqual(e){const t=this.vector.get(e.getActorID());return t===void 0?!1:t>=e.getLamport()}deepcopy(){const e=new Map;for(const[t,r]of this.vector)e.set(t,r);return new Rt(e)}filter(e){const t=new Map;for(const[r]of e){const s=this.vector.get(r);s!==void 0&&t.set(r,s)}return new Rt(t)}size(){return this.vector.size}*[Symbol.iterator](){for(const[e,t]of this.vector)yield[e,t]}}const Do=new Rt(new Map);class Re{constructor(e,t,r,s,i){h(this,"clientSeq");h(this,"serverSeq");h(this,"actor");h(this,"lamport");h(this,"versionVector");this.clientSeq=e,this.serverSeq=i,this.lamport=t,this.versionVector=s,this.actor=r}hasClocks(){return this.versionVector.size()>0&&this.lamport!=Br}static of(e,t,r,s,i){return new Re(e,t,r,s,i)}next(e=!1){if(e)return new Re(this.clientSeq+1,this.lamport,this.actor,Do,Br);const t=this.versionVector.deepcopy();return t.set(this.actor,this.lamport+1n),new Re(this.clientSeq+1,this.lamport+1n,this.actor,t)}syncClocks(e){if(!e.hasClocks())return this;const t=e.lamport>this.lamport?e.lamport+1n:this.lamport+1n,r=this.versionVector.max(e.versionVector),s=new Re(this.clientSeq,t,this.actor,r);return s.versionVector.set(this.actor,t),s}setClocks(e,t){const r=e>this.lamport?e+1n:this.lamport+1n,s=this.versionVector.max(t);return s.set(this.actor,r),Re.of(this.clientSeq,r,this.actor,s)}createTimeTicket(e){return pe.of(this.lamport,e,this.actor)}setActor(e){return new Re(this.clientSeq,this.lamport,e,this.versionVector,this.serverSeq)}setLamport(e){return new Re(this.clientSeq,e,this.actor,this.versionVector,this.serverSeq)}setVersionVector(e){return new Re(this.clientSeq,this.lamport,this.actor,e,this.serverSeq)}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq?this.serverSeq.toString():""}getLamport(){return this.lamport}getLamportAsString(){return this.lamport.toString()}getActorID(){return this.actor}getVersionVector(){return this.versionVector}toTestString(){return`${this.lamport.toString()}:${this.actor.slice(-2)}:${this.clientSeq}`}}const oh=new Re(0,0n,Lr,Do);class Ct{constructor({id:e,operations:t,presenceChange:r,message:s}){h(this,"id");h(this,"operations");h(this,"presenceChange");h(this,"message");this.id=e,this.operations=t||[],this.presenceChange=r,this.message=s}static create({id:e,operations:t,presenceChange:r,message:s}){return new Ct({id:e,operations:t,presenceChange:r,message:s})}getID(){return this.id}getMessage(){return this.message}hasOperations(){return this.operations.length>0}getOperations(){return this.operations}setActor(e){for(const t of this.operations)t.setActor(e);this.id=this.id.setActor(e)}hasPresenceChange(){return this.presenceChange!==void 0}getPresenceChange(){return this.presenceChange}execute(e,t,r){const s=[],i=[],o=[];for(const a of this.operations){const c=a.execute(e,r,this.id.getVersionVector());if(!c)continue;const{opInfos:u,reverseOp:l}=c;s.push(...u),i.push(a),l&&o.unshift(l)}return this.presenceChange&&(this.presenceChange.type===De.Put?t.set(this.id.getActorID(),Ne(this.presenceChange.presence)):t.delete(this.id.getActorID())),{operations:i,opInfos:s,reverseOps:o}}toTestString(){return`${this.operations.map(e=>e.toTestString()).join(",")}`}toStruct(){return{changeID:K.bytesToHex(K.changeIDToBinary(this.getID())),message:this.getMessage(),operations:this.getOperations().map(e=>K.bytesToHex(K.operationToBinary(e))),presenceChange:this.getPresenceChange()}}static fromStruct(e){const{changeID:t,operations:r,presenceChange:s,message:i}=e;return Ct.create({id:K.bytesToChangeID(K.hexToBytes(t)),operations:r==null?void 0:r.map(o=>K.bytesToOperation(K.hexToBytes(o))),presenceChange:s,message:i})}}class Dn{constructor(e,t,r,s,i,o){h(this,"documentKey");h(this,"checkpoint");h(this,"isRemoved");h(this,"changes");h(this,"snapshot");h(this,"versionVector");this.documentKey=e,this.checkpoint=t,this.isRemoved=r,this.changes=s,this.snapshot=o,this.versionVector=i}static create(e,t,r,s,i,o){return new Dn(e,t,r,s,i,o)}getDocumentKey(){return this.documentKey}getCheckpoint(){return this.checkpoint}getIsRemoved(){return this.isRemoved}getChanges(){return this.changes}hasChanges(){return this.changes.length>0}getChangeSize(){return this.changes.length}hasSnapshot(){return!!this.snapshot&&!!this.snapshot.length}getSnapshot(){return this.snapshot}getVersionVector(){return this.versionVector}}class Tt{constructor(e,t){h(this,"serverSeq");h(this,"clientSeq");this.serverSeq=e,this.clientSeq=t}static of(e,t){return new Tt(e,t)}increaseClientSeq(e){return e===0?this:new Tt(this.serverSeq,this.clientSeq+e)}forward(e){if(this.equals(e))return this;const t=this.serverSeq>e.serverSeq?this.serverSeq:e.serverSeq,r=Math.max(this.clientSeq,e.clientSeq);return Tt.of(t,r)}getServerSeqAsString(){return this.serverSeq.toString()}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq}equals(e){return this.clientSeq===e.clientSeq&&this.serverSeq==e.serverSeq}toTestString(){return`serverSeq=${this.serverSeq}, clientSeq=${this.clientSeq}`}}const ah=new Tt(0n,0),xo=n=>n<0?Math.ceil(n):Math.floor(n);var Oe=(n=>(n[n.Int=0]="Int",n[n.Long=1]="Long",n))(Oe||{});class ue extends Xt{constructor(t,r,s){super(s);h(this,"valueType");h(this,"value");switch(this.valueType=t,t){case 0:typeof r=="number"?r>Math.pow(2,31)-1||r<-Math.pow(2,31)?this.value=B.fromNumber(r).toInt():this.value=xo(r):this.value=r.toInt();break;case 1:typeof r=="number"?this.value=B.fromNumber(r):this.value=r;break;default:throw new f(d.ErrUnimplemented,`unimplemented type: ${t}`)}}static create(t,r,s){return new ue(t,r,s)}static valueFromBytes(t,r){switch(t){case 0:return r[0]|r[1]<<8|r[2]<<16|r[3]<<24;case 1:return B.fromBytesLE(Array.from(r));default:throw new f(d.ErrUnimplemented,`unimplemented type: ${t}`)}}getDataSize(){return{data:this.valueType===0?4:8,meta:this.getMetaUsage()}}toJSON(){return`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_COUNTER"}}deepcopy(){const t=ue.create(this.valueType,this.value,this.getCreatedAt());return t.setRemovedAt(this.getRemovedAt()),t.setMovedAt(this.getMovedAt()),t}getType(){return this.valueType}static getCounterType(t){switch(typeof t){case"object":return t instanceof B?1:void 0;case"number":return t>Math.pow(2,31)-1||t<-Math.pow(2,31)?1:0;default:return}}static isSupport(t){return!!ue.getCounterType(t)}static isInteger(t){return t%1===0}isNumericType(){const t=this.valueType;return t===0||t===1}getValueType(){return this.valueType}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:{const t=this.value;return new Uint8Array([t&255,t>>8&255,t>>16&255,t>>24&255])}case 1:{const r=this.value.toBytesLE();return Uint8Array.from(r)}default:throw new f(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}increase(t){function r(s){if(!s.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof s.getValue()}`)}return r(this),r(t),this.valueType===1?this.value=this.value.add(t.getValue()):t.getType()===G.Long?this.value=this.value+t.getValue().toInt():this.value=B.fromNumber(this.value+xo(t.getValue())).toInt(),this}}class Vt extends Se{constructor(t,r,s){super(t,s);h(this,"value");this.value=r}static create(t,r,s){return new Vt(t,r,s)}execute(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof ue))throw new f(d.ErrInvalidArgument,"fail to execute, only Counter can execute increase");const s=r,i=this.value.deepcopy();return s.increase(i),{opInfos:[{type:"increase",path:t.createPath(this.getParentCreatedAt()),value:i.getValue()}],reverseOp:this.toReverseOperation()}}toReverseOperation(){const t=this.value.deepcopy(),s=t.getType()===G.Long?t.getValue().multiply(-1):t.getValue()*-1;return Vt.create(this.getParentCreatedAt(),X.of(s,t.getCreatedAt()))}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.INCREASE.${this.value.toJSON()}`}getValue(){return this.value}}class Je extends Se{constructor(t,r,s,i,o,a){super(t,a);h(this,"fromPos");h(this,"toPos");h(this,"attributes");h(this,"attributesToRemove");this.fromPos=r,this.toPos=s,this.attributes=i,this.attributesToRemove=o}static create(t,r,s,i,o){return new Je(t,r,s,i,[],o)}static createTreeRemoveStyleOperation(t,r,s,i,o){return new Je(t,r,s,new Map,i,o)}execute(t,r,s){const i=t.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof de))throw new f(d.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const o=i;let a,c,u={data:0,meta:0};if(this.attributes.size){const l={};[...this.attributes].forEach(([g,b])=>l[g]=b),[c,a,u]=o.style([this.fromPos,this.toPos],l,this.getExecutedAt(),s)}else{const l=this.attributesToRemove;[c,a,u]=o.removeStyle([this.fromPos,this.toPos],l,this.getExecutedAt(),s)}t.acc(u);for(const l of c)t.registerGCPair(l);return{opInfos:a.map(({from:l,to:g,value:b,fromPath:m,toPath:y})=>({type:"tree-style",from:l,to:g,value:this.attributes.size?{attributes:b}:{attributesToRemove:b},fromPath:m,toPath:y,path:t.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const t=this.getParentCreatedAt().toTestString(),r=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.fromPos.getLeftSiblingID().getOffset()}`,s=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.toPos.getLeftSiblingID().getOffset()}`;return`${t}.STYLE(${r},${s},${Object.entries(this.attributes||{}).map(([i,o])=>`${i}:"${o}"`).join(" ")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}}class Xe extends Se{constructor(t,r,s,i){super(t,i);h(this,"createdAt");h(this,"value");this.createdAt=r,this.value=s}static create(t,r,s,i){return new Xe(t,r,s,i)}execute(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new f(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof re))throw new f(d.ErrInvalidArgument,"fail to execute, only array can execute set");const s=r.getByID(this.createdAt).deepcopy(),i=this.toReverseOperation(this.value,s),o=this.value.deepcopy();return r.insertAfter(this.createdAt,o,this.getExecutedAt()),r.delete(this.createdAt,this.getExecutedAt()),t.registerElement(o),{opInfos:[{type:"array-set",path:t.createPath(this.getParentCreatedAt())}],reverseOp:i}}toReverseOperation(t,r){return Xe.create(this.getParentCreatedAt(),t.getCreatedAt(),r)}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ARRAY_SET.${this.createdAt.toTestString()}=${this.value.toSortedJSON()}`}getCreatedAt(){return this.createdAt}getValue(){return this.value}setCreatedAt(t){this.createdAt=t}}function ch(n){const e={};for(const[t,r]of Object.entries(n))e[t]=JSON.stringify(r);return N(Gl,{data:e})}function uh(n){if(n.type===De.Put)return N(uo,{type:Jt.PUT,presence:ch(n.presence)});if(n.type===De.Clear)return N(uo,{type:Jt.CLEAR});throw new f(d.ErrUnimplemented,"unimplemented type")}function lh(n){return N(Fl,{serverSeq:n.getServerSeq(),clientSeq:n.getClientSeq()})}function Ur(n){return N(Vr,{clientSeq:n.getClientSeq(),lamport:n.getLamport(),actorId:Zn(n.getActorID()),versionVector:Yr(n.getVersionVector())})}function w(n){if(n)return N(Ml,{lamport:n.getLamport(),delimiter:n.getDelimiter(),actorId:Zn(n.getActorID())})}function Yr(n){if(!n)return;const e=N(Dr);for(const[t,r]of n){const s=_h(Zn(t));e.vector[s]=BigInt(r.toString())}return e}function Lo(n){switch(n){case G.Null:return x.NULL;case G.Boolean:return x.BOOLEAN;case G.Integer:return x.INTEGER;case G.Long:return x.LONG;case G.Double:return x.DOUBLE;case G.String:return x.STRING;case G.Bytes:return x.BYTES;case G.Date:return x.DATE;default:throw new f(d.ErrInvalidType,`unsupported type: ${n}`)}}function Bo(n){switch(n){case Oe.Int:return x.INTEGER_CNT;case Oe.Long:return x.LONG_CNT;default:throw new f(d.ErrInvalidType,`unsupported type: ${n}`)}}function xn(n){if(n instanceof te)return N(At,{type:x.JSON_OBJECT,createdAt:w(n.getCreatedAt()),value:Jo(n)});if(n instanceof re)return N(At,{type:x.JSON_ARRAY,createdAt:w(n.getCreatedAt()),value:Kh(n)});if(n instanceof ce)return N(At,{type:x.TEXT,createdAt:w(n.getCreatedAt())});if(n instanceof X)return N(At,{type:Lo(n.getType()),createdAt:w(n.getCreatedAt()),value:n.toBytes()});if(n instanceof ue)return N(At,{type:Bo(n.getType()),createdAt:w(n.getCreatedAt()),value:n.toBytes()});if(n instanceof de)return N(At,{type:x.TREE,createdAt:w(n.getCreatedAt()),value:Jh(n)});throw new f(d.ErrUnimplemented,"unimplemented element")}function hh(n){return N(Ol,{createdAt:w(n.getCreatedAt()),offset:n.getOffset()})}function Ln(n){return N(Kl,{createdAt:w(n.getID().getCreatedAt()),offset:n.getID().getOffset(),relativeOffset:n.getRelativeOffset()})}function Bn(n){return N(Yl,{parentId:Ht(n.getParentID()),leftSiblingId:Ht(n.getLeftSiblingID())})}function Ht(n){return N(Ul,{createdAt:w(n.getCreatedAt()),offset:n.getOffset()})}function Gr(n){const e=N(xr);if(n instanceof ut){const t=n,r=N(bl);r.parentCreatedAt=w(t.getParentCreatedAt()),r.key=t.getKey(),r.value=xn(t.getValue()),r.executedAt=w(t.getExecutedAt()),e.body.case="set",e.body.value=r}else if(n instanceof Qe){const t=n,r=N(yl);r.parentCreatedAt=w(t.getParentCreatedAt()),r.prevCreatedAt=w(t.getPrevCreatedAt()),r.value=xn(t.getValue()),r.executedAt=w(t.getExecutedAt()),e.body.case="add",e.body.value=r}else if(n instanceof Ee){const t=n,r=N(Al);r.parentCreatedAt=w(t.getParentCreatedAt()),r.prevCreatedAt=w(t.getPrevCreatedAt()),r.createdAt=w(t.getCreatedAt()),r.executedAt=w(t.getExecutedAt()),e.body.case="move",e.body.value=r}else if(n instanceof Be){const t=n,r=N(vl);r.parentCreatedAt=w(t.getParentCreatedAt()),r.createdAt=w(t.getCreatedAt()),r.executedAt=w(t.getExecutedAt()),e.body.case="remove",e.body.value=r}else if(n instanceof et){const t=n,r=N(Sl);r.parentCreatedAt=w(t.getParentCreatedAt()),r.from=Ln(t.getFromPos()),r.to=Ln(t.getToPos()),r.content=t.getContent();const s=r.attributes;for(const[i,o]of t.getAttributes())s[i]=o;r.executedAt=w(t.getExecutedAt()),e.body.case="edit",e.body.value=r}else if(n instanceof Me){const t=n,r=N(Il);r.parentCreatedAt=w(t.getParentCreatedAt()),r.from=Ln(t.getFromPos()),r.to=Ln(t.getToPos());const s=t.getAttributesToRemove();s.length>0&&(r.attributesToRemove=s);const i=r.attributes;for(const[o,a]of t.getAttributes())i[o]=a;r.executedAt=w(t.getExecutedAt()),e.body.case="style",e.body.value=r}else if(n instanceof Vt){const t=n,r=N(El);r.parentCreatedAt=w(t.getParentCreatedAt()),r.value=xn(t.getValue()),r.executedAt=w(t.getExecutedAt()),e.body.case="increase",e.body.value=r}else if(n instanceof Qt){const t=n,r=N(Nl);r.parentCreatedAt=w(t.getParentCreatedAt()),r.from=Bn(t.getFromPos()),r.to=Bn(t.getToPos()),r.contents=yh(t.getContents()),r.splitLevel=t.getSplitLevel(),r.executedAt=w(t.getExecutedAt()),e.body.case="treeEdit",e.body.value=r}else if(n instanceof Je){const t=n,r=N(wl);r.parentCreatedAt=w(t.getParentCreatedAt()),r.from=Bn(t.getFromPos()),r.to=Bn(t.getToPos());const s=t.getAttributesToRemove();if(s.length>0)r.attributesToRemove=s;else{const i=r.attributes;for(const[o,a]of t.getAttributes())i[o]=a}r.executedAt=w(t.getExecutedAt()),e.body.case="treeStyle",e.body.value=r}else if(n instanceof Xe){const t=n,r=N(Rl);r.parentCreatedAt=w(t.getParentCreatedAt()),r.createdAt=w(t.getCreatedAt()),r.value=xn(t.getValue()),r.executedAt=w(t.getExecutedAt()),e.body.case="arraySet",e.body.value=r}else throw new f(d.ErrUnimplemented,"unimplemented operation");return e}function dh(n){const e=[];for(const t of n)e.push(Gr(t));return e}function fh(n){const e=N(pl,{id:Ur(n.getID()),message:n.getMessage()});return n.hasOperations()&&(e.operations=dh(n.getOperations())),n.hasPresenceChange()&&(e.presenceChange=uh(n.getPresenceChange())),e}function gh(n){const e=[];for(const t of n)e.push(fh(t));return e}function mh(n){const e=[];for(const t of n)e.push(N(Bl,{key:t.getStrKey(),element:Kr(t.getValue())}));return e}function ph(n){const e=[];for(const t of n)e.push(N(Wl,{element:Kr(t.getValue())}));return e}function bh(n){const e=[];for(const t of n){const r=N(kl);r.id=hh(t.getID()),r.value=t.getValue().getContent(),r.removedAt=w(t.getRemovedAt());const s=r.attributes,i=t.getValue().getAttrs();for(const o of i){const a=N(co);a.value=o.getValue(),a.updatedAt=w(o.getUpdatedAt()),s[o.getKey()]=a}e.push(r)}return e}function yh(n){const e=[];if(!n||!n.length)return e;for(const t of n)e.push(N(Zl,{content:Fr(t)}));return e}function Ah(n){const e={};for(const t of n)e[t.getKey()]=N(co,{value:t.getValue(),updatedAt:w(t.getUpdatedAt()),isRemoved:t.isRemoved()});return e}function Fr(n){if(!n)return[];const e=[];return Vn(n,(t,r)=>{const s=N(Pl,{id:Ht(t.id),type:t.type,removedAt:w(t.removedAt),depth:r});t.isText&&(s.value=t.value),t.insPrevID&&(s.insPrevId=Ht(t.insPrevID)),t.insNextID&&(s.insNextId=Ht(t.insNextID)),t.attrs&&(s.attributes=Ah(t.attrs)),e.push(s)}),e}function vh(n){return N(me,{body:{case:"jsonObject",value:N(Cl,{nodes:mh(n.getRHT()),createdAt:w(n.getCreatedAt()),movedAt:w(n.getMovedAt()),removedAt:w(n.getRemovedAt())})}})}function Wo(n){return N(me,{body:{case:"jsonArray",value:N(Tl,{nodes:ph(n.getElements()),createdAt:w(n.getCreatedAt()),movedAt:w(n.getMovedAt()),removedAt:w(n.getRemovedAt())})}})}function Sh(n){return N(me,{body:{case:"primitive",value:N(Vl,{type:Lo(n.getType()),value:n.toBytes(),createdAt:w(n.getCreatedAt()),movedAt:w(n.getMovedAt()),removedAt:w(n.getRemovedAt())})}})}function Ih(n){return N(me,{body:{case:"text",value:N(Dl,{nodes:bh(n.getRGATreeSplit()),createdAt:w(n.getCreatedAt()),movedAt:w(n.getMovedAt()),removedAt:w(n.getRemovedAt())})}})}function Eh(n){return N(me,{body:{case:"counter",value:N(xl,{type:Bo(n.getType()),value:n.toBytes(),createdAt:w(n.getCreatedAt()),movedAt:w(n.getMovedAt()),removedAt:w(n.getRemovedAt())})}})}function ko(n){return N(me,{body:{case:"tree",value:N(Ll,{nodes:Fr(n.getRoot()),createdAt:w(n.getCreatedAt()),movedAt:w(n.getMovedAt()),removedAt:w(n.getRemovedAt())})}})}function Kr(n){if(n instanceof te)return vh(n);if(n instanceof re)return Wo(n);if(n instanceof X)return Sh(n);if(n instanceof ce)return Ih(n);if(n instanceof ue)return Eh(n);if(n instanceof de)return ko(n);throw new f(d.ErrUnimplemented,"unimplemented element")}function Nh(n){return N(ml,{documentKey:n.getDocumentKey(),checkpoint:lh(n.getCheckpoint()),isRemoved:n.getIsRemoved(),changes:gh(n.getChanges()),snapshot:n.getSnapshot(),versionVector:Yr(n.getVersionVector())})}function wh(n){return{id:n.id,label:n.label,description:n.description,snapshot:n.snapshot,createdAt:n.createdAt?Zc(n.createdAt):new Date}}function qt(n){if(!(n instanceof Y))return{};const e=n.findDetails(Xl);for(const t of e)return t.metadata;return{}}function Dt(n){return qt(n).code??""}function Mr(n,e){return n instanceof Y&&Dt(n)===e}function Oo(n){return Re.of(n.clientSeq,BigInt(n.lamport),zr(n.actorId),Jr(n.versionVector),BigInt(n.serverSeq))}function Jr(n){if(!n)return;const e=new Rt;return Object.entries(n.vector).forEach(([t,r])=>{const s=Pn(Xh(t));e.set(s,BigInt(r.toString()))}),e}function R(n){if(n)return pe.of(BigInt(n.lamport),n.delimiter,zr(n.actorId))}function Xr(n){const e={};return Object.entries(n.data).forEach(([t,r])=>{e[t]=JSON.parse(r)}),e}function Rh(n){const e=n.type;if(e===Jt.PUT){const t=Xr(n.presence);return{type:De.Put,presence:t}}if(e===Jt.CLEAR)return{type:De.Clear};throw new f(d.ErrInvalidType,`unsupported type: ${e}`)}function Ch(n){const e=new Map;return Object.entries(n).forEach(([t,r])=>{e.set(t,Xr(r))}),e}function Po(n){switch(n){case x.NULL:return G.Null;case x.BOOLEAN:return G.Boolean;case x.INTEGER:return G.Integer;case x.LONG:return G.Long;case x.DOUBLE:return G.Double;case x.STRING:return G.String;case x.BYTES:return G.Bytes;case x.DATE:return G.Date}throw new f(d.ErrUnimplemented,`unimplemented value type: ${n}`)}function Wn(n){switch(n){case x.INTEGER_CNT:return Oe.Int;case x.LONG_CNT:return Oe.Long}throw new f(d.ErrUnimplemented,`unimplemented value type: ${n}`)}function kn(n){switch(n.type){case x.JSON_OBJECT:return n.value?Mo(n.value):te.create(R(n.createdAt));case x.JSON_ARRAY:return n.value?Fh(n.value):re.create(R(n.createdAt));case x.TEXT:return ce.create(Nt.create(),R(n.createdAt));case x.TREE:return Mh(n.value);case x.NULL:case x.BOOLEAN:case x.INTEGER:case x.LONG:case x.DOUBLE:case x.STRING:case x.BYTES:case x.DATE:return X.of(X.valueFromBytes(Po(n.type),n.value),R(n.createdAt));case x.INTEGER_CNT:case x.LONG_CNT:return ue.create(Wn(n.type),ue.valueFromBytes(Wn(n.type),n.value),R(n.createdAt))}}function On(n){return q.of(We.of(R(n.createdAt),n.offset),n.relativeOffset)}function Zo(n){return We.of(R(n.createdAt),n.offset)}function Th(n){const e=zt.create(n.value);Object.entries(n.attributes).forEach(([r,s])=>{e.setAttr(r,s.value,R(s.updatedAt))});const t=He.create(Zo(n.id),e);return t.setRemovedAt(R(n.removedAt)),t}function xt(n){return we.of(en(n.parentId),en(n.leftSiblingId))}function en(n){return ee.of(R(n.createdAt),n.offset)}function Vh(n){if(!n.length)return;const e=[];return n.forEach(t=>{const r=_r(t.content);e.push(r)}),e}function _r(n){if(n.length===0)return;const e=[];for(const s of n)e.push(xh(s));const t=e[e.length-1],r=new Map;r.set(n[e.length-1].depth,e[e.length-1]);for(let s=e.length-2;s>=0;s--)r.get(n[s].depth-1).prepend(e[s]),r.set(n[s].depth,e[s]);return t.updateDescendantsSize(),t.updateDescendantsSize(!0),de.create(t,vt).getRoot()}function Dh(n){const e=Fe.create();for(const[t,r]of Object.entries(n))e.setInternal(t,r.value,R(r.updatedAt),r.isRemoved);return e}function xh(n){const e=en(n.id),t=he.create(e,n.type),r=Object.entries(n.attributes);return t.isText?t.value=n.value:r.length&&(t.attrs=Dh(n.attributes)),n.insPrevId&&(t.insPrevID=en(n.insPrevId)),n.insNextId&&(t.insNextID=en(n.insNextId)),t.removedAt=R(n.removedAt),t}function Uo(n){if(n.body.case==="set"){const e=n.body.value;return ut.create(e.key,kn(e.value),R(e.parentCreatedAt),R(e.executedAt))}else if(n.body.case==="add"){const e=n.body.value;return Qe.create(R(e.parentCreatedAt),R(e.prevCreatedAt),kn(e.value),R(e.executedAt))}else if(n.body.case==="move"){const e=n.body.value;return Ee.create(R(e.parentCreatedAt),R(e.prevCreatedAt),R(e.createdAt),R(e.executedAt))}else if(n.body.case==="remove"){const e=n.body.value;return Be.create(R(e.parentCreatedAt),R(e.createdAt),R(e.executedAt))}else if(n.body.case==="edit"){const e=n.body.value,t=new Map;return Object.entries(e.attributes).forEach(([r,s])=>{t.set(r,s)}),et.create(R(e.parentCreatedAt),On(e.from),On(e.to),e.content,t,R(e.executedAt))}else if(n.body.case==="style"){const e=n.body.value,t=new Map;Object.entries(e.attributes).forEach(([s,i])=>{t.set(s,i)});const r=e.attributesToRemove??[];return new Me(R(e.parentCreatedAt),On(e.from),On(e.to),t,r,R(e.executedAt))}else if(n.body.case==="increase"){const e=n.body.value;return Vt.create(R(e.parentCreatedAt),kn(e.value),R(e.executedAt))}else if(n.body.case==="treeEdit"){const e=n.body.value;return Qt.create(R(e.parentCreatedAt),xt(e.from),xt(e.to),Vh(e.contents),e.splitLevel,R(e.executedAt))}else if(n.body.case==="treeStyle"){const e=n.body.value,t=new Map,r=e.attributesToRemove;return(r==null?void 0:r.length)>0?Je.createTreeRemoveStyleOperation(R(e.parentCreatedAt),xt(e.from),xt(e.to),r,R(e.executedAt)):(Object.entries(e.attributes).forEach(([s,i])=>{t.set(s,i)}),Je.create(R(e.parentCreatedAt),xt(e.from),xt(e.to),t,R(e.executedAt)))}else if(n.body.case==="arraySet"){const e=n.body.value;return Xe.create(R(e.parentCreatedAt),R(e.createdAt),kn(e.value),R(e.executedAt))}else throw new f(d.ErrUnimplemented,"unimplemented operation")}function Lh(n){const e=[];for(const t of n){const r=Uo(t);r&&e.push(r)}return e}function Yo(n){const e=[];for(const t of n)e.push(Ct.create({id:Oo(t.id),operations:Lh(t.operations),presenceChange:t.presenceChange?Rh(t.presenceChange):void 0,message:t.message}));return e}function Bh(n){return Tt.of(BigInt(n.serverSeq),n.clientSeq)}function Wh(n){return Dn.create(n.documentKey,Bh(n.checkpoint),n.isRemoved,Yo(n.changes),Jr(n.versionVector),n.snapshot)}function Go(n){const e=new St;for(const r of n.nodes){const s=$r(r.element);e.set(r.key,s,s.getPositionedAt())}const t=new te(R(n.createdAt),e);return t.setMovedAt(R(n.movedAt)),t.setRemovedAt(R(n.removedAt)),t}function Fo(n){const e=new $t;for(const r of n.nodes)e.insert($r(r.element));const t=new re(R(n.createdAt),e);return t.setMovedAt(R(n.movedAt)),t.setRemovedAt(R(n.removedAt)),t}function kh(n){const e=X.of(X.valueFromBytes(Po(n.type),n.value),R(n.createdAt));return e.setMovedAt(R(n.movedAt)),e.setRemovedAt(R(n.removedAt)),e}function Oh(n){const e=new Nt;let t=e.getHead();for(const s of n.nodes){const i=e.insertAfter(t,Th(s));s.insPrevId&&i.setInsPrev(e.findNode(Zo(s.insPrevId))),t=i}const r=new ce(e,R(n.createdAt));return r.setMovedAt(R(n.movedAt)),r.setRemovedAt(R(n.removedAt)),r}function Ph(n){const e=ue.create(Wn(n.type),ue.valueFromBytes(Wn(n.type),n.value),R(n.createdAt));return e.setMovedAt(R(n.movedAt)),e.setRemovedAt(R(n.removedAt)),e}function Ko(n){const e=_r(n.nodes);return de.create(e,R(n.createdAt))}function $r(n){if(n.body.case==="jsonObject")return Go(n.body.value);if(n.body.case==="jsonArray")return Fo(n.body.value);if(n.body.case==="primitive")return kh(n.body.value);if(n.body.case==="text")return Oh(n.body.value);if(n.body.case==="counter")return Ph(n.body.value);if(n.body.case==="tree")return Ko(n.body.value);throw new f(d.ErrUnimplemented,"unimplemented element")}function Zh(n){return n.map(e=>({path:e.path,type:e.type}))}function Uh(n){if(!n)return{root:te.create(vt),presences:new Map};const e=ge(gl,n);return{root:$r(e.root),presences:Ch(e.presences)}}function Yh(n){const e=Yr(n);return Pn(ze(Dr,e))}function Gh(n){const e=jr(n),t=ge(Dr,e);return Jr(t)}function Mo(n){if(!n)throw new f(d.ErrInvalidArgument,"bytes is empty");const e=ge(me,n);return Go(e.body.value)}function Jo(n){return ze(me,Kr(n))}function Fh(n){if(!n)throw new f(d.ErrInvalidArgument,"bytes is empty");const e=ge(me,n);return Fo(e.body.value)}function Kh(n){return ze(me,Wo(n))}function Mh(n){if(!n)throw new f(d.ErrInvalidArgument,"bytes is empty");const e=ge(me,n);return Ko(e.body.value)}function Jh(n){return ze(me,ko(n))}function Pn(n){return n?Array.from(n).map(e=>e.toString(16).padStart(2,"0")).join(""):""}function zr(n){return Pn(n)}function jr(n){return new Uint8Array(n.match(/.{1,2}/g).map(e=>parseInt(e,16)))}function Xh(n){if(typeof window<"u"&&typeof window.atob=="function"){const e=window.atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return r}else if(typeof globalThis<"u"&&typeof globalThis.Buffer<"u"){const e=globalThis.Buffer;return new Uint8Array(e.from(n,"base64"))}else throw new Error("No base64 decoder available")}function Zn(n){return jr(n)}function _h(n){if(typeof window<"u"&&typeof window.btoa=="function"){let e="";for(let t=0;t<n.byteLength;t++)e+=String.fromCharCode(n[t]);return window.btoa(e)}else{if(typeof globalThis<"u"&&typeof globalThis.Buffer<"u")return globalThis.Buffer.from(n).toString("base64");throw new Error("No base64 encoder available")}}function $h(n){const e=ge(Vr,n);return Oo(e)}function zh(n){const e=ge(xr,n);return Uo(e)}const K={fromPresence:Xr,toChangePack:Nh,fromChangePack:Wh,fromChanges:Yo,toTreeNodes:Fr,fromTreeNodes:_r,objectToBytes:Jo,bytesToObject:Mo,bytesToSnapshot:Uh,bytesToHex:Pn,hexToBytes:jr,toHexString:zr,toUint8Array:Zn,toOperation:Gr,toChangeID:Ur,bytesToChangeID:$h,bytesToOperation:zh,versionVectorToHex:Yh,hexToVersionVector:Gh,fromSchemaRules:Zh,toRevisionSummary:wh,changeIDToBinary:n=>ze(Vr,Ur(n)),operationToBinary:n=>ze(xr,Gr(n))};var le=(n=>(n[n.Trivial=0]="Trivial",n[n.Debug=1]="Debug",n[n.Info=2]="Info",n[n.Warn=3]="Warn",n[n.Error=4]="Error",n[n.Fatal=5]="Fatal",n))(le||{});let ht=3;function jh(n){ht=n}const S={trivial:(...n)=>{ht>0||typeof console<"u"&&console.log("YORKIE T:",...n)},debug:(...n)=>{ht>1||typeof console<"u"&&console.log("YORKIE D:",...n)},info:(...n)=>{ht>2||typeof console<"u"&&console.log("YORKIE I:",...n)},warn:(...n)=>{ht>3||typeof console<"u"&&(typeof console.warn<"u"?console.warn("YORKIE W:",...n):console.log("YORKIE W:",...n))},error:(...n)=>{ht>4||typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE E:",...n):console.log("YORKIE E:",...n))},fatal:(...n)=>{typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE F:",...n):console.log("YORKIE F:",...n))},isEnabled:n=>ht<=n};function Xo(){return"xxxxxxxx-xxxx-4xxxy-xxxx-xxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}const Qr=()=>{};class Qh{constructor(e){h(this,"finalized",!1);h(this,"observers",[]);h(this,"finalError");try{e(this)}catch(t){this.error(t)}}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(!e)throw new f(d.ErrInvalidArgument,"missing observer");if(this.finalized)throw new f(d.ErrRefused,"observable is finalized due to previous error");typeof e=="object"?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Qr),s.error===void 0&&(s.error=Qr),s.complete===void 0&&(s.complete=Qr);const i=Xo(),o=this.unsubscribeOne.bind(this,i);if(this.observers.push({subscriptionID:i,observer:s}),this.finalized)try{this.finalError?s.error(this.finalError):s.complete()}catch(a){S.warn(a)}return o}unsubscribeOne(e){var t;this.observers=(t=this.observers)==null?void 0:t.filter(r=>r.subscriptionID!==e)}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e].observer)}catch(r){S.error(r)}}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.observers=void 0)}}function _o(n){const e=new Qh(n);return{subscribe:e.subscribe.bind(e),getProxy:()=>e}}class tn{constructor(e,t,r,s){h(this,"prevID");h(this,"nextID");h(this,"delimiter");h(this,"message");h(this,"root");h(this,"operations");h(this,"presenceChange");h(this,"previousPresence");h(this,"reversePresenceKeys");this.prevID=e,this.nextID=e.next(),this.delimiter=ho,this.root=t,this.operations=[],this.previousPresence=Ne(r),this.presenceChange=void 0,this.reversePresenceKeys=new Set,this.message=s}static create(e,t,r,s){return new tn(e,t,r,s)}push(e){this.operations.push(e)}registerElement(e,t){this.root.registerElement(e,t)}registerRemovedElement(e){this.root.registerRemovedElement(e)}registerGCPair(e){this.root.registerGCPair(e)}getNextID(){return this.isPresenceOnlyChange()?this.prevID.next(!0).setLamport(this.prevID.getLamport()).setVersionVector(this.prevID.getVersionVector()):this.nextID}toChange(){const e=this.isPresenceOnlyChange()?this.prevID.next(!0):this.nextID;return Ct.create({id:e,operations:this.operations,presenceChange:this.presenceChange,message:this.message})}isPresenceOnlyChange(){return this.operations.length===0}hasChange(){return this.operations.length>0||this.presenceChange!==void 0}setPresenceChange(e){this.presenceChange=e}setReversePresence(e,t){for(const r of Object.keys(e))t!=null&&t.addToHistory?this.reversePresenceKeys.add(r):this.reversePresenceKeys.delete(r)}getReversePresence(){if(this.reversePresenceKeys.size===0)return;const e={};for(const t of this.reversePresenceKeys)e[t]=this.previousPresence[t];return e}issueTimeTicket(){return this.delimiter+=1,this.nextID.createTimeTicket(this.delimiter)}getLastTimeTicket(){return this.nextID.createTimeTicket(this.delimiter)}acc(e){this.root.acc(e)}}function $o(n,e){const t=new nn(n);return new Proxy(e,t.getHandlers())}class nn{constructor(e){h(this,"context");h(this,"handlers");this.context=e,this.handlers={set:(t,r,s)=>(S.isEnabled(le.Trivial)&&S.trivial(`obj[${r}]=${JSON.stringify(s)}`),nn.setInternal(e,t,r,s),!0),get:(t,r)=>(S.isEnabled(le.Trivial)&&S.trivial(`obj[${r}]`),r==="getID"?()=>t.getCreatedAt():r==="toJSON"||r==="toString"?()=>t.toJSON():r==="toJS"?()=>t.toJS():r==="toJSForTest"?()=>t.toJSForTest():tt(e,t.get(r))),ownKeys:t=>t.getKeys(),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),deleteProperty:(t,r)=>(S.isEnabled(le.Trivial)&&S.trivial(`obj[${r}]`),nn.deleteInternal(e,t,r),!0)}}static setInternal(e,t,r,s){if(r.includes("."))throw new f(d.ErrInvalidObjectKey,"key must not contain the '.'.");const i=e.issueTimeTicket(),o=rn(e,s,i),a=t.set(r,o,i);e.registerElement(o,t),a&&e.registerRemovedElement(a),e.push(ut.create(r,o.deepcopy(),t.getCreatedAt(),i))}static buildObjectMembers(e,t){const r={};for(const[s,i]of Object.entries(t)){if(s.includes("."))throw new f(d.ErrInvalidObjectKey,"key must not contain the '.'.");const o=e.issueTimeTicket(),a=rn(e,i,o);r[s]=a}return r}static deleteInternal(e,t,r){const s=e.issueTimeTicket(),i=t.deleteByKey(r,s);i&&(e.push(Be.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i))}getHandlers(){return this.handlers}}function Hh(n,e){const t=new Z(n,e);return new Proxy(e,t.getHandlers())}function zo(n){return typeof n=="string"||n instanceof String?!isNaN(n):!1}function qh(n){return["concat","entries","every","filter","find","findIndex","forEach","join","keys","map","reduce","reduceRight","slice","some","toLocaleString","toString","values"].includes(n)}class Z{constructor(e,t){h(this,"context");h(this,"handlers");h(this,"array");this.context=e,this.array=t,this.handlers={get:(r,s,i)=>s==="getID"?()=>r.getCreatedAt():s==="getElementByID"?o=>{const a=r.getByID(o);if(!(!a||a.isRemoved()))return Ce(e,a)}:s==="getElementByIndex"?o=>{const a=r.get(o);return Ce(e,a)}:s==="getLast"?()=>Ce(e,r.getLast()):s==="delete"?o=>{const a=Z.deleteInternalByIndex(e,r,o);return Ce(e,a)}:s==="deleteByID"?o=>{const a=Z.deleteInternalByID(e,r,o);return Ce(e,a)}:s==="insertAfter"?(o,a)=>{const c=Z.insertAfterInternal(e,r,o,a);return Ce(e,c)}:s==="insertIntegerAfter"?(o,a)=>{const c=Z.insertIntegerAfterInternal(e,r,o,a);return Ce(e,c)}:s==="insertBefore"?(o,a)=>{const c=Z.insertBeforeInternal(e,r,o,a);return Ce(e,c)}:s==="setValue"?(o,a)=>{const c=Z.setValueInternal(e,r,o,a);return Ce(e,c)}:s==="moveBefore"?(o,a)=>{Z.moveBeforeInternal(e,r,o,a)}:s==="moveAfter"?(o,a)=>{Z.moveAfterInternal(e,r,o,a)}:s==="moveAfterByIndex"?(o,a)=>{Z.moveAfterByIndexInternal(e,r,o,a)}:s==="moveFront"?o=>{Z.moveFrontInternal(e,r,o)}:s==="moveLast"?o=>{Z.moveLastInternal(e,r,o)}:zo(s)?tt(e,r.get(Number(s))):s==="push"?o=>Z.pushInternal(e,r,o):s==="splice"?(o,a,...c)=>Z.splice(e,r,o,a,...c):s==="length"?r.length:typeof s=="symbol"&&s===Symbol.iterator?Z.iteratorInternal.bind(this,e,r):s==="elements"?Z.wrappedIteratorInternal.bind(this,e,r):s==="includes"?(o,a)=>Z.includes(e,r,o,a):s==="indexOf"?(o,a)=>Z.indexOf(e,r,o,a):s==="lastIndexOf"?(o,a)=>Z.lastIndexOf(e,r,o,a):s==="toJSForTest"?()=>r.toJSForTest():s==="toTestString"?()=>Z.toTestString(r):typeof s=="string"&&qh(s)?(...o)=>{const a=Array.from(r).map(c=>tt(e,c));return Array.prototype[s].apply(a,o)}:Reflect.get(r,s,i),set:(r,s,i)=>{if(zo(s)){const o=Number(s);return Z.setValueInternal(e,r,o,i),!0}return Reflect.set(r,s,i)},deleteProperty:(r,s)=>(S.isEnabled(le.Trivial)&&S.trivial(`array[${s}]`),Z.deleteInternalByIndex(e,r,Number.parseInt(s)),!0)}}static*iteratorInternal(e,t){for(const r of t)yield tt(e,r)}static*wrappedIteratorInternal(e,t){for(const r of t)yield Ce(e,r)}static buildArrayElements(e,t){const r=[];for(const s of t){const i=e.issueTimeTicket(),o=rn(e,s,i);r.push(o)}return r}static pushInternal(e,t,r){return Z.insertAfterInternal(e,t,t.getLastCreatedAt(),r),t.length}static moveBeforeInternal(e,t,r,s){const i=e.issueTimeTicket(),o=t.getPrevCreatedAt(r);t.moveAfter(o,s,i),e.push(Ee.create(t.getCreatedAt(),o,s,i))}static moveAfterInternal(e,t,r,s){const i=e.issueTimeTicket();e.push(Ee.create(t.getCreatedAt(),r,s,i)),t.moveAfter(r,s,i)}static moveAfterByIndexInternal(e,t,r,s){const i=t.get(r);if(!i)throw new f(d.ErrInvalidArgument,`index out of bounds: ${r}`);const o=t.get(s);if(!o)throw new f(d.ErrInvalidArgument,`index out of bounds: ${s}`);Z.moveAfterInternal(e,t,i.getCreatedAt(),o.getCreatedAt())}static moveFrontInternal(e,t,r){const s=e.issueTimeTicket(),i=t.getHead();t.moveAfter(i.getCreatedAt(),r,s),e.push(Ee.create(t.getCreatedAt(),i.getCreatedAt(),r,s))}static moveLastInternal(e,t,r){const s=e.issueTimeTicket(),i=t.getLastCreatedAt();t.moveAfter(i,r,s),e.push(Ee.create(t.getCreatedAt(),i,r,s))}static insertAfterInternal(e,t,r,s){const i=e.issueTimeTicket(),o=rn(e,s,i);return t.insertAfter(r,o),e.registerElement(o,t),e.push(Qe.create(t.getCreatedAt(),r,o.deepcopy(),i)),o}static insertIntegerAfterInternal(e,t,r,s){const i=t.get(r);if(!i)throw new f(d.ErrInvalidArgument,`index out of bounds: ${r}`);return Z.insertAfterInternal(e,t,i.getCreatedAt(),s),t}static insertBeforeInternal(e,t,r,s){return Z.insertAfterInternal(e,t,t.getPrevCreatedAt(r),s)}static setValueInternal(e,t,r,s){const i=t.get(r);if(!i)throw new f(d.ErrInvalidArgument,`index out of bounds: ${r}`);return Z.setByIndexInternal(e,t,i.getCreatedAt(),s),t}static setByIndexInternal(e,t,r,s){const i=e.issueTimeTicket(),o=rn(e,s,i),a=o.deepcopy();return e.push(Xe.create(t.getCreatedAt(),r,a,i)),t.set(r,o,i),e.registerElement(o,t),o}static deleteInternalByIndex(e,t,r){const s=e.issueTimeTicket(),i=t.deleteByIndex(r,s);if(i)return e.push(Be.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i),i}static deleteInternalByID(e,t,r){const s=e.issueTimeTicket(),i=t.delete(r,s);return e.push(Be.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i),i}static splice(e,t,r,s,...i){const o=t.length,a=r>=0?Math.min(r,o):Math.max(o+r,0),c=s===void 0?o:s<0?a:Math.min(a+s,o),u=[];for(let l=a;l<c;l++){const g=Z.deleteInternalByIndex(e,t,a);if(g){const b=g.deepcopy();b.setRemovedAt(),u.push(tt(e,b))}}if(i){let l=a===0?t.getHead().getID():t.get(a-1).getID();for(const g of i)l=Z.insertAfterInternal(e,t,l,g).getID()}return u}static includes(e,t,r,s){var a;const i=t.length,o=s===void 0?0:s<0?Math.max(s+i,0):s;if(o>=i)return!1;if(X.isSupport(r))return Array.from(t).map(u=>tt(e,u)).includes(r,o);for(let c=o;c<i;c++)if(((a=t.get(c))==null?void 0:a.getID())===r.getID())return!0;return!1}static indexOf(e,t,r,s){var a;const i=t.length,o=s===void 0?0:s<0?Math.max(s+i,0):s;if(o>=i)return-1;if(X.isSupport(r))return Array.from(t).map(u=>tt(e,u)).indexOf(r,o);for(let c=o;c<i;c++)if(((a=t.get(c))==null?void 0:a.getID())===r.getID())return c;return-1}static lastIndexOf(e,t,r,s){var a;const i=t.length,o=s===void 0||s>=i?i-1:s<0?s+i:s;if(o<0)return-1;if(X.isSupport(r))return Array.from(t).map(u=>tt(e,u)).lastIndexOf(r,o);for(let c=o;c>0;c--)if(((a=t.get(c))==null?void 0:a.getID())===r.getID())return c;return-1}static toTestString(e){return e.toTestString()}getHandlers(){return this.handlers}}class Hr{constructor(e,t){h(this,"context");h(this,"text");this.context=e,this.text=t}initialize(e,t){this.context=e,this.text=t}getID(){return this.text.getID()}edit(e,t,r,s){if(!this.context||!this.text)throw new f(d.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new f(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.text.indexRangeToPosRange(e,t);S.isEnabled(le.Debug)&&S.debug(`EDIT: f:${e}->${i[0].toTestString()}, t:${t}->${i[1].toTestString()} c:${r}`);const o=s?wt(s):void 0,a=this.context.issueTimeTicket(),[,c,u,l]=this.text.edit(i,r,a,o);this.context.acc(u);for(const g of c)this.context.registerGCPair(g);return this.context.push(new et(this.text.getCreatedAt(),i[0],i[1],r,o?new Map(Object.entries(o)):new Map,a)),this.text.findIndexesFromRange(l)}delete(e,t){return this.edit(e,t,"")}empty(){return this.edit(0,this.length,"")}setStyle(e,t,r){if(!this.context||!this.text)throw new f(d.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new f(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.text.indexRangeToPosRange(e,t);S.isEnabled(le.Debug)&&S.debug(`STYL: f:${e}->${s[0].toTestString()}, t:${t}->${s[1].toTestString()} a:${JSON.stringify(r)}`);const i=wt(r),o=this.context.issueTimeTicket(),[a,c]=this.text.setStyle(s,i,o);this.context.acc(c);for(const u of a)this.context.registerGCPair(u);return this.context.push(Me.create(this.text.getCreatedAt(),s[0],s[1],new Map(Object.entries(i)),o)),!0}indexRangeToPosRange(e){if(!this.context||!this.text)throw new f(d.ErrNotInitialized,"Text is not initialized yet");const t=this.text.indexRangeToPosRange(e[0],e[1]);return[t[0].toStruct(),t[1].toStruct()]}posRangeToIndexRange(e){if(!this.context||!this.text)throw new f(d.ErrNotInitialized,"Text is not initialized yet");const t=this.text.findIndexesFromRange([q.fromStruct(e[0]),q.fromStruct(e[1])]);return[t[0],t[1]]}toTestString(){if(!this.context||!this.text)throw new f(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toTestString()}values(){if(!this.context||!this.text)throw new f(d.ErrNotInitialized,"Text is not initialized yet");return this.text.values()}get length(){return this.text.length}getTreeByIndex(){return this.text.getTreeByIndex()}getTreeByID(){return this.text.getTreeByID()}toString(){if(!this.context||!this.text)throw new f(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toString()}toJSON(){if(!this.context||!this.text)throw new f(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSON()}toJSForTest(){if(!this.context||!this.text)throw new f(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSForTest()}createRangeForTest(e,t){if(!this.context||!this.text)throw new f(d.ErrNotInitialized,"Text is not initialized yet");return this.text.indexRangeToPosRange(e,t)}}class qr{constructor(e,t){h(this,"valueType");h(this,"value");h(this,"context");h(this,"counter");this.valueType=e,this.value=t}initialize(e,t){this.valueType=t.getValueType(),this.context=e,this.counter=t,this.value=t.getValue()}getID(){return this.counter.getID()}getValue(){return this.value}getValueType(){return this.valueType}increase(e){if(!this.context||!this.counter)throw new f(d.ErrNotInitialized,"Counter is not initialized yet");const t=this.context.issueTimeTicket(),r=X.of(e,t);if(!r.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof r.getValue()}`);return this.counter.increase(r),this.context.push(Vt.create(this.counter.getCreatedAt(),r,t)),this}toJSForTest(){if(!this.context||!this.counter)throw new f(d.ErrNotInitialized,"Counter is not initialized yet");return this.counter.toJSForTest()}}function es(n){if(n.isText)return{type:n.type,value:n.value};const e={type:n.type,children:n.children.map(t=>es(t))};return n.attrs&&(e.attributes=Ke(n.attrs.toObject())),e}function ed(n,e){const t={type:n.isText?n.parent.type:n.type,children:n.isText?n.parent.getChildrenText().length===e?[]:[{type:ke,value:n.parent.getChildrenText().slice(e)}]:n.children.slice(e).map(r=>es(r))};return n.attrs?t.attributes=Ke(n.attrs.toObject()):n.isText&&n.parent.attrs&&(t.attributes=Ke(n.parent.attrs.toObject())),t}function td(n,e){const{node:t}=n,r=[...e].slice(0,-1),s=t.isText?t.parent.getChildrenText().length:t.children.length,i=[...r,s],o=[...r],a=[];o[o.length-1]+=1,e.every((u,l)=>u===i[l])||a.push({fromPath:[...e],toPath:i});const c=ed(t,e[e.length-1]);return c&&a.push({fromPath:o,toPath:o,content:c}),a}function nd(n,e){const{node:t,offset:r}=n,s=t.children[r],i=t.children[r-1],{children:o}=s,a=[...e].slice(0,-1),c=[{fromPath:[...e],toPath:[...a,r+1]}];if(!s.children.length)return c;const u=[...a,r-1,i.hasTextChild()?i.getChildrenText().length:i.children.length],l=o.map(g=>es(g));return c.push({fromPath:u,toPath:u,content:l}),c}function ts(n,e,t){const{type:r}=n,s=t.issueTimeTicket();if(r===ke){jo(n);const{value:i}=n,o=he.create(ee.of(s,0),r,i);e.append(o)}else{const{children:i=[]}=n,{attributes:o}=n;let a;if(typeof o=="object"&&!wo(o)){const u=wt(o);a=new Fe;for(const[l,g]of Object.entries(u))a.set(l,g,s)}const c=he.create(ee.of(s,0),r,void 0,a);e.append(c);for(const u of i)ts(u,c,t)}}function rd(n,e){const{type:t}=e,r=n.issueTimeTicket();let s;if(e.type===ke){const{value:i}=e;s=he.create(ee.of(r,0),t,i)}else if(e){const{children:i=[]}=e,{attributes:o}=e;let a;if(typeof o=="object"&&!wo(o)){const c=wt(o);a=new Fe;for(const[u,l]of Object.entries(c))a.set(u,l,r)}s=he.create(ee.of(n.issueTimeTicket(),0),t,void 0,a);for(const c of i)ts(c,s,n)}return s}function jo(n){if(!n.value.length)throw new f(d.ErrInvalidArgument,"text node cannot have empty value");return!0}function Qo(n){if(!n.length)return!0;if(n[0].type===ke)for(const t of n){const{type:r}=t;if(r!==ke)throw new f(d.ErrInvalidArgument,"element node and text node cannot be passed together");jo(t)}else for(const t of n){const{type:r}=t;if(r===ke)throw new f(d.ErrInvalidArgument,"element node and text node cannot be passed together")}return!0}class ns{constructor(e){h(this,"initialRoot");h(this,"context");h(this,"tree");this.initialRoot=e}initialize(e,t){this.context=e,this.tree=t}getID(){return this.tree.getID()}buildRoot(e){if(!this.initialRoot)return he.create(ee.of(e.issueTimeTicket(),0),th);const t=he.create(ee.of(e.issueTimeTicket(),0),this.initialRoot.type);for(const r of this.initialRoot.children)ts(r,t,e);return t}getSize(){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getSize()}getNodeSize(){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getNodeSize()}getIndexTree(){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getIndexTree()}splitByPath(e){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new f(d.ErrInvalidArgument,"path should not be empty");const t=this.tree.pathToTreePos(e),r=td(t,e);for(const s of r){const{fromPath:i,toPath:o,content:a}=s,c=this.tree.pathToPos(i),u=this.tree.pathToPos(o);this.editInternal(c,u,a?[a]:[],0)}}mergeByPath(e){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new f(d.ErrInvalidArgument,"path should not be empty");const t=this.tree.pathToTreePos(e);if(t.node.isText)throw new f(d.ErrInvalidArgument,"text node cannot be merged");const r=nd(t,e);for(const s of r){const{fromPath:i,toPath:o,content:a}=s,c=this.tree.pathToPos(i),u=this.tree.pathToPos(o);this.editInternal(c,u,a??[],0)}}styleByPath(e,t){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new f(d.ErrInvalidArgument,"path should not be empty");const[r,s]=this.tree.pathToPosRange(e),i=this.context.issueTimeTicket(),o=t?wt(t):void 0,[a,,c]=this.tree.style([r,s],o,i);this.context.acc(c);for(const u of a)this.context.registerGCPair(u);this.context.push(Je.create(this.tree.getCreatedAt(),r,s,o?new Map(Object.entries(o)):new Map,i))}style(e,t,r){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new f(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(e),i=this.tree.findPos(t),o=this.context.issueTimeTicket(),a=r?wt(r):void 0,[c,,u]=this.tree.style([s,i],a,o);this.context.acc(u);for(const l of c)this.context.registerGCPair(l);this.context.push(Je.create(this.tree.getCreatedAt(),s,i,a?new Map(Object.entries(a)):new Map,o))}removeStyle(e,t,r){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new f(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(e),i=this.tree.findPos(t),o=this.context.issueTimeTicket(),[a,,c]=this.tree.removeStyle([s,i],r,o);this.context.acc(c);for(const u of a)this.context.registerGCPair(u);this.context.push(Je.createTreeRemoveStyleOperation(this.tree.getCreatedAt(),s,i,r,o))}editInternal(e,t,r,s=0){var u;if(r.length!==0&&r[0]&&(Qo(r),r[0].type!==ke))for(const l of r){const{children:g=[]}=l;Qo(g)}const i=this.context.getLastTimeTicket();let o=new Array;if(((u=r[0])==null?void 0:u.type)===ke){let l="";for(const g of r){const{value:b}=g;l+=b}o.push(he.create(ee.of(this.context.issueTimeTicket(),0),ke,l))}else o=r.map(l=>l&&rd(this.context,l)).filter(l=>l);const[,a,c]=this.tree.edit([e,t],o.length?o.map(l=>l==null?void 0:l.deepcopy()):void 0,s,i,()=>this.context.issueTimeTicket());this.context.acc(c);for(const l of a)this.context.registerGCPair(l);return this.context.push(Qt.create(this.tree.getCreatedAt(),e,t,o.length?o:void 0,s,i)),!0}editByPath(e,t,r,s=0){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new f(d.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new f(d.ErrInvalidArgument,"path should not be empty");const i=this.tree.pathToPos(e),o=this.tree.pathToPos(t);return this.editInternal(i,o,r?[r]:[],s)}editBulkByPath(e,t,r,s=0){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new f(d.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new f(d.ErrInvalidArgument,"path should not be empty");const i=this.tree.pathToPos(e),o=this.tree.pathToPos(t);return this.editInternal(i,o,r,s)}edit(e,t,r,s=0){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new f(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(e),o=this.tree.findPos(t);return this.editInternal(i,o,r?[r]:[],s)}editBulk(e,t,r,s=0){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new f(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(e),o=this.tree.findPos(t);return this.editInternal(i,o,r,s)}toXML(){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toXML()}toJSON(){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSON()}toJSForTest(){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSForTest()}toJSInfoForTest(){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSInfoForTest()}getRootTreeNode(){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getRootTreeNode()}indexToPath(e){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexToPath(e)}pathToIndex(e){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.pathToIndex(e)}pathRangeToPosRange(e){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");const t=[this.tree.pathToIndex(e[0]),this.tree.pathToIndex(e[1])],r=this.tree.indexRangeToPosRange(t);return[r[0].toStruct(),r[1].toStruct()]}indexRangeToPosRange(e){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexRangeToPosStructRange(e)}posRangeToIndexRange(e){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");const t=[we.fromStruct(e[0]),we.fromStruct(e[1])];return this.tree.posRangeToIndexRange(t)}posRangeToPathRange(e){if(!this.context||!this.tree)throw new f(d.ErrNotInitialized,"Tree is not initialized yet");const t=[we.fromStruct(e[0]),we.fromStruct(e[1])];return this.tree.posRangeToPathRange(t)}}function Ho(n,e){return $o(n,e)}function Ce(n,e){if(e){if(e instanceof X)return e;if(e instanceof te)return $o(n,e);if(e instanceof re)return Hh(n,e);if(e instanceof ce)return new Hr(n,e);if(e instanceof ue){const t=new qr(Oe.Int,0);return t.initialize(n,e),t}else if(e instanceof de){const t=new ns;return t.initialize(n,e),t}}else return;throw new TypeError(`Unsupported type of element: ${typeof e}`)}function tt(n,e){const t=Ce(n,e);return t instanceof X?t.getValue():t}function rn(n,e,t){let r;if(X.isSupport(e))r=X.of(e,t);else if(Array.isArray(e))r=re.create(t,Z.buildArrayElements(n,e));else if(typeof e=="object")e instanceof Hr?(r=ce.create(Nt.create(),t),e.initialize(n,r)):e instanceof qr?(r=ue.create(e.getValueType(),e.getValue(),t),e.initialize(n,r)):e instanceof ns?(r=de.create(e.buildRoot(n),t),e.initialize(n,r)):r=te.create(t,nn.buildObjectMembers(n,e));else throw new TypeError(`Unsupported type of value: ${typeof e}`);return r}class sn{constructor(e){h(this,"rootObject");h(this,"elementPairMapByCreatedAt");h(this,"gcElementSetByCreatedAt");h(this,"gcPairMap");h(this,"docSize");this.rootObject=e,this.elementPairMapByCreatedAt=new Map,this.gcElementSetByCreatedAt=new Set,this.gcPairMap=new Map,this.docSize={live:{data:0,meta:0},gc:{data:0,meta:0}},this.registerElement(e,void 0),e.getDescendants(t=>{if(t.getRemovedAt()&&this.registerRemovedElement(t),t instanceof ce||t instanceof de)for(const r of t.getGCPairs())this.registerGCPair(r);return!1})}static create(){return new sn(te.create(vt))}findByCreatedAt(e){const t=this.elementPairMapByCreatedAt.get(e.toIDString());if(t)return t.element}findElementPairByCreatedAt(e){return this.elementPairMapByCreatedAt.get(e.toIDString())}createSubPaths(e){let t=this.elementPairMapByCreatedAt.get(e.toIDString());if(!t)return[];const r=[];for(;t.parent;){const s=t.element.getCreatedAt(),i=t.parent.subPathOf(s);if(i===void 0)throw new f(d.ErrInvalidArgument,`cant find the given element: ${s.toIDString()}`);r.unshift(i),t=this.elementPairMapByCreatedAt.get(t.parent.getCreatedAt().toIDString())}return r.unshift("$"),r}createPath(e){return this.createSubPaths(e).join(".")}registerElement(e,t){this.elementPairMapByCreatedAt.set(e.getCreatedAt().toIDString(),{parent:t,element:e}),Q(this.docSize.live,e.getDataSize()),e instanceof je&&e.getDescendants((r,s)=>(this.elementPairMapByCreatedAt.set(r.getCreatedAt().toIDString(),{parent:s,element:r}),Q(this.docSize.live,r.getDataSize()),!1))}deregisterElement(e){let t=0;const r=s=>{const i=s.getCreatedAt().toIDString();lt(this.docSize.gc,s.getDataSize()),this.elementPairMapByCreatedAt.delete(i),this.gcElementSetByCreatedAt.delete(i),t++};return r(e),e instanceof je&&e.getDescendants(s=>(r(s),!1)),t}registerRemovedElement(e){Q(this.docSize.gc,e.getDataSize()),lt(this.docSize.live,e.getDataSize()),this.docSize.live.meta+=xe,this.gcElementSetByCreatedAt.add(e.getCreatedAt().toIDString())}registerGCPair(e){if(this.gcPairMap.get(e.child.toIDString())){this.gcPairMap.delete(e.child.toIDString());return}this.gcPairMap.set(e.child.toIDString(),e);const r=this.gcPairMap.get(e.child.toIDString()).child.getDataSize();Q(this.docSize.gc,r),lt(this.docSize.live,r),e.child instanceof qe||(this.docSize.live.meta+=xe)}getElementMapSize(){return this.elementPairMapByCreatedAt.size}getGarbageElementSetSize(){const e=new Set;for(const t of this.gcElementSetByCreatedAt){e.add(t);const r=this.elementPairMapByCreatedAt.get(t);r.element instanceof je&&r.element.getDescendants(s=>(e.add(s.getCreatedAt().toIDString()),!1))}return e.size}getObject(){return this.rootObject}getGarbageLen(){return this.getGarbageElementSetSize()+this.gcPairMap.size}getDocSize(){return this.docSize}deepcopy(){return new sn(this.rootObject.deepcopy())}garbageCollect(e){let t=0;for(const r of this.gcElementSetByCreatedAt){const s=this.elementPairMapByCreatedAt.get(r),i=s.element.getRemovedAt();i&&(e!=null&&e.afterOrEqual(i))&&(s.parent.purge(s.element),t+=this.deregisterElement(s.element))}for(const[,r]of this.gcPairMap){const s=r.child.getRemovedAt();s&&(e!=null&&e.afterOrEqual(s))&&(r.parent.purge(r.child),lt(this.docSize.gc,r.child.getDataSize()),this.gcPairMap.delete(r.child.toIDString()),t+=1)}return t}toJSON(){return this.rootObject.toJSON()}toSortedJSON(){return this.rootObject.toSortedJSON()}getStats(){return{elements:this.getElementMapSize(),gcPairs:this.gcPairMap.size,gcElements:this.getGarbageElementSetSize()}}acc(e){Q(this.docSize.live,e)}*getGCElementPairs(){for(const e of this.gcElementSetByCreatedAt){const t=this.elementPairMapByCreatedAt.get(e);t&&(yield t)}}}let qo=class{constructor(e,t){h(this,"context");h(this,"presence");this.context=e,this.presence=t}set(e,t){for(const r of Object.keys(e))this.presence[r]=e[r];this.context.setPresenceChange({type:De.Put,presence:Ne(this.presence)}),this.context.setReversePresence(e,t)}get(e){return this.presence[e]}clear(){this.presence={},this.context.setPresenceChange({type:De.Clear})}};const ea=50;class sd{constructor(){h(this,"undoStack",[]);h(this,"redoStack",[])}hasUndo(){return this.undoStack.length>0}hasRedo(){return this.redoStack.length>0}pushUndo(e){this.undoStack.length>=ea&&this.undoStack.shift(),this.undoStack.push(e)}popUndo(){return this.undoStack.pop()}pushRedo(e){this.redoStack.length>=ea&&this.redoStack.shift(),this.redoStack.push(e)}popRedo(){return this.redoStack.pop()}clearRedo(){this.redoStack=[]}clearUndo(){this.undoStack=[]}getUndoStackForTest(){return this.undoStack}getRedoStackForTest(){return this.redoStack}reconcileCreatedAt(e,t){const r=s=>{for(const i of s)for(const o of i)(o instanceof Xe||o instanceof Be||o instanceof Ee)&&o.getCreatedAt()===e&&o.setCreatedAt(t),(o instanceof Qe||o instanceof Ee)&&o.getPrevCreatedAt()===e&&o.setPrevCreatedAt(t)};r(this.undoStack),r(this.redoStack)}reconcileTextEdit(e,t,r,s){const i=o=>{for(const a of o)for(const c of a)c instanceof et&&c.getParentCreatedAt().compare(e)===0&&c.reconcileOperation(t,r,s)};i(this.undoStack),i(this.redoStack)}}function id(n,e){const t=[];for(const r of e){const s=od(n,r.path),i=ad(s,r);if(!i.valid)for(const o of i.errors||[])t.push(o)}return{valid:t.length===0,errors:t}}function od(n,e){if(!e.startsWith("$"))throw new Error(`Path must start with $, got ${e}`);const t=e.split(".");let r=n;for(let s=1;s<t.length;s++){const i=t[s];if(!(r instanceof te))return;r=r.get(i)}return r}function ad(n,e){switch(e.type){case"string":case"boolean":case"integer":case"double":case"long":case"date":case"bytes":case"null":return ud(n,e);case"object":if(!(n instanceof te))return{valid:!1,errors:[{path:e.path,message:`expected object at path ${e.path}`}]};break;case"array":if(!(n instanceof re))return{valid:!1,errors:[{path:e.path,message:`expected array at path ${e.path}`}]};break;case"yorkie.Text":if(!(n instanceof ce))return{valid:!1,errors:[{path:e.path,message:`expected yorkie.Text at path ${e.path}`}]};break;case"yorkie.Tree":if(!(n instanceof de))return{valid:!1,errors:[{path:e.path,message:`expected yorkie.Tree at path ${e.path}`}]};break;case"yorkie.Counter":if(!(n instanceof ue))return{valid:!1,errors:[{path:e.path,message:`expected yorkie.Counter at path ${e.path}`}]};break;default:throw new Error(`Unknown rule type: ${e.type}`)}return{valid:!0}}function cd(n){switch(n){case"null":return G.Null;case"boolean":return G.Boolean;case"integer":return G.Integer;case"long":return G.Long;case"double":return G.Double;case"string":return G.String;case"bytes":return G.Bytes;case"date":return G.Date;default:throw new Error(`Unknown primitive type: ${n}`)}}function ud(n,e){return n instanceof X&&n.getType()===cd(e.type)?{valid:!0}:{valid:!1,errors:[{path:e.path,message:`expected ${e.type} at path ${e.path}`}]}}const ld="yorkie-devtools-panel",hd="yorkie-devtools-sdk";function dd(n){return[se.StatusChanged,se.Snapshot,se.LocalChange,se.RemoteChange,se.Initialized,se.Watched,se.Unwatched,se.PresenceChanged].includes(n.type)}function fd(n){return n.every(dd)}let Lt="disconnected";const ta=new Map,Un=new Map;typeof window<"u"&&(window.docEventsForReplayByDocKey=Un);function Yn(n,e){(e!=null&&e.force||Lt!=="disconnected")&&window.postMessage({source:hd,...n},"*")}function gd(n){if(!n.isEnableDevtools()||typeof window>"u"||ta.has(n.getKey()))return;Un.set(n.getKey(),[]);const e=n.subscribe("all",t=>{fd(t)&&(Un.get(n.getKey()).push(t),Lt==="synced"&&Yn({msg:"doc::sync::partial",docKey:n.getKey(),event:t}))});ta.set(n.getKey(),[e]),Yn({msg:"refresh-devtools"},{force:!0}),window.addEventListener("message",t=>{var s;if(((s=t.data)==null?void 0:s.source)!==ld)return;switch(t.data.msg){case"devtools::connect":if(Lt!=="disconnected")break;Lt="connected",Yn({msg:"doc::available",docKey:n.getKey()}),S.info(`[YD] Devtools connected. Doc: ${n.getKey()}`);break;case"devtools::disconnect":Lt="disconnected",S.info(`[YD] Devtools disconnected. Doc: ${n.getKey()}`);break;case"devtools::subscribe":Lt="synced",Yn({msg:"doc::sync::full",docKey:n.getKey(),events:Un.get(n.getKey())}),S.info(`[YD] Devtools subscribed. Doc: ${n.getKey()}`);break}})}var nt=(n=>(n.Detached="detached",n.Attached="attached",n.Removed="removed",n))(nt||{}),se=(n=>(n.StatusChanged="status-changed",n.ConnectionChanged="connection-changed",n.SyncStatusChanged="sync-status-changed",n.Snapshot="snapshot",n.LocalChange="local-change",n.RemoteChange="remote-change",n.Initialized="initialized",n.Watched="watched",n.Unwatched="unwatched",n.PresenceChanged="presence-changed",n.AuthError="auth-error",n))(se||{}),on=(n=>(n.Connected="connected",n.Disconnected="disconnected",n))(on||{}),rs=(n=>(n.Synced="synced",n.SyncFailed="sync-failed",n))(rs||{});class rt{constructor(e,t){h(this,"key");h(this,"status");h(this,"opts");h(this,"maxSizeLimit");h(this,"schemaRules");h(this,"changeID");h(this,"checkpoint");h(this,"localChanges");h(this,"root");h(this,"presences");h(this,"clone");h(this,"internalHistory");h(this,"isUpdating");h(this,"onlineClients");h(this,"eventStream");h(this,"eventStreamObserver");h(this,"history");this.key=e,this.status="detached",this.opts=t||{},this.maxSizeLimit=0,this.schemaRules=[],this.changeID=oh,this.checkpoint=ah,this.localChanges=[],this.root=sn.create(),this.presences=new Map,this.onlineClients=new Set,this.internalHistory=new sd,this.isUpdating=!1,this.eventStream=_o(r=>this.eventStreamObserver=r),this.history={canUndo:()=>this.internalHistory.hasUndo()&&!this.isUpdating,canRedo:()=>this.internalHistory.hasRedo()&&!this.isUpdating,undo:()=>this.executeUndoRedo(!0),redo:()=>this.executeUndoRedo(!1)},gd(this)}update(e,t){var a,c,u;if(this.getStatus()==="removed")throw new f(d.ErrDocumentRemoved,`${this.key} is removed`);this.ensureClone();const r=this.changeID.getActorID(),s=tn.create(this.changeID,this.clone.root,this.clone.presences.get(r)||{},t);try{const l=Ho(s,this.clone.root.getObject());this.presences.has(r)||this.clone.presences.set(r,{}),this.isUpdating=!0,e(l,new qo(s,this.clone.presences.get(r)))}catch(l){throw this.clone=void 0,l}finally{this.isUpdating=!1}const i=this.getSchemaRules();if(!s.isPresenceOnlyChange()&&i.length){const l=id((a=this.clone)==null?void 0:a.root.getObject(),i);if(!l.valid)throw this.clone=void 0,new f(d.ErrDocumentSchemaValidationFailed,`schema validation failed: ${(c=l.errors)==null?void 0:c.map(g=>g.message).join(", ")}`)}const o=Hl((u=this.clone)==null?void 0:u.root.getDocSize());if(!s.isPresenceOnlyChange()&&this.maxSizeLimit>0&&this.maxSizeLimit<o)throw this.clone=void 0,new f(d.ErrDocumentSizeExceedsLimit,`document size exceeded: ${o} > ${this.maxSizeLimit}`);if(s.hasChange()){S.isEnabled(le.Trivial)&&S.trivial(`trying to update a local change: ${this.toJSON()}`);const l=s.toChange(),{opInfos:g,reverseOps:b}=l.execute(this.root,this.presences,J.Local);for(const A of l.getOperations())A instanceof Xe&&this.internalHistory.reconcileCreatedAt(A.getCreatedAt(),A.getValue().getCreatedAt());const m=s.getReversePresence();m&&b.push({type:"presence",value:m}),this.localChanges.push(l),b.length&&this.internalHistory.pushUndo(b),g.length&&this.internalHistory.clearRedo(),this.changeID=s.getNextID();const y=[];g.length&&y.push({type:"local-change",source:J.Local,value:{message:l.getMessage()||"",operations:g,actor:r,clientSeq:l.getID().getClientSeq(),serverSeq:l.getID().getServerSeq()},rawChange:this.isEnableDevtools()?l.toStruct():void 0}),l.hasPresenceChange()&&y.push({type:"presence-changed",source:J.Local,value:{clientID:r,presence:this.getPresence(r)}}),this.publish(y),S.isEnabled(le.Trivial)&&S.trivial(`after update a local change: ${this.toJSON()}`)}}subscribe(e,t,r,s){if(typeof e=="string"){if(typeof t!="function")throw new f(d.ErrInvalidArgument,"Second argument must be a callback function");if(e==="presence"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type!=="initialized"&&u.type!=="watched"&&u.type!=="unwatched"&&u.type!=="presence-changed"||a(u)},r,s)}if(e==="my-presence"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type!=="initialized"&&u.type!=="presence-changed"||u.type==="presence-changed"&&u.value.clientID!==this.changeID.getActorID()||a(u)},r,s)}if(e==="others"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type!=="watched"&&u.type!=="unwatched"&&u.type!=="presence-changed"||u.value.clientID!==this.changeID.getActorID()&&a(u)},r,s)}if(e==="connection"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type==="connection-changed"&&a(u)},r,s)}if(e==="status"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type==="status-changed"&&a(u)},r,s)}if(e==="sync"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type==="sync-status-changed"&&a(u)},r,s)}if(e==="auth-error"){const a=t;return this.eventStream.subscribe(c=>{for(const u of c)u.type==="auth-error"&&a(u)},r)}if(e==="all"){const a=t;return this.eventStream.subscribe(a,r,s)}const i=e,o=t;return this.eventStream.subscribe(a=>{for(const c of a){if(c.type!=="local-change"&&c.type!=="remote-change")continue;const u=[];for(const l of c.value.operations)this.isSameElementOrChildOf(l.path,i)&&u.push(l);u.length&&o({...c,value:{...c.value,operations:u}})}},r,s)}if(typeof e=="function"){const i=e,o=t,a=r;return this.eventStream.subscribe(c=>{for(const u of c)u.type!=="snapshot"&&u.type!=="local-change"&&u.type!=="remote-change"||i(u)},o,a)}throw new f(d.ErrInvalidArgument,`"${e}" is not a valid`)}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}applyChangePack(e){e.hasSnapshot()?this.applySnapshot(e.getCheckpoint().getServerSeq(),e.getVersionVector(),e.getSnapshot(),e.getCheckpoint().getClientSeq()):(this.applyChanges(e.getChanges(),J.Remote),this.removePushedLocalChanges(e.getCheckpoint().getClientSeq())),this.checkpoint=this.checkpoint.forward(e.getCheckpoint()),e.hasSnapshot()||this.garbageCollect(e.getVersionVector()),e.getIsRemoved()&&this.applyStatus("removed"),S.isEnabled(le.Trivial)&&S.trivial(`${this.root.toJSON()}`)}getCheckpoint(){return this.checkpoint}getChangeID(){return this.changeID}hasLocalChanges(){return this.localChanges.length>0}ensureClone(){this.clone||(this.clone={root:this.root.deepcopy(),presences:Ne(this.presences)})}createChangePack(){const e=Array.from(this.localChanges),t=this.checkpoint.increaseClientSeq(e.length);return Dn.create(this.key,t,!1,e,this.getVersionVector())}setActor(e){for(const t of this.localChanges)t.setActor(e);this.changeID=this.changeID.setActor(e)}isEnableDevtools(){return!!this.opts.enableDevtools}getKey(){return this.key}getStatus(){return this.status}getClone(){return this.clone}getCloneRoot(){if(this.clone)return this.clone.root.getObject()}getRoot(){this.ensureClone();const e=tn.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});return Ho(e,this.clone.root.getObject())}getDocSize(){return this.root.getDocSize()}getMaxSizePerDocument(){return this.maxSizeLimit}setMaxSizePerDocument(e){this.maxSizeLimit=e}getSchemaRules(){return this.schemaRules}setSchemaRules(e){this.schemaRules=e}garbageCollect(e){return this.opts.disableGC?0:(this.clone&&this.clone.root.garbageCollect(e),this.root.garbageCollect(e))}getRootObject(){return this.root.getObject()}getGarbageLen(){return this.root.getGarbageLen()}getRootCRDT(){return this.root}getGarbageLenFromClone(){return this.clone.root.getGarbageLen()}toJSON(){return this.root.toJSON()}toSortedJSON(){return this.root.toSortedJSON()}getStats(){return this.root.getStats()}toJSForTest(){return{...this.getRoot().toJSForTest(),key:"root"}}applySnapshot(e,t,r,s=-1){const{root:i,presences:o}=K.bytesToSnapshot(r);this.root=new sn(i),this.presences=o,this.changeID=this.changeID.setClocks(t.maxLamport(),t),this.clone=void 0,this.removePushedLocalChanges(s),this.applyChanges(this.localChanges,J.Local),this.clearHistory(),this.publish([{type:"snapshot",source:J.Remote,value:{serverSeq:e.toString(),snapshot:this.isEnableDevtools()?K.bytesToHex(r):void 0,snapshotVector:K.versionVectorToHex(t)}}])}clearHistory(){this.internalHistory.clearRedo(),this.internalHistory.clearUndo()}applyChanges(e,t){S.isEnabled(le.Debug)&&S.debug(`trying to apply ${e.length} remote changes.elements:${this.root.getElementMapSize()}, removeds:${this.root.getGarbageElementSetSize()}`),S.isEnabled(le.Trivial)&&S.trivial(e.map(r=>`${r.getID().toTestString()}	${r.toTestString()}`).join(`
`));for(const r of e)this.applyChange(r,t);S.isEnabled(le.Debug)&&S.debug(`after appling ${e.length} remote changes.elements:${this.root.getElementMapSize()},  removeds:${this.root.getGarbageElementSetSize()}`)}applyChange(e,t){var a;this.ensureClone(),e.execute(this.clone.root,this.clone.presences,t);const r=[],s=e.getID().getActorID();if(e.hasPresenceChange()&&this.onlineClients.has(s)){const c=e.getPresenceChange();switch(c.type){case De.Put:r.push(this.presences.has(s)?{type:"presence-changed",source:t,value:{clientID:s,presence:c.presence}}:{type:"watched",source:J.Remote,value:{clientID:s,presence:c.presence}});break;case De.Clear:r.push({type:"unwatched",source:J.Remote,value:{clientID:s,presence:this.getPresence(s)}}),this.removeOnlineClient(s);break}}const{opInfos:i,operations:o}=e.execute(this.root,this.presences,t);for(const c of o)if(c instanceof et){const[u,l]=c.normalizePos(this.root);this.internalHistory.reconcileTextEdit(c.getParentCreatedAt(),u,l,((a=c.getContent())==null?void 0:a.length)??0)}if(this.changeID=this.changeID.syncClocks(e.getID()),i.length){const c=this.isEnableDevtools()?e.toStruct():void 0;r.push(t===J.Remote?{type:"remote-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:c}:{type:"local-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:c})}r.length&&this.publish(r)}applyWatchInit(e){const t=new Set;for(const r of e)r!==this.changeID.getActorID()&&t.add(r);this.setOnlineClients(t);for(const r of Array.from(this.presences.keys()))r!==this.changeID.getActorID()&&!t.has(r)&&this.presences.delete(r);this.publish([{type:"initialized",source:J.Local,value:this.getPresences()}])}applyDocEvent(e,t){const r=[];if(e===Nn.DOCUMENT_WATCHED){if(this.onlineClients.has(t)&&this.hasPresence(t))return;this.addOnlineClient(t),this.hasPresence(t)&&r.push({type:"watched",source:J.Remote,value:{clientID:t,presence:this.getPresence(t)}})}else if(e===Nn.DOCUMENT_UNWATCHED){const s=this.getPresence(t);this.removeOnlineClient(t),this.presences.delete(t),s&&r.push({type:"unwatched",source:J.Remote,value:{clientID:t,presence:s}})}r.length&&this.publish(r)}applyStatus(e){this.status=e,e==="detached"&&this.setActor(Lr),this.publish([{source:e==="removed"?J.Remote:J.Local,type:"status-changed",value:e==="attached"?{status:e,actorID:this.changeID.getActorID()}:{status:e}}])}applyDocEventsForReplay(e){for(const t of e){if(t.type==="status-changed"){this.applyStatus(t.value.status),t.value.status==="attached"&&this.setActor(t.value.actorID);continue}if(t.type==="snapshot"){const{snapshot:r,serverSeq:s,snapshotVector:i}=t.value;if(!r)continue;this.applySnapshot(BigInt(s),K.hexToVersionVector(i),K.hexToBytes(r));continue}if(t.type==="local-change"||t.type==="remote-change"){if(!t.rawChange)continue;const r=Ct.fromStruct(t.rawChange);this.applyChange(r,t.source)}if(t.type==="initialized"){const r=new Set;for(const{clientID:s,presence:i}of t.value)r.add(s),this.presences.set(s,i);this.setOnlineClients(r)}else if(t.type==="watched"){const{clientID:r,presence:s}=t.value;this.addOnlineClient(r),this.presences.set(r,s)}else if(t.type==="unwatched"){const{clientID:r}=t.value;this.removeOnlineClient(r),this.presences.delete(r)}else if(t.type==="presence-changed"){const{clientID:r,presence:s}=t.value;this.presences.set(r,s)}}}getValueByPath(e){if(!e.startsWith("$"))throw new f(d.ErrInvalidArgument,'path must start with "$"');const t=e.split(".");t.shift();let r=this.getRoot();for(const s of t)if(r=r[s],!r)return;return r}setOnlineClients(e){this.onlineClients=e}resetOnlineClients(){this.onlineClients=new Set}addOnlineClient(e){this.onlineClients.add(e)}removeOnlineClient(e){this.onlineClients.delete(e)}hasPresence(e){return this.presences.has(e)}getMyPresence(){if(this.status!=="attached")return{};const e=this.presences.get(this.changeID.getActorID());return e?Ne(e):{}}getOthersPresences(){const e=[],t=this.changeID.getActorID();for(const r of this.onlineClients)r!==t&&this.presences.has(r)&&e.push({clientID:r,presence:Ne(this.presences.get(r))});return e}getPresence(e){if(e===this.changeID.getActorID())return this.getMyPresence();if(!this.onlineClients.has(e))return;const t=this.presences.get(e);return t?Ne(t):void 0}getPresences(){const e=[];e.push({clientID:this.changeID.getActorID(),presence:Ne(this.getMyPresence())});for(const t of this.onlineClients)this.presences.has(t)&&e.push({clientID:t,presence:Ne(this.presences.get(t))});return e}getPresenceForTest(e){const t=this.presences.get(e);return t?Ne(t):void 0}getSelfForTest(){return{clientID:this.getChangeID().getActorID(),presence:this.getMyPresence()}}getOthersForTest(){const e=this.getChangeID().getActorID();return this.getPresences().filter(t=>t.clientID!==e).sort((t,r)=>t.clientID>r.clientID?1:-1)}getUndoStackForTest(){return this.internalHistory.getUndoStackForTest()}getRedoStackForTest(){return this.internalHistory.getRedoStackForTest()}getVersionVector(){return this.changeID.getVersionVector()}isSameElementOrChildOf(e,t){if(t===e)return!0;const r=e.split(".");return t.split(".").every((s,i)=>s===r[i])}removePushedLocalChanges(e){for(;this.localChanges.length&&!(this.localChanges[0].getID().getClientSeq()>e);)this.localChanges.shift()}executeUndoRedo(e){if(this.isUpdating)throw new f(d.ErrRefused,`${e?"Undo":"Redo"} is not allowed during an update`);const t=e?this.internalHistory.popUndo():this.internalHistory.popRedo();if(!t)throw new f(d.ErrRefused,`There is no operation to be ${e?"undone":"redone"}`);this.ensureClone();const r=tn.create(this.changeID,this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const l of t){if(!(l instanceof Se)){new qo(r,Ne(this.clone.presences.get(this.changeID.getActorID()))).set(l.value,{addToHistory:!0});continue}const g=r.issueTimeTicket();if(l.setExecutedAt(g),l instanceof Xe){const b=l.getCreatedAt();l.getValue().setCreatedAt(g),this.internalHistory.reconcileCreatedAt(b,g)}else if(l instanceof Qe){const b=l.getValue().getCreatedAt();l.getValue().setCreatedAt(g),this.internalHistory.reconcileCreatedAt(b,g)}r.push(l)}const s=r.toChange();s.execute(this.clone.root,this.clone.presences,J.UndoRedo);const{opInfos:i,reverseOps:o}=s.execute(this.root,this.presences,J.UndoRedo),a=r.getReversePresence();if(a&&o.push({type:"presence",value:a}),o.length&&(e?this.internalHistory.pushRedo(o):this.internalHistory.pushUndo(o)),!s.hasPresenceChange()&&!i.length)return;this.localChanges.push(s),this.changeID=r.getNextID();const c=this.changeID.getActorID(),u=[];i.length&&u.push({type:"local-change",source:J.UndoRedo,value:{message:s.getMessage()||"",operations:i,actor:c,clientSeq:s.getID().getClientSeq(),serverSeq:s.getID().getServerSeq()},rawChange:this.isEnableDevtools()?s.toStruct():void 0}),s.hasPresenceChange()&&u.push({type:"presence-changed",source:J.UndoRedo,value:{clientID:c,presence:this.getPresence(c)}}),this.publish(u)}}class na{constructor(e,t,r,s){h(this,"resource");h(this,"resourceID");h(this,"syncMode");h(this,"changeEventReceived");h(this,"lastHeartbeatTime");h(this,"reconnectStreamDelay");h(this,"cancelled");h(this,"watchStream");h(this,"watchLoopTimerID");h(this,"watchAbortController");this.reconnectStreamDelay=e,this.resource=t,this.resourceID=r,this.syncMode=s,this.changeEventReceived=s!==void 0?!1:void 0,this.lastHeartbeatTime=Date.now(),this.cancelled=!1}changeSyncMode(e){this.syncMode=e}needRealtimeSync(){return this.syncMode===un.RealtimeSyncOff?!1:this.syncMode===un.RealtimePushOnly?this.resource.hasLocalChanges():this.syncMode!==un.Manual&&(this.resource.hasLocalChanges()||(this.changeEventReceived??!1))}needSync(e){return this.resource instanceof rt?this.needRealtimeSync():this.syncMode===un.Manual?!1:Date.now()-this.lastHeartbeatTime>=e}updateHeartbeatTime(){this.lastHeartbeatTime=Date.now()}async runWatchLoop(e){const t=async()=>{if(this.watchStream)return Promise.resolve();this.watchLoopTimerID&&(clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0);try{[this.watchStream,this.watchAbortController]=await e(()=>{this.watchStream=void 0,this.watchAbortController=void 0,this.cancelled||(this.watchLoopTimerID=setTimeout(t,this.reconnectStreamDelay))})}catch{}};await t()}cancelWatchStream(){this.cancelled=!0,this.watchStream&&this.watchAbortController&&(this.watchAbortController.abort(),this.watchStream=void 0,this.watchAbortController=void 0),clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0}}function md(n,e){let t=e;return{authInterceptor:i=>async o=>(n&&o.header.set("x-api-key",n),t&&o.header.set("authorization",t),await i(o)),setToken:i=>{t=i}}}const ra={name:"@yorkie-js/sdk",version:"0.6.49"};function pd(n){return e=>async t=>(n?t.header.set("x-yorkie-user-agent",n):t.header.set("x-yorkie-user-agent",ra.name+"/"+ra.version),await e(t))}const bd=n=>{try{if(JSON.stringify(n)===void 0)return!1}catch{return!1}return!0};var an=(n=>(n.Detached="detached",n.Attached="attached",n.Removed="removed",n))(an||{}),Bt=(n=>(n.PresenceChanged="presence-changed",n.Initialized="initialized",n.Broadcast="broadcast",n.LocalBroadcast="local-broadcast",n.AuthError="auth-error",n))(Bt||{});const cn=".";class _e{constructor(e){h(this,"key");h(this,"status");h(this,"actorID");h(this,"sessionID");h(this,"sessionCount");h(this,"seq");h(this,"eventStream");h(this,"eventStreamObserver");this.validateChannelKey(e),this.key=e,this.status="detached",this.sessionCount=0,this.seq=0,this.eventStream=_o(t=>this.eventStreamObserver=t)}getKey(){return this.key}getFirstKeyPath(){return this.key.split(cn)[0]}getStatus(){return this.status}applyStatus(e){this.status=e}isAttached(){return this.status==="attached"}getActorID(){return this.actorID}setActor(e){this.actorID=e}getSessionID(){return this.sessionID}setSessionID(e){this.sessionID=e}getSessionCount(){return this.sessionCount}updateSessionCount(e,t){return t===0||t>this.seq?(this.sessionCount=e,this.seq=t,!0):!1}hasLocalChanges(){return!1}subscribe(e,t){if(typeof e=="function")return this.eventStream.subscribe(e);const r=e,s=t;if(!s)throw new Error("callback is required when subscribing to specific event type or topic");if(r==="broadcast")return this.eventStream.subscribe(o=>{o.type==="broadcast"&&s(o)});if(r==="local-broadcast")return this.eventStream.subscribe(o=>{o.type==="local-broadcast"&&s(o)});if(r==="auth-error")return this.eventStream.subscribe(o=>{o.type==="auth-error"&&s(o)});if(r==="presence")return this.eventStream.subscribe(o=>{(o.type==="presence-changed"||o.type==="initialized")&&s(o)});if(r==="all")return this.eventStream.subscribe(s);const i=r;return this.eventStream.subscribe(o=>{o.type==="broadcast"&&o.topic===i&&s(o)})}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}broadcast(e,t,r){if(this.status!=="attached")throw new Error(`channel is not attached: ${this.status}`);if(!this.actorID)throw new Error("actorID is not set");this.publish({type:"local-broadcast",clientID:this.actorID,topic:e,payload:t,options:r})}validateChannelKey(e){if(e==="")throw new Error("channel key must not be empty");if(e.includes(" "))throw new Error("channel key must not contain a whitespace");if(e.startsWith(cn))throw new Error("channel key must not start with a period");if(e.endsWith(cn))throw new Error("channel key must not end with a period");if(e.includes(`${cn}${cn}`))throw new Error("channel key path must not empty")}}function sa(n,e,t){const{stream:r,ac:s,isInit:i,onResponse:o,onStreamEnd:a,onError:c,onDisconnect:u,shouldIgnoreError:l}=n;return new Promise((g,b)=>{(async()=>{try{let y=!1;for await(const A of r)o(A),!y&&i(A)&&(y=!0,g([r,s]));a(),u()}catch(y){if(l&&l(y))return;c(y),await e(y)?u():t(),b(y)}})()})}var un=(n=>(n.Manual="manual",n.Realtime="realtime",n.RealtimePushOnly="realtime-pushonly",n.RealtimeSyncOff="realtime-syncoff",n))(un||{});const Wt={rpcAddr:"https://api.yorkie.dev",syncLoopDuration:50,retrySyncLoopDelay:1e3,reconnectStreamDelay:1e3,channelHeartbeatInterval:3e4},ss={maxRetries:1/0,initialRetryInterval:1e3,maxBackoff:2e4};class ia{constructor(e){h(this,"id");h(this,"key");h(this,"metadata");h(this,"status");h(this,"attachmentMap");h(this,"apiKey");h(this,"authTokenInjector");h(this,"conditions");h(this,"syncLoopDuration");h(this,"reconnectStreamDelay");h(this,"retrySyncLoopDelay");h(this,"channelHeartbeatInterval");h(this,"rpcClient");h(this,"setAuthToken");h(this,"taskQueue");h(this,"processing",!1);h(this,"keepalive",!1);e=e||Wt;const t=e.rpcAddr||Wt.rpcAddr;this.key=e.key||Xo(),this.metadata=e.metadata||{},this.status="deactivated",this.attachmentMap=new Map,this.apiKey=e.apiKey||"",this.authTokenInjector=e.authTokenInjector,this.conditions={SyncLoop:!1,WatchLoop:!1},this.syncLoopDuration=e.syncLoopDuration??Wt.syncLoopDuration,this.reconnectStreamDelay=e.reconnectStreamDelay??Wt.reconnectStreamDelay,this.retrySyncLoopDelay=e.retrySyncLoopDelay??Wt.retrySyncLoopDelay,this.channelHeartbeatInterval=e.channelHeartbeatInterval??Wt.channelHeartbeatInterval;const{authInterceptor:r,setToken:s}=md(this.apiKey);this.setAuthToken=s,this.rpcClient=Ku(Jl,fl({baseUrl:t,interceptors:[r,pd(e==null?void 0:e.userAgent)],fetch:(i,o)=>fetch(i,{...o,keepalive:this.keepalive})})),this.taskQueue=[]}async activate(){if(this.isActive())return Promise.resolve();if(this.authTokenInjector){const e=await this.authTokenInjector();this.setAuthToken(e)}return this.enqueueTask(async()=>{try{const e=await this.rpcClient.activateClient({clientKey:this.key,metadata:this.metadata},{headers:{"x-shard-key":`${this.apiKey}/${this.key}`}});this.id=e.clientId,this.status="activated",this.runSyncLoop(),S.info(`[AC] c:"${this.getKey()}" activated, id:"${this.id}"`),typeof window<"u"&&window.addEventListener("beforeunload",async()=>{await this.deactivate({keepalive:!0})})}catch(e){throw S.error(`[AC] c:"${this.getKey()}" err :`,e),await this.handleConnectError(e),e}})}deactivate(e={keepalive:!1,synchronous:!1}){if(this.status==="deactivated")return Promise.resolve();const t=async()=>{try{await this.rpcClient.deactivateClient({clientId:this.id,synchronous:e.synchronous},{headers:{"x-shard-key":`${this.apiKey}/${this.key}`}}),this.deactivateInternal(),S.info(`[DC] c"${this.getKey()}" deactivated`)}catch(r){throw S.error(`[DC] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}};if(e.keepalive){this.keepalive=!0;const r=t();return this.keepalive=!1,r}return this.enqueueTask(t)}has(e){return this.attachmentMap.has(e)}attach(e,t){return e instanceof _e?this.attachChannel(e,t):this.attachDocument(e,t)}attachDocument(e,t={}){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);if(e.getStatus()!==nt.Detached)throw new f(d.ErrNotDetached,`${e.getKey()} is not detached`);e.setActor(this.id),e.update((s,i)=>i.set(t.initialPresence||{}));const r=t.syncMode??"realtime";return this.enqueueTask(async()=>{try{const s=await this.rpcClient.attachDocument({clientId:this.id,changePack:K.toChangePack(e.createChangePack()),schemaKey:t.schema},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}});(s.maxSizePerDocument??0)>0&&e.setMaxSizePerDocument(s.maxSizePerDocument),s.schemaRules.length>0&&e.setSchemaRules(K.fromSchemaRules(s.schemaRules));const o=K.fromChangePack(s.changePack);if(e.applyChangePack(o),e.getStatus()===nt.Removed)return e;e.applyStatus(nt.Attached),this.attachmentMap.set(e.getKey(),new na(this.reconnectStreamDelay,e,s.documentId,r)),r!=="manual"&&await this.runWatchLoop(e.getKey()),S.info(`[AD] c:"${this.getKey()}" attaches d:"${e.getKey()}"`);const a=e.getRootObject();if(t.initialRoot){const c=t.initialRoot;e.update(u=>{for(const[l,g]of Object.entries(c))if(!a.has(l)){const b=l;u[b]=g}})}return e}catch(s){throw S.error(`[AD] c:"${this.getKey()}" err :`,s),await this.handleConnectError(s),s}})}detach(e,t){return e instanceof _e?this.detachChannel(e):this.detachDocument(e,t)}detachDocument(e,t={keepalive:!1}){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new f(d.ErrNotAttached,`${e.getKey()} is not attached`);e.update((i,o)=>o.clear());const s=async()=>{try{const i=await this.rpcClient.detachDocument({clientId:this.id,documentId:r.resourceID,changePack:K.toChangePack(e.createChangePack())},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}),o=K.fromChangePack(i.changePack);return e.applyChangePack(o),e.getStatus()!==nt.Removed&&e.applyStatus(nt.Detached),this.detachInternal(e.getKey()),S.info(`[DD] c:"${this.getKey()}" detaches d:"${e.getKey()}"`),e}catch(i){throw S.error(`[DD] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}};if(t.keepalive){this.keepalive=!0;const i=s();return this.keepalive=!1,i}return this.enqueueTask(s)}async attachChannel(e,t={}){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);if(e.getStatus()!==an.Detached)throw new f(d.ErrNotDetached,`${e.getKey()} is not detached`);e.setActor(this.id);const r=async()=>{try{const s=await this.rpcClient.attachChannel({clientId:this.id,channelKey:e.getKey()},{headers:{"x-shard-key":`${this.apiKey}/${e.getFirstKeyPath()}`}});e.setSessionID(s.sessionId),e.updateSessionCount(Number(s.sessionCount),0),e.applyStatus(an.Attached);const i=t.isRealtime!==!1?"realtime":"manual",o=new na(this.reconnectStreamDelay,e,s.sessionId,i);return e.subscribe("local-broadcast",a=>{const{topic:c,payload:u,options:l}=a;this.broadcast(e.getKey(),c,u,l).catch(g=>{l!=null&&l.error&&l.error(g),S.error(`[BC] c:"${this.getKey()}" failed: ${g}`)})}),this.attachmentMap.set(e.getKey(),o),i==="realtime"&&await this.runWatchLoop(e.getKey()),S.info(`[AP] c:"${this.getKey()}" attaches p:"${e.getKey()}" mode:${i} count:${e.getSessionCount()}`),e}catch(s){throw S.error(`[AP] c:"${this.getKey()}" err :`,s),await this.handleConnectError(s),s}};return this.enqueueTask(r)}async detachChannel(e){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);if(!this.attachmentMap.has(e.getKey()))throw new f(d.ErrNotAttached,`${e.getKey()} is not attached`);const t=async()=>{try{const r=await this.rpcClient.detachChannel({clientId:this.id,channelKey:e.getKey(),sessionId:e.getSessionID()},{headers:{"x-shard-key":`${this.apiKey}/${e.getFirstKeyPath()}`}});return e.updateSessionCount(Number(r.sessionCount),0),e.applyStatus(an.Detached),this.detachInternal(e.getKey()),S.info(`[DP] c:"${this.getKey()}" detaches p:"${e.getKey()}" count:${e.getSessionCount()}`),e}catch(r){throw S.error(`[DP] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}};return this.enqueueTask(t)}async changeSyncMode(e,t){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new f(d.ErrNotAttached,`${e.getKey()} is not attached`);const s=r.syncMode;return s===t?e:(r.changeSyncMode(t),t==="manual"?(r.cancelWatchStream(),e):(t==="realtime"&&(r.changeEventReceived=!0),s==="manual"&&await this.runWatchLoop(e.getKey()),e))}sync(e){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);if(e instanceof _e){const t=this.attachmentMap.get(e.getKey());if(!t)throw new f(d.ErrNotAttached,`${e.getKey()} is not attached`);return this.enqueueTask(async()=>this.syncInternal(t).catch(async r=>{throw S.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}))}if(e instanceof rt){const t=this.attachmentMap.get(e.getKey());if(!t)throw new f(d.ErrNotAttached,`${e.getKey()} is not attached`);return this.enqueueTask(async()=>this.syncInternal(t,"realtime").catch(async r=>{throw S.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}))}return this.enqueueTask(async()=>{const t=[];for(const[,r]of this.attachmentMap)r.syncMode!==void 0&&r.resource instanceof rt&&t.push(this.syncInternal(r,r.syncMode));return Promise.all(t).catch(async r=>{throw S.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r})})}remove(e){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);const t=this.attachmentMap.get(e.getKey());if(!t)throw new f(d.ErrNotAttached,`${e.getKey()} is not attached`);e.setActor(this.id);const r=K.toChangePack(e.createChangePack());return r.isRemoved=!0,this.enqueueTask(async()=>{try{const s=await this.rpcClient.removeDocument({clientId:this.id,documentId:t.resourceID,changePack:r},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}),i=K.fromChangePack(s.changePack);e.applyChangePack(i),this.detachInternal(e.getKey()),S.info(`[RD] c:"${this.getKey()}" removes d:"${e.getKey()}"`)}catch(s){throw S.error(`[RD] c:"${this.getKey()}" err :`,s),await this.handleConnectError(s),s}})}getID(){return this.id}getKey(){return this.key}isActive(){return this.status==="activated"}getStatus(){return this.status}getCondition(e){return this.conditions[e]}async createRevision(e,t,r){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);const s=this.attachmentMap.get(e.getKey());if(!s)throw new f(d.ErrNotAttached,`${e.getKey()} is not attached`);const i=async()=>{try{const o=await this.rpcClient.createRevision({clientId:this.id,documentId:s.resourceID,label:t,description:r||""},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}});if(!o.revision)throw new f(d.ErrInvalidArgument,"revision is not returned");return S.info(`[CR] c:"${this.getKey()}" creates revision d:"${e.getKey()}" l:"${t}"`),K.toRevisionSummary(o.revision)}catch(o){throw S.error(`[CR] c:"${this.getKey()}" err :`,o),await this.handleConnectError(o),o}};return this.enqueueTask(i)}async listRevisions(e,t){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new f(d.ErrNotAttached,`${e.getKey()} is not attached`);const s=async()=>{try{const i=await this.rpcClient.listRevisions({clientId:this.id,documentId:r.resourceID,pageSize:(t==null?void 0:t.pageSize)||10,offset:(t==null?void 0:t.offset)||0,isForward:(t==null?void 0:t.isForward)??!1},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}});return S.info(`[LR] c:"${this.getKey()}" lists revisions d:"${e.getKey()}" count:${i.revisions.length}`),i.revisions.map(K.toRevisionSummary)}catch(i){throw S.error(`[LR] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}};return this.enqueueTask(s)}async getRevision(e,t){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new f(d.ErrNotAttached,`${e.getKey()} is not attached`);const s=async()=>{try{const i=await this.rpcClient.getRevision({clientId:this.id,documentId:r.resourceID,revisionId:t},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}});if(!i.revision)throw new f(d.ErrInvalidArgument,"revision is not returned");return S.info(`[GR] c:"${this.getKey()}" gets revision d:"${e.getKey()}" r:"${t}"`),K.toRevisionSummary(i.revision)}catch(i){throw S.error(`[GR] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}};return this.enqueueTask(s)}async restoreRevision(e,t){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new f(d.ErrNotAttached,`${e.getKey()} is not attached`);const s=async()=>{try{await this.rpcClient.restoreRevision({clientId:this.id,documentId:r.resourceID,revisionId:t},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}),S.info(`[RR] c:"${this.getKey()}" restores revision d:"${e.getKey()}" r:"${t}"`)}catch(i){throw S.error(`[RR] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}};return this.enqueueTask(s)}async broadcast(e,t,r,s){if(!this.isActive())throw new f(d.ErrClientNotActivated,`${this.key} is not active`);const i=this.attachmentMap.get(e);if(!i)throw new f(d.ErrNotAttached,`${e} is not attached`);if(!bd(r))throw new f(d.ErrInvalidArgument,"payload is not serializable");const o=i.resource,a=(s==null?void 0:s.maxRetries)??ss.maxRetries,c=ss.maxBackoff;let u=0;const l=b=>Math.min(ss.initialRetryInterval*2**b,c),g=async()=>this.enqueueTask(async()=>{try{await this.rpcClient.broadcast({clientId:this.id,channelKey:e,topic:t,payload:new TextEncoder().encode(JSON.stringify(r))},{headers:{"x-shard-key":`${this.apiKey}/${o.getFirstKeyPath()}`}}),S.info(`[BC] c:"${this.getKey()}" broadcasts p:"${e}" t:"${t}"`)}catch(b){if(S.error(`[BC] c:"${this.getKey()}" err:`,b),await this.handleConnectError(b))if(Mr(b,d.ErrUnauthenticated)&&i.resource instanceof _e&&i.resource.publish({type:Bt.AuthError,reason:qt(b).reason||"unauthenticated",method:"Broadcast"}),u<a)u++,setTimeout(()=>g(),l(u-1)),S.info(`[BC] c:"${this.getKey()}" retry attempt ${u}/${a}`);else throw S.error(`[BC] c:"${this.getKey()}" exceeded maximum retry attempts`),b}});return g()}runSyncLoop(){const e=async()=>{if(!this.isActive()){S.debug(`[SL] c:"${this.getKey()}" exit sync loop`),this.conditions.SyncLoop=!1;return}try{await this.enqueueTask(async()=>{const t=[];for(const[,r]of this.attachmentMap)r.needSync(this.channelHeartbeatInterval)&&(r.changeEventReceived!==void 0&&(r.changeEventReceived=!1),t.push(this.syncInternal(r,r.syncMode).catch(s=>{throw Mr(s,d.ErrUnauthenticated)&&r.resource.publish([{type:se.AuthError,value:{reason:qt(s).reason,method:"PushPull"}}]),s})));await Promise.all(t),setTimeout(e,this.syncLoopDuration)})}catch(t){S.error(`[SL] c:"${this.getKey()}" sync failed:`,t),await this.handleConnectError(t)?setTimeout(e,this.retrySyncLoopDelay):this.conditions.SyncLoop=!1}};S.debug(`[SL] c:"${this.getKey()}" run sync loop`),this.conditions.SyncLoop=!0,e()}async runWatchLoop(e){const t=this.attachmentMap.get(e);if(!t)throw new f(d.ErrNotAttached,`${e} is not attached`);return this.conditions.WatchLoop=!0,t.runWatchLoop(r=>{if(!this.isActive())return this.conditions.WatchLoop=!1,Promise.reject(new f(d.ErrClientNotActivated,`${this.key} is not active`));if(!this.attachmentMap.has(e))return this.conditions.WatchLoop=!1,Promise.reject(new f(d.ErrNotAttached,`${e} is not attached`));const s=new AbortController;return t.resource instanceof rt?this.createDocumentWatchStream(t,e,s,r):t.resource instanceof _e?this.createChannelWatchStream(t,e,s,r):Promise.reject(new f(d.ErrClientNotActivated,`Unknown resource type for ${e}`))})}createDocumentWatchStream(e,t,r,s){const i=this.rpcClient.watch({clientId:this.id,resources:[{resource:{case:"document",value:{documentId:e.resourceID}}}]},{headers:{"x-shard-key":`${this.apiKey}/${t}`},signal:r.signal});e.resource.publish([{type:se.ConnectionChanged,value:on.Connected}]),S.info(`[WD] c:"${this.getKey()}" watches d:"${t}"`),e.changeEventReceived!==void 0&&(e.changeEventReceived=!0);const o=()=>{e.resource.resetOnlineClients(),e.resource.publish([{type:se.Initialized,source:J.Local,value:e.resource.getPresences()}]),e.resource.publish([{type:se.ConnectionChanged,value:on.Disconnected}])};return sa({stream:i,ac:r,isInit:a=>a.body.case==="initialization",onResponse:a=>this.handleWatchDocumentResponse(e,a),onStreamEnd:()=>{o(),S.debug(`[WD] c:"${this.getKey()}" unwatches (stream ended)`)},onError:a=>{o(),S.debug(`[WD] c:"${this.getKey()}" unwatches`),Mr(a,d.ErrUnauthenticated)&&e.resource.publish([{type:se.AuthError,value:{reason:qt(a).reason,method:"Watch"}}])},onDisconnect:s},a=>this.handleConnectError(a),()=>{this.conditions.WatchLoop=!1})}createChannelWatchStream(e,t,r,s){const i=this.rpcClient.watch({clientId:this.id,resources:[{resource:{case:"channel",value:{channelKey:t}}}]},{headers:{"x-shard-key":`${this.apiKey}/${e.resource.getFirstKeyPath()}`},signal:r.signal});return S.info(`[WP] c:"${this.getKey()}" watches p:"${t}"`),sa({stream:i,ac:r,isInit:o=>o.body.case==="initialization",onResponse:o=>this.handleWatchChannelResponse(e,o),onStreamEnd:()=>{S.debug(`[WP] c:"${this.getKey()}" p:"${t}" stream ended`)},onError:o=>{S.debug(`[WP] c:"${this.getKey()}" p:"${t}" err:`,o)},onDisconnect:s,shouldIgnoreError:o=>o instanceof Error&&o.name==="AbortError"?(S.debug(`[WP] c:"${this.getKey()}" p:"${t}" stream aborted`),!0):!1},o=>this.handleConnectError(o),()=>{this.conditions.WatchLoop=!1})}handleWatchChannelResponse(e,t){const r=e.resource;if(t.body.case==="initialization"){for(const s of t.body.value.resourceInits)if(s.init.case==="channelInit"){const{sessionCount:i,seq:o}=s.init.value;r.updateSessionCount(Number(i),Number(o))&&r.publish({type:Bt.Initialized,count:Number(i)})}return}if(t.body.case==="event"){const s=t.body.value;if(s.event.case==="channelEvent"){const i=s.event.value.event;if(!i)return;if(i.type===lo.BROADCAST){const o=new TextDecoder;try{const a=JSON.parse(o.decode(i.payload));r.publish({type:Bt.Broadcast,clientID:i.publisher,topic:i.topic,payload:a})}catch(a){S.error(`[WP] c:"${this.getKey()}" failed to parse broadcast payload:`,a)}return}r.updateSessionCount(Number(i.sessionCount),Number(i.seq))&&r.publish({type:Bt.PresenceChanged,count:Number(i.sessionCount)})}}}handleWatchDocumentResponse(e,t){var r;if(t.body.case==="initialization"){for(const s of t.body.value.resourceInits)s.init.case==="documentInit"&&e.resource.applyWatchInit(s.init.value.clientIds);return}if(t.body.case==="event"){const s=t.body.value;if(s.event.case==="docEvent"){const i=s.event.value;if(((r=i.event)==null?void 0:r.type)===Nn.DOCUMENT_CHANGED){e.changeEventReceived!==void 0&&(e.changeEventReceived=!0);return}i.event&&e.resource.applyDocEvent(i.event.type,i.event.publisher)}}}deactivateInternal(){this.status="deactivated";for(const[e,t]of this.attachmentMap)this.detachInternal(e),t.resource instanceof rt?t.resource.applyStatus(nt.Detached):t.resource instanceof _e&&t.resource.applyStatus(an.Detached)}detachInternal(e){const t=this.attachmentMap.get(e);t&&(t.cancelWatchStream(),t.resource instanceof rt&&t.resource.resetOnlineClients(),this.attachmentMap.delete(e))}async syncInternal(e,t){const{resource:r}=e;if(r instanceof _e){try{const a=await this.rpcClient.refreshChannel({clientId:this.id,channelKey:r.getKey(),sessionId:r.getSessionID()},{headers:{"x-shard-key":`${this.apiKey}/${r.getFirstKeyPath()}`}});r.updateSessionCount(Number(a.sessionCount),0),e.updateHeartbeatTime(),S.debug(`[RP] c:"${this.getKey()}" refreshes p:"${r.getKey()}" mode:${e.syncMode}`)}catch(a){throw S.error(`[RP] c:"${this.getKey()}" err :`,a),a}return r}const s=r,{resourceID:i}=e,o=s.createChangePack();try{const a=await this.rpcClient.pushPullChanges({clientId:this.id,documentId:i,changePack:K.toChangePack(o),pushOnly:t==="realtime-pushonly"},{headers:{"x-shard-key":`${this.apiKey}/${s.getKey()}`}}),c=K.fromChangePack(a.changePack);if(c.hasChanges()&&(e.syncMode==="realtime-pushonly"||e.syncMode==="realtime-syncoff"))return s;s.applyChangePack(c),e.resource.publish([{type:se.SyncStatusChanged,value:rs.Synced}]),s.getStatus()===nt.Removed&&this.detachInternal(s.getKey());const u=s.getKey(),l=c.getChangeSize();return S.info(`[PP] c:"${this.getKey()}" sync d:"${u}", push:${o.getChangeSize()} pull:${l} cp:${c.getCheckpoint().toTestString()}`),s}catch(a){throw s.publish([{type:se.SyncStatusChanged,value:rs.SyncFailed}]),S.error(`[PP] c:"${this.getKey()}" err :`,a),a}}async handleConnectError(e){if(!(e instanceof Y))return!1;if(e.code===L.Canceled||e.code===L.Unknown||e.code===L.ResourceExhausted||e.code===L.Unavailable)return!0;if(Dt(e)===d.ErrUnauthenticated){if(this.authTokenInjector){const t=await this.authTokenInjector(qt(e).reason);this.setAuthToken(t)}return!0}return Dt(e)===d.ErrTooManySubscribers?(S.error(`[WD] c:"${this.getKey()}" err :`,e.rawMessage),!0):(Dt(e)===d.ErrTooManyAttachments||(Dt(e)===d.ErrClientNotActivated||Dt(e)===d.ErrClientNotFound)&&this.deactivateInternal(),!1)}enqueueTask(e){return new Promise((t,r)=>{this.taskQueue.push(()=>e().then(t).catch(r)),this.processing||this.processNext()})}async processNext(){if(this.taskQueue.length===0){this.processing=!1;return}try{this.processing=!0,await this.taskQueue.shift()()}catch{S.error(`[TQ] c:"${this.getKey()}" process failed, id:"${this.id}"`)}this.processNext()}}function oa(n){return typeof n=="object"&&n!==null&&n.type==="Text"&&Array.isArray(n.nodes)}function aa(n){return typeof n=="object"&&n!==null&&n.type==="Tree"&&typeof n.root=="object"}function ca(n){return typeof n=="object"&&n!==null&&n.type==="Int"&&typeof n.value=="number"}function ua(n){return typeof n=="object"&&n!==null&&n.type==="Long"&&typeof n.value=="number"}function la(n){return typeof n=="object"&&n!==null&&n.type==="Date"&&typeof n.value=="string"}function ha(n){return typeof n=="object"&&n!==null&&n.type==="BinData"&&typeof n.value=="string"}function da(n){return typeof n=="object"&&n!==null&&n.type==="Counter"&&typeof n.value=="object"}function yd(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&!oa(n)&&!aa(n)&&!ca(n)&&!ua(n)&&!la(n)&&!ha(n)&&!da(n)}function Ad(n){try{const e=vd(n),t=JSON.parse(e);return Gn(t)}catch(e){throw new f(d.ErrInvalidArgument,`Failed to parse YSON: ${e instanceof Error?e.message:String(e)}`)}}function vd(n){let e=n;return e=e.replace(/Counter\((Int|Long)\((-?\d+)\)\)/g,(t,r,s)=>`{"__yson_type":"Counter","__yson_data":{"__yson_type":"${r}","__yson_data":${s}}}`),e=e.replace(/Int\((-?\d+)\)/g,(t,r)=>`{"__yson_type":"Int","__yson_data":${r}}`),e=e.replace(/Long\((-?\d+)\)/g,(t,r)=>`{"__yson_type":"Long","__yson_data":${r}}`),e=e.replace(/Date\("([^"]*)"\)/g,(t,r)=>`{"__yson_type":"Date","__yson_data":"${r}"}`),e=e.replace(/BinData\("([^"]*)"\)/g,(t,r)=>`{"__yson_type":"BinData","__yson_data":"${r}"}`),e=e.replace(/Text\((\[(?:[^[\]]|\[(?:[^[\]]|\[[^[\]]*\])*\])*\])\)/g,(t,r)=>`{"__yson_type":"Text","__yson_data":${r}}`),e=e.replace(/Tree\((\{[^{}]*(?:\{[^{}]*(?:\{[^{}]*\})*[^{}]*\})*[^{}]*\})\)/g,(t,r)=>`{"__yson_type":"Tree","__yson_data":${r}}`),e}function Gn(n){if(n===null||typeof n!="object")return n;if(n.__yson_type==="Int"&&typeof n.__yson_data=="number")return{type:"Int",value:n.__yson_data};if(n.__yson_type==="Long"&&typeof n.__yson_data=="number")return{type:"Long",value:n.__yson_data};if(n.__yson_type==="Date"&&typeof n.__yson_data=="string")return{type:"Date",value:n.__yson_data};if(n.__yson_type==="BinData"&&typeof n.__yson_data=="string")return{type:"BinData",value:n.__yson_data};if(n.__yson_type==="Counter"&&typeof n.__yson_data=="object"){const t=Gn(n.__yson_data);if(typeof t=="object"&&t!==null&&"type"in t&&(t.type==="Int"||t.type==="Long"))return{type:"Counter",value:t};throw new f(d.ErrInvalidArgument,"Counter must contain Int or Long")}if(n.__yson_type==="Text"&&Array.isArray(n.__yson_data))return{type:"Text",nodes:n.__yson_data.map(t=>Sd(t))};if(n.__yson_type==="Tree"&&typeof n.__yson_data=="object")return{type:"Tree",root:fa(n.__yson_data)};if(Array.isArray(n))return n.map(t=>Gn(t));const e={};for(const[t,r]of Object.entries(n))e[t]=Gn(r);return e}function Sd(n){if(typeof n!="object"||n===null||typeof n.val!="string")throw new f(d.ErrInvalidArgument,"invalid text node format");const e={val:n.val};return n.attrs&&typeof n.attrs=="object"&&(e.attrs=n.attrs),e}function fa(n){if(typeof n!="object"||n===null||typeof n.type!="string")throw new f(d.ErrInvalidArgument,"invalid tree node format");const e={type:n.type};return n.type==="text"&&typeof n.value=="string"?(e.value=n.value,e):(n.attrs&&typeof n.attrs=="object"&&(e.attrs=n.attrs),Array.isArray(n.children)&&(e.children=n.children.map(t=>fa(t))),e)}function Id(n){return n.nodes.map(e=>e.val).join("")}function Ed(n){return ga(n.root)}function ga(n){const e=n.attrs?Object.entries(n.attrs).map(([r,s])=>` ${r}="${ma(s)}"`).join(""):"";if(n.type==="text"&&n.value!==void 0)return`<${n.type}${e}>${ma(n.value)}</${n.type}>`;if(!n.children||n.children.length===0)return`<${n.type}${e} />`;const t=n.children.map(r=>ga(r)).join("");return`<${n.type}${e}>${t}</${n.type}>`}function ma(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}const Nd=Object.freeze(Object.defineProperty({__proto__:null,isBinData:ha,isCounter:da,isDate:la,isInt:ca,isLong:ua,isObject:yd,isText:oa,isTree:aa,parse:Ad,textToString:Id,treeToXML:Ed},Symbol.toStringTag,{value:"Module"}));Oe.Int,Oe.Long,typeof globalThis<"u"&&(globalThis.yorkie={Client:ia,Document:rt,Primitive:X,Text:Hr,Counter:qr,Tree:ns,Channel:_e,ChannelEventType:Bt,YSON:Nd,LogLevel:le,setLogLevel:jh,IntType:Oe.Int,LongType:Oe.Long});const Fn={name:"@yorkie-js/react",version:"0.6.49"},pa=W.createContext({client:void 0,loading:!0,error:void 0});function ba(n){const[e,t]=W.useState(void 0),[r,s]=W.useState(!0),[i,o]=W.useState(void 0),[a,c]=W.useState(!1);return W.useEffect(()=>{c(!0)},[]),W.useEffect(()=>{s(!0),o(void 0);async function u(){if(a)try{const l=new ia(n);await l.activate(),t(l)}catch(l){o(l instanceof Error?l:new Error("Failed to activate client"))}finally{s(!1)}}return u(),()=>{e!=null&&e.isActive()&&e.deactivate({keepalive:!0})}},[n.apiKey,n.rpcAddr,a]),{client:e,loading:r,error:i}}const wd=({children:n,...e})=>{const t=W.useMemo(()=>({userAgent:Fn.name+"/"+Fn.version,...e}),[e.apiKey,e.rpcAddr]),{client:r,loading:s,error:i}=ba(t);return kt.jsx(pa.Provider,{value:{client:r,loading:s,error:i},children:n})},is=()=>{const n=W.useContext(pa);if(!n)throw new Error("useYorkie must be used under YorkieProvider");return{client:n.client,loading:n.loading,error:n.error}};function ya(n){const e=new Set;let t=n;const r=()=>{e.forEach(c=>c(t))};return{subscribe:c=>(e.add(c),()=>e.delete(c)),getSnapshot:()=>t,setState:c=>{const u=t;t=typeof c=="function"?c(u):c,u!==t&&r()},destroy:()=>{e.clear()}}}const Aa=n=>ya(n);function Te(n,e,t=Object.is){const r=W.useRef(e),s=W.useRef(t),i=W.useRef(void 0);r.current=e,s.current=t;const o=()=>{const a=n.getSnapshot(),c=r.current?r.current(a):a;return i.current!==void 0&&s.current(i.current,c)?i.current:(i.current=c,c)};return W.useSyncExternalStore(n.subscribe,o,o)}function va(n){return n!=null&&typeof n[Symbol.iterator]=="function"}function Sa(n){return"entries"in n&&typeof n.entries=="function"}function Rd(n,e){const t=n instanceof Map?n:new Map(n.entries()),r=e instanceof Map?e:new Map(e.entries());if(t.size!==r.size)return!1;for(const[s,i]of t)if(!r.has(s)||!Object.is(i,r.get(s)))return!1;return!0}function Cd(n,e){const t=n[Symbol.iterator](),r=e[Symbol.iterator]();let s=t.next(),i=r.next();for(;!s.done&&!i.done;){if(!Object.is(s.value,i.value))return!1;s=t.next(),i=r.next()}return s.done===i.done}function Td(n,e){const t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(const s of t)if(!Object.prototype.hasOwnProperty.call(e,s)||!Object.is(n[s],e[s]))return!1;return!0}function Ia(n,e){if(Object.is(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null||Object.getPrototypeOf(n)!==Object.getPrototypeOf(e))return!1;const t=va(n),r=va(e);return t!==r?!1:t&&r?Sa(n)&&Sa(e)?Rd(n,e):Cd(n,e):Td(n,e)}function Ea(n,e,t,r,s,i,o,a){const c=W.useRef(s),u=W.useRef(i),[l,g]=W.useState(!1);W.useEffect(()=>{g(!0)},[]),W.useEffect(()=>{if(t){a.setState(A=>({...A,loading:!1,error:t}));return}if(!n||e||!l){a.setState(A=>({...A,loading:!0}));return}a.setState(A=>({...A,loading:!0,error:void 0}));const b=new rt(r,{enableDevtools:o}),m=[];m.push(b.subscribe(()=>{a.setState(A=>({...A,root:b.getRoot()}))})),m.push(b.subscribe("presence",()=>{a.setState(A=>({...A,presences:b.getPresences()}))})),m.push(b.subscribe("connection",A=>{a.setState(I=>({...I,connection:A.value}))}));async function y(){try{await(n==null?void 0:n.attach(b,{initialRoot:c.current,initialPresence:u.current}));const A=I=>{try{b.update(I)}catch(E){a.setState(C=>({...C,error:E instanceof Error?E:new Error("Failed to update document")}))}};a.setState(I=>({...I,doc:b,root:b.getRoot(),presences:b.getPresences(),update:A}))}catch(A){a.setState(I=>({...I,error:A instanceof Error?A:new Error("Failed to attach document")}))}finally{a.setState(A=>({...A,loading:!1}))}}return y(),()=>{n&&n.has(r)&&n.detach(b);for(const A of m)A()}},[n,e,t,r,a,l])}const Kn=W.createContext(void 0),Vd=({docKey:n,initialRoot:e={},initialPresence:t={},enableDevtools:r=!1,children:s})=>{const{client:i,loading:o,error:a}=is(),c=W.useRef(void 0);c.current||(c.current=Aa({doc:void 0,root:e,presences:[],connection:on.Disconnected,update:()=>{},loading:!0,error:void 0}));const u=c.current;return Ea(i,o,a,n,e,t,r,u),kt.jsx(Kn.Provider,{value:u,children:s})};function Dd(){const n=W.useContext(Kn);if(!n)throw new Error("useDocument must be used within a DocumentProvider");return Te(n)}const xd=()=>(n,e=Ia)=>{const t=W.useContext(Kn);if(!t)throw new Error("useDocument must be used within a DocumentProvider");return Te(t,n,e)},Ld=()=>{const n=Mn("useRoot");return{root:Te(n,t=>t.root)}},Bd=()=>{const n=Mn("usePresences");return Te(n,e=>e.presences)},Wd=()=>{const n=Mn("useConnection");return Te(n,e=>e.connection)},kd=()=>{const{client:n}=is(),e=Mn("useRevisions"),t=Te(e,a=>a.doc),r=W.useCallback(async(a,c)=>{if(!n||!t)throw new Error("Client or document is not ready");return n.createRevision(t,a,c)},[n,t]),s=W.useCallback(async a=>{if(!n||!t)throw new Error("Client or document is not ready");return n.listRevisions(t,a)},[n,t]),i=W.useCallback(async a=>{if(!n||!t)throw new Error("Client or document is not ready");return n.getRevision(t,a)},[n,t]),o=W.useCallback(async a=>{if(!n||!t)throw new Error("Client or document is not ready");return n.restoreRevision(t,a)},[n,t]);return{createRevision:r,listRevisions:s,getRevision:i,restoreRevision:o}},Mn=n=>{const e=W.useContext(Kn);if(!e)throw new Error(`${n} must be used within a DocumentProvider`);return e};function Od(n,e,t){const r=W.useRef(void 0);r.current||(r.current=Aa({doc:void 0,root:(t==null?void 0:t.initialRoot)??{},presences:[],connection:on.Disconnected,update:()=>{},loading:!0,error:void 0}));const s=r.current,i=W.useMemo(()=>({apiKey:n,userAgent:Fn.name+"/"+Fn.version,...t}),[n,t]),{client:o,loading:a,error:c}=ba(i);Ea(o,a,c,e,(t==null?void 0:t.initialRoot)??{},(t==null?void 0:t.initialPresence)??{},(t==null?void 0:t.enableDevtools)??!1,s);const u=Te(s);return{root:u.root,presences:u.presences,connection:u.connection,update:u.update,loading:u.loading,error:u.error}}function Pd(n){return ya(n)}const Na=W.createContext(void 0);function Zd(n,e,t,r,s,i){const o=W.useRef(void 0),[a,c]=W.useState(!1);W.useEffect(()=>{c(!0)},[]),W.useEffect(()=>{if(!a||e||t||!n){t&&i.setState(g=>({...g,error:t,loading:!1}));return}let u;async function l(){if(!(!n||!n.isActive())){i.setState(g=>({...g,loading:!0,error:void 0}));try{const g=new _e(r);await n.attach(g,{isRealtime:s}),o.current=g,u=g.subscribe(()=>{i.setState(b=>({...b,sessionCount:g.getSessionCount()}))}),i.setState({channel:g,sessionCount:g.getSessionCount(),loading:!1,error:void 0})}catch(g){i.setState(b=>({...b,loading:!1,error:g instanceof Error?g:new Error("Failed to attach channel")}))}}}return l(),()=>{u&&u();async function g(){if(o.current&&(n!=null&&n.isActive()))try{await n.detach(o.current)}catch(b){console.error("Failed to detach channel:",b)}}g()}},[n,e,t,r,s,a])}const Ud=({children:n,channelKey:e,isRealtime:t=!0})=>{const{client:r,loading:s,error:i}=is(),o=W.useRef(void 0);o.current||(o.current=Pd({channel:void 0,sessionCount:0,loading:!0,error:void 0}));const a=o.current;return Zd(r,s,i,e,t,a),kt.jsx(Na.Provider,{value:a,children:n})},wa=n=>{const e=W.useContext(Na);if(!e)throw new Error(`${n} must be used within ChannelProvider`);return e},Yd=()=>{const n=wa("useChannel"),e=Te(n,s=>s.sessionCount),t=Te(n,s=>s.loading),r=Te(n,s=>s.error);return{sessionCount:e,loading:t,error:r}},Gd=()=>{const n=wa("useChannelSessionCount");return Te(n,e=>e.sessionCount)};ie.ChannelProvider=Ud,ie.DocumentProvider=Vd,ie.YorkieProvider=wd,ie.createDocumentSelector=xd,ie.shallowEqual=Ia,ie.useChannel=Yd,ie.useChannelSessionCount=Gd,ie.useConnection=Wd,ie.useDocument=Dd,ie.usePresences=Bd,ie.useRevisions=kd,ie.useRoot=Ld,ie.useYorkieDoc=Od,Object.defineProperty(ie,Symbol.toStringTag,{value:"Module"})})}(ln,ln.exports)),ln.exports}var of=_d();export{of as y};
